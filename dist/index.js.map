{"version":3,"file":"index.js","sources":["../src/constants/styles.js","../src/constants/index.js","../src/utils/view.js","../src/controls/GoToPlace/index.js","../src/MapGrid/index.js","../src/controls/MapControls/index.js","../src/MapWrapper/index.js","../src/MapSet/index.js","../src/controls/MapTools/index.js","../src/Map.js","../src/ReactLeafletMap/viewHelpers.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/svg.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/Cross.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/Pin.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/MarkerShape.js","../src/ReactLeafletMap/layers/SvgVectorLayer/helpers.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/genericCanvasLayer.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/helpers.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/shapes.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/polygons.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/lines.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/LeafletCanvasLayer.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/index.js","../src/ReactLeafletMap/layers/IndexedVectorLayer/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/ContextWrapper.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/GeoJsonLayer/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/index.js","../src/ReactLeafletMap/layers/TiledVectorLayer/Tile.js","../src/ReactLeafletMap/layers/TiledVectorLayer/index.js","../src/ReactLeafletMap/layers/VectorLayer/index.js","../src/ReactLeafletMap/layers/WMSLayer/leaflet.wms.js","../src/ReactLeafletMap/layers/WMSLayer/index.js","../src/ReactLeafletMap/layers/TileGridLayer/index.js","../src/utils/viewport.js","../src/ReactLeafletMap/index.js","../src/controls/SimpleLayersControl/index.js","../src/WorldWindMap/controllers/WorldWindowControllerDecorator/index.js","../src/WorldWindMap/layers/VectorLayer.js","../src/WorldWindMap/layers/OsmLayer.js","../src/WorldWindMap/layers/WikimediaLayer.js","../src/WorldWindMap/layers/WmsLayer.js","../src/WorldWindMap/layers/WmtsLayer.js","../src/WorldWindMap/layers/LargeDataLayerSource/canvasShapes.js","../src/WorldWindMap/layers/LargeDataLayerSource/LargeDataLayerTile.js","../src/WorldWindMap/layers/LargeDataLayerSource/LargeDataLayer.js","../src/WorldWindMap/layers/helpers.js","../src/WorldWindMap/navigator/helpers.js","../src/WorldWindMap/index.js","../src/controls/LoadableMapControls/presentationEmpty.js","../src/controls/LoadableMapControls/index.js","../src/LoadableMap/presentationEmpty.js","../src/LoadableMapSet/index.js","../src/LoadableReactLeafletMap/index.js","../src/LoadableMap/index.js","../src/index.js"],"sourcesContent":["/* Vector feature basic style */\nconst defaultVectorFeatureStyle = {\n\tfill: '#ffffff',\n\tfillOpacity: 0.8,\n\toutlineColor: '#000000',\n\toutlineWidth: 2,\n\toutlineOpacity: 1,\n};\n\nconst selectedVectorFeatureStyle = {\n\toutlineWidth: 3,\n\toutlineColor: '#ff00ff',\n\toutlineOpacity: 1,\n};\n\nconst hoveredVectorFeatureStyle = {\n\toutlineWidth: 3,\n\toutlineColor: '#00ffff',\n\toutlineOpacity: 1,\n};\n\nconst selectedHoveredVectorFeatureStyle = {\n\toutlineWidth: 3,\n\toutlineColor: '#8800ff',\n\toutlineOpacity: 1,\n};\n\nconst vectorFeatureStyle = {\n\tdefault: defaultVectorFeatureStyle,\n\tdefaultFull: {rules: [{styles: [defaultVectorFeatureStyle]}]},\n\thovered: hoveredVectorFeatureStyle,\n\tselected: selectedVectorFeatureStyle,\n\tselectedHovered: selectedHoveredVectorFeatureStyle,\n};\n\n/* Diagram basic style */\nconst defaultDiagramStyle = {\n\tdiagramFill: '#87c7ff',\n\tdiagramFillOpacity: 1,\n\tdiagramOutlineColor: '#3b80ff',\n\tdiagramOutlineWidth: 1,\n\tdiagramOutlineOpacity: 1,\n};\n\nconst selectedDiagramStyle = {\n\tdiagramOutlineWidth: 2,\n\tdiagramOutlineColor: '#ff00ff',\n\tdiagramOutlineOpacity: 1,\n};\n\nconst hoveredDiagramStyle = {\n\tdiagramOutlineWidth: 2,\n\tdiagramOutlineColor: '#00ffff',\n\tdiagramOutlineOpacity: 1,\n};\n\nconst selectedHoveredDiagramStyle = {\n\tdiagramOutlineWidth: 2,\n\tdiagramOutlineColor: '#8800ff',\n\tdiagramOutlineOpacity: 1,\n};\n\nconst diagramStyle = {\n\tdefault: defaultDiagramStyle,\n\tdefaultFull: {rules: {styles: [defaultDiagramStyle]}},\n\thovered: hoveredDiagramStyle,\n\tselected: selectedDiagramStyle,\n\tselectedHovered: selectedHoveredDiagramStyle,\n};\n\n/* TODO obsolete, remain due to backward compatibility */\nconst vectorLayerHighlightedFeatureStyle = {\n\tstrokeColor: '#00FFFF',\n\tstrokeWidth: 2,\n};\n\nconst vectorLayerDefaultFeatureStyle = {\n\tfillColor: null,\n\tfillOpacity: 0,\n\tstrokeColor: '#444',\n\tstrokeWidth: 2,\n};\n\nexport default {\n\tdiagramStyle,\n\tvectorFeatureStyle,\n\n\t/* TODO obsolete */\n\tvectorLayerHighlightedFeatureStyle,\n\tvectorLayerDefaultFeatureStyle,\n};\n","import styles from './styles';\n\n// Frameworks\n/** https://leafletjs.com/reference-1.6.0.html#map-overlaypane */\nconst defaultLeafletPaneZindex = 400;\n\n/* Max number of features rendered as React element in leaflet vector layer  */\nconst maxFeaturesAsReactElement = 100;\n\n// Projections\nconst projDefinitions = {\n\tepsg5514:\n\t\t'+proj=krovak +lat_0=49.5 +lon_0=24.83333333333333 +alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 +ellps=bessel +towgs84=589,76,480,0,0,0,0 +units=m +no_defs',\n};\n\nexport default {\n\tmaxFeaturesAsReactElement,\n\tdefaultLeafletPaneZindex,\n\tprojDefinitions,\n\t...styles,\n};\n","import {isArray as _isArray} from 'lodash';\n\n/**\n * Convert Web World Wind range to Panther boxRange\n * @param range {WorldWind.Navigator.range}\n * @param width {number} map width\n * @param height {number} map height\n * @return {number|*} Panther view box range\n */\nfunction getBoxRangeFromWorldWindRange(range, width, height) {\n\tif (width && width >= height) {\n\t\treturn (range * height) / width;\n\t} else {\n\t\treturn range;\n\t}\n}\n\n/**\n * Convert Panther boxRange to Web World Wind range\n * @param boxRange {number} Panther view boxRange\n * @param width {number} map width\n * @param height {number} map height\n * @return {number|*} WorldWind navigator range\n */\nfunction getWorldWindRangeFromBoxRange(boxRange, width, height) {\n\tif (width && width >= height) {\n\t\treturn (boxRange * width) / height;\n\t} else {\n\t\treturn boxRange;\n\t}\n}\n\n/**\n * Check if given boxRange is inside defined range. Lower limit is excluded, upper limit is included.\n * @param boxRange {number} map view boxRange\n * @param range {Array} boxRangeRange\n * @return {boolean}\n */\nfunction isBoxRangeInRange(boxRange, range) {\n\tif (_isArray(range)) {\n\t\t// both limits defined by number\n\t\tconst fitsInLimits = boxRange > range[0] && boxRange <= range[1];\n\n\t\t// without lower limit\n\t\tconst noLowerLimitLessThanUpper = !range[0] && boxRange <= range[1];\n\n\t\t// without upper limit\n\t\tconst noUpperLimitMoreThanLower = boxRange > range[0] && !range[1];\n\n\t\treturn (\n\t\t\tfitsInLimits || noLowerLimitLessThanUpper || noUpperLimitMoreThanLower\n\t\t);\n\t} else {\n\t\treturn false;\n\t}\n}\n\n/**\n * It compares center coordinates with limits. If given center is outside limit, adjusted center will be returned\n * @param center {{lat: number, lon: number}}\n * @param limit {{minLat: number, maxLat: number, minLon: number, maxLon: number}}\n * @return {{lat: number, lon: number}}\n */\nfunction getCenterWhichFitsLimits(center, limit) {\n\tif (!limit) {\n\t\treturn center;\n\t} else {\n\t\tlet updatedLat = null;\n\t\tlet updatedLon = null;\n\t\tconst givenLat = center.lat;\n\t\tconst givenLon = center.lon;\n\t\tconst maxLat = limit.maxLat;\n\t\tconst maxLon = limit.maxLon;\n\t\tconst minLat = limit.minLat;\n\t\tconst minLon = limit.minLon;\n\n\t\tif (givenLat >= maxLat) {\n\t\t\tupdatedLat = maxLat;\n\t\t}\n\n\t\tif (givenLat <= minLat) {\n\t\t\tupdatedLat = minLat;\n\t\t}\n\n\t\tif (givenLon >= maxLon) {\n\t\t\tupdatedLon = maxLon;\n\t\t}\n\n\t\tif (givenLon <= minLon) {\n\t\t\tupdatedLon = minLon;\n\t\t}\n\n\t\t// Don't mutate, if center fits limits\n\t\tif (!updatedLon && !updatedLat) {\n\t\t\treturn center;\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tlat: updatedLat || center.lat,\n\t\t\t\tlon: updatedLon || center.lon,\n\t\t\t};\n\t\t}\n\t}\n}\n\nexport default {\n\tgetBoxRangeFromWorldWindRange,\n\tgetCenterWhichFitsLimits,\n\tgetWorldWindRangeFromBoxRange,\n\tisBoxRangeInRange,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport './style.scss';\nimport {Icon, Input} from '@gisatcz/ptr-atoms';\n\nclass GoToPlace extends React.PureComponent {\n\tstatic propTypes = {\n\t\tgoToPlace: PropTypes.func,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\ttext: null,\n\t\t\tpreviousSearching: null,\n\t\t};\n\n\t\tthis.search = this.search.bind(this);\n\t\tthis.onTextChange = this.onTextChange.bind(this);\n\t}\n\n\tonTextChange(text) {\n\t\tthis.setState({text});\n\t}\n\n\tsearch(e) {\n\t\tif (\n\t\t\te.charCode === 13 &&\n\t\t\tthis.props.goToPlace &&\n\t\t\tthis.state.text !== this.state.previousSearching\n\t\t) {\n\t\t\tthis.props.goToPlace(this.state.text);\n\t\t\tthis.state.previousSearching = this.state.text;\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"ptr-go-to-place-box\" onKeyPress={this.search}>\n\t\t\t\t<Input\n\t\t\t\t\tplaceholder=\"Zoom to\"\n\t\t\t\t\tonChange={this.onTextChange}\n\t\t\t\t\tvalue={this.state.text}\n\t\t\t\t>\n\t\t\t\t\t<Icon icon=\"search\" />\n\t\t\t\t</Input>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default GoToPlace;\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport './style.scss';\n\nclass MapGrid extends React.PureComponent {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.ref = React.createRef();\n\n\t\tthis.state = {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.resize();\n\t\tif (typeof window !== 'undefined')\n\t\t\twindow.addEventListener('resize', this.resize.bind(this), {\n\t\t\t\tpassive: true,\n\t\t\t}); //todo IE\n\t}\n\n\tresize() {\n\t\tif (this.ref && this.ref.current) {\n\t\t\tlet width = this.ref.current.clientWidth;\n\t\t\tlet height = this.ref.current.clientHeight;\n\n\t\t\tthis.setState({\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t});\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"ptr-map-grid\" ref={this.ref}>\n\t\t\t\t{this.renderMaps()}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderMaps() {\n\t\tlet availableWidth = this.state.width;\n\t\tlet availableHeight = this.state.height;\n\n\t\tif (this.props.children.length && availableWidth && availableHeight) {\n\t\t\tlet sizeRatio = availableWidth / availableHeight;\n\t\t\tlet rows = 1,\n\t\t\t\tcolumns = 1;\n\n\t\t\tswitch (this.props.children.length) {\n\t\t\t\tcase 1:\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tif (sizeRatio > 1) {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tif (sizeRatio > 2) {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t} else if (sizeRatio < 0.6666) {\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tif (sizeRatio > 3) {\n\t\t\t\t\t\tcolumns = 4;\n\t\t\t\t\t} else if (sizeRatio < 0.5) {\n\t\t\t\t\t\trows = 4;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\tcase 6:\n\t\t\t\t\tif (sizeRatio > 1) {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 7:\n\t\t\t\tcase 8:\n\t\t\t\t\tif (sizeRatio > 2) {\n\t\t\t\t\t\tcolumns = 4;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t} else if (sizeRatio < 0.6666) {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 4;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 9:\n\t\t\t\t\tif (sizeRatio > 2.5) {\n\t\t\t\t\t\tcolumns = 5;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t} else if (sizeRatio < 0.5) {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 5;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (sizeRatio > 1) {\n\t\t\t\t\t\tcolumns = 4;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 4;\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet width = +(100 / columns).toFixed(4) + '%';\n\t\t\tlet height = +(100 / rows).toFixed(4) + '%';\n\n\t\t\tlet style = {width, height};\n\n\t\t\treturn this.props.children.map((map, index) => {\n\t\t\t\tindex++;\n\t\t\t\tlet rowNo = Math.ceil(index / columns);\n\t\t\t\tlet colNo = index % columns || columns;\n\n\t\t\t\tlet wrapperClasses = classNames(\n\t\t\t\t\t'ptr-map-grid-cell',\n\t\t\t\t\t'row' + rowNo,\n\t\t\t\t\t'col' + colNo,\n\t\t\t\t\tmap.props.wrapperClasses\n\t\t\t\t);\n\n\t\t\t\treturn (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={'map-grid-cell-' + index}\n\t\t\t\t\t\tclassName={wrapperClasses}\n\t\t\t\t\t\tstyle={style}\n\t\t\t\t\t>\n\t\t\t\t\t\t{map}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t});\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport default MapGrid;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport {Icon, Button} from '@gisatcz/ptr-atoms';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport './style.scss';\n\nclass MapControls extends React.PureComponent {\n\tstatic propTypes = {\n\t\tview: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\t\tupdateView: PropTypes.func,\n\t\tresetHeading: PropTypes.func,\n\t\tmapKey: PropTypes.string,\n\t\tzoomOnly: PropTypes.bool,\n\t\tlevelsBased: PropTypes.oneOfType([PropTypes.bool, PropTypes.array]),\n\t\tmapHeight: PropTypes.number,\n\t\tmapWidth: PropTypes.number,\n\t};\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.tiltIncrement = 5;\n\t\tthis.headingIncrement = 1.0;\n\t\tthis.zoomIncrement = 0.04;\n\t\tthis.exaggerationIncrement = 1;\n\n\t\tthis.state = {\n\t\t\tresetHeadingDisabled: false,\n\t\t};\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (\n\t\t\tthis.state.resetHeadingDisabled &&\n\t\t\t(!this.props.view.heading || this.props.heading === '360')\n\t\t) {\n\t\t\tthis.setState({\n\t\t\t\tresetHeadingDisabled: false,\n\t\t\t});\n\t\t}\n\t}\n\n\thandleTiltUp() {\n\t\tconst update = {tilt: this.props.view.tilt - this.tiltIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleTiltDown() {\n\t\tconst update = {tilt: this.props.view.tilt + this.tiltIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleHeadingRight() {\n\t\tconst update = {heading: this.props.view.heading - this.headingIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\thandleHeadingLeft() {\n\t\tconst update = {heading: this.props.view.heading + this.headingIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\thandleZoomIn() {\n\t\tlet update = null;\n\t\tif (this.props.levelsBased && this.props.view && this.props.view.boxRange) {\n\t\t\t// remove 1 from box range to prevent rounding issues\n\t\t\tupdate = {boxRange: (this.props.view.boxRange - 1) / 2};\n\t\t} else {\n\t\t\tupdate = {boxRange: this.props.view.boxRange * (1 - this.zoomIncrement)};\n\t\t}\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleZoomOut() {\n\t\tlet update;\n\t\tif (this.props.levelsBased && this.props.view && this.props.view.boxRange) {\n\t\t\t// add 1 to box range to prevent rounding issues\n\t\t\tupdate = {boxRange: this.props.view.boxRange * 2 + 1};\n\t\t} else {\n\t\t\tupdate = {boxRange: this.props.view.boxRange * (1 + this.zoomIncrement)};\n\t\t}\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleResetHeading() {\n\t\tthis.props.resetHeading(this.props.mapKey);\n\t\tthis.setState({\n\t\t\tresetHeadingDisabled: true,\n\t\t});\n\t}\n\n\thandleExaggeratePlus() {\n\t\t// const update = {elevation: this.props.view.elevation + this.exaggerationIncrement};\n\t\t// this.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleExaggerateMinus() {\n\t\t// const update = {elevation: Math.max(1, this.props.view.elevation - this.exaggerationIncrement)};\n\t\t// this.props.updateView(update, this.props.mapKey);\n\t}\n\n\tisZoomButtonActive(type) {\n\t\tconst definedLimits =\n\t\t\tthis.props.viewLimits && this.props.viewLimits.boxRangeRange;\n\t\tconst currentBoxRange = this.props.view && this.props.view.boxRange;\n\n\t\tif (this.props.levelsBased) {\n\t\t\tconst currentLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\tcurrentBoxRange,\n\t\t\t\tthis.props.mapWidth,\n\t\t\t\tthis.props.mapHeight\n\t\t\t);\n\n\t\t\tif (type === 'in') {\n\t\t\t\tlet maxZoom = mapConstants.defaultLevelsRange[1];\n\t\t\t\tif (definedLimits && definedLimits[0]) {\n\t\t\t\t\tlet definedLimitAsLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\tdefinedLimits[0],\n\t\t\t\t\t\tthis.props.mapWidth,\n\t\t\t\t\t\tthis.props.mapHeight\n\t\t\t\t\t);\n\t\t\t\t\tif (definedLimitAsLevel < maxZoom) {\n\t\t\t\t\t\tmaxZoom = definedLimitAsLevel;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn currentLevel < maxZoom;\n\t\t\t} else {\n\t\t\t\tlet minZoom = mapConstants.defaultLevelsRange[0];\n\t\t\t\tif (definedLimits && definedLimits[1]) {\n\t\t\t\t\tlet definedLimitAsLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\tdefinedLimits[1],\n\t\t\t\t\t\tthis.props.mapWidth,\n\t\t\t\t\t\tthis.props.mapHeight\n\t\t\t\t\t);\n\t\t\t\t\tif (definedLimitAsLevel > minZoom) {\n\t\t\t\t\t\tminZoom = definedLimitAsLevel;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn currentLevel > minZoom;\n\t\t\t}\n\t\t} else {\n\t\t\tif (type === 'in') {\n\t\t\t\tconst limit =\n\t\t\t\t\t(definedLimits && definedLimits[0]) || mapConstants.minBoxRange;\n\t\t\t\treturn currentBoxRange * (1 - this.zoomIncrement) >= limit;\n\t\t\t} else {\n\t\t\t\tconst limit =\n\t\t\t\t\t(definedLimits && definedLimits[1]) || mapConstants.maxBoxRange;\n\t\t\t\treturn currentBoxRange * (1 + this.zoomIncrement) <= limit;\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\t// TODO different controls for 2D\n\t\treturn (\n\t\t\t<div className=\"ptr-map-controls\">\n\t\t\t\t{/* <div className=\"exaggerate-control control\">\n                        <HoldButton \n                            pressCallback={() => {this.handleExaggerateMinus()}}\n                            onClick={() => {this.handleExaggerateMinus()}}\n                            onMouseDown={200}\n                            pressCallbackTimeout={20}\n                            finite={false}\n                        >\n                            <Icon style={{transform: 'rotate(90deg)'}} icon='arrow-left' width={22} height={22} viewBox={'0 0 34 34'}/>\n                        </HoldButton>\n                        <HoldButton \n                            pressCallback={() => {this.handleExaggerateMinus()}}\n                            onClick={() => {this.handleExaggerateMinus()}}\n                            onMouseDown={200}\n                            pressCallbackTimeout={20}\n                            finite={false}\n                        >\n                            <Icon style={{transform: 'rotate(-90deg)'}} icon='arrow-left' width={22} height={22} viewBox={'0 0 34 34'}/>\n                        </HoldButton>\n                    </div> */}\n\t\t\t\t<div className=\"zoom-control control\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\tthis.handleZoomIn();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tthis.handleZoomIn();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!this.isZoomButtonActive('in')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon=\"plus-thick\" />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\tthis.handleZoomOut();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tthis.handleZoomOut();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!this.isZoomButtonActive('out')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon=\"minus-thick\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t{!this.props.zoomOnly ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<div className=\"rotate-control control\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingRight();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingRight();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"rotate-right\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleResetHeading();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tdisabled={this.state.resetHeadingDisabled}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\ttransform: `rotate(${\n\t\t\t\t\t\t\t\t\t\t\tthis.props.view ? -this.props.view.heading : 0\n\t\t\t\t\t\t\t\t\t\t}deg)`,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ticon=\"north-arrow\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingLeft();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingLeft();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"rotate-left\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"tilt-control control\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"tilt-more-control\"\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltDown();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltDown();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"tilt-more\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"tilt-more-control\"\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltUp();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltUp();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"tilt-less\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t) : null}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default MapControls;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\n\nimport './style.scss';\nimport {Button} from '@gisatcz/ptr-atoms';\n\nclass MapWrapper extends React.PureComponent {\n\tstatic propTypes = {\n\t\tactive: PropTypes.bool,\n\t\ttitle: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),\n\t\tonMapRemove: PropTypes.func,\n\t};\n\n\tstatic defaultProps = {\n\t\ttitle: false,\n\t};\n\n\trender() {\n\t\tconst props = this.props;\n\t\tconst wrapperClasses = classNames('ptr-map-wrapper', {\n\t\t\tactive: this.props.active,\n\t\t});\n\n\t\treturn (\n\t\t\t<div className={wrapperClasses}>\n\t\t\t\t<div className=\"ptr-map-wrapper-header\">\n\t\t\t\t\t{props.onMapRemove ? this.renderCloseButton() : null}\n\t\t\t\t\t{props.title ? this.renderTitle() : null}\n\t\t\t\t</div>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderTitle() {\n\t\tlet title = this.props.title;\n\t\tif (title === true) {\n\t\t\ttitle = this.props.name || this.props.mapKey || 'Map';\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"ptr-map-wrapper-title\" title={title}>\n\t\t\t\t{title}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderCloseButton() {\n\t\tlet mapKey = this.props.stateMapKey || this.props.mapKey;\n\n\t\treturn (\n\t\t\t<div className=\"ptr-map-wrapper-close-button\">\n\t\t\t\t<Button\n\t\t\t\t\ticon=\"times\"\n\t\t\t\t\tinverted\n\t\t\t\t\tinvisible\n\t\t\t\t\tonClick={this.props.onMapRemove.bind(this, mapKey)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default MapWrapper;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n\tforEach as _forEach,\n\tisEmpty as _isEmpty,\n\tmapValues as _mapValues,\n\tpickBy as _pickBy,\n} from 'lodash';\n\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\n\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport MapGrid from '../MapGrid';\n\nimport './style.scss';\nimport MapWrapper from '../MapWrapper';\n\nclass Map extends React.PureComponent {\n\trender() {\n\t\treturn null;\n\t}\n}\n\nclass PresentationMap extends React.PureComponent {\n\trender() {\n\t\treturn null;\n\t}\n}\n\nclass MapSet extends React.PureComponent {\n\tstatic defaultProps = {\n\t\tdisableMapRemoval: false,\n\t};\n\n\tstatic propTypes = {\n\t\tactiveMapKey: PropTypes.string,\n\t\tactiveMapView: PropTypes.object,\n\t\tactiveMapViewport: PropTypes.object,\n\t\tdisableMapRemoval: PropTypes.bool,\n\t\tmapSetKey: PropTypes.string,\n\t\tmaps: PropTypes.array,\n\t\tmapComponent: PropTypes.func,\n\t\tview: PropTypes.object,\n\t\tstateMapSetKey: PropTypes.string,\n\t\tsync: PropTypes.object,\n\t\twrapper: PropTypes.oneOfType([\n\t\t\tPropTypes.elementType,\n\t\t\tPropTypes.element,\n\t\t\tPropTypes.bool,\n\t\t]),\n\t\twrapperProps: PropTypes.object,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tif (!props.stateMapSetKey) {\n\t\t\tthis.state = {\n\t\t\t\tview: mapUtils.view.mergeViews(mapConstants.defaultMapView, props.view),\n\n\t\t\t\tactiveMapKey: props.activeMapKey,\n\t\t\t\tmapViews: {},\n\t\t\t\tmapsDimensions: {},\n\t\t\t};\n\n\t\t\t_forEach(this.props.children, child => {\n\t\t\t\tif (\n\t\t\t\t\tchild &&\n\t\t\t\t\ttypeof child === 'object' &&\n\t\t\t\t\t(child.type === Map ||\n\t\t\t\t\t\tchild.type === this.props.connectedMapComponent ||\n\t\t\t\t\t\tchild.type === PresentationMap) &&\n\t\t\t\t\tchild.props.mapKey === props.activeMapKey\n\t\t\t\t) {\n\t\t\t\t\tthis.state.mapViews[child.props.mapKey] = mapUtils.view.mergeViews(\n\t\t\t\t\t\tmapConstants.defaultMapView,\n\t\t\t\t\t\tprops.view,\n\t\t\t\t\t\tchild.props.view\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.state = {\n\t\t\t\tmapsDimensions: {},\n\t\t\t};\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif (this.props.onMount) {\n\t\t\tthis.props.onMount();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (this.props.onUnmount) {\n\t\t\tthis.props.onUnmount();\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tconst props = this.props;\n\t\tif (!props.stateMapSetKey) {\n\t\t\tif (prevProps.view !== props.view) {\n\t\t\t\tlet mapViews = _mapValues(this.state.mapViews, view => {\n\t\t\t\t\treturn {...view, ...props.view};\n\t\t\t\t});\n\n\t\t\t\tthis.setState({\n\t\t\t\t\t// TODO sync props to view only?\n\t\t\t\t\tview: {...this.state.view, ...props.view},\n\t\t\t\t\tmapViews,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(props.layers && props.layers !== prevProps.layers) ||\n\t\t\t\t(props.backgroundLayer &&\n\t\t\t\t\tprops.backgroundLayer !== prevProps.backgroundLayer)\n\t\t\t) {\n\t\t\t\tif (props.refreshUse) {\n\t\t\t\t\t// props.refreshUse();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewChange(mapKey, update) {\n\t\tlet syncUpdate;\n\t\tupdate = mapUtils.view.ensureViewIntegrity(update);\n\t\tmapKey = mapKey || this.state.activeMapKey;\n\n\t\tif (this.props.sync) {\n\t\t\tsyncUpdate = _pickBy(update, (updateVal, updateKey) => {\n\t\t\t\treturn this.props.sync[updateKey];\n\t\t\t});\n\t\t\tsyncUpdate = mapUtils.view.ensureViewIntegrity(syncUpdate);\n\t\t}\n\n\t\t// merge views of all maps\n\t\tlet mapViews = _mapValues(this.state.mapViews, view => {\n\t\t\treturn mapUtils.view.mergeViews(view, syncUpdate);\n\t\t});\n\n\t\t// merge views of given map\n\t\tmapViews[mapKey] = mapUtils.view.mergeViews(\n\t\t\tthis.state.mapViews[mapKey],\n\t\t\tupdate\n\t\t);\n\n\t\tif (syncUpdate && !_isEmpty(syncUpdate)) {\n\t\t\tconst mergedView = mapUtils.view.mergeViews(this.state.view, syncUpdate);\n\n\t\t\tthis.setState({\n\t\t\t\tview: mergedView,\n\t\t\t\tmapViews,\n\t\t\t});\n\n\t\t\tif (this.props.onViewChange) {\n\t\t\t\tthis.props.onViewChange(mergedView);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.setState({\n\t\t\t\tmapViews,\n\t\t\t});\n\t\t}\n\t}\n\n\tonResetHeading() {\n\t\tmapUtils.resetHeading(\n\t\t\tthis.state.mapViews[this.state.activeMapKey].heading,\n\t\t\theading => this.onViewChange(this.state.activeMapKey, {heading})\n\t\t);\n\t}\n\n\t/**\n\t * Called in uncontrolled map set\n\t * @param key\n\t * @param view\n\t */\n\tonMapClick(key, view) {\n\t\tif (this.state.mapViews[key]) {\n\t\t\tthis.setState({activeMapKey: key});\n\t\t} else {\n\t\t\tlet mapViews = {...this.state.mapViews};\n\t\t\tmapViews[key] = view;\n\n\t\t\tthis.setState({activeMapKey: key, mapViews});\n\t\t}\n\t}\n\n\tonMapResize(mapKey, width, height) {\n\t\tconst mapsDimensions = {\n\t\t\t...this.state.mapsDimensions,\n\t\t\t[mapKey]: {width, height},\n\t\t};\n\t\tthis.setState({mapsDimensions});\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"ptr-map-set\">\n\t\t\t\t<div className=\"ptr-map-set-maps\">{this.renderMaps()}</div>\n\t\t\t\t<div className=\"ptr-map-set-controls\">{this.renderControls()}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderControls() {\n\t\tlet updateView, resetHeading, view, mapKey, activeMapDimensions;\n\t\tif (this.props.stateMapSetKey) {\n\t\t\tupdateView = this.props.updateView;\n\t\t\tresetHeading = this.props.resetHeading;\n\t\t\tview = this.props.activeMapView || this.props.view;\n\t\t\tmapKey = this.props.activeMapKey;\n\t\t\tactiveMapDimensions = this.props.activeMapViewport;\n\t\t} else {\n\t\t\tupdateView = this.onViewChange.bind(this, null);\n\t\t\tresetHeading = this.onResetHeading.bind(this);\n\t\t\tview = mapUtils.view.mergeViews(\n\t\t\t\tthis.state.view,\n\t\t\t\tthis.state.mapViews[this.state.activeMapKey]\n\t\t\t);\n\t\t\tmapKey = this.state.activeMapKey;\n\t\t\tactiveMapDimensions =\n\t\t\t\tthis.state.mapsDimensions &&\n\t\t\t\tthis.state.mapsDimensions[this.state.activeMapKey];\n\t\t}\n\n\t\treturn React.Children.map(this.props.children, child => {\n\t\t\tif (!(typeof child === 'object' && child.type === Map)) {\n\t\t\t\treturn React.cloneElement(child, {\n\t\t\t\t\t...child.props,\n\t\t\t\t\tview,\n\t\t\t\t\tupdateView,\n\t\t\t\t\tresetHeading,\n\t\t\t\t\tmapKey,\n\t\t\t\t\tmapWidth: activeMapDimensions && activeMapDimensions.width,\n\t\t\t\t\tmapHeight: activeMapDimensions && activeMapDimensions.height,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\trenderMaps() {\n\t\tlet maps = [];\n\n\t\t// For now, render either maps from state, OR from children\n\n\t\tif (this.props.stateMapSetKey) {\n\t\t\t// all from state\n\t\t\tif (this.props.maps && this.props.maps.length) {\n\t\t\t\tthis.props.maps.map(mapKey => {\n\t\t\t\t\tlet props = {\n\t\t\t\t\t\tkey: mapKey,\n\t\t\t\t\t\tstateMapKey: mapKey,\n\t\t\t\t\t\tonResize: this.onMapResize.bind(this, mapKey),\n\t\t\t\t\t};\n\n\t\t\t\t\tmaps.push(\n\t\t\t\t\t\tthis.renderMap(\n\t\t\t\t\t\t\tthis.props.connectedMapComponent,\n\t\t\t\t\t\t\t{...props, mapComponent: this.props.mapComponent},\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tmapKey === this.props.activeMapKey\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tReact.Children.map(this.props.children, (child, index) => {\n\t\t\t\tlet {view, layers, backgroundLayer, mapKey, ...restProps} = child.props;\n\t\t\t\tlet props = {\n\t\t\t\t\t...restProps,\n\t\t\t\t\tkey: index,\n\t\t\t\t\tview: mapUtils.view.mergeViews(\n\t\t\t\t\t\tthis.state.view,\n\t\t\t\t\t\tview,\n\t\t\t\t\t\tthis.state.mapViews[mapKey]\n\t\t\t\t\t),\n\t\t\t\t\tbackgroundLayer: backgroundLayer || this.props.backgroundLayer,\n\t\t\t\t\tlayers: mapUtils.mergeLayers(this.props.layers, layers),\n\t\t\t\t\tonViewChange: this.onViewChange.bind(this, mapKey),\n\t\t\t\t\tonClick: this.onMapClick.bind(this, mapKey),\n\t\t\t\t\tonResize: this.onMapResize.bind(this, mapKey),\n\t\t\t\t\tmapKey,\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\ttypeof child === 'object' &&\n\t\t\t\t\t(child.type === Map ||\n\t\t\t\t\t\tchild.type === this.props.connectedMapComponent)\n\t\t\t\t) {\n\t\t\t\t\t// layers from state\n\t\t\t\t\tmaps.push(\n\t\t\t\t\t\tthis.renderMap(\n\t\t\t\t\t\t\tthis.props.connectedMapComponent,\n\t\t\t\t\t\t\t{...props, mapComponent: this.props.mapComponent},\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tmapKey === this.state.activeMapKey\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t} else if (\n\t\t\t\t\ttypeof child === 'object' &&\n\t\t\t\t\tchild.type === PresentationMap\n\t\t\t\t) {\n\t\t\t\t\t// all presentational\n\t\t\t\t\tmaps.push(\n\t\t\t\t\t\tthis.renderMap(\n\t\t\t\t\t\t\tthis.props.mapComponent || child.props.mapComponent,\n\t\t\t\t\t\t\tprops,\n\t\t\t\t\t\t\tchild.props.children,\n\t\t\t\t\t\t\tmapKey === this.state.activeMapKey,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn <MapGrid>{maps}</MapGrid>;\n\t}\n\n\trenderMap(mapComponent, props, children, active, renderWrapper) {\n\t\t// TODO custom wrapper component\n\t\tif (this.props.wrapper) {\n\t\t\tlet wrapperProps = this.props.wrapperProps;\n\t\t\tif (this.props.onMapRemove && !this.props.disableMapRemoval) {\n\t\t\t\twrapperProps = {\n\t\t\t\t\t...this.props.wrapperProps,\n\t\t\t\t\tonMapRemove: this.props.onMapRemove,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst allProps = {\n\t\t\t\t...props,\n\t\t\t\t...wrapperProps,\n\t\t\t\twrapper: this.props.wrapper,\n\t\t\t\tactive,\n\t\t\t};\n\n\t\t\t// Render wrapper here, if mapComponent is final (framework-specific) map component\n\t\t\tif (renderWrapper) {\n\t\t\t\tconst wrapperComponent =\n\t\t\t\t\t(this.props.wrapper.prototype &&\n\t\t\t\t\t\tthis.props.wrapper.prototype.isReactComponent) ||\n\t\t\t\t\ttypeof this.props.wrapper === 'function'\n\t\t\t\t\t\t? this.props.wrapper\n\t\t\t\t\t\t: MapWrapper;\n\t\t\t\treturn React.createElement(\n\t\t\t\t\twrapperComponent,\n\t\t\t\t\tallProps,\n\t\t\t\t\tReact.createElement(mapComponent, props, children)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn React.createElement(mapComponent, allProps, children);\n\t\t\t}\n\t\t} else {\n\t\t\treturn React.createElement(mapComponent, props, children);\n\t\t}\n\t}\n}\n\nexport const MapSetMap = Map;\nexport const MapSetPresentationMap = PresentationMap;\n\nexport default MapSet;\n","import React from 'react';\nimport './mapTools.scss';\nexport default props => {\n\treturn <div className=\"map-tools\">{props.children}</div>;\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {isEqual as _isEqual, isEmpty as _isEmpty} from 'lodash';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport {Error} from '@gisatcz/ptr-atoms';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport MapWrapper from './MapWrapper';\n\nimport './style.scss';\n\nclass PresentationMap extends React.PureComponent {\n\tstatic propTypes = {\n\t\tbackgroundLayer: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n\t\tchildren: PropTypes.element,\n\t\tlayers: PropTypes.array,\n\t\tmapComponent: PropTypes.oneOfType([PropTypes.element, PropTypes.func]),\n\t\tonMount: PropTypes.func,\n\t\tonPropViewChange: PropTypes.func,\n\t\tonResize: PropTypes.func,\n\t\tonViewChange: PropTypes.func,\n\t\tresetHeading: PropTypes.func,\n\t\tstateMapKey: PropTypes.string,\n\t\tview: PropTypes.object,\n\t\tviewport: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\t\twrapper: PropTypes.oneOfType([\n\t\t\tPropTypes.elementType,\n\t\t\tPropTypes.element,\n\t\t\tPropTypes.bool,\n\t\t]),\n\t\twrapperProps: PropTypes.object,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t};\n\n\t\tif (!props.stateMapKey) {\n\t\t\tthis.state.view = {...mapConstants.defaultMapView, ...props.view};\n\t\t}\n\n\t\tthis.onViewChange = this.onViewChange.bind(this);\n\t\tthis.onPropViewChange = this.onPropViewChange.bind(this);\n\t\tthis.resetHeading = this.resetHeading.bind(this);\n\t\tthis.onResize = this.onResize.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\tif (this.props.onMount) {\n\t\t\tthis.props.onMount(this.state.width, this.state.height);\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tconst props = this.props;\n\t\tif (props.view) {\n\t\t\tconst view = this.getValidView(props.view);\n\t\t\tif (prevProps && prevProps.view) {\n\t\t\t\t//todo simplify\n\t\t\t\tif (!_isEqual(props.view, prevProps.view)) {\n\t\t\t\t\tif (!this.props.stateMapKey) {\n\t\t\t\t\t\tthis.saveViewChange(view, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.onPropViewChange(view);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this.props.stateMapKey) {\n\t\t\t\t\tthis.saveViewChange(view, true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.onPropViewChange(view);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t(props.layers && props.layers !== prevProps.layers) ||\n\t\t\t(props.backgroundLayer &&\n\t\t\t\tprops.backgroundLayer !== prevProps.backgroundLayer)\n\t\t) {\n\t\t\t// this.props.refreshUse();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (this.props.onUnmount) {\n\t\t\tthis.props.onUnmount();\n\t\t}\n\t}\n\n\tonViewChangeDecorator(onViewChange) {\n\t\treturn update => {\n\t\t\tonViewChange(update, this.state.width, this.state.height);\n\t\t};\n\t}\n\n\tgetValidView(update) {\n\t\tlet view = {...mapConstants.defaultMapView, ...view};\n\t\tif (this.state.view && !_isEmpty(this.state.view)) {\n\t\t\tview = {...this.state.view, ...update};\n\t\t}\n\t\tview = mapUtils.view.ensureViewIntegrity(view);\n\t\treturn view;\n\t}\n\n\tsaveViewChange(view, checkViewEquality) {\n\t\tif (checkViewEquality && !_isEqual(view, this.state.view)) {\n\t\t\tif (!this.props.stateMapKey) {\n\t\t\t\tthis.setState({view});\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewChange(update) {\n\t\tconst view = this.getValidView(update);\n\t\tthis.saveViewChange(view, true);\n\n\t\tif (!_isEqual(view, this.state.view)) {\n\t\t\tif (this.props.onViewChange && !this.props.stateMapKey) {\n\t\t\t\tthis.onViewChangeDecorator(this.props.onViewChange)(view);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPropViewChange(view) {\n\t\tif (this.props.stateMapKey && this.props.onPropViewChange) {\n\t\t\tthis.onViewChangeDecorator(this.props.onPropViewChange)(view);\n\t\t}\n\t}\n\n\tresetHeading() {\n\t\tmapUtils.resetHeading(this.state.view.heading, heading =>\n\t\t\tthis.setState({\n\t\t\t\tview: {...this.state.view, heading},\n\t\t\t})\n\t\t);\n\t}\n\n\tonResize(width, height) {\n\t\tif (this.props.onResize) {\n\t\t\tthis.props.onResize(width, height);\n\t\t}\n\n\t\tthis.setState({width, height});\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tmapComponent,\n\t\t\twrapper,\n\t\t\twrapperProps,\n\t\t\t...props\n\t\t} = this.props;\n\n\t\tif (!mapComponent) {\n\t\t\treturn <Error centered>mapComponent not supplied to Map</Error>;\n\t\t} else {\n\t\t\tprops.onResize = this.onResize;\n\n\t\t\tif (!props.stateMapKey) {\n\t\t\t\tprops.view = this.state.view || props.view;\n\t\t\t\tprops.onViewChange = this.onViewChange;\n\t\t\t}\n\n\t\t\tif (wrapper) {\n\t\t\t\tconst wrapperComponent =\n\t\t\t\t\t(this.props.wrapper.prototype &&\n\t\t\t\t\t\tthis.props.wrapper.prototype.isReactComponent) ||\n\t\t\t\t\ttypeof this.props.wrapper === 'function'\n\t\t\t\t\t\t? this.props.wrapper\n\t\t\t\t\t\t: MapWrapper;\n\n\t\t\t\treturn React.createElement(\n\t\t\t\t\twrapperComponent,\n\t\t\t\t\t{...props, ...wrapperProps},\n\t\t\t\t\tthis.renderContent(mapComponent, props, children)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn this.renderContent(mapComponent, props, children);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderContent(mapComponent, props, children) {\n\t\tlet map = React.createElement(mapComponent, props);\n\n\t\tif (!children) {\n\t\t\treturn map;\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div className=\"ptr-map-controls-wrapper\">\n\t\t\t\t\t{map}\n\t\t\t\t\t{React.Children.map(children, child => {\n\t\t\t\t\t\treturn React.cloneElement(child, {\n\t\t\t\t\t\t\t...child.props,\n\t\t\t\t\t\t\tview: props.view,\n\t\t\t\t\t\t\tviewLimits: this.props.viewLimits,\n\t\t\t\t\t\t\tupdateView: props.onViewChange,\n\t\t\t\t\t\t\tresetHeading: this.props.stateMapKey\n\t\t\t\t\t\t\t\t? this.props.resetHeading\n\t\t\t\t\t\t\t\t: this.resetHeading,\n\t\t\t\t\t\t\tmapWidth: this.props.stateMapKey\n\t\t\t\t\t\t\t\t? this.props.viewport?.width\n\t\t\t\t\t\t\t\t: this.state.width,\n\t\t\t\t\t\t\tmapHeight: this.props.stateMapKey\n\t\t\t\t\t\t\t\t? this.props.viewport?.height\n\t\t\t\t\t\t\t\t: this.state.height,\n\t\t\t\t\t\t});\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default PresentationMap;\n","import {mapConstants} from '@gisatcz/ptr-core';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\n\nfunction getLeafletViewFromViewParams(view, width, height) {\n\tconst completeView = {...mapConstants.defaultMapView, ...view};\n\n\treturn {\n\t\tzoom: mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\tcompleteView.boxRange,\n\t\t\twidth,\n\t\t\theight\n\t\t),\n\t\tcenter: {\n\t\t\tlat: completeView.center.lat,\n\t\t\tlng: completeView.center.lon,\n\t\t},\n\t};\n}\n\nfunction getLeafletViewportFromViewParams(view, width, height) {\n\tconst leafletView = getLeafletViewFromViewParams(view, width, height);\n\n\treturn {\n\t\tzoom: leafletView.zoom,\n\t\tcenter: [leafletView.center.lat, leafletView.center.lng],\n\t};\n}\n\nfunction update(map, view, width, height) {\n\tlet stateCenter = map.getCenter();\n\tlet stateZoom = map.getZoom();\n\n\tlet leafletUpdate = getLeafletViewFromViewParams(view, width, height);\n\n\tif (\n\t\tstateCenter.lat !== leafletUpdate.center.lat ||\n\t\tstateCenter.lng !== leafletUpdate.center.lng ||\n\t\tstateZoom !== leafletUpdate.zoom\n\t) {\n\t\tmap.setView(\n\t\t\tleafletUpdate.center || stateCenter,\n\t\t\tleafletUpdate.zoom || stateZoom\n\t\t);\n\t}\n}\n\nexport default {\n\tgetLeafletViewportFromViewParams,\n\tupdate,\n};\n","import React from 'react';\n\nexport default props => {\n\tlet svgSize = 32;\n\tlet offset = 0;\n\n\tif (props.outlineWidth) {\n\t\tsvgSize += props.outlineWidth;\n\t\toffset = props.outlineWidth / 2;\n\t}\n\n\treturn (\n\t\t<svg\n\t\t\tversion=\"1.1\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\txmlnsXlink=\"http://www.w3.org/1999/xlink\"\n\t\t\tx=\"0px\"\n\t\t\ty=\"0px\"\n\t\t\twidth={svgSize + 'px'}\n\t\t\theight={svgSize + 'px'}\n\t\t\tviewBox={`0 0 ${svgSize} ${svgSize}`}\n\t\t\txmlSpace=\"preserve\"\n\t\t\tclassName={`ptr-map-shape ${props.className || ''}`}\n\t\t\tstyle={props.style}\n\t\t>\n\t\t\t{React.createElement(props.children, {...props, offset})}\n\t\t</svg>\n\t);\n};\n","import React from 'react';\nimport svg from './svg';\n\nconst Cross = props => {\n\treturn (\n\t\t<g transform={`translate(${props.offset} ${props.offset})`}>\n\t\t\t<path vectorEffect=\"non-scaling-stroke\" d=\"M 1,1 31,31\" />\n\t\t\t<path vectorEffect=\"non-scaling-stroke\" d=\"M 1,31 31,1\" />\n\t\t</g>\n\t);\n};\n\nexport default props => React.createElement(svg, props, Cross);\n","import React from 'react';\nimport svg from './svg';\n\nconst Pin = props => {\n\treturn (\n\t\t<g\n\t\t\ttransform={`translate(${props.offset} ${\n\t\t\t\tprops.offset + props.offset / 4\n\t\t\t})`}\n\t\t>\n\t\t\t<path\n\t\t\t\tvectorEffect=\"non-scaling-stroke\"\n\t\t\t\td=\"M 27,10.999999 C 26.999936,4.924849 22.075087,0 16,0 9.9249129,0 5.0000636,4.924849 5,10.999999 4.9998451,13.460703 6.2398215,15.834434 8.6666665,18.857143 11.093512,21.879851 13.424935,25.819509 16,32 18.614084,25.725879 20.878951,21.8993 23.333333,18.857143 25.787715,15.814985 26.999857,13.488539 27,10.999999 Z\"\n\t\t\t/>\n\t\t\t{props.icon ? (\n\t\t\t\t<g transform=\"translate(9 3.5) scale(0.4375 0.4375)\">{props.icon}</g>\n\t\t\t) : null}\n\t\t</g>\n\t);\n};\n\nexport default props => React.createElement(svg, props, Pin);\n","import Cross from './Cross';\nimport Pin from './Pin';\n\nexport default {\n\tcross: {\n\t\tanchorPoint: [0.5, 0.5],\n\t\tcomponent: Cross,\n\t},\n\tpin: {\n\t\tanchorPoint: [0.5, 1],\n\t\tcomponent: Pin,\n\t},\n};\n","import L from 'leaflet';\nimport {forIn as _forIn} from 'lodash';\nimport ReactDOMServer from 'react-dom/server';\nimport React from 'react';\nimport helpers from '../helpers';\n\n/**\n * It enables to draw various shapes as marker icon.\n * @augments L.DivIcon\n * @param props {object}\n * @param props.basicShape {bool} If true -> DIV element, if false -> SVG element\n * @param props.icon {Object} Icon definition\n * @param props.icon.component {React.Component}\n * @param props.icon.componentProps {React.Object} Additional icon component props\n * @param props.id {string}\n * @param props.iconAnchor {string} https://leafletjs.com/reference-1.7.1.html#icon-iconanchor\n * @param props.onClick {function} onclick callback\n * @param props.onMouseMove {function} mousemove callback\n * @param props.onMouseOver {function} mouseover callback\n * @param props.onMouseOut {function} mouseout callback\n * @param props.shape {Object} Shape definition\n * @param props.shape.component {React.Component}\n * @param props.shape.componentProps {React.Object} Additional shape component props\n * @param props.style {string} Extended Leaflet style (see getSvgStyle method for details)\n */\nclass MarkerShape extends L.DivIcon {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\t// Needed by L.DivIcon\n\t\tthis.iconAnchor = props.iconAnchor;\n\n\t\tthis.basicShape = props.basicShape;\n\t\tthis.id = props.id;\n\t\tthis.style = props.style;\n\t\tthis.shape = props.shape;\n\t\tthis.icon = props.icon;\n\n\t\tthis.onMouseMove = props.onMouseMove;\n\t\tthis.onMouseOver = props.onMouseOver;\n\t\tthis.onMouseOut = props.onMouseOut;\n\t\tthis.onClick = props.onClick;\n\t}\n\n\t/**\n\t * Overwrite ancestor's method\n\t * @param oldShape\n\t * @return {HTMLDivElement}\n\t */\n\tcreateIcon(oldShape) {\n\t\tlet div;\n\t\tif (oldShape && oldShape.tagName === 'DIV') {\n\t\t\tdiv = oldShape;\n\t\t} else {\n\t\t\tdiv = document.createElement('div');\n\t\t\tdiv.id = this.id;\n\t\t\tif (this.onMouseMove) {\n\t\t\t\tdiv.addEventListener('mousemove', this.onMouseMove);\n\t\t\t}\n\t\t\tif (this.onMouseOver) {\n\t\t\t\tdiv.addEventListener('mouseover', this.onMouseOver);\n\t\t\t}\n\t\t\tif (this.onMouseOut) {\n\t\t\t\tdiv.addEventListener('mouseout', this.onMouseOut);\n\t\t\t}\n\t\t\tif (this.onClick) {\n\t\t\t\tdiv.addEventListener('click', this.onClick);\n\t\t\t}\n\t\t}\n\n\t\tconst html = this.getShapeHtml();\n\t\tif (html instanceof Element) {\n\t\t\tdiv.appendChild(html);\n\t\t} else {\n\t\t\tdiv.innerHTML = html !== false ? html : '';\n\t\t}\n\n\t\tthis._setIconStyles(div, 'icon');\n\n\t\treturn div;\n\t}\n\n\t/**\n\t * Prepare html of the icon based on shape and icon components\n\t * @return {string}\n\t */\n\tgetShapeHtml() {\n\t\t// Basic shape -> no need for svg\n\t\tif (this.basicShape) {\n\t\t\tconst style = helpers.getMarkerShapeCssStyle(this.style);\n\t\t\treturn ReactDOMServer.renderToString(<div style={style} />);\n\t\t} else {\n\t\t\tlet finalShape;\n\t\t\tconst style = helpers.getMarkerShapeSvgStyle(this.style);\n\n\t\t\t// Combined shape and icon\n\t\t\t// Currently only shape=\"pin\" is suitable for combination\n\t\t\tif (this.shape && this.icon) {\n\t\t\t\tfinalShape = this.getShapeWithIcon(style);\n\t\t\t}\n\n\t\t\t// Just shape\n\t\t\telse if (this.shape) {\n\t\t\t\tfinalShape = this.getShape(style);\n\t\t\t}\n\n\t\t\t// No shape, but icon? Use icon as shape\n\t\t\telse if (this.icon) {\n\t\t\t\tfinalShape = this.getIcon(style);\n\t\t\t}\n\n\t\t\treturn ReactDOMServer.renderToString(finalShape);\n\t\t}\n\t}\n\n\t/**\n\t * @param style {Object} style object suitable for SVG\n\t * @return {React.DetailedReactHTMLElement<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>}\n\t */\n\tgetShape(style) {\n\t\tconst props = this.shape.componentProps\n\t\t\t? {...this.shape.componentProps, style}\n\t\t\t: {style};\n\t\treturn React.createElement(this.shape.component, {\n\t\t\t...props,\n\t\t\toutlineWidth: this.style.weight,\n\t\t});\n\t}\n\n\t/**\n\t * @param style {Object} style object suitable for SVG\n\t * @return {React.DetailedReactHTMLElement<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>}\n\t */\n\tgetIcon(style) {\n\t\tconst iconStyle = {\n\t\t\t...style,\n\t\t\tfill: style.iconFill ? style.iconFill : style.fill,\n\t\t};\n\n\t\tconst props = this.icon.componentProps\n\t\t\t? {...this.icon.componentProps, style: iconStyle}\n\t\t\t: {style: iconStyle};\n\t\treturn React.createElement(this.icon.component, props);\n\t}\n\n\t/**\n\t * @param style {Object} style object suitable for SVG\n\t * @return {React.DetailedReactHTMLElement<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>}\n\t */\n\tgetShapeWithIcon(style) {\n\t\tlet iconStyle = {strokeWidth: 0}; // TODO think about icons styling inside shape\n\t\tconst {iconFill, ...shapeStyle} = style;\n\n\t\tif (iconFill) {\n\t\t\ticonStyle.fill = iconFill;\n\t\t} else {\n\t\t\ticonStyle.fill = shapeStyle.stroke;\n\t\t}\n\n\t\tconst iconProps = this.icon.componentProps\n\t\t\t? {...this.icon.componentProps, style: iconStyle}\n\t\t\t: {style: iconStyle};\n\t\tconst iconComponent = React.createElement(this.icon.component, iconProps);\n\n\t\tconst props = this.shape.componentProps\n\t\t\t? {...this.shape.componentProps, style: shapeStyle}\n\t\t\t: {style: shapeStyle};\n\t\treturn React.createElement(this.shape.component, {\n\t\t\t...props,\n\t\t\ticon: iconComponent,\n\t\t\toutlineWidth: this.style.weight,\n\t\t});\n\t}\n\n\t/**\n\t * Set style of element\n\t * @param style {Object} Leaflet style definition\n\t * @param id {string} id of the shape\n\t * @param isBasicShape {bool} If true -> DIV element, if false -> SVG element\n\t */\n\tsetStyle(style, id, isBasicShape) {\n\t\tid = id || this.id;\n\t\tisBasicShape = isBasicShape || this.basicShape;\n\n\t\tlet shapeStyle = isBasicShape\n\t\t\t? helpers.getMarkerShapeCssStyle(style)\n\t\t\t: helpers.getMarkerShapeSvgStyle(style);\n\t\tlet element = document.getElementById(id);\n\t\tlet shape = element?.children?.[0];\n\n\t\tif (shape) {\n\t\t\t_forIn(shapeStyle, (value, key) => {\n\t\t\t\tshape.style[key] = value;\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport default MarkerShape;\n","import {mapStyle} from '@gisatcz/ptr-utils';\nimport constants from '../../../constants';\nimport memoize from 'memoize-one';\nimport flip from '@turf/flip';\nimport shapes from './Feature/shapes';\nimport MarkerShape from './Feature/MarkerShape';\n\n/**\n * @param feature {GeoJSONFeature}\n * @param styleDefinition {Object} Panther style definition\n * @return {Object}\n */\nfunction getDefaultStyleObject(feature, styleDefinition) {\n\treturn mapStyle.getStyleObject(\n\t\tfeature.properties,\n\t\tstyleDefinition || constants.vectorFeatureStyle.defaultFull\n\t);\n}\n\n/**\n * @param selectedStyleDefinition {Object} Panther style definition\n * @return {Object}\n */\nfunction getSelectedStyleObject(selectedStyleDefinition) {\n\treturn selectedStyleDefinition === 'default'\n\t\t? constants.vectorFeatureStyle.selected\n\t\t: selectedStyleDefinition;\n}\n\n/**\n * @param feature {GeoJSONFeature}\n * @param defaultStyleObject {Object} Panther style definition\n * @return {Object}\n */\nfunction getFeatureDefaultStyle(feature, defaultStyleObject) {\n\treturn getFeatureLeafletStyle(feature, defaultStyleObject);\n}\n\n/**\n * @param feature {GeoJSONFeature}\n * @param defaultStyleObject {Object} Panther style definition\n * @param accentedStyleObject {Object} Panther style definition\n * @return {Object}\n */\nfunction getFeatureAccentedStyle(\n\tfeature,\n\tdefaultStyleObject,\n\taccentedStyleObject\n) {\n\tconst style = {...defaultStyleObject, ...accentedStyleObject};\n\treturn getFeatureLeafletStyle(feature, style);\n}\n\n/**\n * @param feature {GeoJSONFeature}\n * @param style {Object} Panther style definition\n * @return {Object} Leaflet style definition\n */\nfunction getFeatureLeafletStyle(feature, style) {\n\tlet {\n\t\toutlineColor,\n\t\toutlineWidth,\n\t\toutlineOpacity,\n\t\tfillOpacity,\n\t\tfill,\n\t\tsize,\n\t\tvolume,\n\t\t...finalStyle\n\t} = style;\n\n\tfinalStyle.color = style.outlineColor ? style.outlineColor : null;\n\tfinalStyle.weight = style.outlineWidth ? style.outlineWidth : 0;\n\tfinalStyle.opacity = style.outlineOpacity ? style.outlineOpacity : 1;\n\tfinalStyle.fillOpacity = style.fillOpacity ? style.fillOpacity : 1;\n\tfinalStyle.fillColor = style.fill;\n\n\tif (!style.fill) {\n\t\tfinalStyle.fillColor = null;\n\t\tfinalStyle.fillOpacity = 0;\n\t}\n\n\tif (!style.outlineColor || !style.outlineWidth) {\n\t\tfinalStyle.color = null;\n\t\tfinalStyle.opacity = 0;\n\t\tfinalStyle.weight = 0;\n\t}\n\n\t// for point features, set radius\n\tif (feature.geometry.type === 'Point') {\n\t\tif (style.size) {\n\t\t\tfinalStyle.radius = style.size;\n\t\t} else if (style.volume) {\n\t\t\tfinalStyle.radius = Math.sqrt(style.volume / Math.PI);\n\t\t}\n\t}\n\n\treturn finalStyle;\n}\n\n/**\n * Leaflet requires coordinates in different order than GeoJSON standard\n * @param feature {GeoJSONFeature}\n */\nconst convertCoordinatesMemo = memoize(feature => {\n\t// TODO do we need turf for this?\n\tconst flippedFeature = flip(feature);\n\treturn (\n\t\tflippedFeature &&\n\t\tflippedFeature.geometry &&\n\t\tflippedFeature.geometry.coordinates\n\t);\n});\n\nconst getDefaultStyle = (feature, styleDefinition) => {\n\tconst defaultStyleObject = getDefaultStyleObject(feature, styleDefinition);\n\treturn getFeatureDefaultStyle(feature, defaultStyleObject);\n};\n\nconst calculateStyle = (\n\tfeature,\n\tstyleDefinition,\n\thoveredStyleDefinition,\n\tselected,\n\tselectedStyleDefinition,\n\tselectedHoveredStyleDefinition\n) => {\n\t// Prepare default style\n\tconst defaultStyleObject = getDefaultStyleObject(feature, styleDefinition);\n\tconst defaultStyle = getFeatureDefaultStyle(feature, defaultStyleObject);\n\n\t// Prepare hovered style\n\tlet hoveredStyleObject = null;\n\tlet hoveredStyle = null;\n\tif (hoveredStyleDefinition) {\n\t\thoveredStyleObject =\n\t\t\thoveredStyleDefinition === 'default'\n\t\t\t\t? constants.vectorFeatureStyle.hovered\n\t\t\t\t: hoveredStyleDefinition;\n\t\thoveredStyle = getFeatureAccentedStyle(\n\t\t\tfeature,\n\t\t\tdefaultStyleObject,\n\t\t\thoveredStyleObject\n\t\t);\n\t}\n\n\t// Prepare selected and selected hovered style, if selected\n\tlet selectedStyle = null;\n\tlet selectedHoveredStyle = null;\n\tif (selected) {\n\t\tlet selectedHoveredStyleObject = null;\n\t\tif (selectedStyleDefinition) {\n\t\t\tselectedStyle = getFeatureAccentedStyle(\n\t\t\t\tfeature,\n\t\t\t\tdefaultStyleObject,\n\t\t\t\tgetSelectedStyleObject(selectedStyleDefinition)\n\t\t\t);\n\t\t}\n\t\tif (selectedHoveredStyleDefinition) {\n\t\t\tselectedHoveredStyleObject =\n\t\t\t\tselectedHoveredStyleDefinition === 'default'\n\t\t\t\t\t? constants.vectorFeatureStyle.selectedHovered\n\t\t\t\t\t: selectedHoveredStyleDefinition;\n\t\t\tselectedHoveredStyle = getFeatureAccentedStyle(\n\t\t\t\tfeature,\n\t\t\t\tdefaultStyleObject,\n\t\t\t\tselectedHoveredStyleObject\n\t\t\t);\n\t\t}\n\t}\n\n\treturn {\n\t\tdefault: defaultStyle,\n\t\thovered: hoveredStyle,\n\t\tselected: selectedStyle,\n\t\tselectedHovered: selectedHoveredStyle,\n\t};\n};\n\nconst calculateStylesMemo = memoize(calculateStyle);\n\n/**\n * @param id {string}\n * @param style {Object} Leaflet style definition\n * @param options {Object}\n * @param options.icons {Object} see https://gisat.github.io/components/maps/map#resources\n * @param options.onMouseMove {function}\n * @param options.onMouseOver {function}\n * @param options.onMouseOut {function}\n * @param options.onClick {function}\n * @return {MarkerShape}\n */\nconst getMarkerShape = (id, style, options) => {\n\tconst shapeKey = style.shape;\n\tconst iconKey = style.icon;\n\tlet basicShape = true;\n\tlet anchorShift = 0; // shift of anchor in pixels\n\tlet anchorPositionX = 0.5; // relative anchor X position (0.5 means that the shape reference point is in the middle horizontally)\n\tlet anchorPositionY = 0.5; // relative anchor Y position\n\tlet shape, icon;\n\n\t// find shape by key in the internal set of shapes\n\tif (shapeKey) {\n\t\tshape = shapes[shapeKey] || null;\n\t}\n\n\t// find icon by key in the given set of icons\n\tif (iconKey) {\n\t\ticon = options?.icons?.[iconKey] || null;\n\t}\n\n\tif (shape || icon) {\n\t\tbasicShape = false;\n\n\t\t// get anchor positions from definitions, if exist\n\t\tif (shape?.anchorPoint) {\n\t\t\tanchorPositionX = shape.anchorPoint[0];\n\t\t\tanchorPositionY = shape.anchorPoint[1];\n\t\t} else if (!shape && icon?.anchorPoint) {\n\t\t\tanchorPositionX = icon.anchorPoint[0];\n\t\t\tanchorPositionY = icon.anchorPoint[1];\n\t\t}\n\n\t\t// if outline, shift the anchor point\n\t\tif (style?.weight) {\n\t\t\tanchorShift = style?.weight;\n\t\t}\n\t}\n\n\treturn new MarkerShape({\n\t\tbasicShape,\n\t\tid: id,\n\t\tstyle,\n\t\ticonAnchor: style.radius\n\t\t\t? [\n\t\t\t\t\t(2 * style.radius + anchorShift) * anchorPositionX,\n\t\t\t\t\t(2 * style.radius + anchorShift) * anchorPositionY,\n\t\t\t  ]\n\t\t\t: null,\n\t\ticon,\n\t\tshape,\n\t\tonMouseMove: options.onMouseMove,\n\t\tonMouseOut: options.onMouseOut,\n\t\tonMouseOver: options.onMouseOver,\n\t\tonClick: options.onClick,\n\t});\n};\n\n/**\n * Prepare element style by shape\n * @param leafletStyle {Object} Leaflet style definition\n * @return {Object} calculated style object\n */\nconst getMarkerShapeCssStyle = leafletStyle => {\n\tswitch (leafletStyle.shape) {\n\t\tcase 'square':\n\t\t\treturn getMarkerShapeSquareStyle(leafletStyle);\n\t\tcase 'diamond':\n\t\t\treturn getMarkerShapeSquareStyle(leafletStyle, 45);\n\t\tcase 'circle':\n\t\tdefault:\n\t\t\treturn getMarkerShapeCircleStyle(leafletStyle);\n\t}\n};\n\n/**\n * @param leafletStyle {Object} Leaflet style definition\n * @return {Object} calculated style object\n */\nconst getMarkerShapeCircleStyle = leafletStyle => {\n\treturn getMarkerShapeSquareStyle(leafletStyle, null, leafletStyle.radius);\n};\n\n/**\n * @param leafletStyle {Object} Leaflet style definition\n * @param rotation {number}\n * @param borderRadius {number}\n * @return {Object} calculated style object\n */\nconst getMarkerShapeSquareStyle = (leafletStyle, rotation, borderRadius) => {\n\tlet style = {};\n\tif (leafletStyle.radius) {\n\t\tstyle.width = leafletStyle.radius * 2 + 'px';\n\t\tstyle.height = leafletStyle.radius * 2 + 'px';\n\t}\n\n\tif (leafletStyle.fillColor) {\n\t\tif (leafletStyle.fillOpacity && leafletStyle.fillOpacity !== 1) {\n\t\t\tconst rgb = mapStyle.hexToRgb(leafletStyle.fillColor);\n\t\t\tstyle[\n\t\t\t\t'backgroundColor'\n\t\t\t] = `rgba(${rgb.r},${rgb.g},${rgb.b},${leafletStyle.fillOpacity})`;\n\t\t} else {\n\t\t\tstyle['backgroundColor'] = leafletStyle.fillColor;\n\t\t}\n\t}\n\n\tif (leafletStyle.color) {\n\t\tif (leafletStyle.opacity && leafletStyle.opacity !== 1) {\n\t\t\tconst rgb = mapStyle.hexToRgb(leafletStyle.color);\n\t\t\tstyle[\n\t\t\t\t'borderColor'\n\t\t\t] = `rgba(${rgb.r},${rgb.g},${rgb.b},${leafletStyle.opacity})`;\n\t\t} else {\n\t\t\tstyle['borderColor'] = leafletStyle.color;\n\t\t}\n\t}\n\n\tif (leafletStyle.weight) {\n\t\tstyle['borderStyle'] = 'solid';\n\t\tstyle['borderWidth'] = leafletStyle.weight + 'px';\n\t}\n\n\tif (borderRadius) {\n\t\tstyle['borderRadius'] = borderRadius + 'px';\n\t}\n\n\tif (rotation) {\n\t\tstyle.transform = 'rotate(' + rotation + 'deg)';\n\t}\n\n\treturn style;\n};\n\n/**\n * Prepare element style\n * @param leafletStyle {Object} Leaflet style definition\n * @param leafletStyle.color {string} hex code of outline color\n * @param leafletStyle.fillColor {string} hex code of fill color\n * @param leafletStyle.fillOpacity {number} range from 0 to 1, where 0 is transparent and 1 is fully opaque\n * @param leafletStyle.icon {string} icon id\n * @param leafletStyle.iconFill {string} hex code of icon fill color\n * @param leafletStyle.opacity {number} Outline opacity. range from 0 to 1, where 0 is transparent and 1 is fully opaque\n * @param leafletStyle.radius {number} Shape radius is a half of shape height/width\n * @param leafletStyle.shape {string} shape id\n * @param leafletStyle.weight {number} outline width\n * @return {Object} calculated style object suitable for SVG\n */\nconst getMarkerShapeSvgStyle = leafletStyle => {\n\tlet style = {};\n\tif (leafletStyle.radius) {\n\t\tconst size = leafletStyle.radius * 2 + (leafletStyle.weight || 0);\n\t\tstyle.width = size + 'px';\n\t\tstyle.height = size + 'px';\n\t}\n\n\tif (leafletStyle.fillColor) {\n\t\tstyle.fill = leafletStyle.fillColor;\n\t}\n\n\tif (leafletStyle.fillOpacity || leafletStyle.fillOpacity === 0) {\n\t\tstyle.fillOpacity = leafletStyle.fillOpacity;\n\t}\n\n\tif (leafletStyle.color) {\n\t\tstyle.stroke = leafletStyle.color;\n\t}\n\n\tif (leafletStyle.opacity) {\n\t\tstyle.strokeOpacity = leafletStyle.opacity;\n\t}\n\n\tif (leafletStyle.weight) {\n\t\tstyle.strokeWidth = leafletStyle.weight + 'px';\n\t}\n\n\tif (leafletStyle.iconFill) {\n\t\tstyle.iconFill = leafletStyle.iconFill;\n\t}\n\n\treturn style;\n};\n\nexport default {\n\tcalculateStyle,\n\tcalculateStylesMemo,\n\tconvertCoordinatesMemo,\n\n\tgetDefaultStyle,\n\tgetDefaultStyleObject,\n\tgetFeatureAccentedStyle,\n\tgetFeatureDefaultStyle,\n\tgetFeatureLeafletStyle,\n\tgetMarkerShape,\n\tgetMarkerShapeCssStyle,\n\tgetMarkerShapeSvgStyle,\n\tgetSelectedStyleObject,\n};\n","/*\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc, 1.2, 1.3\n  copyright Stanislav Sumbera,  2016-2018, sumbera.com , license MIT\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\n\n  also thanks to contributors: heyyeyheman,andern,nikiv3, anyoneelse ?\n  enjoy !\n*/\n\n// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n//------------------------------------------------------------------------------\nimport * as L from 'leaflet';\nL.DomUtil.setTransform =\n\tL.DomUtil.setTransform ||\n\tfunction (el, offset, scale) {\n\t\tvar pos = offset || new L.Point(0, 0);\n\n\t\tel.style[L.DomUtil.TRANSFORM] =\n\t\t\t(L.Browser.ie3d\n\t\t\t\t? 'translate(' + pos.x + 'px,' + pos.y + 'px)'\n\t\t\t\t: 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\n\t};\n\n// -- support for both  0.0.7 and 1.0.0 rc2 leaflet\nexport const CanvasLayer = (L.Layer ? L.Layer : L.Class).extend({\n\t// -- initialized is called on prototype\n\tinitialize: function (options) {\n\t\tthis._paneName = options.paneName;\n\t\tthis._paneZindex = options.paneZindex;\n\t\tthis._map = null;\n\t\tthis._canvas = null;\n\t\tthis._frame = null;\n\t\tthis._delegate = null;\n\t\tL.setOptions(this, options);\n\t},\n\n\tdelegate: function (del) {\n\t\tthis._delegate = del;\n\t\treturn this;\n\t},\n\n\tneedRedraw: function () {\n\t\tif (!this._frame) {\n\t\t\tthis._frame = L.Util.requestAnimFrame(this.drawLayer, this);\n\t\t}\n\t\treturn this;\n\t},\n\n\t//-------------------------------------------------------------\n\t_onLayerDidResize: function (resizeEvent) {\n\t\tthis._canvas.width = resizeEvent.newSize.x;\n\t\tthis._canvas.height = resizeEvent.newSize.y;\n\t},\n\t//-------------------------------------------------------------\n\t_onLayerDidMove: function (e) {\n\t\tvar topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\t\tif (topLeft.x !== this._topLeft?.x || topLeft.y !== this._topLeft.y) {\n\t\t\tthis._topLeft = topLeft;\n\t\t\tL.DomUtil.setPosition(this._canvas, topLeft);\n\t\t\tthis.drawLayer();\n\t\t}\n\t},\n\t_onLayerDidZoom: function (e) {\n\t\tif (this.props.type !== 'tiledVector') {\n\t\t\tvar topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\t\t\tL.DomUtil.setPosition(this._canvas, topLeft);\n\t\t\tthis.needRedraw();\n\t\t}\n\t},\n\t//-------------------------------------------------------------\n\tgetEvents: function () {\n\t\tvar events = {\n\t\t\tresize: this._onLayerDidResize,\n\t\t\tmoveend: this._onLayerDidMove,\n\t\t\tzoom: this._onLayerDidZoom,\n\t\t};\n\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\n\t\t\tevents.zoomanim = this._animateZoom;\n\t\t}\n\n\t\treturn events;\n\t},\n\t//-------------------------------------------------------------\n\tonAdd: function (map) {\n\t\tthis._map = map;\n\t\tthis._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\n\t\tthis.tiles = {};\n\n\t\tvar size = this._map.getSize();\n\t\tthis._canvas.width = size.x;\n\t\tthis._canvas.height = size.y;\n\n\t\tvar animated = this._map.options.zoomAnimation && L.Browser.any3d;\n\t\tL.DomUtil.addClass(\n\t\t\tthis._canvas,\n\t\t\t'leaflet-zoom-' + (animated ? 'animated' : 'hide')\n\t\t);\n\n\t\tvar topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\t\tL.DomUtil.setPosition(this._canvas, topLeft);\n\n\t\tvar pane = this._map.getPane(this._paneName);\n\t\tif (!pane) {\n\t\t\tpane = this._map.createPane(this._paneName);\n\t\t\tpane.style.zIndex = this._paneZindex;\n\t\t}\n\t\tpane.appendChild(this._canvas);\n\n\t\tmap.on(this.getEvents(), this);\n\n\t\tvar del = this._delegate || this;\n\t\tdel.onLayerDidMount && del.onLayerDidMount(); // -- callback\n\t\tthis.needRedraw();\n\t},\n\n\t//-------------------------------------------------------------\n\tonRemove: function (map) {\n\t\tvar del = this._delegate || this;\n\t\tdel.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\n\n\t\tif (this._frame) {\n\t\t\tL.Util.cancelAnimFrame(this._frame);\n\t\t}\n\n\t\tmap.getPane(this._paneName).removeChild(this._canvas);\n\n\t\tmap.off(this.getEvents(), this);\n\n\t\tthis._canvas = null;\n\t},\n\n\t//------------------------------------------------------------\n\taddTo: function (map) {\n\t\tmap.addLayer(this);\n\t\treturn this;\n\t},\n\t// --------------------------------------------------------------------------------\n\tLatLonToMercator: function (latlon) {\n\t\treturn {\n\t\t\tx: (latlon.lng * 6378137 * Math.PI) / 180,\n\t\t\ty: Math.log(Math.tan(((90 + latlon.lat) * Math.PI) / 360)) * 6378137,\n\t\t};\n\t},\n\n\t//------------------------------------------------------------------------------\n\tdrawLayer: function () {\n\t\tif (this._map) {\n\t\t\tvar size = this._map.getSize();\n\t\t\tvar bounds = this._map.getBounds();\n\t\t\tvar zoom = this._map.getZoom();\n\n\t\t\tvar center = this.LatLonToMercator(this._map.getCenter());\n\t\t\tvar corner = this.LatLonToMercator(\n\t\t\t\tthis._map.containerPointToLatLng(this._map.getSize())\n\t\t\t);\n\n\t\t\tvar del = this._delegate || this;\n\t\t\tdel.onDrawLayer &&\n\t\t\t\tdel.onDrawLayer({\n\t\t\t\t\tlayer: this,\n\t\t\t\t\tcanvas: this._canvas,\n\t\t\t\t\tbounds: bounds,\n\t\t\t\t\tsize: size,\n\t\t\t\t\tzoom: zoom,\n\t\t\t\t\tcenter: center,\n\t\t\t\t\tcorner: corner,\n\t\t\t\t});\n\t\t\tthis._frame = null;\n\t\t}\n\t},\n\t// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n\t//------------------------------------------------------------------------------\n\t_setTransform: function (el, offset, scale) {\n\t\tvar pos = offset || new L.Point(0, 0);\n\n\t\tel.style[L.DomUtil.TRANSFORM] =\n\t\t\t(L.Browser.ie3d\n\t\t\t\t? 'translate(' + pos.x + 'px,' + pos.y + 'px)'\n\t\t\t\t: 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\n\t},\n\n\t//------------------------------------------------------------------------------\n\t_animateZoom: function (e) {\n\t\tvar scale = this._map.getZoomScale(e.zoom);\n\t\t// -- different calc of animation zoom  in leaflet 1.0.3 thanks @peterkarabinovic, @jduggan1\n\t\tvar offset = L.Layer\n\t\t\t? this._map._latLngBoundsToNewLayerBounds(\n\t\t\t\t\tthis._map.getBounds(),\n\t\t\t\t\te.zoom,\n\t\t\t\t\te.center\n\t\t\t  ).min\n\t\t\t: this._map\n\t\t\t\t\t._getCenterOffset(e.center)\n\t\t\t\t\t._multiplyBy(-scale)\n\t\t\t\t\t.subtract(this._map._getMapPanePos());\n\n\t\tL.DomUtil.setTransform(this._canvas, offset, scale);\n\t},\n});\n\nexport default options => {\n\treturn new CanvasLayer(options);\n};\n","import chroma from 'chroma-js';\n\nfunction setPolygonStyle(context, style) {\n\tif (style.fill) {\n\t\tcontext.fillStyle = style.fill;\n\t\tif (style.fillOpacity) {\n\t\t\tcontext.fillStyle = chroma(style.fill).alpha(style.fillOpacity).hex();\n\t\t}\n\n\t\tcontext.fill();\n\t}\n\n\tif (style.outlineColor && style.outlineWidth) {\n\t\tcontext.lineWidth = style.outlineWidth;\n\t\tcontext.strokeStyle = style.outlineColor;\n\t\tif (style.outlineOpacity) {\n\t\t\tcontext.strokeStyle = chroma(style.outlineColor)\n\t\t\t\t.alpha(style.outlineOpacity)\n\t\t\t\t.hex();\n\t\t}\n\n\t\tcontext.lineJoin = 'round';\n\t\tcontext.stroke();\n\t}\n}\n\nfunction setLineStyle(context, style) {\n\tif (style.outlineColor && style.outlineWidth) {\n\t\tcontext.lineWidth = style.outlineWidth;\n\t\tcontext.strokeStyle = style.outlineColor;\n\t\tif (style.outlineOpacity) {\n\t\t\tcontext.strokeStyle = chroma(style.outlineColor)\n\t\t\t\t.alpha(style.outlineOpacity)\n\t\t\t\t.hex();\n\t\t}\n\n\t\tcontext.lineJoin = 'round';\n\t\tcontext.lineCap = 'round';\n\t\tcontext.stroke();\n\t}\n}\n\nfunction getSize(definedSize, pixelSizeInMeters) {\n\tlet size = pixelSizeInMeters ? definedSize / pixelSizeInMeters : definedSize;\n\treturn size < 0.5 ? 0.5 : size;\n}\n\nexport default {\n\tsetLineStyle,\n\tsetPolygonStyle,\n\tgetSize,\n};\n","import helpers from './helpers';\n\n/**\n * Draw shape to the given canvas\n * @param context {Object} canvas context\n * @param center {Object} center point of the shape\n * @param style {Object} Panther style definition\n * @param pixelSizeInMeters {number | null}\n */\nfunction draw(context, center, style, pixelSizeInMeters) {\n\t// TODO add other shapes\n\tif (style.shape === 'square') {\n\t\tsquare(context, center, style, pixelSizeInMeters);\n\t} else {\n\t\tcircle(context, center, style, pixelSizeInMeters);\n\t}\n}\n\nfunction square(context, center, style, pixelSizeInMeters) {\n\tconst size = helpers.getSize(style.size, pixelSizeInMeters);\n\tconst a = 2 * size; // side length\n\tcontext.beginPath();\n\tcontext.rect(center.x - a / 2, center.y - a / 2, a, a);\n\thelpers.setPolygonStyle(context, style);\n\tcontext.closePath();\n}\n\nfunction circle(context, center, style, pixelSizeInMeters) {\n\tcontext.beginPath();\n\tconst size = helpers.getSize(style.size, pixelSizeInMeters);\n\tcontext.arc(Math.floor(center.x), Math.floor(center.y), size, 0, Math.PI * 2);\n\thelpers.setPolygonStyle(context, style);\n\tcontext.closePath();\n}\n\nexport default {\n\tdraw,\n};\n","import helpers from './helpers';\n\n/**\n * Draw shape to the given canvas\n * @param context {Object} canvas context\n * @param coordinates {Array}\n * @param style {Object} Panther style definition\n */\nfunction drawPolygon(context, coordinates, style) {\n\tcontext.beginPath();\n\n\tcoordinates.forEach(linearRing => {\n\t\tconst start = linearRing[0];\n\t\tconst rest = linearRing.slice(1);\n\n\t\tcontext.moveTo(Math.floor(start.x), Math.floor(start.y));\n\t\trest.forEach(point => {\n\t\t\tcontext.lineTo(Math.floor(point.x), Math.floor(point.y));\n\t\t});\n\n\t\tcontext.closePath();\n\t});\n\n\thelpers.setPolygonStyle(context, style);\n}\n\nfunction drawMultiPolygon(context, coordinates, style) {\n\tcoordinates.map(polygon => drawPolygon(context, polygon, style));\n}\n\nexport default {\n\tdrawPolygon,\n\tdrawMultiPolygon,\n};\n","import helpers from './helpers';\n\n/**\n * Draw shape to the given canvas\n * @param context {Object} canvas context\n * @param coordinates {Array}\n * @param style {Object} Panther style definition\n */\nfunction drawLine(context, coordinates, style) {\n\tcontext.beginPath();\n\n\tconst start = coordinates[0];\n\tconst rest = coordinates.slice(1);\n\n\tcontext.moveTo(Math.floor(start.x), Math.floor(start.y));\n\trest.forEach(point => {\n\t\tcontext.lineTo(Math.floor(point.x), Math.floor(point.y));\n\t});\n\n\thelpers.setLineStyle(context, style);\n}\n\nexport default {\n\tdrawLine,\n};\n","import {\n\tforEach as _forEach,\n\tforIn as _forIn,\n\tincludes as _includes,\n\tisArray as _isArray,\n\torderBy as _orderBy,\n} from 'lodash';\n\nimport {point as turfPoint} from '@turf/helpers';\nimport nearestPoint from '@turf/nearest-point';\nimport booleanPointInPolygon from '@turf/boolean-point-in-polygon';\nimport {mapConstants} from '@gisatcz/ptr-core';\n\nimport helpers from '../SvgVectorLayer/helpers';\nimport {CanvasLayer} from './genericCanvasLayer';\nimport shapes from './shapes/shapes';\nimport polygons from './shapes/polygons';\nimport lines from './shapes/lines';\nimport * as L from 'leaflet';\n\nconst LeafletCanvasLayer = CanvasLayer.extend({\n\tonLayerDidMount: function () {\n\t\tthis.customEvents = {\n\t\t\tclick: this.onLayerClick,\n\t\t};\n\t\tthis._map.on(this.customEvents, this);\n\t},\n\n\tonLayerWillUnmount: function () {\n\t\tthis._map.off(this.customEvents, this);\n\t},\n\n\tboundsToQuery: function (bounds) {\n\t\treturn {\n\t\t\tlat: bounds.getSouthWest().lat,\n\t\t\tlng: bounds.getSouthWest().lng,\n\t\t\twidth: bounds.getNorthEast().lat - bounds.getSouthWest().lat,\n\t\t\theight: bounds.getNorthEast().lng - bounds.getSouthWest().lng,\n\t\t};\n\t},\n\n\tisPointInsideBounds: function (lat, lng, bounds) {\n\t\treturn (\n\t\t\tlat >= bounds.lat &&\n\t\t\tlat <= bounds.lat + bounds.width &&\n\t\t\tlng >= bounds.lng &&\n\t\t\tlng <= bounds.lng + bounds.height\n\t\t);\n\t},\n\n\tonLayerClick: function (e) {\n\t\tif (this.props.selectable) {\n\t\t\tvar pointsInsideBounds = [];\n\t\t\tvar selectedPolygons = [];\n\t\t\tvar mousePoint = e.containerPoint;\n\n\t\t\tconst self = this;\n\n\t\t\t// TODO breakable loop?\n\t\t\tif (_isArray(this.features)) {\n\t\t\t\tthis.features.forEach(feature => {\n\t\t\t\t\tconst type = feature.original.geometry.type;\n\t\t\t\t\tif (type === 'Point') {\n\t\t\t\t\t\tconst radius = feature.defaultStyle.size;\n\t\t\t\t\t\tvar LatLngBounds = L.latLngBounds(\n\t\t\t\t\t\t\tthis._map.containerPointToLatLng(\n\t\t\t\t\t\t\t\tmousePoint.add(L.point(radius, radius))\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tthis._map.containerPointToLatLng(\n\t\t\t\t\t\t\t\tmousePoint.subtract(L.point(radius, radius))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tvar BoundingBox = this.boundsToQuery(LatLngBounds);\n\t\t\t\t\t\tvar coordinates = feature.original.geometry.coordinates;\n\t\t\t\t\t\tvar lat = coordinates[1];\n\t\t\t\t\t\tvar lng = coordinates[0];\n\n\t\t\t\t\t\tif (self.isPointInsideBounds(lat, lng, BoundingBox)) {\n\t\t\t\t\t\t\tpointsInsideBounds.push(feature.original);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (type === 'Polygon' || type === 'MultiPolygon') {\n\t\t\t\t\t\tconst point = this._map.containerPointToLatLng(\n\t\t\t\t\t\t\tL.point(mousePoint.x, mousePoint.y)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst pointFeature = turfPoint([point.lng, point.lat]);\n\t\t\t\t\t\tconst insidePolygon = booleanPointInPolygon(\n\t\t\t\t\t\t\tpointFeature,\n\t\t\t\t\t\t\tfeature.original.geometry\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (insidePolygon) {\n\t\t\t\t\t\t\tselectedPolygons.push(feature);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// select single point\n\t\t\t\tif (pointsInsideBounds.length) {\n\t\t\t\t\tconst position = this._map.containerPointToLatLng(mousePoint);\n\t\t\t\t\tconst nearest = nearestPoint(\n\t\t\t\t\t\tturfPoint([position.lng, position.lat]),\n\t\t\t\t\t\t{type: 'FeatureCollection', features: pointsInsideBounds}\n\t\t\t\t\t);\n\t\t\t\t\tself.props.onClick(self.props.layerKey, [\n\t\t\t\t\t\tnearest.properties[self.props.fidColumnName],\n\t\t\t\t\t]);\n\t\t\t\t} else if (selectedPolygons.length) {\n\t\t\t\t\tself.props.onClick(self.props.layerKey, [\n\t\t\t\t\t\tselectedPolygons[0].original.properties[self.props.fidColumnName],\n\t\t\t\t\t]);\n\t\t\t\t}\n\n\t\t\t\t// TODO select single line\n\t\t\t}\n\t\t}\n\t},\n\n\tsetProps: function (data) {\n\t\tthis.props = data;\n\t\tthis.features = this.prepareFeatures(data.features);\n\t\tthis.needRedraw();\n\t},\n\n\tprepareFeatures: function (features) {\n\t\tconst props = this.props;\n\t\tlet pointFeatures = [];\n\t\tlet polygonFeatures = [];\n\t\tlet lineFeatures = [];\n\n\t\t_forEach(features, feature => {\n\t\t\tconst type = feature && feature.geometry && feature.geometry.type;\n\t\t\tconst fid =\n\t\t\t\tfeature.id ||\n\t\t\t\t(props.fidColumnName && feature.properties[props.fidColumnName]);\n\t\t\tconst defaultStyle = helpers.getDefaultStyleObject(feature, props.style);\n\n\t\t\tlet preparedFeature = {\n\t\t\t\toriginal: feature,\n\t\t\t\tdefaultStyle,\n\t\t\t\tfid,\n\t\t\t};\n\n\t\t\tif (props.selected && fid) {\n\t\t\t\t_forIn(props.selected, (selection, key) => {\n\t\t\t\t\tif (selection.keys && _includes(selection.keys, fid)) {\n\t\t\t\t\t\tpreparedFeature.selected = true;\n\t\t\t\t\t\tpreparedFeature.selectedStyle = {\n\t\t\t\t\t\t\t...defaultStyle,\n\t\t\t\t\t\t\t...helpers.getSelectedStyleObject(selection.style),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// TODO add support for multipoints and multilines\n\t\t\tif (type === 'Point') {\n\t\t\t\tpointFeatures.push(preparedFeature);\n\t\t\t} else if (type === 'Polygon' || type === 'MultiPolygon') {\n\t\t\t\tpolygonFeatures.push(preparedFeature);\n\t\t\t} else if (type === 'LineString') {\n\t\t\t\tlineFeatures.push(preparedFeature);\n\t\t\t}\n\t\t});\n\n\t\t// TODO what if diferrent geometry types in one layer?\n\t\tif (pointFeatures.length) {\n\t\t\treturn _orderBy(\n\t\t\t\tpointFeatures,\n\t\t\t\t['defaultStyle.size', 'fid'],\n\t\t\t\t['desc', 'asc']\n\t\t\t);\n\t\t} else if (polygonFeatures.length) {\n\t\t\tif (props.selected) {\n\t\t\t\treturn _orderBy(polygonFeatures, ['selected'], ['desc']);\n\t\t\t} else {\n\t\t\t\treturn polygonFeatures;\n\t\t\t}\n\t\t} else if (lineFeatures.length) {\n\t\t\tif (props.selected) {\n\t\t\t\treturn _orderBy(lineFeatures, ['selected'], ['desc']);\n\t\t\t} else {\n\t\t\t\treturn lineFeatures;\n\t\t\t}\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t},\n\n\tonDrawLayer: function (params) {\n\t\tlet context = params.canvas.getContext('2d');\n\t\tcontext.clearRect(0, 0, params.canvas.width, params.canvas.height);\n\t\tif (this.features) {\n\t\t\t// clear whole layer\n\t\t\tcontext.drawImage(this.renderOffScreen(params), 0, 0);\n\t\t}\n\t},\n\n\trenderOffScreen: function (params) {\n\t\tlet pixelSizeInMeters = null;\n\t\tvar offScreenCanvas = document.createElement('canvas');\n\t\toffScreenCanvas.width = params.canvas.width;\n\t\toffScreenCanvas.height = params.canvas.height;\n\t\tvar context = offScreenCanvas.getContext('2d');\n\n\t\tif (!params.layer.props.pointAsMarker) {\n\t\t\tpixelSizeInMeters = mapConstants.getPixelSizeInLevelsForLatitude(\n\t\t\t\tmapConstants.pixelSizeInLevels,\n\t\t\t\t0\n\t\t\t)[params.zoom];\n\t\t}\n\n\t\t// redraw all features\n\t\tfor (let i = 0; i < this.features.length; i++) {\n\t\t\tconst feature = this.features[i];\n\t\t\tconst omitFeature =\n\t\t\t\tthis.props.omittedFeatureKeys?.length &&\n\t\t\t\t_includes(this.props.omittedFeatureKeys, feature.fid);\n\n\t\t\tif (!omitFeature) {\n\t\t\t\tthis.drawFeature(\n\t\t\t\t\tcontext,\n\t\t\t\t\tparams.layer,\n\t\t\t\t\tparams.canvas,\n\t\t\t\t\tfeature,\n\t\t\t\t\tpixelSizeInMeters\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn offScreenCanvas;\n\t},\n\n\t/**\n\t * @param ctx {Object} Canvas context\n\t * @param layer {Object}\n\t * @param canvas {Object}\n\t * @param feature {Object} Feature data\n\t * @param pixelSizeInMeters {number | null}\n\t */\n\tdrawFeature: function (ctx, layer, canvas, feature, pixelSizeInMeters) {\n\t\tconst geometry = feature.original.geometry;\n\t\tconst type = geometry.type;\n\n\t\t// TODO multipoints multilines\n\t\tif (type === 'Point') {\n\t\t\tconst coordinates = geometry.coordinates;\n\t\t\tconst center = layer._map.latLngToContainerPoint([\n\t\t\t\tcoordinates[1],\n\t\t\t\tcoordinates[0],\n\t\t\t]);\n\n\t\t\tif (\n\t\t\t\tcenter.x >= 0 &&\n\t\t\t\tcenter.y >= 0 &&\n\t\t\t\tcenter.x <= canvas.width &&\n\t\t\t\tcenter.y <= canvas.height\n\t\t\t) {\n\t\t\t\tlet style = feature.defaultStyle;\n\n\t\t\t\tif (feature.selected) {\n\t\t\t\t\tstyle = feature.selectedStyle;\n\t\t\t\t}\n\n\t\t\t\tshapes.draw(ctx, center, style, pixelSizeInMeters);\n\t\t\t}\n\t\t} else if (type === 'Polygon' || type === 'MultiPolygon') {\n\t\t\tlet coordinates = null;\n\t\t\tlet style = feature.defaultStyle;\n\n\t\t\tif (feature.selected) {\n\t\t\t\tstyle = feature.selectedStyle;\n\t\t\t}\n\n\t\t\tif (type === 'Polygon') {\n\t\t\t\tcoordinates = this.getPolygonCoordinates(geometry.coordinates, layer);\n\t\t\t\tpolygons.drawPolygon(ctx, coordinates, style);\n\t\t\t} else {\n\t\t\t\tcoordinates = geometry.coordinates.map(polygon =>\n\t\t\t\t\tthis.getPolygonCoordinates(polygon, layer)\n\t\t\t\t);\n\t\t\t\tpolygons.drawMultiPolygon(ctx, coordinates, style);\n\t\t\t}\n\t\t} else if (type === 'LineString') {\n\t\t\tlet coordinates = null;\n\t\t\tlet style = feature.defaultStyle;\n\n\t\t\tif (feature.selected) {\n\t\t\t\tstyle = feature.selectedStyle;\n\t\t\t}\n\n\t\t\tcoordinates = this.getLineCoordinates(geometry.coordinates, layer);\n\t\t\tlines.drawLine(ctx, coordinates, style);\n\t\t}\n\t},\n\n\tgetPolygonCoordinates: function (polygon, layer) {\n\t\treturn polygon.map(linearRing =>\n\t\t\tthis.getLineCoordinates(linearRing, layer)\n\t\t);\n\t},\n\n\tgetLineCoordinates: function (line, layer) {\n\t\treturn line.map(coordinates => {\n\t\t\t// TODO do not add the same points again?\n\t\t\treturn layer._map.latLngToContainerPoint([\n\t\t\t\tcoordinates[1],\n\t\t\t\tcoordinates[0],\n\t\t\t]);\n\t\t});\n\t},\n});\n\nexport default LeafletCanvasLayer;\n","import {MapLayer, withLeaflet} from 'react-leaflet';\nimport LeafletCanvasLayer from './LeafletCanvasLayer';\n\nclass CanvasVectorLayer extends MapLayer {\n\tcreateLeafletElement(props) {\n\t\tlet layer = new LeafletCanvasLayer({\n\t\t\tpaneName: props.uniqueLayerKey,\n\t\t\tpaneZindex: props.zIndex,\n\t\t});\n\t\tlayer.setProps(props);\n\t\treturn layer;\n\t}\n\n\tupdateLeafletElement(fromProps, toProps) {\n\t\tsuper.updateLeafletElement(fromProps, toProps);\n\n\t\t// TODO\n\t\tif (\n\t\t\tfromProps.selected !== toProps.selected ||\n\t\t\tfromProps.features !== toProps.features ||\n\t\t\tfromProps.style !== toProps.style ||\n\t\t\tfromProps.omittedFeatureKeys !== this.props.omittedFeatureKeys\n\t\t) {\n\t\t\tthis.leafletElement.setProps(toProps);\n\t\t}\n\t}\n}\n\nexport default withLeaflet(CanvasVectorLayer);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport memoize from 'memoize-one';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport {mapConstants} from '@gisatcz/ptr-core';\n\nconst geojsonRbush = require('geojson-rbush').default;\n\nfunction getBoundingBox(view, width, height, crs, optLat) {\n\t// TODO extent calculations for non-mercator projections\n\tif (!crs || crs === 'EPSG:3857') {\n\t\tlet boxRange = view.boxRange;\n\n\t\t// view.boxRange may differ from actual rance visible in map because of levels\n\t\tconst calculatedBoxRange = mapUtils.view.getNearestZoomLevelBoxRange(\n\t\t\twidth,\n\t\t\theight,\n\t\t\tview.boxRange\n\t\t);\n\n\t\tif (boxRange !== calculatedBoxRange) {\n\t\t\tboxRange = calculatedBoxRange;\n\t\t}\n\n\t\treturn mapUtils.view.getBoundingBoxFromViewForEpsg3857(\n\t\t\tview.center,\n\t\t\tboxRange,\n\t\t\twidth / height,\n\t\t\toptLat\n\t\t);\n\t} else {\n\t\treturn {\n\t\t\tminLat: -90,\n\t\t\tmaxLat: 90,\n\t\t\tminLon: -180,\n\t\t\tmaxLon: 180,\n\t\t};\n\t}\n}\n\nclass IndexedVectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tboxRangeRange: PropTypes.array,\n\t\tcomponent: PropTypes.oneOfType([PropTypes.func, PropTypes.object]),\n\t\tomittedFeatureKeys: PropTypes.array,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\trerender: null,\n\t\t};\n\n\t\tthis.indexTree = geojsonRbush();\n\t\tthis.repopulateIndexTreeIfNeeded = memoize(features => {\n\t\t\tif (features) {\n\t\t\t\tthis.indexTree.clear();\n\t\t\t\tthis.indexTree.load(features);\n\t\t\t}\n\t\t});\n\t}\n\n\tboxRangeFitsLimits() {\n\t\tconst props = this.props;\n\t\tif (props.boxRangeRange) {\n\t\t\tconst minBoxRange = props.boxRangeRange[0];\n\t\t\tconst maxBoxRange = props.boxRangeRange[1];\n\t\t\tif (minBoxRange && maxBoxRange) {\n\t\t\t\treturn (\n\t\t\t\t\tminBoxRange <= props.view.boxRange &&\n\t\t\t\t\tmaxBoxRange >= props.view.boxRange\n\t\t\t\t);\n\t\t\t} else if (minBoxRange) {\n\t\t\t\treturn minBoxRange <= props.view.boxRange;\n\t\t\t} else if (maxBoxRange) {\n\t\t\t\treturn maxBoxRange >= props.view.boxRange;\n\t\t\t}\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {view, zoom, component, width, height, crs, ...props} = this.props;\n\n\t\tif (props.features && this.boxRangeFitsLimits()) {\n\t\t\tthis.repopulateIndexTreeIfNeeded(props.features);\n\t\t\tconst bbox = getBoundingBox(\n\t\t\t\tview,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\tcrs,\n\t\t\t\tmapConstants.averageLatitude\n\t\t\t);\n\t\t\tconst geoJsonBbox = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tbbox: [bbox.minLon, bbox.minLat, bbox.maxLon, bbox.maxLat],\n\t\t\t};\n\n\t\t\t// Find features in given bounding box\n\t\t\tconst foundFeatureCollection = this.indexTree.search(geoJsonBbox);\n\t\t\tconst foundFeatures =\n\t\t\t\t(foundFeatureCollection && foundFeatureCollection.features) || [];\n\n\t\t\t// Add filtered features only to Vector layer\n\t\t\tif (props.features.length !== foundFeatures.length) {\n\t\t\t\tprops.features = foundFeatures;\n\t\t\t}\n\n\t\t\treturn React.createElement(component, props);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport default IndexedVectorLayer;\n","import React from 'react';\n\nimport Context from '@gisatcz/cross-package-react-context';\nimport {indexOf as _indexOf} from 'lodash';\nconst HoverContext = Context.getContext('HoverContext');\n\nexport default function contextWrapper(WrappedFeature) {\n\treturn class extends React.PureComponent {\n\t\tstatic contextType = HoverContext;\n\n\t\tconstructor(props) {\n\t\t\tsuper(props);\n\n\t\t\tthis.hoveredFromContext = false;\n\t\t\tthis.changeContext = this.changeContext.bind(this);\n\t\t}\n\n\t\tchangeContext(hoveredItems, options) {\n\t\t\tif (hoveredItems && this.context && this.context.onHover) {\n\t\t\t\tthis.context.onHover(hoveredItems, options);\n\t\t\t} else if (!hoveredItems && this.context && this.context.onHoverOut) {\n\t\t\t\tthis.context.onHoverOut();\n\t\t\t}\n\t\t}\n\n\t\trender() {\n\t\t\tif (this.props.fid && this.context && this.context.hoveredItems) {\n\t\t\t\tthis.hoveredFromContext =\n\t\t\t\t\t_indexOf(this.context.hoveredItems, this.props.fid) !== -1;\n\t\t\t}\n\n\t\t\t// TODO interactive without context case?\n\t\t\tif (this.context && this.props.hoverable) {\n\t\t\t\treturn (\n\t\t\t\t\t<WrappedFeature\n\t\t\t\t\t\t{...this.props}\n\t\t\t\t\t\tchangeContext={this.changeContext}\n\t\t\t\t\t\thoveredFromContext={this.hoveredFromContext}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn <WrappedFeature {...this.props} />;\n\t\t\t}\n\t\t}\n\t};\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Circle, Polygon, Marker, Polyline} from 'react-leaflet';\nimport {shallowEqualObjects} from 'shallow-equal';\nimport {utils} from '@gisatcz/ptr-utils';\n\nimport ContextWrapper from './ContextWrapper';\nimport helpers from '../helpers';\n\nclass Feature extends React.PureComponent {\n\tstatic propTypes = {\n\t\tfeature: PropTypes.object,\n\t\tfid: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n\t\tfidColumnName: PropTypes.string,\n\t\thoverable: PropTypes.bool,\n\t\thoveredFromContext: PropTypes.bool,\n\t\thoveredStyleDefinition: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object,\n\t\t]),\n\t\tselectable: PropTypes.bool,\n\t\tselected: PropTypes.bool,\n\t\tselectedStyleDefinition: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object,\n\t\t]),\n\t\tselectedHoveredStyleDefinition: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object,\n\t\t]),\n\t\tchangeContext: PropTypes.func,\n\t\tinteractive: PropTypes.bool,\n\t\tstyleDefinition: PropTypes.object,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this);\n\t\tthis.onMouseOut = this.onMouseOut.bind(this);\n\t\tthis.onAdd = this.onAdd.bind(this);\n\n\t\tthis.fid = props.fid;\n\n\t\tif (props.type === 'Point' && props.pointAsMarker) {\n\t\t\tthis.shapeId = this.props.uniqueFeatureKey\n\t\t\t\t? `${this.props.uniqueFeatureKey}_icon`\n\t\t\t\t: utils.uuid();\n\t\t}\n\n\t\tthis.state = {\n\t\t\thovered: false,\n\t\t};\n\n\t\tthis.calculateStyles = helpers.calculateStylesMemo;\n\t\tthis.convertCoordinates = helpers.convertCoordinatesMemo;\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (this.props.hasOwnProperty('hoveredFromContext')) {\n\t\t\tif (this.props.hoveredFromContext && !this.state.hovered) {\n\t\t\t\tthis.showOnTop();\n\t\t\t\tthis.setState({hovered: true});\n\t\t\t} else if (!this.props.hoveredFromContext && this.state.hovered) {\n\t\t\t\tif (!this.props.selected) {\n\t\t\t\t\tthis.showOnBottom();\n\t\t\t\t}\n\t\t\t\tthis.setState({hovered: false});\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (this.props.changeContext) {\n\t\t\tthis.props.changeContext(null);\n\t\t}\n\t}\n\n\tonAdd(event) {\n\t\tif (event.target) {\n\t\t\tthis.leafletFeature = event.target;\n\t\t}\n\t}\n\n\tonClick() {\n\t\tif (this.props.selectable) {\n\t\t\tthis.showOnTop();\n\n\t\t\tif (this.props.onClick && this.props.fid) {\n\t\t\t\tthis.props.onClick(this.props.fid);\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseMove(event) {\n\t\tif (this.props.hoverable) {\n\t\t\tthis.showOnTop();\n\n\t\t\tif (this.fid && this.props.changeContext) {\n\t\t\t\tthis.props.changeContext([this.fid], {\n\t\t\t\t\tpopup: {\n\t\t\t\t\t\tx: event.originalEvent ? event.originalEvent.pageX : event.pageX,\n\t\t\t\t\t\ty: event.originalEvent ? event.originalEvent.pageY : event.pageY,\n\t\t\t\t\t\tfidColumnName: this.props.fidColumnName,\n\t\t\t\t\t\tdata: this.props.feature.properties,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.state.hovered) {\n\t\t\t\tthis.setState({hovered: true});\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseOut() {\n\t\tif (this.props.hoverable) {\n\t\t\tif (!this.props.selected) {\n\t\t\t\tthis.showOnBottom();\n\t\t\t}\n\n\t\t\tif (this.props.changeContext) {\n\t\t\t\tthis.props.changeContext(null);\n\t\t\t}\n\n\t\t\tthis.setState({hovered: false});\n\t\t}\n\t}\n\n\t/**\n\t * Show feature on the top of others, if it's not a point\n\t */\n\tshowOnTop() {\n\t\tif (this.leafletFeature && this.props.type !== 'Point') {\n\t\t\tthis.leafletFeature.bringToFront();\n\t\t}\n\t}\n\n\t/**\n\t * Show feature in the bottom, if it's a polygon\n\t */\n\tshowOnBottom() {\n\t\tif (\n\t\t\tthis.leafletFeature &&\n\t\t\t(this.props.type === 'Polygon' || this.props.type === 'MultiPolygon')\n\t\t) {\n\t\t\tthis.leafletFeature.bringToBack();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst props = this.props;\n\t\tconst coordinates = this.convertCoordinates(props.feature);\n\t\tconst styles = this.calculateStyles(\n\t\t\tprops.feature,\n\t\t\tprops.styleDefinition,\n\t\t\tprops.hoveredStyleDefinition,\n\t\t\tprops.selected,\n\t\t\tprops.selectedStyleDefinition,\n\t\t\tprops.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tlet style = styles.default;\n\n\t\tif (props.selected && this.state.hovered && styles.selectedHovered) {\n\t\t\tstyle = styles.selectedHovered;\n\t\t} else if (this.state.hovered && styles.hovered) {\n\t\t\tstyle = styles.hovered;\n\t\t} else if (props.selected && styles.selected) {\n\t\t\tstyle = styles.selected;\n\t\t}\n\n\t\t// TODO add support for other geometry types\n\t\tswitch (this.props.type) {\n\t\t\tcase 'Polygon':\n\t\t\tcase 'MultiPolygon':\n\t\t\t\treturn this.renderPolygon(coordinates, style);\n\t\t\tcase 'Point':\n\t\t\tcase 'MultiPoint':\n\t\t\t\treturn this.renderPoint(coordinates, style);\n\t\t\tcase 'LineString':\n\t\t\tcase 'MultiLineString':\n\t\t\t\treturn this.renderLine(coordinates, style);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\trenderPolygon(coordinates, style) {\n\t\treturn (\n\t\t\t<Polygon\n\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\tonAdd={this.onAdd}\n\t\t\t\tonClick={this.onClick}\n\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\tpositions={coordinates}\n\t\t\t\t{...style}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderLine(coordinates, style) {\n\t\treturn (\n\t\t\t<Polyline\n\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\tonAdd={this.onAdd}\n\t\t\t\tonClick={this.onClick}\n\t\t\t\tonMouseOver={this.onMouseMove}\n\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\tpositions={coordinates}\n\t\t\t\t{...style}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderPoint(coordinates, style) {\n\t\tif (this.props.pointAsMarker) {\n\t\t\treturn this.renderShape(coordinates, style);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<Circle\n\t\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\t\tonAdd={this.onAdd}\n\t\t\t\t\tonClick={this.onClick}\n\t\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\t\tonMouseOver={this.onMouseMove}\n\t\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\t\tcenter={coordinates}\n\t\t\t\t\t{...style}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n\n\trenderShape(coordinates, style) {\n\t\tif (!this.shape) {\n\t\t\tthis.shape = helpers.getMarkerShape(this.shapeId, style, {\n\t\t\t\ticons: this.props.icons,\n\t\t\t\tonMouseMove: this.onMouseMove,\n\t\t\t\tonMouseOver: this.onMouseMove,\n\t\t\t\tonMouseOut: this.onMouseOut,\n\t\t\t\tonClick: this.onClick,\n\t\t\t});\n\t\t}\n\n\t\tif (!shallowEqualObjects(this.style, style)) {\n\t\t\tthis.style = style;\n\t\t\tthis.shape.setStyle(style, this.shapeId, this.shape.basicShape);\n\t\t}\n\n\t\treturn (\n\t\t\t<Marker\n\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\tposition={coordinates}\n\t\t\t\ticon={this.shape}\n\t\t\t\tonAdd={this.onAdd}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default ContextWrapper(Feature);\n","import React from 'react';\nimport {includes as _includes} from 'lodash';\nimport PropTypes from 'prop-types';\nimport {utils} from '@gisatcz/ptr-utils';\nimport {GeoJSON, withLeaflet} from 'react-leaflet';\nimport L from 'leaflet';\nimport helpers from '../helpers';\nimport memoize from 'memoize-one';\n\nclass GeoJsonLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tomittedFeatureKeys: PropTypes.array, // list of feature keys that shouldn't be rendered\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getStyle = this.getStyle.bind(this);\n\t\tthis.filter = this.filter.bind(this);\n\t\tthis.onEachFeature = this.onEachFeature.bind(this);\n\t\tthis.pointToLayer = this.pointToLayer.bind(this);\n\n\t\tthis.getRenderId = memoize(features => {\n\t\t\tif (features) {\n\t\t\t\treturn utils.uuid();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetStyle(feature) {\n\t\tconst styles = helpers.calculateStyle(\n\t\t\tfeature.feature,\n\t\t\tthis.props.styleDefinition,\n\t\t\tthis.props.hoveredStyleDefinition,\n\t\t\tfeature.selected,\n\t\t\tfeature.selectedStyleDefinition,\n\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tif (feature.selected) {\n\t\t\treturn styles.selected;\n\t\t} else {\n\t\t\treturn styles.default;\n\t\t}\n\t}\n\n\tonEachFeature(feature, layer) {\n\t\tconst geometryType = feature.geometry.type;\n\t\tconst isPolygon =\n\t\t\tgeometryType === 'Polygon' || geometryType === 'MultiPolygon';\n\t\tconst isLine = geometryType === 'Line' || geometryType === 'LineString';\n\n\t\tconst styles = helpers.calculateStyle(\n\t\t\tfeature.feature,\n\t\t\tthis.props.styleDefinition,\n\t\t\tthis.props.hoveredStyleDefinition,\n\t\t\tfeature.selected,\n\t\t\tfeature.selectedStyleDefinition,\n\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tlayer.on({\n\t\t\tclick: e => {\n\t\t\t\tif (this.props.onFeatureClick && this.props.selectable && feature.fid) {\n\t\t\t\t\tthis.props.onFeatureClick(feature.fid);\n\t\t\t\t}\n\t\t\t},\n\t\t\tmousemove: e => {\n\t\t\t\tif (this.props.hoverable) {\n\t\t\t\t\tif (feature.selected && styles.selectedHovered) {\n\t\t\t\t\t\tthis.setStyle(styles.selectedHovered, e.target);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setStyle(styles.hovered, e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isPolygon || isLine) {\n\t\t\t\t\t\tlayer.bringToFront();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmouseout: e => {\n\t\t\t\tif (this.props.hoverable) {\n\t\t\t\t\tif (feature.selected && styles.selected) {\n\t\t\t\t\t\tthis.setStyle(styles.selected, e.target);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setStyle(styles.default, e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((isLine || isPolygon) && !feature.selected) {\n\t\t\t\t\t\tlayer.bringToBack();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Set style of the feature\n\t * @param leafletStyle {Object} Leaflet style definition\n\t * @param element {Object} Leaflet element\n\t */\n\tsetStyle(leafletStyle, element) {\n\t\tconst shape = element?.options?.icon;\n\t\tif (shape) {\n\t\t\tshape.setStyle(leafletStyle, shape.id, shape.isBasicShape);\n\t\t} else {\n\t\t\telement.setStyle(leafletStyle);\n\t\t}\n\t}\n\n\t// render points\n\tpointToLayer(feature, coord) {\n\t\tif (this.props.pointAsMarker) {\n\t\t\tlet style = feature.defaultStyle;\n\n\t\t\t// for circles, use L.circleMarker due to better performance\n\t\t\tif ((!style?.shape && !style?.icon) || style?.shape === 'circle') {\n\t\t\t\treturn L.circleMarker(coord, {\n\t\t\t\t\t...feature.defaultStyle,\n\t\t\t\t\tpane: this.props.paneName,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (feature.selected) {\n\t\t\t\t\tconst styles = helpers.calculateStyle(\n\t\t\t\t\t\tfeature.feature,\n\t\t\t\t\t\tthis.props.styleDefinition,\n\t\t\t\t\t\tthis.props.hoveredStyleDefinition,\n\t\t\t\t\t\tfeature.selected,\n\t\t\t\t\t\tfeature.selectedStyleDefinition,\n\t\t\t\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t\t\t\t);\n\t\t\t\t\tstyle = styles.selected;\n\t\t\t\t}\n\n\t\t\t\tconst shapeId = feature.uniqueFeatureKey\n\t\t\t\t\t? `${feature.uniqueFeatureKey}_icon`\n\t\t\t\t\t: utils.uuid();\n\t\t\t\tconst shape = helpers.getMarkerShape(shapeId, style, {\n\t\t\t\t\ticons: this.props.icons,\n\t\t\t\t});\n\n\t\t\t\treturn L.marker(coord, {\n\t\t\t\t\tpane: this.props.paneName,\n\t\t\t\t\tinteractive: this.props.hoverable || this.props.selectable,\n\t\t\t\t\ticon: shape,\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\treturn L.circle(coord, feature.defaultStyle);\n\t\t}\n\t}\n\n\tfilter(feature) {\n\t\tif (this.props.omittedFeatureKeys) {\n\t\t\tconst featureKey =\n\t\t\t\tfeature.id || feature.properties[this.props.fidColumnName];\n\t\t\treturn !(\n\t\t\t\tfeatureKey && _includes(this.props.omittedFeatureKeys, featureKey)\n\t\t\t);\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\trender() {\n\t\tconst features = this.props.features.map(item => {\n\t\t\treturn {...item.feature, ...item};\n\t\t});\n\n\t\t// generate new key on features change to return the new instance\n\t\t// more: https://react-leaflet.js.org/docs/en/components#geojson\n\t\tconst key = this.getRenderId(this.props.features);\n\n\t\treturn (\n\t\t\t<GeoJSON\n\t\t\t\tkey={key}\n\t\t\t\tdata={features}\n\t\t\t\tstyle={this.getStyle}\n\t\t\t\tonEachFeature={this.onEachFeature}\n\t\t\t\tpointToLayer={this.pointToLayer}\n\t\t\t\tfilter={this.filter}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default withLeaflet(GeoJsonLayer);\n","import React from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\nimport {\n\tforEach as _forEach,\n\tforIn as _forIn,\n\tincludes as _includes,\n\torderBy as _orderBy,\n} from 'lodash';\nimport {utils} from '@gisatcz/ptr-utils';\nimport {Pane} from 'react-leaflet';\n\nimport helpers from './helpers';\nimport Feature from './Feature';\nimport constants from '../../../constants';\nimport GeoJsonLayer from './GeoJsonLayer';\n\nclass SvgVectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.string, // typically a combination of layerKey and data source key (or just layerKey, if no data source)\n\t\trenderAsGeoJson: PropTypes.bool, // Use Leaflet's GeoJSON layer to render vector features\n\t\tfeatures: PropTypes.array,\n\t\tfidColumnName: PropTypes.string,\n\t\tomittedFeatureKeys: PropTypes.array,\n\t\tselectable: PropTypes.bool,\n\t\tselected: PropTypes.object,\n\t\thoverable: PropTypes.bool,\n\t\thovered: PropTypes.object,\n\t\tstyle: PropTypes.object,\n\t\tpointAsMarker: PropTypes.bool,\n\t\tonClick: PropTypes.func,\n\t\twithSelectedFeaturesOnly: PropTypes.bool, // True, if layer contains only selected features\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.pointsPaneName = utils.uuid();\n\t\tthis.linesPaneName = utils.uuid();\n\t\tthis.polygonsPaneName = utils.uuid();\n\t\tthis.onFeatureClick = this.onFeatureClick.bind(this);\n\t}\n\n\tonFeatureClick(fid) {\n\t\tif (this.props.onClick) {\n\t\t\tthis.props.onClick(this.props.layerKey, [fid]);\n\t\t}\n\t}\n\n\tprepareData(features) {\n\t\tif (features) {\n\t\t\tlet pointFeatures = [];\n\t\t\tlet polygonFeatures = [];\n\t\t\tlet lineFeatures = [];\n\n\t\t\tlet sortedPointFeatures = null;\n\t\t\tlet sortedPolygonFeatures = null;\n\n\t\t\t_forEach(features, feature => {\n\t\t\t\tconst type = feature && feature.geometry && feature.geometry.type;\n\n\t\t\t\tif (type) {\n\t\t\t\t\tconst fid =\n\t\t\t\t\t\tthis.props.fidColumnName &&\n\t\t\t\t\t\tfeature.properties[this.props.fidColumnName];\n\t\t\t\t\tconst uniqueFeatureKey = `${this.props.uniqueLayerKey}_${fid}`;\n\n\t\t\t\t\tlet selected = null;\n\t\t\t\t\tlet defaultStyle = null;\n\n\t\t\t\t\tif (this.props.selected && fid) {\n\t\t\t\t\t\t_forIn(this.props.selected, (selection, key) => {\n\t\t\t\t\t\t\tif (selection.keys && _includes(selection.keys, fid)) {\n\t\t\t\t\t\t\t\tselected = selection;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === 'Point' || type === 'MultiPoint') {\n\t\t\t\t\t\tdefaultStyle = helpers.getDefaultStyle(feature, this.props.style);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst data = {\n\t\t\t\t\t\tfeature,\n\t\t\t\t\t\tfid,\n\t\t\t\t\t\tuniqueFeatureKey,\n\t\t\t\t\t\tdefaultStyle,\n\t\t\t\t\t\tselected: !!selected,\n\t\t\t\t\t\tselectedStyleDefinition: selected?.style,\n\t\t\t\t\t\tselectedHoveredStyleDefinition: selected?.hoveredStyle,\n\t\t\t\t\t};\n\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase 'Point':\n\t\t\t\t\t\tcase 'MultiPoint':\n\t\t\t\t\t\t\tpointFeatures.push(data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Polygon':\n\t\t\t\t\t\tcase 'MultiPolygon':\n\t\t\t\t\t\t\tpolygonFeatures.push(data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'LineString':\n\t\t\t\t\t\tcase 'MultiLineString':\n\t\t\t\t\t\t\tlineFeatures.push(data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// sort point features by radius\n\t\t\tif (pointFeatures.length) {\n\t\t\t\tsortedPointFeatures = _orderBy(\n\t\t\t\t\tpointFeatures,\n\t\t\t\t\t['defaultStyle.radius', 'fid'],\n\t\t\t\t\t['desc', 'asc']\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// sort polygon features, if selected\n\t\t\tif (polygonFeatures.length) {\n\t\t\t\tif (this.props.selected) {\n\t\t\t\t\tsortedPolygonFeatures = _orderBy(\n\t\t\t\t\t\tpolygonFeatures,\n\t\t\t\t\t\t['selected'],\n\t\t\t\t\t\t['asc']\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsortedPolygonFeatures = polygonFeatures;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tpolygons: sortedPolygonFeatures,\n\t\t\t\tpoints: sortedPointFeatures || pointFeatures,\n\t\t\t\tlines: lineFeatures,\n\t\t\t};\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\trender() {\n\t\tconst data = this.prepareData(this.props.features);\n\t\tconst style = this.props.opacity ? {opacity: this.props.opacity} : null;\n\t\tconst classes = classnames({\n\t\t\t'hoverable-pane': this.props.hoverable,\n\t\t\t'selected-features-pane': this.props.withSelectedFeaturesOnly,\n\t\t});\n\n\t\treturn data ? (\n\t\t\t<>\n\t\t\t\t{data.polygons?.length ? (\n\t\t\t\t\t<Pane className={classes} style={style} name={this.polygonsPaneName}>\n\t\t\t\t\t\t{this.renderFeatures(data.polygons)}\n\t\t\t\t\t</Pane>\n\t\t\t\t) : null}\n\t\t\t\t{data.lines?.length ? (\n\t\t\t\t\t<Pane className={classes} style={style} name={this.linesPaneName}>\n\t\t\t\t\t\t{this.renderFeatures(data.lines)}\n\t\t\t\t\t</Pane>\n\t\t\t\t) : null}\n\t\t\t\t{data.points?.length ? (\n\t\t\t\t\t<Pane className={classes} style={style} name={this.pointsPaneName}>\n\t\t\t\t\t\t{this.renderFeatures(data.points)}\n\t\t\t\t\t</Pane>\n\t\t\t\t) : null}\n\t\t\t</>\n\t\t) : null;\n\t}\n\n\trenderFeatures(features) {\n\t\tif (\n\t\t\tthis.props.renderAsGeoJson ||\n\t\t\tfeatures.length > constants.maxFeaturesAsReactElement\n\t\t) {\n\t\t\t// GeoJsonLayer doesn't get context\n\t\t\treturn this.renderGeoJson(features);\n\t\t} else {\n\t\t\treturn features.map((item, index) => this.renderFeature(item, index));\n\t\t}\n\t}\n\n\trenderGeoJson(features) {\n\t\treturn (\n\t\t\t<GeoJsonLayer\n\t\t\t\tlayerKey={this.props.layerKey}\n\t\t\t\tuniqueLayerKey={this.props.uniqueLayerKey}\n\t\t\t\tpaneName={this.pointsPaneName}\n\t\t\t\tfeatures={features}\n\t\t\t\tonFeatureClick={this.onFeatureClick}\n\t\t\t\tomittedFeatureKeys={this.props.omittedFeatureKeys}\n\t\t\t\tfidColumnName={this.props.fidColumnName}\n\t\t\t\tpointAsMarker={this.props.pointAsMarker}\n\t\t\t\tselectable={this.props.selectable}\n\t\t\t\thoverable={this.props.hoverable}\n\t\t\t\tstyleDefinition={this.props.style}\n\t\t\t\thoveredStyleDefinition={this.props.hovered && this.props.hovered.style}\n\t\t\t\ticons={this.props.resources?.icons}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderFeature(data, index) {\n\t\tconst key =\n\t\t\tdata.uniqueFeatureKey ||\n\t\t\t`${this.props.uniqueLayerKey}_${data.fid || index}`;\n\n\t\treturn (\n\t\t\t<Feature\n\t\t\t\tkey={key}\n\t\t\t\tuniqueFeatureKey={data.uniqueFeatureKey}\n\t\t\t\tonClick={this.onFeatureClick}\n\t\t\t\tfid={data.fid}\n\t\t\t\tfidColumnName={this.props.fidColumnName}\n\t\t\t\tfeature={data.feature}\n\t\t\t\ttype={data.feature.geometry.type}\n\t\t\t\tpointAsMarker={this.props.pointAsMarker}\n\t\t\t\tselectable={this.props.selectable}\n\t\t\t\tselected={data.selected}\n\t\t\t\tselectedStyleDefinition={data.selectedStyleDefinition}\n\t\t\t\tselectedHoveredStyleDefinition={data.selectedStyleDefinition}\n\t\t\t\thoverable={this.props.hoverable}\n\t\t\t\tstyleDefinition={this.props.style}\n\t\t\t\thoveredStyleDefinition={this.props.hovered && this.props.hovered.style}\n\t\t\t\ticons={this.props.resources?.icons}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default SvgVectorLayer;\n","import React from 'react';\nimport {\n\tfindIndex as _findIndex,\n\tforEach as _forEach,\n\tisEqual as _isEqual,\n} from 'lodash';\nimport PropTypes from 'prop-types';\nimport memoize from 'memoize-one';\n\nimport IndexedVectorLayer from '../IndexedVectorLayer';\nimport CanvasVectorLayer from '../CanvasVectorLayer';\nimport SvgVectorLayer from '../SvgVectorLayer';\n\n/**\n * @param featureKeysGroupedByTileKey {Array} A collection of feature keys by tile key\n * @param tileKey {String} unique tile identifier\n * @param features {Array} List of current tile's features\n * @param fidColumnName {String}\n * @return {[]|null} List of feature keys to omit\n */\nfunction getFeatureKeysToOmit(\n\tfeatureKeysGroupedByTileKey,\n\ttileKey,\n\tfeatures,\n\tfidColumnName\n) {\n\t// Find the order of current tile among others\n\tconst indexOfCurrentTile = _findIndex(featureKeysGroupedByTileKey, tile => {\n\t\treturn tile.tileKey === tileKey;\n\t});\n\n\tlet i = 0;\n\tif (indexOfCurrentTile > 0) {\n\t\tlet featureKeysToOmit = [];\n\t\tlet renderedFeatureKeys = new Set();\n\n\t\t// Iterate over sibling tiles that should be rendered earlier\n\t\t// TODO don't iterate through features in each tile again\n\t\twhile (i < indexOfCurrentTile) {\n\t\t\tconst tile = featureKeysGroupedByTileKey[i];\n\t\t\t_forEach(tile.featureKeys, featureKey => {\n\t\t\t\trenderedFeatureKeys.add(featureKey);\n\t\t\t});\n\t\t\ti++;\n\t\t}\n\n\t\t// Iterate over current tile's features to find which features are rendered already\n\t\t_forEach(features, feature => {\n\t\t\t// TODO feature.id\n\t\t\tconst featureKey = feature.properties[fidColumnName];\n\t\t\tif (featureKey && renderedFeatureKeys.has(featureKey)) {\n\t\t\t\tfeatureKeysToOmit.push(featureKey);\n\t\t\t}\n\t\t});\n\n\t\treturn featureKeysToOmit.length ? featureKeysToOmit : null;\n\t} else {\n\t\treturn null;\n\t}\n}\n\n/**\n * Return true, if previous feature keys are the same as the next\n * @param prev {Array} previous arguments\n * @param next {Array} next arguments\n * @return {boolean}\n */\nfunction checkIdentity(prev, next) {\n\tconst prevKeys = prev[0];\n\tconst nextKeys = next[0];\n\n\tif (!prevKeys && !nextKeys) {\n\t\treturn true;\n\t} else if (!prevKeys || !nextKeys) {\n\t\treturn false;\n\t} else {\n\t\t//performance suggestion\n\t\t// return prevKeys.sort().join(',') === nextKeys.sort().join(',')\n\t\treturn _isEqual(prevKeys.sort(), nextKeys.sort());\n\t}\n}\n\nclass Tile extends React.PureComponent {\n\tstatic propTypes = {\n\t\ttileKey: PropTypes.string,\n\t\tfeatures: PropTypes.array,\n\t\tfidColumnName: PropTypes.string,\n\t\tlevel: PropTypes.number,\n\t\ttile: PropTypes.oneOfType([PropTypes.array, PropTypes.string]),\n\t\tfeatureKeysGroupedByTileKey: PropTypes.array, // a collection of all tiles and their features for each tile in the layer\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getFeatureKeysToOmit = memoize(getFeatureKeysToOmit);\n\n\t\t// return memoized feature keys, if nothing changed and not render IndexedVectorLayer again\n\t\tthis.checkIdentity = memoize(keys => keys, checkIdentity);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttileKey,\n\t\t\tfeatureKeysGroupedByTileKey,\n\t\t\tcomponent,\n\t\t\t...props\n\t\t} = this.props;\n\t\tconst omittedFeatureKeys = this.getFeatureKeysToOmit(\n\t\t\tfeatureKeysGroupedByTileKey,\n\t\t\ttileKey,\n\t\t\tprops.features,\n\t\t\tprops.fidColumnName\n\t\t);\n\n\t\tif (props.renderingTechnique === 'canvas') {\n\t\t\treturn (\n\t\t\t\t<CanvasVectorLayer\n\t\t\t\t\t{...props}\n\t\t\t\t\tkey={tileKey}\n\t\t\t\t\tuniqueLayerKey={tileKey}\n\t\t\t\t\tomittedFeatureKeys={this.checkIdentity(omittedFeatureKeys)}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<IndexedVectorLayer\n\t\t\t\t\t{...props}\n\t\t\t\t\tcomponent={SvgVectorLayer}\n\t\t\t\t\tkey={tileKey}\n\t\t\t\t\tuniqueLayerKey={tileKey}\n\t\t\t\t\tomittedFeatureKeys={this.checkIdentity(omittedFeatureKeys)}\n\t\t\t\t\trenderAsGeoJson // TODO always render as GeoJson for now\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default Tile;\n","import React from 'react';\nimport {\n\tforEach as _forEach,\n\tforIn as _forIn,\n\tincludes as _includes,\n\tisEmpty as _isEmpty,\n\tuniq as _uniq,\n} from 'lodash';\nimport PropTypes from 'prop-types';\nimport memoize from 'memoize-one';\n\nimport Tile from './Tile';\n\n/**\n * @param uniqueLayerKey {string}\n * @param tile {Object}\n * @return {string}\n */\nfunction getTileKey(uniqueLayerKey, tile) {\n\treturn `${uniqueLayerKey}_${tile.level}_${\n\t\ttypeof tile.tile === 'string' ? tile.tile : JSON.stringify(tile.tile)\n\t}`;\n}\n\n/**\n * @param uniqueLayerKey {string}\n * @param tiles {Array}\n * @param fidColumnName {string}\n * @param selections {Object}\n * @return {Object} groupedFeatures - a collection of features grouped by tile key, groupedFeaturesKeys - a collection of feature keys grouped by tile key\n */\nfunction getFeaturesGroupedByTileKey(\n\tuniqueLayerKey,\n\ttiles,\n\tfidColumnName,\n\tselections\n) {\n\tlet groupedFeatures = [];\n\tlet groupedFeatureKeys = [];\n\tlet selected = {};\n\n\t_forEach(tiles, tile => {\n\t\t// TODO pass featureKeys or filters\n\t\tconst key = getTileKey(uniqueLayerKey, tile);\n\t\tlet tileFeatureKeys = [];\n\n\t\tif (tile.features) {\n\t\t\t_forEach(tile.features, feature => {\n\t\t\t\tconst fid = feature.id || feature.properties[fidColumnName];\n\n\t\t\t\tif (selections) {\n\t\t\t\t\t_forIn(selections, (selection, selectionKey) => {\n\t\t\t\t\t\tif (selection.keys && _includes(selection.keys, fid)) {\n\t\t\t\t\t\t\tif (selected[selectionKey]?.features) {\n\t\t\t\t\t\t\t\tselected[selectionKey].features[fid] = feature;\n\t\t\t\t\t\t\t\tselected[selectionKey].featureKeys.push(fid);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected[selectionKey] = {\n\t\t\t\t\t\t\t\t\tfeatures: {\n\t\t\t\t\t\t\t\t\t\t[fid]: feature,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfeatureKeys: [fid],\n\t\t\t\t\t\t\t\t\tlevel: tile.level,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttileFeatureKeys.push(fid);\n\t\t\t});\n\t\t}\n\n\t\tgroupedFeatures.push({\n\t\t\t...tile,\n\t\t\tkey,\n\t\t});\n\n\t\tgroupedFeatureKeys.push({\n\t\t\tkey,\n\t\t\tfeatureKeys: tileFeatureKeys,\n\t\t});\n\t});\n\n\tif (!_isEmpty(selected)) {\n\t\t_forIn(selected, (selection, selectionKey) => {\n\t\t\tconst key = `${uniqueLayerKey}_${selectionKey}_${selection.level}`;\n\t\t\tgroupedFeatures.unshift({\n\t\t\t\tkey,\n\t\t\t\tfeatures: Object.values(selection.features),\n\t\t\t\tlevel: selection.level,\n\t\t\t\twithSelectedFeaturesOnly: true,\n\t\t\t});\n\n\t\t\tgroupedFeatureKeys.unshift({\n\t\t\t\tkey,\n\t\t\t\tfeatureKeys: _uniq(selection.featureKeys),\n\t\t\t});\n\t\t});\n\t}\n\n\treturn {groupedFeatures, groupedFeatureKeys};\n}\n\nclass TiledVectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tfidColumnName: PropTypes.string,\n\t\ttiles: PropTypes.array,\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.string,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getFeaturesGroupedByTileKey = memoize(getFeaturesGroupedByTileKey);\n\t}\n\n\trender() {\n\t\tconst {tiles, ...props} = this.props;\n\t\tconst data = this.getFeaturesGroupedByTileKey(\n\t\t\tprops.uniqueLayerKey,\n\t\t\ttiles,\n\t\t\tprops.fidColumnName,\n\t\t\tprops.selected\n\t\t);\n\n\t\tif (data.groupedFeatures?.length) {\n\t\t\treturn data.groupedFeatures.map(tile => {\n\t\t\t\treturn (\n\t\t\t\t\t<Tile\n\t\t\t\t\t\t{...props}\n\t\t\t\t\t\tkey={tile.key}\n\t\t\t\t\t\ttileKey={tile.key}\n\t\t\t\t\t\tfeatures={tile.features}\n\t\t\t\t\t\tlevel={tile.level}\n\t\t\t\t\t\ttile={tile.tile}\n\t\t\t\t\t\tfeatureKeysGroupedByTileKey={data.groupedFeatureKeys}\n\t\t\t\t\t\twithSelectedFeaturesOnly={tile.withSelectedFeaturesOnly}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t});\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport default TiledVectorLayer;\n","import React from 'react';\nimport {find as _find} from 'lodash';\nimport PropTypes from 'prop-types';\n\nimport CanvasVectorLayer from '../CanvasVectorLayer';\nimport IndexedVectorLayer from '../IndexedVectorLayer';\nimport SvgVectorLayer from '../SvgVectorLayer';\nimport TiledVectorLayer from '../TiledVectorLayer';\nimport view from '../../../utils/view';\n\nclass VectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\t\tonClick: PropTypes.func,\n\t\topacity: PropTypes.number,\n\t\toptions: PropTypes.object,\n\t\ttype: PropTypes.string,\n\t\tview: PropTypes.object,\n\t\tzoom: PropTypes.number,\n\t\tzIndex: PropTypes.number,\n\t};\n\n\tgetOptions() {\n\t\tconst props = this.props;\n\t\tconst renderAs = props.options?.renderAs;\n\t\tlet options = props.options;\n\n\t\tif (renderAs) {\n\t\t\tconst boxRange = props.view?.boxRange;\n\t\t\tconst renderAsData = _find(renderAs, renderAsItem => {\n\t\t\t\treturn view.isBoxRangeInRange(boxRange, renderAsItem.boxRangeRange);\n\t\t\t});\n\n\t\t\tif (renderAsData) {\n\t\t\t\t// TODO enable to define other layer options in renderAs\n\t\t\t\toptions = {\n\t\t\t\t\t...options,\n\t\t\t\t\tstyle: renderAsData.options?.style || options?.style,\n\t\t\t\t\tpointAsMarker: renderAsData.options?.hasOwnProperty('pointAsMarker')\n\t\t\t\t\t\t? renderAsData.options.pointAsMarker\n\t\t\t\t\t\t: options?.pointAsMarker,\n\t\t\t\t\trenderingTechnique:\n\t\t\t\t\t\trenderAsData.options?.renderingTechnique ||\n\t\t\t\t\t\toptions?.renderingTechnique,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn options;\n\t}\n\n\trender() {\n\t\tconst {type} = this.props;\n\t\tconst options = this.getOptions();\n\n\t\t// TODO handle type 'diagram'\n\t\tif (type === 'tiledVector' || type === 'tiled-vector') {\n\t\t\treturn this.renderTiledVectorLayer(options);\n\t\t} else {\n\t\t\treturn this.renderBasicVectorLayer(options);\n\t\t}\n\t}\n\n\trenderTiledVectorLayer(options) {\n\t\tconst {options: opt, ...props} = this.props;\n\n\t\treturn <TiledVectorLayer {...props} {...options} />;\n\t}\n\n\trenderBasicVectorLayer(options) {\n\t\tconst {options: opt, ...props} = this.props;\n\n\t\tif (options.renderingTechnique === 'canvas') {\n\t\t\treturn <CanvasVectorLayer {...props} {...options} />;\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<IndexedVectorLayer\n\t\t\t\t\tcomponent={SvgVectorLayer}\n\t\t\t\t\t{...props}\n\t\t\t\t\t{...options}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default VectorLayer;\n","/*!\n * leaflet.wms.js\n * A collection of Leaflet utilities for working with Web Mapping services.\n * (c) 2014-2016, Houston Engineering, Inc.\n * MIT License\n */\nimport * as L from 'leaflet';\n\n// Module object\nvar wms = {};\n\n// Quick shim for Object.keys()\nif (!('keys' in Object)) {\n\tObject.keys = function (obj) {\n\t\tvar result = [];\n\t\tfor (var i in obj) {\n\t\t\tif (obj.hasOwnProperty(i)) {\n\t\t\t\tresult.push(i);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n}\n\n/*\n * wms.Source\n * The Source object manages a single WMS connection.  Multiple \"layers\" can be\n * created with the getLayer function, but a single request will be sent for\n * each image update.  Can be used in non-tiled \"overlay\" mode (default), or\n * tiled mode, via an internal wms.Overlay or wms.TileLayer, respectively.\n */\nwms.Source = L.Layer.extend({\n\toptions: {\n\t\tuntiled: true,\n\t\tidentify: true,\n\t},\n\n\tinitialize: function (url, options) {\n\t\tL.setOptions(this, options);\n\t\tif (this.options.tiled) {\n\t\t\tthis.options.untiled = false;\n\t\t}\n\t\tthis._url = url;\n\t\tthis._subLayers = {};\n\t\tthis._overlay = this.createOverlay(this.options.untiled);\n\t},\n\n\tcreateOverlay: function (untiled) {\n\t\t// Create overlay with all options other than untiled & identify\n\t\tvar overlayOptions = {};\n\t\tfor (var opt in this.options) {\n\t\t\tif (opt != 'untiled' && opt != 'identify') {\n\t\t\t\toverlayOptions[opt] = this.options[opt];\n\t\t\t}\n\t\t}\n\t\tif (untiled) {\n\t\t\treturn wms.overlay(this._url, overlayOptions);\n\t\t} else {\n\t\t\treturn wms.tileLayer(this._url, overlayOptions);\n\t\t}\n\t},\n\n\tonAdd: function () {\n\t\tthis.refreshOverlay();\n\t},\n\n\tsetParams: function (params) {\n\t\t// L.extend(this.wmsParams, params);\n\t\t// this.update();\n\t\tthis._overlay.setParams(params);\n\t},\n\n\tonRemove: function () {\n\t\tvar subLayers = Object.keys(this._subLayers).join(',');\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\tif (subLayers) {\n\t\t\tthis._overlay.remove();\n\t\t}\n\t},\n\n\tgetEvents: function () {\n\t\tif (this.options.identify) {\n\t\t\treturn {click: this.identify};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\n\tsetOpacity: function (opacity) {\n\t\tthis.options.opacity = opacity;\n\t\tif (this._overlay) {\n\t\t\tthis._overlay.setOpacity(opacity);\n\t\t}\n\t},\n\n\tbringToBack: function () {\n\t\tthis.options.isBack = true;\n\t\tif (this._overlay) {\n\t\t\tthis._overlay.bringToBack();\n\t\t}\n\t},\n\n\tbringToFront: function () {\n\t\tthis.options.isBack = false;\n\t\tif (this._overlay) {\n\t\t\tthis._overlay.bringToFront();\n\t\t}\n\t},\n\n\tgetLayer: function (name) {\n\t\treturn wms.layer(this, name);\n\t},\n\n\taddSubLayer: function (name) {\n\t\tthis._subLayers[name] = true;\n\t\tthis.refreshOverlay();\n\t},\n\n\tremoveSubLayer: function (name) {\n\t\tdelete this._subLayers[name];\n\t\tthis.refreshOverlay();\n\t},\n\n\trefreshOverlay: function () {\n\t\tvar subLayers = Object.keys(this._subLayers).join(',');\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\tif (!subLayers) {\n\t\t\tthis._overlay.remove();\n\t\t} else {\n\t\t\tthis._overlay.setParams({layers: subLayers});\n\t\t\tthis._overlay.addTo(this._map);\n\t\t}\n\t},\n\n\tidentify: function (evt) {\n\t\t// Identify map features in response to map clicks. To customize this\n\t\t// behavior, create a class extending wms.Source and override one or\n\t\t// more of the following hook functions.\n\n\t\tvar layers = this.getIdentifyLayers();\n\t\tif (!layers.length) {\n\t\t\treturn;\n\t\t}\n\t\tthis.getFeatureInfo(\n\t\t\tevt.containerPoint,\n\t\t\tevt.latlng,\n\t\t\tlayers,\n\t\t\tthis.showFeatureInfo\n\t\t);\n\t},\n\n\tgetFeatureInfo: function (point, latlng, layers, callback) {\n\t\t// Request WMS GetFeatureInfo and call callback with results\n\t\t// (split from identify() to faciliate use outside of map events)\n\t\tvar params = this.getFeatureInfoParams(point, layers),\n\t\t\turl = this._url + L.Util.getParamString(params, this._url);\n\n\t\tthis.showWaiting();\n\t\tthis.ajax(url, done);\n\n\t\tfunction done(result) {\n\t\t\tthis.hideWaiting();\n\t\t\tvar text = this.parseFeatureInfo(result, url);\n\t\t\tcallback.call(this, latlng, text);\n\t\t}\n\t},\n\n\tajax: function (url, callback) {\n\t\tajax.call(this, url, callback);\n\t},\n\n\tgetIdentifyLayers: function () {\n\t\t// Hook to determine which layers to identify\n\t\tif (this.options.identifyLayers) return this.options.identifyLayers;\n\t\treturn Object.keys(this._subLayers);\n\t},\n\n\tgetFeatureInfoParams: function (point, layers) {\n\t\t// Hook to generate parameters for WMS service GetFeatureInfo request\n\t\tvar wmsParams, overlay;\n\t\tif (this.options.untiled) {\n\t\t\t// Use existing overlay\n\t\t\twmsParams = this._overlay.wmsParams;\n\t\t} else {\n\t\t\t// Create overlay instance to leverage updateWmsParams\n\t\t\toverlay = this.createOverlay(true);\n\t\t\toverlay.updateWmsParams(this._map);\n\t\t\twmsParams = overlay.wmsParams;\n\t\t\twmsParams.layers = layers.join(',');\n\t\t}\n\t\tvar infoParams = {\n\t\t\trequest: 'GetFeatureInfo',\n\t\t\tquery_layers: layers.join(','),\n\t\t\tX: Math.round(point.x),\n\t\t\tY: Math.round(point.y),\n\t\t};\n\t\treturn L.extend({}, wmsParams, infoParams);\n\t},\n\n\tparseFeatureInfo: function (result, url) {\n\t\t// Hook to handle parsing AJAX response\n\t\tif (result == 'error') {\n\t\t\t// AJAX failed, possibly due to CORS issues.\n\t\t\t// Try loading content in <iframe>.\n\t\t\tresult = \"<iframe src='\" + url + \"' style='border:none'>\";\n\t\t}\n\t\treturn result;\n\t},\n\n\tshowFeatureInfo: function (latlng, info) {\n\t\t// Hook to handle displaying parsed AJAX response to the user\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\tthis._map.openPopup(info, latlng);\n\t},\n\n\tshowWaiting: function () {\n\t\t// Hook to customize AJAX wait animation\n\t\tif (!this._map) return;\n\t\tthis._map._container.style.cursor = 'progress';\n\t},\n\n\thideWaiting: function () {\n\t\t// Hook to remove AJAX wait animation\n\t\tif (!this._map) return;\n\t\tthis._map._container.style.cursor = 'default';\n\t},\n});\n\nwms.source = function (url, options) {\n\treturn new wms.Source(url, options);\n};\n\n/*\n * Layer\n * Leaflet \"layer\" with all actual rendering handled via an underlying Source\n * object.  Can be called directly with a URL to automatically create or reuse\n * an existing Source.  Note that the auto-source feature doesn't work well in\n * multi-map environments; so for best results, create a Source first and use\n * getLayer() to retrieve wms.Layer instances.\n */\n\nwms.Layer = L.Layer.extend({\n\tinitialize: function (source, layerName, options) {\n\t\tL.setOptions(this, {pane: source.options.pane});\n\t\tif (!source.addSubLayer) {\n\t\t\t// Assume source is a URL\n\t\t\tsource = wms.getSourceForUrl(source, options);\n\t\t}\n\t\tthis._source = source;\n\t\tthis._name = layerName;\n\t},\n\tonAdd: function () {\n\t\tif (!this._source._map) this._source.addTo(this._map);\n\t\tthis._source.addSubLayer(this._name);\n\t},\n\tonRemove: function () {\n\t\tthis._source.removeSubLayer(this._name);\n\t},\n\tsetOpacity: function (opacity) {\n\t\tthis._source.setOpacity(opacity);\n\t},\n\n\tsetParams: function (params) {\n\t\tthis._source.setParams(params);\n\t},\n\tbringToBack: function () {\n\t\tthis._source.bringToBack();\n\t},\n\tbringToFront: function () {\n\t\tthis._source.bringToFront();\n\t},\n});\n\nwms.layer = function (source, options) {\n\treturn new wms.Layer(source, options);\n};\n\n// Cache of sources for use with wms.Layer auto-source option\nvar sources = {};\nwms.getSourceForUrl = function (url, options) {\n\tif (!sources[url]) {\n\t\tsources[url] = wms.source(url, options);\n\t}\n\treturn sources[url];\n};\n\n// Copy tiled WMS layer from leaflet core, in case we need to subclass it later\nwms.TileLayer = L.TileLayer.WMS;\nwms.tileLayer = L.tileLayer.wms;\n\n/*\n * wms.Overlay:\n * \"Single Tile\" WMS image overlay that updates with map changes.\n * Portions of wms.Overlay are directly extracted from L.TileLayer.WMS.\n * See Leaflet license.\n */\nwms.Overlay = L.Layer.extend({\n\tdefaultWmsParams: {\n\t\tservice: 'WMS',\n\t\trequest: 'GetMap',\n\t\tversion: '1.1.1',\n\t\tlayers: '',\n\t\tstyles: '',\n\t\tformat: 'image/jpeg',\n\t\ttransparent: false,\n\t},\n\n\toptions: {\n\t\tcrs: null,\n\t\tuppercase: false,\n\t\tattribution: '',\n\t\topacity: 1,\n\t\tisBack: false,\n\t\tminZoom: 0,\n\t\tmaxZoom: 18,\n\t},\n\n\tinitialize: function (url, options) {\n\t\tthis._url = url;\n\n\t\t// Move WMS parameters to params object\n\t\tvar params = {},\n\t\t\topts = {};\n\t\tfor (var opt in options) {\n\t\t\tif (opt in this.options) {\n\t\t\t\topts[opt] = options[opt];\n\t\t\t} else {\n\t\t\t\tparams[opt] = options[opt];\n\t\t\t}\n\t\t}\n\t\tL.setOptions(this, opts);\n\t\tthis.wmsParams = L.extend({}, this.defaultWmsParams, params);\n\t},\n\n\tsetParams: function (params) {\n\t\tL.extend(this.wmsParams, params);\n\t\tthis.update();\n\t},\n\n\tgetAttribution: function () {\n\t\treturn this.options.attribution;\n\t},\n\n\tonAdd: function () {\n\t\tthis.update();\n\t},\n\n\tonRemove: function (map) {\n\t\tif (this._currentOverlay) {\n\t\t\tmap.removeLayer(this._currentOverlay);\n\t\t\tdelete this._currentOverlay;\n\t\t}\n\t\tif (this._currentUrl) {\n\t\t\tdelete this._currentUrl;\n\t\t}\n\t},\n\n\tgetEvents: function () {\n\t\treturn {\n\t\t\tmoveend: this.update,\n\t\t};\n\t},\n\n\tupdate: function () {\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\t// Determine image URL and whether it has changed since last update\n\t\tthis.updateWmsParams();\n\t\tvar url = this.getImageUrl();\n\t\tif (this._currentUrl == url) {\n\t\t\treturn;\n\t\t}\n\t\tthis._currentUrl = url;\n\n\t\t// Keep current image overlay in place until new one loads\n\t\t// (inspired by esri.leaflet)\n\t\tvar bounds = this._map.getBounds();\n\t\tvar overlay = L.imageOverlay(url, bounds, {\n\t\t\topacity: 0,\n\t\t\tpane: this.options.pane,\n\t\t});\n\t\toverlay.addTo(this._map);\n\t\toverlay.once('load', _swap, this);\n\t\tfunction _swap() {\n\t\t\tif (!this._map) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (overlay._url != this._currentUrl) {\n\t\t\t\tthis._map.removeLayer(overlay);\n\t\t\t\treturn;\n\t\t\t} else if (this._currentOverlay) {\n\t\t\t\tthis._map.removeLayer(this._currentOverlay);\n\t\t\t}\n\t\t\tthis._currentOverlay = overlay;\n\t\t\toverlay.setOpacity(this.options.opacity ? this.options.opacity : 1);\n\t\t\tif (this.options.isBack === true) {\n\t\t\t\toverlay.bringToBack();\n\t\t\t}\n\t\t\tif (this.options.isBack === false) {\n\t\t\t\toverlay.bringToFront();\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\tthis._map.getZoom() < this.options.minZoom ||\n\t\t\tthis._map.getZoom() > this.options.maxZoom\n\t\t) {\n\t\t\tthis._map.removeLayer(overlay);\n\t\t}\n\t},\n\n\tsetOpacity: function (opacity) {\n\t\tthis.options.opacity = opacity;\n\t\tif (this._currentOverlay) {\n\t\t\tthis._currentOverlay.setOpacity(opacity);\n\t\t}\n\t},\n\n\tbringToBack: function () {\n\t\tthis.options.isBack = true;\n\t\tif (this._currentOverlay) {\n\t\t\tthis._currentOverlay.bringToBack();\n\t\t}\n\t},\n\n\tbringToFront: function () {\n\t\tthis.options.isBack = false;\n\t\tif (this._currentOverlay) {\n\t\t\tthis._currentOverlay.bringToFront();\n\t\t}\n\t},\n\n\t// See L.TileLayer.WMS: onAdd() & getTileUrl()\n\tupdateWmsParams: function (map) {\n\t\tif (!map) {\n\t\t\tmap = this._map;\n\t\t}\n\t\t// Compute WMS options\n\t\tvar bounds = map.getBounds();\n\t\tvar size = map.getSize();\n\t\tvar wmsVersion = parseFloat(this.wmsParams.version);\n\t\tvar crs = this.options.crs || map.options.crs;\n\t\tvar projectionKey = wmsVersion >= 1.3 ? 'crs' : 'srs';\n\t\tvar nw = crs.project(bounds.getNorthWest());\n\t\tvar se = crs.project(bounds.getSouthEast());\n\n\t\t// Assemble WMS parameter string\n\t\tvar params = {\n\t\t\twidth: size.x,\n\t\t\theight: size.y,\n\t\t};\n\t\tparams[projectionKey] = crs.code;\n\t\tparams.bbox = (wmsVersion >= 1.3 && crs === L.CRS.EPSG4326\n\t\t\t? [se.y, nw.x, nw.y, se.x]\n\t\t\t: [nw.x, se.y, se.x, nw.y]\n\t\t).join(',');\n\n\t\tL.extend(this.wmsParams, params);\n\t},\n\n\tgetImageUrl: function () {\n\t\tvar uppercase = this.options.uppercase || false;\n\t\tvar pstr = L.Util.getParamString(this.wmsParams, this._url, uppercase);\n\t\treturn this._url + pstr;\n\t},\n});\n\nwms.overlay = function (url, options) {\n\treturn new wms.Overlay(url, options);\n};\n\n// Simple AJAX helper (since we can't assume jQuery etc. are present)\nfunction ajax(url, callback) {\n\tvar context = this,\n\t\trequest = new XMLHttpRequest();\n\trequest.onreadystatechange = change;\n\trequest.open('GET', url);\n\trequest.send();\n\n\tfunction change() {\n\t\tif (request.readyState === 4) {\n\t\t\tif (request.status === 200) {\n\t\t\t\tcallback.call(context, request.responseText);\n\t\t\t} else {\n\t\t\t\tcallback.call(context, 'error');\n\t\t\t}\n\t\t}\n\t}\n}\nexport default wms;\n","import {TileLayer} from 'leaflet';\nimport isEqual from 'fast-deep-equal';\nimport {MapLayer, withLeaflet} from 'react-leaflet';\n\nimport wms from './leaflet.wms';\nexport const EVENTS_RE = /^on(.+)$/i;\nclass WMSLayer extends MapLayer {\n\tcreateLeafletElement(props) {\n\t\tconst {url, params, singleTile, ...restParams} = props;\n\t\tconst {leaflet: _l, ...options} = this.getOptions({\n\t\t\t...restParams,\n\t\t\t...params,\n\t\t});\n\n\t\tif (singleTile) {\n\t\t\tconst source = new wms.source(url, {\n\t\t\t\t...options,\n\t\t\t\tpane: _l.pane,\n\t\t\t\ttiled: false,\n\t\t\t\tidentify: false,\n\t\t\t});\n\t\t\tconst layer = source.getLayer(options.layers);\n\t\t\tlayer.options.pane = _l.pane;\n\t\t\treturn layer;\n\t\t} else {\n\t\t\treturn new TileLayer.WMS(url, options);\n\t\t}\n\t}\n\n\tupdateLeafletElement(fromProps, toProps) {\n\t\tsuper.updateLeafletElement(fromProps, toProps);\n\n\t\tconst {url: prevUrl} = fromProps;\n\t\tconst {url} = toProps;\n\n\t\tif (url !== prevUrl) {\n\t\t\tthis.leafletElement.setUrl(url);\n\t\t}\n\t\tif (!isEqual(fromProps.params, toProps.params)) {\n\t\t\tthis.leafletElement.setParams({\n\t\t\t\t...toProps.params,\n\t\t\t\tpane: toProps.leaflet.pane,\n\t\t\t});\n\t\t}\n\t}\n\n\tgetOptions(params) {\n\t\tconst superOptions = super.getOptions(params);\n\t\treturn Object.keys(superOptions).reduce((options, key) => {\n\t\t\tif (!EVENTS_RE.test(key)) {\n\t\t\t\toptions[key] = superOptions[key];\n\t\t\t}\n\t\t\treturn options;\n\t\t}, {});\n\t}\n}\n\nexport default withLeaflet(WMSLayer);\n","import React from 'react';\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport {utils} from '@gisatcz/ptr-utils';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport {utils as tileGridUtils, grid} from '@gisatcz/ptr-tile-grid';\nimport {GeoJSON, withLeaflet, Marker, Pane} from 'react-leaflet';\nimport memoize from 'memoize-one';\nimport helpers from '../SvgVectorLayer/helpers';\n\nconst getBoxRange = (boxRange, width, height) => {\n\tconst calculatedBoxRange = mapUtils.view.getNearestZoomLevelBoxRange(\n\t\twidth,\n\t\theight,\n\t\tboxRange\n\t);\n\n\tif (boxRange !== calculatedBoxRange) {\n\t\treturn calculatedBoxRange;\n\t} else {\n\t\treturn boxRange;\n\t}\n};\n\nclass TileGridLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\t\tview: PropTypes.object,\n\t\tzoom: PropTypes.number,\n\t\tzIndex: PropTypes.number,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.pointsPaneName = utils.uuid();\n\t\tthis.getStyle = this.getStyle.bind(this);\n\t\tthis.onEachFeature = this.onEachFeature.bind(this);\n\n\t\tthis.getRenderId = memoize(features => {\n\t\t\tif (features) {\n\t\t\t\treturn utils.uuid();\n\t\t\t}\n\t\t});\n\t}\n\n\tonEachFeature(feature, layer) {}\n\n\tgetStyle(feature) {\n\t\tconst styles = helpers.calculateStyle(\n\t\t\tfeature,\n\t\t\tthis.props.style,\n\t\t\tundefined,\n\t\t\tfeature.selected,\n\t\t\tfeature.selectedStyleDefinition,\n\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tif (feature.selected) {\n\t\t\treturn styles.selected;\n\t\t} else {\n\t\t\treturn styles.default;\n\t\t}\n\t}\n\n\t/**\n\t * Set style of the feature\n\t * @param leafletStyle {Object} Leaflet style definition\n\t * @param element {Object} Leaflet element\n\t */\n\tsetStyle(leafletStyle, element) {\n\t\tconst shape = element?.options?.icon;\n\t\tif (shape) {\n\t\t\tshape.setStyle(leafletStyle, shape.id, shape.isBasicShape);\n\t\t} else {\n\t\t\telement.setStyle(leafletStyle);\n\t\t}\n\t}\n\n\trender() {\n\t\tconst options = this.props.options;\n\t\treturn this.renderBasicVectorLayer(options);\n\t}\n\n\tgetGeoJsonTileGrid(tileGrid, boxRange, viewport) {\n\t\tconst level = this.getTileGridLevel(boxRange, viewport);\n\n\t\t// // todo\n\t\t// // add buffer for leveles bigger than 5\n\t\tconst size = tileGridUtils.getGridSizeForLevel(level);\n\n\t\t// //consider caching levels\n\t\tconst geojsonTileGrid = tileGridUtils.getTileGridAsGeoJSON(tileGrid, size);\n\t\treturn geojsonTileGrid;\n\t}\n\n\tgetTileGridLevel(boxRange, viewport) {\n\t\tconst viewportRange = mapUtils.view.getMapViewportRange(\n\t\t\tviewport.width,\n\t\t\tviewport.height\n\t\t);\n\t\tconst nearestBoxRange = mapUtils.view.getNearestZoomLevelBoxRange(\n\t\t\tviewport.width,\n\t\t\tviewport.height,\n\t\t\tboxRange\n\t\t);\n\t\tconst level = grid.getLevelByViewport(nearestBoxRange, viewportRange);\n\n\t\treturn level;\n\t}\n\tgetTilesMarkers(tileGrid = [], boxRange, viewport) {\n\t\tconst level = this.getTileGridLevel(boxRange, viewport);\n\n\t\tconst markers = tileGrid.reduce((acc, row) => {\n\t\t\tconst rowMarkers = row.map((tile, i) => {\n\t\t\t\treturn (\n\t\t\t\t\t<Pane\n\t\t\t\t\t\tstyle={{zIndex: this.props.zIndex}}\n\t\t\t\t\t\tkey={`${level}-${tile[0]}-${tile[1]}`}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Marker\n\t\t\t\t\t\t\tzIndex={this.props.zIndex}\n\t\t\t\t\t\t\tposition={[tile[1], tile[0]]}\n\t\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t\tnew L.DivIcon({\n\t\t\t\t\t\t\t\t\t//push every second tile title up to prevent overlays\n\t\t\t\t\t\t\t\t\ticonAnchor: [-10, 20 + (i % 2) * 20],\n\t\t\t\t\t\t\t\t\tclassName: 'my-div-icon',\n\t\t\t\t\t\t\t\t\thtml: `<div style=\"display:flex\"><div style=\"white-space: nowrap;\">${level}-${tile[0]}-${tile[1]}</div></div>`,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Pane>\n\t\t\t\t);\n\t\t\t});\n\n\t\t\treturn [...acc, ...rowMarkers];\n\t\t}, []);\n\n\t\treturn markers;\n\t}\n\n\trenderBasicVectorLayer(options) {\n\t\tconst {options: opt, ...props} = this.props;\n\n\t\tconst recalculatedBoxrange = getBoxRange(\n\t\t\tprops.view.boxRange,\n\t\t\toptions.viewport.width,\n\t\t\toptions.viewport.height\n\t\t);\n\n\t\tconst tileGrid = grid.getTileGrid(\n\t\t\toptions.viewport.width,\n\t\t\toptions.viewport.height,\n\t\t\trecalculatedBoxrange,\n\t\t\tprops.view.center,\n\t\t\ttrue\n\t\t);\n\n\t\tconst geoJsonTileGrid = this.getGeoJsonTileGrid(\n\t\t\ttileGrid,\n\t\t\trecalculatedBoxrange,\n\t\t\toptions.viewport\n\t\t);\n\n\t\t// generate new key on features change to return the new instance\n\t\t// more: https://react-leaflet.js.org/docs/en/components#geojson\n\t\tconst key = this.getRenderId(geoJsonTileGrid.features);\n\n\t\tconst tilesMarkers = this.getTilesMarkers(\n\t\t\ttileGrid,\n\t\t\trecalculatedBoxrange,\n\t\t\toptions.viewport\n\t\t);\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<GeoJSON\n\t\t\t\t\tkey={key}\n\t\t\t\t\tdata={geoJsonTileGrid.features}\n\t\t\t\t\tstyle={this.getStyle}\n\t\t\t\t\tonEachFeature={this.onEachFeature}\n\t\t\t\t\tzIndex={this.props.zIndex}\n\t\t\t\t\t// pointToLayer={this.pointToLayer}\n\t\t\t\t\t// filter={this.filter}\n\t\t\t\t/>\n\t\t\t\t{tilesMarkers}\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default withLeaflet(TileGridLayer);\n","/**\n * Round one viewport dimension (width or height)\n * @param dimension {number} original dimension (width or height)\n * @return {number} Rounded dimension\n */\nconst roundDimension = dimension => {\n\treturn Math.ceil(dimension);\n};\n\nexport default {\n\troundDimension,\n};\n","import React from 'react';\nimport {isArray as _isArray, isEmpty as _isEmpty} from 'lodash';\nimport {Map, TileLayer, Pane} from 'react-leaflet';\nimport PropTypes from 'prop-types';\nimport L from 'leaflet';\nimport Proj from 'proj4leaflet';\nimport ReactResizeDetector from 'react-resize-detector';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\n\nimport viewUtils from '../utils/view';\nimport viewHelpers from './viewHelpers';\nimport VectorLayer from './layers/VectorLayer';\nimport WMSLayer from './layers/WMSLayer';\nimport TileGridLayer from './layers/TileGridLayer';\nimport constants from '../constants';\nimport viewport from '../utils/viewport';\n\nimport './style.scss';\n\nclass ReactLeafletMap extends React.PureComponent {\n\tstatic propTypes = {\n\t\tbackgroundLayer: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n\t\tname: PropTypes.string,\n\t\tcrs: PropTypes.string,\n\t\tlayers: PropTypes.array,\n\t\tmapKey: PropTypes.string.isRequired,\n\t\tonClick: PropTypes.func,\n\t\tonLayerClick: PropTypes.func,\n\t\tonViewChange: PropTypes.func,\n\t\tresources: PropTypes.object,\n\t\tview: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\t\tdebugTileGrid: PropTypes.oneOfType([\n\t\t\tPropTypes.bool,\n\t\t\tPropTypes.shape({\n\t\t\t\tbottom: PropTypes.bool,\n\t\t\t}),\n\t\t]),\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tview: null,\n\t\t\tcrs: this.getCRS(props.crs),\n\t\t};\n\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onLayerClick = this.onLayerClick.bind(this);\n\t\tthis.onViewportChanged = this.onViewportChanged.bind(this);\n\t\tthis.onResize = this.onResize.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\t// Hack for ugly 1px tile borders in Chrome\n\t\t// Version of Leaflet package in dependencies should match version used by react-leaflet\n\t\tlet originalInitTile = L.GridLayer.prototype._initTile;\n\t\tL.GridLayer.include({\n\t\t\t_initTile: function (tile) {\n\t\t\t\toriginalInitTile.call(this, tile);\n\n\t\t\t\tvar tileSize = this.getTileSize();\n\n\t\t\t\ttile.style.width = tileSize.x + 1 + 'px';\n\t\t\t\ttile.style.height = tileSize.y + 1 + 'px';\n\t\t\t},\n\t\t});\n\t}\n\n\tgetCRS(code) {\n\t\tswitch (code) {\n\t\t\tcase 'EPSG:4326':\n\t\t\t\treturn L.CRS.EPSG4326;\n\t\t\tcase 'EPSG:5514':\n\t\t\t\treturn new Proj.CRS('EPSG:5514', constants.projDefinitions.epsg5514, {\n\t\t\t\t\tresolutions: [\n\t\t\t\t\t\t102400,\n\t\t\t\t\t\t51200,\n\t\t\t\t\t\t25600,\n\t\t\t\t\t\t12800,\n\t\t\t\t\t\t6400,\n\t\t\t\t\t\t3200,\n\t\t\t\t\t\t1600,\n\t\t\t\t\t\t800,\n\t\t\t\t\t\t400,\n\t\t\t\t\t\t200,\n\t\t\t\t\t\t100,\n\t\t\t\t\t\t50,\n\t\t\t\t\t\t25,\n\t\t\t\t\t\t12.5,\n\t\t\t\t\t\t6.25,\n\t\t\t\t\t\t3.125,\n\t\t\t\t\t\t1.5625,\n\t\t\t\t\t\t0.78125,\n\t\t\t\t\t\t0.390625,\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn L.CRS.EPSG3857;\n\t\t}\n\t}\n\n\tsetZoomLevelsBounds(width, height) {\n\t\tconst props = this.props;\n\t\tthis.minZoom = mapConstants.defaultLevelsRange[0];\n\t\tthis.maxZoom = mapConstants.defaultLevelsRange[1];\n\t\tif (props.viewLimits && props.viewLimits.boxRangeRange) {\n\t\t\tif (props.viewLimits.boxRangeRange[1]) {\n\t\t\t\tthis.minZoom = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\tprops.viewLimits.boxRangeRange[1],\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (props.viewLimits.boxRangeRange[0]) {\n\t\t\t\tthis.maxZoom = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\tprops.viewLimits.boxRangeRange[0],\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewportChanged(viewport) {\n\t\tif (viewport) {\n\t\t\tlet change = {};\n\n\t\t\tif (\n\t\t\t\tviewport.center &&\n\t\t\t\t(viewport.center[0] !== this.state.leafletView.center[0] ||\n\t\t\t\t\tviewport.center[1] !== this.state.leafletView.center[1])\n\t\t\t) {\n\t\t\t\tchange.center = viewUtils.getCenterWhichFitsLimits(\n\t\t\t\t\t{\n\t\t\t\t\t\tlat: viewport.center[0],\n\t\t\t\t\t\tlon: viewport.center[1],\n\t\t\t\t\t},\n\t\t\t\t\tthis.props.viewLimits?.center\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tviewport.hasOwnProperty('zoom') &&\n\t\t\t\tNumber.isFinite(viewport.zoom) &&\n\t\t\t\tviewport.zoom !== this.state.leafletView.zoom\n\t\t\t) {\n\t\t\t\tchange.boxRange = mapUtils.view.getBoxRangeFromZoomLevel(\n\t\t\t\t\tviewport.zoom,\n\t\t\t\t\tthis.state.width,\n\t\t\t\t\tthis.state.height\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!_isEmpty(change) && !this.hasResized()) {\n\t\t\t\tchange = mapUtils.view.ensureViewIntegrity(change);\n\n\t\t\t\tif (this.props.viewLimits?.center) {\n\t\t\t\t\t/* Center coordinate values are compared by value. If the map view is changed from inside (by dragging) and the center gets out of the range, then the center coordinates are adjusted to those limits. However, if we move the map a bit again, these values will remain the same and the map component will not reredner. Therefore, it is necessary to make insignificant change in center coordinates values */\n\t\t\t\t\tchange.center = {\n\t\t\t\t\t\tlat: change.center.lat + Math.random() / Math.pow(10, 13),\n\t\t\t\t\t\tlon: change.center.lon + Math.random() / Math.pow(10, 13),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (this.props.onViewChange) {\n\t\t\t\t\tthis.props.onViewChange(change);\n\t\t\t\t}\n\t\t\t\t// just presentational map\n\t\t\t\telse {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tview: {...this.props.view, ...this.state.view, ...change},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thasResized() {\n\t\tconst {x, y} = this.leafletMap._size;\n\n\t\t// take into account only a significant change in size\n\t\tconst widthChange = Math.abs(x - this.state.width) > 5;\n\t\tconst heightChange = Math.abs(y - this.state.height) > 5;\n\t\treturn widthChange || heightChange;\n\t}\n\n\tonResize(width, height) {\n\t\theight = viewport.roundDimension(height);\n\t\twidth = viewport.roundDimension(width);\n\n\t\tif (this.leafletMap) {\n\t\t\tthis.leafletMap.invalidateSize();\n\t\t}\n\n\t\tif (!this.maxZoom && !this.minZoom) {\n\t\t\tthis.setZoomLevelsBounds(width, height);\n\t\t}\n\n\t\tthis.setState({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tleafletView: viewHelpers.getLeafletViewportFromViewParams(\n\t\t\t\tthis.state.view || this.props.view,\n\t\t\t\tthis.state.width,\n\t\t\t\tthis.state.height\n\t\t\t),\n\t\t});\n\n\t\tif (this.props.onResize) {\n\t\t\tthis.props.onResize(width, height);\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ReactResizeDetector\n\t\t\t\t\thandleHeight\n\t\t\t\t\thandleWidth\n\t\t\t\t\tonResize={this.onResize}\n\t\t\t\t\trefreshMode=\"debounce\"\n\t\t\t\t\trefreshRate={500}\n\t\t\t\t/>\n\t\t\t\t{this.state.width && this.state.height ? this.renderMap() : null}\n\t\t\t</>\n\t\t);\n\t}\n\n\trenderMap() {\n\t\tconst leafletView = viewHelpers.getLeafletViewportFromViewParams(\n\t\t\tthis.state.view || this.props.view,\n\t\t\tthis.state.width,\n\t\t\tthis.state.height\n\t\t);\n\n\t\t// fix for backward compatibility\n\t\tconst backgroundLayersSource = _isArray(this.props.backgroundLayer)\n\t\t\t? this.props.backgroundLayer\n\t\t\t: [this.props.backgroundLayer];\n\t\tconst backgroundLayersZindex = constants.defaultLeafletPaneZindex + 1;\n\t\tconst backgroundLayers =\n\t\t\tbackgroundLayersSource &&\n\t\t\tbackgroundLayersSource.map((layer, i) =>\n\t\t\t\tthis.getLayerByType(layer, i, null, leafletView.zoom)\n\t\t\t);\n\n\t\tconst baseLayersZindex = constants.defaultLeafletPaneZindex + 101;\n\t\tlet layers =\n\t\t\tthis.props.layers &&\n\t\t\tthis.props.layers.map((layer, i) => (\n\t\t\t\t<Pane key={layer.key || i} style={{zIndex: baseLayersZindex + i}}>\n\t\t\t\t\t{this.getLayerByType(\n\t\t\t\t\t\tlayer,\n\t\t\t\t\t\ti,\n\t\t\t\t\t\tbaseLayersZindex + i,\n\t\t\t\t\t\tleafletView.zoom\n\t\t\t\t\t)}\n\t\t\t\t</Pane>\n\t\t\t));\n\n\t\t//\n\t\t// Add debug grid layer on under all \"layers\" or at the top\n\t\t//\n\t\tif (this.props.debugTileGrid) {\n\t\t\tconst bottom = this.props.debugTileGrid?.bottom;\n\t\t\tconst zIndex = bottom ? 0 : (layers?.length || 0) + 1;\n\t\t\tconst tileGridLayer = (\n\t\t\t\t<Pane key={'tilegrid'} style={{zIndex: baseLayersZindex + zIndex - 1}}>\n\t\t\t\t\t{this.getLayerByType(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'tile-grid',\n\t\t\t\t\t\t\tkey: 'tilegrid',\n\t\t\t\t\t\t\tlayerKey: 'tilegridlayerkey',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tviewport: {\n\t\t\t\t\t\t\t\t\twidth: this.state.width,\n\t\t\t\t\t\t\t\t\theight: this.state.height,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tbaseLayersZindex + zIndex - 1,\n\t\t\t\t\t\tleafletView.zoom\n\t\t\t\t\t)}\n\t\t\t\t</Pane>\n\t\t\t);\n\n\t\t\tif (bottom) {\n\t\t\t\tlayers = layers ? [tileGridLayer, ...layers] : [tileGridLayer];\n\t\t\t} else {\n\t\t\t\tlayers = layers ? [...layers, tileGridLayer] : [tileGridLayer];\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<Map\n\t\t\t\tid={this.props.mapKey}\n\t\t\t\tref={map => {\n\t\t\t\t\tthis.leafletMap = map && map.leafletElement;\n\t\t\t\t}}\n\t\t\t\tclassName=\"ptr-map ptr-leaflet-map\"\n\t\t\t\tonViewportChanged={this.onViewportChanged}\n\t\t\t\tonClick={this.onClick}\n\t\t\t\tcenter={leafletView.center}\n\t\t\t\tzoom={leafletView.zoom}\n\t\t\t\tzoomControl={false}\n\t\t\t\tminZoom={this.minZoom} // non-dynamic prop\n\t\t\t\tmaxZoom={this.maxZoom} // non-dynamic prop\n\t\t\t\tattributionControl={false}\n\t\t\t\tcrs={this.state.crs}\n\t\t\t\tanimate={false}\n\t\t\t>\n\t\t\t\t<Pane style={{zIndex: backgroundLayersZindex}}>{backgroundLayers}</Pane>\n\t\t\t\t{layers}\n\t\t\t\t{this.props.children}\n\t\t\t</Map>\n\t\t);\n\t}\n\n\tgetLayerByType(layer, i, zIndex, zoom) {\n\t\tif (layer && layer.type) {\n\t\t\tswitch (layer.type) {\n\t\t\t\tcase 'wmts':\n\t\t\t\t\treturn this.getTileLayer(layer, i);\n\t\t\t\tcase 'wms':\n\t\t\t\t\treturn this.getWmsTileLayer(layer, i);\n\t\t\t\tcase 'vector':\n\t\t\t\tcase 'tiledVector':\n\t\t\t\tcase 'tiled-vector':\n\t\t\t\tcase 'diagram':\n\t\t\t\t\treturn this.getVectorLayer(layer, i, zIndex, zoom);\n\t\t\t\tcase 'tile-grid':\n\t\t\t\t\treturn this.getTileGridLayer(layer, i, zIndex, zoom);\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetVectorLayer(layer, i, zIndex, zoom) {\n\t\treturn (\n\t\t\t<VectorLayer\n\t\t\t\tkey={layer.key || i}\n\t\t\t\tlayerKey={layer.layerKey || layer.key}\n\t\t\t\tuniqueLayerKey={layer.key || i}\n\t\t\t\tresources={this.props.resources}\n\t\t\t\tonClick={this.onLayerClick}\n\t\t\t\topacity={layer.opacity || 1}\n\t\t\t\toptions={layer.options}\n\t\t\t\ttype={layer.type}\n\t\t\t\tview={this.state.view || this.props.view}\n\t\t\t\twidth={this.state.width}\n\t\t\t\theight={this.state.height}\n\t\t\t\tcrs={this.props.crs}\n\t\t\t\tzoom={zoom}\n\t\t\t\tzIndex={zIndex}\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetTileGridLayer(layer, i, zIndex, zoom) {\n\t\treturn (\n\t\t\t<TileGridLayer\n\t\t\t\tkey={layer.key || i}\n\t\t\t\tlayerKey={layer.layerKey || layer.key}\n\t\t\t\tuniqueLayerKey={layer.key || i}\n\t\t\t\tview={this.state.view || this.props.view}\n\t\t\t\toptions={layer.options}\n\t\t\t\tzoom={zoom}\n\t\t\t\tzIndex={zIndex}\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetTileLayer(layer, i) {\n\t\tlet {url, ...restOptions} = layer.options;\n\n\t\t// fix for backward compatibility\n\t\tif (layer.options.urls) {\n\t\t\turl = layer.options.urls[0];\n\t\t}\n\n\t\treturn <TileLayer key={layer.key || i} url={url} {...restOptions} />;\n\t}\n\n\tgetWmsTileLayer(layer, i) {\n\t\tconst o = layer.options;\n\t\tlet layers = (o.params && o.params.layers) || '';\n\t\tlet crs = (o.params && o.params.crs && this.getCRS(o.params.crs)) || null;\n\t\tlet imageFormat = (o.params && o.params.imageFormat) || 'image/png';\n\t\tconst reservedParamsKeys = [\n\t\t\t'layers',\n\t\t\t'crs',\n\t\t\t'imageFormat',\n\t\t\t'pane',\n\t\t\t'maxZoom',\n\t\t\t'styles',\n\t\t];\n\t\tlet restParameters =\n\t\t\t(o.params &&\n\t\t\t\tObject.entries(o.params).reduce((acc, [key, value]) => {\n\t\t\t\t\tif (reservedParamsKeys.includes(key)) {\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tacc[key] = value;\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t}\n\t\t\t\t}, {})) ||\n\t\t\t{};\n\n\t\treturn (\n\t\t\t<WMSLayer\n\t\t\t\tkey={layer.key || i}\n\t\t\t\turl={o.url}\n\t\t\t\tcrs={crs}\n\t\t\t\tsingleTile={o.singleTile === true}\n\t\t\t\tparams={{\n\t\t\t\t\tlayers: layers,\n\t\t\t\t\topacity: layer.opacity || 1,\n\t\t\t\t\ttransparent: true,\n\t\t\t\t\tformat: imageFormat,\n\t\t\t\t\t...restParameters,\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonLayerClick(layerKey, featureKeys) {\n\t\tif (this.props.onLayerClick) {\n\t\t\tthis.props.onLayerClick(this.props.mapKey, layerKey, featureKeys);\n\t\t}\n\t}\n\n\tonClick() {\n\t\tif (this.props.onClick) {\n\t\t\tthis.props.onClick(this.props.view);\n\t\t}\n\t}\n}\n\nexport default ReactLeafletMap;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport {Icon, Button} from '@gisatcz/ptr-atoms';\n\nimport './style.scss';\n\n// TODO Refactor\nclass SimpleLayersControl extends React.PureComponent {\n\tstatic propTypes = {\n\t\tactiveLayer: PropTypes.object,\n\t\tlayers: PropTypes.array,\n\t\tonSelect: PropTypes.func,\n\t\tright: PropTypes.bool,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.ref = React.createRef();\n\t\tthis.state = {\n\t\t\topen: false,\n\t\t};\n\n\t\tthis.onControlButtonClick = this.onControlButtonClick.bind(this);\n\t\tthis.onBlur = this.onBlur.bind(this);\n\t}\n\n\tonBlur(e) {\n\t\tsetTimeout(() => {\n\t\t\tthis.setState({open: false});\n\t\t}, 50);\n\t}\n\n\tonControlButtonClick() {\n\t\tthis.setState({\n\t\t\topen: !this.state.open,\n\t\t});\n\t}\n\n\tonLayerTileClick(key) {\n\t\tif (this.props.onSelect) {\n\t\t\tthis.props.onSelect(key);\n\t\t}\n\t}\n\n\trender() {\n\t\tlet buttonClasses = classnames('ptr-simple-layers-control control', {\n\t\t\topen: this.state.open,\n\t\t});\n\n\t\treturn (\n\t\t\t<div className={buttonClasses} onBlur={this.onBlur} ref={this.ref}>\n\t\t\t\t<Button onClick={this.onControlButtonClick}>\n\t\t\t\t\t<Icon icon=\"layers\" />\n\t\t\t\t</Button>\n\t\t\t\t{this.renderMenu()}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderMenu() {\n\t\tconst layers = this.props.layers;\n\t\tconst tileWidth = 7;\n\t\tconst tileHeight = 5;\n\t\tconst tileMargin = 0.25;\n\t\tconst contentMargin = 1;\n\n\t\tif (layers) {\n\t\t\tlet grid = this.getGrid(layers.length);\n\n\t\t\tlet menuClasses = classnames('ptr-simple-layers-control-menu', {\n\t\t\t\topen: this.state.open,\n\t\t\t\tright: this.props.right,\n\t\t\t\tleft: !this.props.right,\n\t\t\t});\n\n\t\t\tlet menuStyle = {\n\t\t\t\twidth: this.state.open\n\t\t\t\t\t? `${\n\t\t\t\t\t\t\t(tileWidth + 2 * tileMargin) * grid.width + 2 * contentMargin\n\t\t\t\t\t  }rem`\n\t\t\t\t\t: 0,\n\t\t\t\theight: this.state.open\n\t\t\t\t\t? `${\n\t\t\t\t\t\t\t(tileHeight + 2 * tileMargin) * grid.height + 2 * contentMargin\n\t\t\t\t\t  }rem`\n\t\t\t\t\t: '2rem',\n\t\t\t};\n\n\t\t\tlet contentStyle = {\n\t\t\t\tmargin: `${contentMargin}rem`,\n\t\t\t\twidth: `calc(100% - ${2 * contentMargin}rem)`,\n\t\t\t\theight: `calc(100% - ${2 * contentMargin}rem)`,\n\t\t\t};\n\n\t\t\treturn (\n\t\t\t\t<div className={menuClasses} style={menuStyle}>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"ptr-simple-layers-control-menu-content\"\n\t\t\t\t\t\tstyle={contentStyle}\n\t\t\t\t\t>\n\t\t\t\t\t\t{layers.map(layer =>\n\t\t\t\t\t\t\tthis.renderTile(layer, tileWidth, tileHeight, tileMargin)\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\trenderTile(layer, width, height, margin) {\n\t\tlet active = layer.key === this.props.activeLayer.key;\n\n\t\tlet classes = classnames('ptr-simple-layers-control-tile', {\n\t\t\tactive,\n\t\t});\n\n\t\tlet style = {\n\t\t\twidth: `${width}rem`,\n\t\t\theight: `${height}rem`,\n\t\t\tmargin: `${margin}rem`,\n\t\t};\n\n\t\tif (layer.thumbnail) {\n\t\t\t// TODO check type of thumbnail\n\t\t\t// style.backgroundImage = `url(${require('./img/' + layer.thumbnail + '.png')})`;\n\t\t}\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tkey={layer.key}\n\t\t\t\tstyle={style}\n\t\t\t\tclassName={classes}\n\t\t\t\tonClick={this.onLayerTileClick.bind(this, layer.key)}\n\t\t\t>\n\t\t\t\t<div className=\"ptr-simple-layers-control-tile-name\">{layer.name}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tgetGrid(count) {\n\t\tlet width = 1;\n\t\tlet height = 1;\n\n\t\t// TODO solve 9+ cases\n\t\tif (count >= 7) {\n\t\t\twidth = 3;\n\t\t\theight = 3;\n\t\t} else if (count >= 5) {\n\t\t\twidth = 2;\n\t\t\theight = 3;\n\t\t} else if (count === 4) {\n\t\t\twidth = 2;\n\t\t\theight = 2;\n\t\t} else if (count === 3) {\n\t\t\theight = 3;\n\t\t} else if (count === 2) {\n\t\t\theight = 2;\n\t\t}\n\n\t\treturn {width, height};\n\t}\n}\n\nexport default SimpleLayersControl;\n","import WorldWind from 'webworldwind-esa';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport viewUtils from '../../../utils/view';\n\nconst {Angle, WWMath} = WorldWind;\n\n/**\n * @param {WorldWind.WorldWindController} basicController\n * @param {Object} viewLimits\n */\nexport default function (basicController, viewLimits, levelsBased) {\n\t//Customized applyLimits function that call onNavigatorChanged on every execution\n\tconst applyLimits = () => {\n\t\tlet navigator = basicController.wwd.navigator;\n\t\tconst {width, height} = basicController.wwd.viewport;\n\n\t\tif (!levelsBased) {\n\t\t\tlet minBoxRange =\n\t\t\t\t(viewLimits &&\n\t\t\t\t\tviewLimits.boxRangeRange &&\n\t\t\t\t\tviewLimits.boxRangeRange[0]) ||\n\t\t\t\tmapConstants.minBoxRange;\n\t\t\tlet maxBoxRange =\n\t\t\t\t(viewLimits &&\n\t\t\t\t\tviewLimits.boxRangeRange &&\n\t\t\t\t\tviewLimits.boxRangeRange[1]) ||\n\t\t\t\tmapConstants.maxBoxRange;\n\t\t\tlet currentRange = viewUtils.getBoxRangeFromWorldWindRange(\n\t\t\t\tnavigator.range,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\n\t\t\tif (currentRange < minBoxRange) {\n\t\t\t\tnavigator.range = viewUtils.getWorldWindRangeFromBoxRange(\n\t\t\t\t\tminBoxRange,\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t} else if (currentRange > maxBoxRange) {\n\t\t\t\tnavigator.range = viewUtils.getWorldWindRangeFromBoxRange(\n\t\t\t\t\tmaxBoxRange,\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// TODO apply other viewLimits params\n\n\t\t// Clamp latitude to between -90 and +90, and normalize longitude to between -180 and +180.\n\t\tnavigator.lookAtLocation.latitude = WWMath.clamp(\n\t\t\tnavigator.lookAtLocation.latitude,\n\t\t\t-90,\n\t\t\t90\n\t\t);\n\t\tnavigator.lookAtLocation.longitude = Angle.normalizedDegreesLongitude(\n\t\t\tnavigator.lookAtLocation.longitude\n\t\t);\n\n\t\t// Normalize heading to between -180 and +180.\n\t\tnavigator.heading = Angle.normalizedDegrees(navigator.heading);\n\n\t\t// Clamp tilt to between 0 and +90 to prevent the viewer from going upside down.\n\t\tnavigator.tilt = WWMath.clamp(navigator.tilt, 0, 90);\n\n\t\t// Normalize heading to between -180 and +180.\n\t\tnavigator.roll = Angle.normalizedDegrees(navigator.roll);\n\n\t\t// Apply 2D limits when the globe is 2D.\n\t\tif (basicController.wwd.globe.is2D() && navigator.enable2DLimits) {\n\t\t\t// Clamp range to prevent more than 360 degrees of visible longitude. Assumes a 45 degree horizontal\n\t\t\t// field of view.\n\t\t\tvar maxRange = 2 * Math.PI * basicController.wwd.globe.equatorialRadius;\n\t\t\tnavigator.range = WWMath.clamp(navigator.range, 1, maxRange);\n\n\t\t\t// Force tilt to 0 when in 2D mode to keep the viewer looking straight down.\n\t\t\tnavigator.tilt = 0;\n\t\t}\n\n\t\t//event map changed\n\t\tif (typeof basicController.onNavigatorChanged === 'function') {\n\t\t\tbasicController.onNavigatorChanged(navigator);\n\t\t}\n\t};\n\n\tbasicController.applyLimits = applyLimits;\n\tbasicController.onNavigatorChanged = null;\n}\n","import WorldWind from 'webworldwind-esa';\nimport utils from '@gisatcz/ptr-utils';\nimport {forIn as _forIn, includes as _includes} from 'lodash';\nimport constants from '../../constants';\n\n/**\n * @param layer {Object}\n * @param layer.key {string}\n * @param layer.name {string}\n * @param layer.opacity {number}\n * @param layer.options {Object}\n * @param layer.options.features {Array}\n * @augments WorldWind.RenderableLayer\n * @constructor\n */\nclass VectorLayer extends WorldWind.RenderableLayer {\n\tconstructor(layer, options) {\n\t\tconst name = layer.name || '';\n\t\tsuper(name);\n\n\t\tthis.opacity = layer.opacity || 1;\n\n\t\tthis.pantherProps = {\n\t\t\tfeatures: options.features || [],\n\t\t\tfidColumnName: options.fidColumnName,\n\t\t\thoverable: options.hoverable,\n\t\t\tselectable: options.selectable,\n\t\t\thovered: {...options.hovered},\n\t\t\tselected: {...options.selected},\n\t\t\tkey: layer.key,\n\t\t\tlayerKey: options.layerKey,\n\t\t\tonHover: options.onHover,\n\t\t\tonClick: options.onClick,\n\t\t\tstyle: options.style,\n\t\t};\n\n\t\tthis.addFeatures(this.pantherProps.features);\n\t}\n\n\t/**;\n\t * @param features {Array} List of GeoJSON features\n\t */\n\taddFeatures(features) {\n\t\tlet geojson = {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: features,\n\t\t};\n\n\t\tconst parser = new WorldWind.GeoJSONParser(geojson);\n\n\t\tconst shapeConfigurationCallback = (geometry, properties) => {\n\t\t\tconst defaultStyleObject = utils.mapStyle.getStyleObject(\n\t\t\t\tproperties,\n\t\t\t\tthis.pantherProps.style || constants.vectorFeatureStyle.defaultFull\n\t\t\t);\n\t\t\tconst defaultStyle = this.getStyleDefinition(defaultStyleObject);\n\n\t\t\tlet hoveredStyleObject, hoveredStyle;\n\t\t\tif (this.pantherProps.hovered?.style) {\n\t\t\t\thoveredStyleObject =\n\t\t\t\t\tthis.pantherProps.hovered.style === 'default'\n\t\t\t\t\t\t? constants.vectorFeatureStyle.hovered\n\t\t\t\t\t\t: this.pantherProps.hovered.style;\n\t\t\t\thoveredStyle = this.getStyleDefinition({\n\t\t\t\t\t...defaultStyleObject,\n\t\t\t\t\t...hoveredStyleObject,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserProperties: {\n\t\t\t\t\t...properties,\n\t\t\t\t\tdefaultStyleObject,\n\t\t\t\t\tdefaultStyle,\n\t\t\t\t\thoveredStyleObject,\n\t\t\t\t\thoveredStyle,\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\n\t\tconst renderablesAddCallback = layer => {\n\t\t\tlayer.renderables.forEach(renderable => {\n\t\t\t\tthis.applyStyles(renderable);\n\t\t\t});\n\t\t};\n\n\t\tparser.load(renderablesAddCallback, shapeConfigurationCallback, this);\n\t}\n\n\t/**\n\t * @param fids {Array}\n\t */\n\tupdateHoveredFeatures(fids) {\n\t\tthis.renderables.forEach(renderable => {\n\t\t\tconst key = renderable.userProperties[this.pantherProps.fidColumnName];\n\t\t\tif (_includes(fids, key)) {\n\t\t\t\tconst selection = this.getSelection(renderable);\n\t\t\t\tif (selection?.hoveredStyle) {\n\t\t\t\t\tlet selectedHoveredStyleObject =\n\t\t\t\t\t\tselection.hoveredStyle === 'default'\n\t\t\t\t\t\t\t? constants.vectorFeatureStyle.selectedHovered\n\t\t\t\t\t\t\t: selection.hoveredStyle;\n\t\t\t\t\tlet selectedHoveredStyle = this.getStyleDefinition({\n\t\t\t\t\t\t...renderable.userProperties.defaultStyleObject,\n\t\t\t\t\t\t...selectedHoveredStyleObject,\n\t\t\t\t\t});\n\t\t\t\t\tthis.applyWorldWindStyles(renderable, selectedHoveredStyle);\n\t\t\t\t} else if ((renderable, renderable.userProperties.hoveredStyle)) {\n\t\t\t\t\tthis.applyWorldWindStyles(\n\t\t\t\t\t\trenderable,\n\t\t\t\t\t\trenderable.userProperties.hoveredStyle\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.applyStyles(renderable);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Convert panther style definition to World Wind style definition\n\t * @param styleObject {Object}\n\t * @return {Object}\n\t */\n\tgetStyleDefinition(styleObject) {\n\t\tlet style = {};\n\n\t\tif (styleObject.fill) {\n\t\t\tconst fillRgb = utils.mapStyle.hexToRgb(styleObject.fill);\n\t\t\tstyle.interiorColor = new WorldWind.Color(\n\t\t\t\tfillRgb.r / 255,\n\t\t\t\tfillRgb.g / 256,\n\t\t\t\tfillRgb.b / 256,\n\t\t\t\tstyleObject.fillOpacity || 1\n\t\t\t);\n\t\t} else {\n\t\t\tstyle.interiorColor = WorldWind.Color.TRANSPARENT;\n\t\t}\n\n\t\tif (styleObject.outlineColor && styleObject.outlineWidth) {\n\t\t\tconst outlineRgb = utils.mapStyle.hexToRgb(styleObject.outlineColor);\n\t\t\tstyle.outlineColor = new WorldWind.Color(\n\t\t\t\toutlineRgb.r / 255,\n\t\t\t\toutlineRgb.g / 256,\n\t\t\t\toutlineRgb.b / 256,\n\t\t\t\tstyleObject.outlineOpacity || 1\n\t\t\t);\n\t\t\tstyle.outlineWidth = styleObject.outlineWidth;\n\t\t} else {\n\t\t\tstyle.outlineColor = WorldWind.Color.TRANSPARENT;\n\t\t}\n\n\t\treturn style;\n\t}\n\n\t/**\n\t * Get selection for feature\n\t * @param renderable {Object}\n\t * @return {Object}\n\t */\n\tgetSelection(renderable) {\n\t\tif (this.pantherProps.selected) {\n\t\t\tconst featureKey =\n\t\t\t\trenderable.userProperties[this.pantherProps.fidColumnName];\n\t\t\tlet selectionDefintion = null;\n\n\t\t\t_forIn(this.pantherProps.selected, (selection, key) => {\n\t\t\t\tif (selection.keys && _includes(selection.keys, featureKey)) {\n\t\t\t\t\tselectionDefintion = selection;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn selectionDefintion;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * @param renderable {WorldWind.Renderable}\n\t */\n\tapplyStyles(renderable) {\n\t\tconst defaultStyleObject = renderable.userProperties.defaultStyleObject;\n\t\tconst selection = this.getSelection(renderable);\n\n\t\tif (selection?.style) {\n\t\t\tconst selectedStyleObject =\n\t\t\t\tselection.style === 'default'\n\t\t\t\t\t? constants.vectorFeatureStyle.selected\n\t\t\t\t\t: selection.style;\n\t\t\tconst selectedStyle = this.getStyleDefinition({\n\t\t\t\t...defaultStyleObject,\n\t\t\t\t...selectedStyleObject,\n\t\t\t});\n\t\t\tthis.applyWorldWindStyles(renderable, selectedStyle);\n\t\t} else {\n\t\t\tthis.applyWorldWindStyles(\n\t\t\t\trenderable,\n\t\t\t\trenderable.userProperties.defaultStyle\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * @param renderable {WorldWind.Renderable}\n\t * @param style {Object}\n\t */\n\tapplyWorldWindStyles(renderable, style) {\n\t\trenderable.attributes.outlineWidth = style.outlineWidth;\n\t\trenderable.attributes.outlineColor = style.outlineColor;\n\t\trenderable.attributes.interiorColor = style.interiorColor;\n\t}\n}\n\nexport default VectorLayer;\n","import WorldWind from 'webworldwind-esa';\n\nconst {Location, Sector, MercatorTiledImageLayer} = WorldWind;\n\n/**\n * Constructs an Open Street Map layer.\n * @alias OpenStreetMapImageLayer\n * @constructor\n * @augments MercatorTiledImageLayer\n * @classdesc Provides a layer that shows Open Street Map imagery.\n *\n * @param {String} displayName This layer's display name. \"Open Street Map\" if this parameter is\n * null or undefined.\n */\nclass OsmLayer extends MercatorTiledImageLayer {\n\tconstructor(displayName) {\n\t\tdisplayName = displayName || 'Open Street Map';\n\n\t\tsuper(\n\t\t\tnew Sector(-85.05, 85.05, -180, 180),\n\t\t\tnew Location(85.05, 180),\n\t\t\t19,\n\t\t\t'image/png',\n\t\t\tdisplayName,\n\t\t\t256,\n\t\t\t256\n\t\t);\n\n\t\tthis.displayName = displayName;\n\t\tthis.pickEnabled = false;\n\n\t\t// Create a canvas we can use when unprojecting retrieved images.\n\t\tthis.destCanvas = document.createElement('canvas');\n\t\tthis.destContext = this.destCanvas.getContext('2d');\n\n\t\tthis.urlBuilder = {\n\t\t\turlForTile: function (tile, imageFormat) {\n\t\t\t\t//var url = \"https://a.tile.openstreetmap.org/\" +\n\t\t\t\treturn (\n\t\t\t\t\t'https://otile1.mqcdn.com/tiles/1.0.0/osm/' +\n\t\t\t\t\t(tile.level.levelNumber + 1) +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.column +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.row +\n\t\t\t\t\t'.png'\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\n\t\tthis.doRender = this.doRender.bind(this);\n\t}\n\n\tdoRender(dc) {\n\t\tMercatorTiledImageLayer.prototype.doRender.call(this, dc);\n\t}\n\n\t// Overridden from TiledImageLayer.\n\tcreateTopLevelTiles(dc) {\n\t\tthis.topLevelTiles = [];\n\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 0, 0)\n\t\t);\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 0, 1)\n\t\t);\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 1, 0)\n\t\t);\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 1, 1)\n\t\t);\n\t}\n\n\t// Determines the Bing map size for a specified level number.\n\tmapSizeForLevel(levelNumber) {\n\t\treturn 256 << (levelNumber + 1);\n\t}\n}\n\nexport default OsmLayer;\n","import OsmLayer from './OsmLayer';\nimport WorldWind from 'webworldwind-esa';\n\nconst {ArgumentError, Logger} = WorldWind;\n\nclass WikimediaLayer extends OsmLayer {\n\tconstructor(options) {\n\t\tsuper('');\n\t\tthis.imageSize = 256;\n\n\t\tif (!options.source && !options.sourceObject) {\n\t\t\tthrow new ArgumentError(\n\t\t\t\tLogger.logMessage(\n\t\t\t\t\tLogger.LEVEL_SEVERE,\n\t\t\t\t\t'MyOsmLayer',\n\t\t\t\t\t'constructor',\n\t\t\t\t\t'missingSource'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis._source = options.sourceObject\n\t\t\t? this.buildSourceUrl(options.sourceObject)\n\t\t\t: options.source;\n\t\tthis._attribution = options.attribution;\n\t\tthis._imageType = options.imageType ? options.imageType : 'png';\n\n\t\tthis.cachePath = this._source;\n\t\tthis.detailControl = options.detailControl ? options.detailControl : 1;\n\t\tthis.levels.numLevels = 18;\n\n\t\tlet self = this;\n\t\tthis.urlBuilder = {\n\t\t\turlForTile: function (tile, imageFormat) {\n\t\t\t\treturn (\n\t\t\t\t\tself._source +\n\t\t\t\t\t(tile.level.levelNumber + 1) +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.column +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.row +\n\t\t\t\t\t'.' +\n\t\t\t\t\tself._imageType\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Build source URL\n\t * @param source {Object}\n\t * @returns {string} URL of source\n\t */\n\tbuildSourceUrl(source) {\n\t\tlet prefix = this.buildPrefix(source.prefixes);\n\t\tlet protocol = source.protocol ? source.protocol + '://' : 'http://';\n\t\tlet host = source.host + '/';\n\t\tlet path = source.path ? source.path + '/' : '';\n\n\t\treturn protocol + prefix + host + path;\n\t}\n\n\tbuildPrefix(prefixes) {\n\t\tlet prefix = '';\n\t\tif (prefixes) {\n\t\t\tlet index = Math.floor(Math.random() * prefixes.length);\n\t\t\tprefix = prefixes[index] + '.';\n\t\t}\n\t\treturn prefix;\n\t}\n}\n\nexport default WikimediaLayer;\n","import WorldWind from 'webworldwind-esa';\nimport {isEmpty as _isEmpty} from 'lodash';\n\n/**\n * @param layer {Object}\n * @param layer.key {string}\n * @param layer.opacity {number}\n * @param layer.options {Object}\n * @param layer.options.url {string}\n * @param layer.options.params {object}\n * @augments WorldWind.WmsLayer\n * @constructor\n */\nclass WmsLayer extends WorldWind.WmsLayer {\n\tconstructor(layer) {\n\t\tconst {key, options, opacity} = layer;\n\t\tconst {\n\t\t\timageFormat,\n\t\t\tlayers,\n\t\t\tname,\n\t\t\tstyles,\n\t\t\tversion,\n\t\t\t...params\n\t\t} = options.params;\n\n\t\tconst worldWindOptions = {\n\t\t\tkey: key,\n\t\t\tformat: imageFormat || 'image/png',\n\t\t\tlayerNames: layers,\n\t\t\tlevelZeroDelta: new WorldWind.Location(45, 45),\n\t\t\tname: name,\n\t\t\tnumLevels: 18,\n\t\t\topacity: opacity || 1,\n\t\t\tparams: _isEmpty(params) ? null : params,\n\t\t\tsector: new WorldWind.Sector(-90, 90, -180, 180),\n\t\t\tservice: options.url,\n\t\t\tsize: 256,\n\t\t\tstyleNames: styles,\n\t\t\tversion: version || '1.3.0',\n\t\t};\n\n\t\tsuper(worldWindOptions);\n\n\t\tthis.key = key;\n\t\tthis.attributions = options.attributions;\n\t\tthis.layerNames = layers;\n\t\tthis.service = options.url;\n\t\tthis.styleNames = styles || '';\n\t\tthis.customParams = params;\n\t\tthis.numLevels = worldWindOptions.numLevels;\n\n\t\tthis.cachePath = `${this.service}/${this.layerNames}`;\n\t\tif (this.styleNames) {\n\t\t\tthis.cachePath += `/${this.styleNames}`;\n\t\t}\n\t\tif (this.customParams && this.customParams.time) {\n\t\t\tthis.cachePath += `/${this.customParams.time}`;\n\t\t}\n\n\t\tthis.opacity = worldWindOptions.opacity;\n\n\t\t// TODO extend url builder to accept custom params\n\t}\n\n\tdoRender(dc) {\n\t\tWorldWind.WmsLayer.prototype.doRender.call(this, dc);\n\t\tdc.screenCreditController.clear();\n\t}\n}\n\nexport default WmsLayer;\n","import OsmLayer from './OsmLayer';\nimport WorldWind from 'webworldwind-esa';\nimport uriTemplates from 'uri-templates';\n\nclass WmtsLayer extends OsmLayer {\n\tconstructor(layer) {\n\t\tsuper('');\n\t\tthis.imageSize = 256;\n\t\tthis.detailControl = 1;\n\t\tthis.levels.numLevels = 18;\n\n\t\tthis.cachePath = layer.options.url;\n\t\tthis.urlBuilder = {\n\t\t\t...this.urlBuilder,\n\t\t\turlForTile: this.urlForTile.bind(this, layer.options.url),\n\t\t};\n\t}\n\n\t/**\n\t * @param url {string} URL template\n\t * @param tile {Tile}\n\t * @param imageFormat {string}\n\t * @returns {string} Final url for request\n\t */\n\turlForTile(url, tile, imageFormat) {\n\t\tlet template = uriTemplates(url);\n\t\tif (template && template.varNames && template.varNames.length) {\n\t\t\tlet prefixes = ['a', 'b', 'c']; // TODO optional\n\t\t\tlet numberOfUrls = prefixes.length;\n\t\t\tlet index = tile.row % numberOfUrls;\n\n\t\t\treturn template.fill({\n\t\t\t\ts: prefixes[index],\n\t\t\t\tz: tile.level.levelNumber + 1,\n\t\t\t\tx: tile.column,\n\t\t\t\ty: tile.row,\n\t\t\t});\n\t\t} else {\n\t\t\treturn `${url}/${tile.level.levelNumber + 1}/${tile.column}/${\n\t\t\t\ttile.row\n\t\t\t}.${WorldWind.WWUtil.suffixForMimeType(imageFormat)}`;\n\t\t}\n\t}\n}\n\nexport default WmtsLayer;\n","/**\n * @param context\n * @param x0 {number} starting x coordinate\n * @param y0 {number} starting y coordinate\n * @param x1 {number} ending x coordinate\n * @param y1 {number} ending y coordinate\n * @param color {string} hex code\n * @param width {number} line width in pixels\n */\nfunction arrow(context, x0, y0, x1, y1, color, width) {\n\tcontext.beginPath();\n\tcontext.moveTo(x0, y0);\n\tcontext.lineTo(x1, y1);\n\tcontext.strokeStyle = color;\n\tcontext.lineWidth = width;\n\tcontext.stroke();\n}\n\n/**\n * @param context\n * @param cx {number} x coordinate of center\n * @param cy {number} y coordinate of center\n * @param rx {number} x radius\n * @param ry {number} y radius\n * @param style {Object}\n */\nfunction ellipse(context, cx, cy, rx, ry, style) {\n\tcontext.save(); // save state\n\tcontext.beginPath();\n\n\tcontext.translate(cx - rx, cy - ry);\n\tcontext.scale(rx, ry);\n\tcontext.arc(1, 1, 1, 0, 2 * Math.PI, false);\n\n\tfillPolygon(context, style);\n}\n\nfunction path(context, nodes, style) {\n\tcontext.save(); // save state\n\tcontext.beginPath();\n\n\tnodes.forEach((node, index) => {\n\t\tif (index === 0) {\n\t\t\tcontext.moveTo(node[0], node[1]);\n\t\t} else {\n\t\t\tcontext.lineTo(node[0], node[1]);\n\t\t}\n\t});\n\n\tfillPolygon(context, style);\n}\n\n/**\n *\n * @param context\n * @param x0\n * @param y0\n * @param dx\n * @param dy\n * @param style\n */\nfunction rectangle(context, x0, y0, dx, dy, style) {\n\tcontext.save(); // save state\n\tcontext.beginPath();\n\tcontext.rect(x0, y0, dx, dy);\n\n\tfillPolygon(context, style);\n}\n\n// helpers\nfunction fillPolygon(context, style) {\n\tcontext.restore(); // restore to original state\n\tcontext.fillStyle = style.fill;\n\tcontext.lineWidth = style.outlineWidth;\n\tcontext.strokeStyle = style.outlineColor;\n\tcontext.globalAlpha = style.fillOpacity || style.outlineOpacity; // TODO solve opacity properly\n\tcontext.fill();\n\tcontext.stroke();\n}\n\nexport default {\n\tarrow,\n\tellipse,\n\tpath,\n\trectangle,\n};\n","/**\n * Constructs a HeatMapTile.\n *\n * Returns one tile for the HeatMap information. It is basically an interface specifying the public methods\n * properties and default configuration. The logic itself is handled in the subclasses.\n *\n * @alias HeatMapTile\n * @constructor\n * @classdesc Tile for the HeatMap layer visualising data on a canvas using shades of gray scale.\n *\n * @param data {Object[]} Array of information constituting points in the map.\n * @param options {Object}\n * @param options.sector {Sector} Sector representing the geographical area for this tile. It is used to correctly\n *  interpret the location of the MeasuredLocation on the resulting canvas.\n * @param options.width {Number} Width of the Canvas to be created in pixels.\n * @param options.height {Number} Height of the Canvas to be created in pixels.\n * @param options.radius {Number} Radius of the data point in pixels. The radius represents the blur applied to the\n *  drawn shape\n * @param options.incrementPerIntensity {Number} The ratio representing the 1 / measure for the maximum measure.\n * @param options.intensityGradient {Object} Keys represent the opacity between 0 and 1 and the values represent\n *  color strings.\n */\nimport {mapStyle} from '@gisatcz/ptr-utils';\nimport {isEmpty as _isEmpty, forIn as _forIn} from 'lodash';\nimport shapes from './canvasShapes';\n\nclass LargeDataLayerTile {\n\tconstructor(data, options, style, fidColumnName, selected, hovered) {\n\t\tthis._data = data;\n\t\tthis._style = style;\n\t\tthis._fidColumnName = fidColumnName;\n\t\tthis._hovered = hovered;\n\n\t\t// todo here?\n\t\tif (this._hovered && this._hovered.keys) {\n\t\t\tthis._hoveredStyle = mapStyle.getStyleObject(\n\t\t\t\tnull,\n\t\t\t\tthis._hovered.style,\n\t\t\t\ttrue\n\t\t\t); // todo add default\n\t\t}\n\n\t\tif (selected && !_isEmpty(selected)) {\n\t\t\tlet sel = [];\n\t\t\t_forIn(selected, selectedDef => {\n\t\t\t\tif (selectedDef && !_isEmpty(selectedDef)) {\n\t\t\t\t\tsel.push({\n\t\t\t\t\t\tkeys: selectedDef.keys,\n\t\t\t\t\t\tstyle: mapStyle.getStyleObject(null, selectedDef.style, true), // todo add default\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._selected = sel.length ? sel : null;\n\t\t}\n\n\t\tthis._sector = options.sector;\n\n\t\tthis._canvas = this.createCanvas(options.width, options.height);\n\n\t\tthis._width = options.width;\n\t\tthis._height = options.height;\n\n\t\tconst tileCenterLatitude =\n\t\t\t((this._sector.maxLatitude + this._sector.minLatitude) *\n\t\t\t\t(Math.PI / 180)) /\n\t\t\t2;\n\t\tthis._latitudeFactor = 1 / Math.cos(Math.abs(tileCenterLatitude));\n\t}\n\n\t/**\n\t * Returns the drawn HeatMapTile in the form of URL.\n\t * @return {String} Data URL of the tile.\n\t */\n\turl() {\n\t\treturn this.draw().toDataURL();\n\t}\n\n\t/**\n\t * Returns the whole Canvas. It is then possible to use further. This one is actually used in the\n\t * HeatMapLayer mechanism so if you want to provide some custom implementation of Canvas creation in your tile,\n\t * change this method.\n\t * @return {HTMLCanvasElement} Canvas Element representing the drawn tile.\n\t */\n\tcanvas() {\n\t\treturn this.draw();\n\t}\n\n\t/**\n\t * Draws the shapes on the canvas.\n\t * @returns {HTMLCanvasElement}\n\t */\n\tdraw() {\n\t\tconst ctx = this._canvas.getContext('2d');\n\t\tlet hovered = [];\n\t\tlet selected = [];\n\n\t\tfor (let i = 0; i < this._data.length; i++) {\n\t\t\tconst dataPoint = this._data[i];\n\t\t\tconst attributes = dataPoint.data;\n\n\t\t\tlet isHovered = this.isHovered(attributes);\n\t\t\tlet isSelected = this.isSelected(attributes);\n\n\t\t\tif (isSelected) {\n\t\t\t\tselected.push(dataPoint);\n\t\t\t} else if (isHovered) {\n\t\t\t\thovered.push(dataPoint);\n\t\t\t} else {\n\t\t\t\tthis.shape(ctx, dataPoint);\n\t\t\t}\n\t\t}\n\n\t\t// draw hovered\n\t\thovered.forEach(dataPoint => {\n\t\t\tthis.shape(ctx, dataPoint, true);\n\t\t});\n\n\t\t// draw selected\n\t\tselected.forEach(dataPoint => {\n\t\t\tthis.shape(ctx, dataPoint, false, true);\n\t\t});\n\n\t\treturn this._canvas;\n\t}\n\n\tisHovered(attributes) {\n\t\tif (this._hovered && this._hovered.keys) {\n\t\t\treturn this._hovered.keys.indexOf(attributes[this._fidColumnName]) !== -1;\n\t\t}\n\t}\n\n\tisSelected(attributes) {\n\t\tlet isSelected = false;\n\t\tif (this._selected) {\n\t\t\tthis._selected.forEach(selection => {\n\t\t\t\tlet selected =\n\t\t\t\t\tselection.keys.indexOf(attributes[this._fidColumnName]) !== -1;\n\t\t\t\tif (selected) {\n\t\t\t\t\tisSelected = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn isSelected;\n\t}\n\n\tshape(context, data, hovered, selected) {\n\t\tlet attributes = data.data;\n\t\tlet style = mapStyle.getStyleObject(attributes, this._style);\n\n\t\t// apply hovered style, if feature is hovered\n\t\tif (hovered) {\n\t\t\tstyle = {...style, ...this._hoveredStyle};\n\t\t}\n\n\t\t// TODO optimize looping through selections two times\n\t\t// apply selected style, if feature is selected\n\t\tif (selected) {\n\t\t\tthis._selected.forEach(selection => {\n\t\t\t\tlet selected =\n\t\t\t\t\tselection.keys.indexOf(attributes[this._fidColumnName]) !== -1;\n\t\t\t\tif (selected) {\n\t\t\t\t\tstyle = {...style, ...selection.style};\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (style.shape) {\n\t\t\tif (style.shape === 'circle-with-arrow') {\n\t\t\t\tthis.circleWithArrow(context, data, style);\n\t\t\t} else if (style.shape === 'circle') {\n\t\t\t\tthis.point(context, data, style);\n\t\t\t} else if (style.shape === 'square') {\n\t\t\t\tthis.square(context, data, style);\n\t\t\t} else if (style.shape === 'diamond') {\n\t\t\t\tthis.diamond(context, data, style);\n\t\t\t} else if (style.shape === 'triangle') {\n\t\t\t\tthis.triangle(context, data, style);\n\t\t\t} else {\n\t\t\t\tthis.point(context, data, style);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.point(context, data, style);\n\t\t}\n\t}\n\n\tpoint(context, data, style) {\n\t\tlet radius = this.getSize(style) / 2;\n\t\tlet center = this.getCenterCoordinates(data);\n\t\tlet cy = radius;\n\t\tlet cx = radius * this._latitudeFactor;\n\n\t\tshapes.ellipse(context, center[0], center[1], cx, cy, style);\n\t}\n\n\tsquare(context, data, style) {\n\t\tlet size = this.getSize(style);\n\t\tlet center = this.getCenterCoordinates(data);\n\t\tlet dx = size * this._latitudeFactor;\n\n\t\tshapes.rectangle(\n\t\t\tcontext,\n\t\t\tcenter[0] - dx / 2,\n\t\t\tcenter[1] - size / 2,\n\t\t\tdx,\n\t\t\tsize,\n\t\t\tstyle\n\t\t);\n\t}\n\n\tdiamond(context, data, style) {\n\t\tlet edgeLength = this.getSize(style);\n\t\tlet diagonalLength = Math.sqrt(2) * edgeLength;\n\n\t\t// center coordinates\n\t\tlet center = this.getCenterCoordinates(data);\n\n\t\tlet dx = diagonalLength * this._latitudeFactor;\n\t\tlet nodes = [\n\t\t\t[center[0] - dx / 2, center[1]],\n\t\t\t[center[0], center[1] - diagonalLength / 2],\n\t\t\t[center[0] + dx / 2, center[1]],\n\t\t\t[center[0], center[1] + diagonalLength / 2],\n\t\t\t[center[0] - dx / 2, center[1]],\n\t\t];\n\n\t\tshapes.path(context, nodes, style);\n\t}\n\n\ttriangle(context, data, style) {\n\t\tlet edgeLength = this.getSize(style);\n\t\tlet ty = Math.sqrt(Math.pow(edgeLength, 2) - Math.pow(edgeLength / 2, 2));\n\n\t\t// center coordinates\n\t\tlet center = this.getCenterCoordinates(data);\n\n\t\tlet dx = edgeLength * this._latitudeFactor;\n\t\tlet nodes = [\n\t\t\t[center[0] - dx / 2, center[1] + ty / 3],\n\t\t\t[center[0], center[1] - (2 * ty) / 3],\n\t\t\t[center[0] + dx / 2, center[1] + ty / 3],\n\t\t\t[center[0] - dx / 2, center[1] + ty / 3],\n\t\t];\n\n\t\tshapes.path(context, nodes, style);\n\t}\n\n\tcircleWithArrow(context, data, style) {\n\t\tlet radius = this.getSize(style) / 2;\n\t\tlet direction = style.arrowDirection || 1;\n\n\t\tlet center = this.getCenterCoordinates(data);\n\t\tlet ry = radius;\n\t\tlet rx = radius * this._latitudeFactor;\n\n\t\tshapes.ellipse(context, center[0], center[1], rx, ry, style);\n\n\t\tlet x0 = center[0] + direction * rx;\n\t\tlet y0 = center[1];\n\t\tlet x1 = x0 + direction * style.arrowLength;\n\t\tlet y1 = y0;\n\n\t\tshapes.arrow(context, x0, y0, x1, y1, style.arrowColor, style.arrowWidth);\n\t}\n\n\tgetSize(style) {\n\t\tif (style.size) {\n\t\t\treturn style.size;\n\t\t} else if (style.volume) {\n\t\t\tif (style.shape === 'triangle') {\n\t\t\t\treturn Math.sqrt(style.volume / 2);\n\t\t\t} else if (style.shape === 'square' || style.shape === 'diamond') {\n\t\t\t\treturn Math.sqrt(style.volume);\n\t\t\t} else {\n\t\t\t\treturn Math.sqrt(style.volume / Math.PI);\n\t\t\t}\n\t\t} else {\n\t\t\treturn mapStyle.DEFAULT_SIZE;\n\t\t}\n\t}\n\n\tgetCenterCoordinates(data) {\n\t\treturn [\n\t\t\tthis.longitudeInSector(data, this._sector, this._width),\n\t\t\tthis._height - this.latitudeInSector(data, this._sector, this._height),\n\t\t];\n\t}\n\n\t/**\n\t * Creates canvas element of given size.\n\t * @protected\n\t * @param width {Number} Width of the canvas in pixels\n\t * @param height {Number} Height of the canvas in pixels\n\t * @returns {HTMLCanvasElement} Created the canvas\n\t */\n\tcreateCanvas(width, height) {\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\treturn canvas;\n\t}\n\n\t/**\n\t * Calculates position in pixels of the point based on its latitude.\n\t * @param dataPoint {Object} Location to transform\n\t * @param sector {Sector} Sector to which transform\n\t * @param height {Number} Height of the tile to draw to.\n\t * @private\n\t * @returns {Number} Position on the height in pixels.\n\t */\n\tlatitudeInSector(dataPoint, sector, height) {\n\t\tvar sizeOfArea = sector.maxLatitude - sector.minLatitude;\n\t\tvar locationInArea = dataPoint.y - 90 - sector.minLatitude;\n\t\treturn Math.ceil((locationInArea / sizeOfArea) * height);\n\t}\n\n\t/**\n\t * Calculates position in pixels of the point based on its longitude.\n\t * @param dataPoint {Object} Location to transform\n\t * @param sector {Sector} Sector to which transform\n\t * @param width {Number} Width of the tile to draw to.\n\t * @private\n\t * @returns {Number} Position on the width in pixels.\n\t */\n\tlongitudeInSector(dataPoint, sector, width) {\n\t\tvar sizeOfArea = sector.maxLongitude - sector.minLongitude;\n\t\tvar locationInArea = dataPoint.x - 180 - sector.minLongitude;\n\t\treturn Math.ceil((locationInArea / sizeOfArea) * width);\n\t}\n}\n\nexport default LargeDataLayerTile;\n","import React from 'react';\nimport WorldWind from 'webworldwind-esa';\nimport {QuadTree, Box, Point, Circle} from 'js-quadtree';\nimport {\n\tpoint as turfPoint,\n\tfeatureCollection as turfFeatureCollection,\n} from '@turf/helpers';\nimport nearestPoint from '@turf/nearest-point';\nimport turfCentroid from '@turf/centroid';\nimport LargeDataLayerTile from './LargeDataLayerTile';\nimport {compact as _compact, each as _each} from 'lodash';\nimport {mapStyle} from '@gisatcz/ptr-utils';\n\nconst {\n\tLocation,\n\tREDRAW_EVENT_TYPE,\n\tSector,\n\tSurfaceCircle,\n\tTiledImageLayer,\n} = WorldWind;\n\n// It supports GeoJSON as format with only points and maximum 1 000 000 points.\n// Multipolygons are represented as points\n\n// TODO: Highlight the selected points.\nclass LargeDataLayer extends TiledImageLayer {\n\tconstructor(wwd, options, layer) {\n\t\tsuper(\n\t\t\tnew Sector(-90, 90, -180, 180),\n\t\t\tnew Location(45, 45),\n\t\t\t18,\n\t\t\t'image/png',\n\t\t\tlayer.key,\n\t\t\t256,\n\t\t\t256\n\t\t);\n\n\t\tthis.tileWidth = 256;\n\t\tthis.tileHeight = 256;\n\t\tthis.detailControl = 1;\n\t\tthis.wwd = wwd;\n\n\t\t// At the moment the URL must contain the GeoJSON.\n\t\tthis.processedTiles = {};\n\t\tthis.quadTree = new QuadTree(new Box(0, 0, 360, 180));\n\n\t\tthis.pantherProps = {\n\t\t\tfeatures: options.features,\n\t\t\tfidColumnName: options.fidColumnName,\n\t\t\thovered: {...options.hovered},\n\t\t\tselected: {...options.selected},\n\t\t\tkey: layer.key,\n\t\t\tlayerKey: layer.layerKey,\n\t\t\tonHover: options.onHover,\n\t\t\tonClick: options.onClick,\n\t\t\tpointHoverBuffer: options.pointHoverBuffer || mapStyle.DEFAULT_SIZE,\n\t\t\tstyle: options.style,\n\t\t\twwd: wwd,\n\t\t};\n\n\t\tif (this.pantherProps.features) {\n\t\t\tthis.addFeatures(this.pantherProps.features);\n\t\t} else {\n\t\t\tthis.loadData(options.url);\n\t\t}\n\n\t\tthis.onClick = this.onClick.bind(this, wwd);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this, wwd);\n\t\twwd.addEventListener('click', this.onClick);\n\t\twwd.addEventListener('mousemove', this.onMouseMove);\n\t}\n\n\tremoveListeners() {\n\t\tthis.pantherProps.wwd.removeEventListener('click', this.onClick);\n\t\tthis.pantherProps.wwd.removeEventListener('mousemove', this.onMouseMove);\n\t}\n\n\tloadData(url) {\n\t\tfetch(url)\n\t\t\t.then(data => {\n\t\t\t\treturn data.json();\n\t\t\t})\n\t\t\t.then(file => {\n\t\t\t\tif (file.features.length > 1000000) {\n\t\t\t\t\tthrow new Error('Too many features.');\n\t\t\t\t}\n\n\t\t\t\tthis.addFeatures(file.features);\n\t\t\t});\n\t}\n\n\taddFeatures(features) {\n\t\tfeatures.forEach(feature => {\n\t\t\tconst type = feature.geometry && feature.geometry.type;\n\t\t\tlet point = null;\n\t\t\tlet props = {...feature.properties};\n\n\t\t\t// TODO support other geometry types\n\t\t\tif (type === 'Point') {\n\t\t\t\tprops.centroid = feature.geometry.coordinates;\n\t\t\t\tpoint = new Point(\n\t\t\t\t\tfeature.geometry.coordinates[0] + 180,\n\t\t\t\t\tfeature.geometry.coordinates[1] + 90,\n\t\t\t\t\tprops\n\t\t\t\t);\n\t\t\t} else if (type === 'MultiPoint') {\n\t\t\t\tconst coordinates = feature.geometry.coordinates[0];\n\t\t\t\tprops.centroid = coordinates;\n\t\t\t\tpoint = new Point(coordinates[0] + 180, coordinates[1] + 90, props);\n\t\t\t} else if (type === 'MultiPolygon') {\n\t\t\t\tlet centroid = turfCentroid(feature.geometry);\n\t\t\t\tprops.centroid = centroid.geometry.coordinates;\n\t\t\t\tpoint = new Point(\n\t\t\t\t\tcentroid.geometry.coordinates[0] + 180,\n\t\t\t\t\tcentroid.geometry.coordinates[1] + 90,\n\t\t\t\t\tprops\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (point) {\n\t\t\t\tthis.quadTree.insert(point);\n\t\t\t}\n\t\t});\n\n\t\tthis.refresh();\n\t}\n\n\thandleEvent(wwd, event) {\n\t\tconst x =\n\t\t\t\t(event.touches && event.touches[0] && event.touches[0].clientX) ||\n\t\t\t\tevent.clientX,\n\t\t\ty =\n\t\t\t\t(event.touches && event.touches[0] && event.touches[0].clientY) ||\n\t\t\t\tevent.clientY;\n\n\t\tconst pageX =\n\t\t\t(event.touches && event.touches[0] && event.touches[0].pageX) ||\n\t\t\tevent.pageX;\n\t\tconst pageY =\n\t\t\t(event.touches && event.touches[0] && event.touches[0].pageY) ||\n\t\t\tevent.pageY;\n\n\t\tconst terrainObject = wwd\n\t\t\t.pickTerrain(wwd.canvasCoordinates(x, y))\n\t\t\t.terrainObject();\n\n\t\tlet buffer = this.getPointHoverBuffer(wwd);\n\n\t\tif (terrainObject) {\n\t\t\tconst position = terrainObject.position;\n\t\t\tlet points = this.quadTree.query(\n\t\t\t\tnew Circle(position.longitude + 180, position.latitude + 90, buffer)\n\t\t\t);\n\n\t\t\t// find nearest\n\t\t\tif (points.length > 1) {\n\t\t\t\tlet targetPoint = turfPoint([position.longitude, position.latitude]);\n\t\t\t\tlet features = points.map(point => {\n\t\t\t\t\treturn turfPoint([point.data.centroid[0], point.data.centroid[1]], {\n\t\t\t\t\t\t...point,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tlet featureCollection = turfFeatureCollection(features);\n\t\t\t\tlet nearest = nearestPoint(targetPoint, featureCollection);\n\t\t\t\tpoints = [nearest.properties];\n\t\t\t}\n\n\t\t\treturn {points, x: pageX, y: pageY};\n\t\t} else {\n\t\t\treturn {points: [], x: pageX, y: pageY};\n\t\t}\n\t}\n\n\tonMouseMove(wwd, event) {\n\t\tthis.onMouseMoveResult(this.handleEvent(wwd, event));\n\t}\n\n\tonClick(wwd, event) {\n\t\tthis.onClickResult(this.handleEvent(wwd, event));\n\t}\n\n\tonClickResult(data) {\n\t\tif (this.pantherProps.onClick) {\n\t\t\tlet gids = data.points.map(\n\t\t\t\tpoint => point.data[this.pantherProps.fidColumnName]\n\t\t\t);\n\t\t\tif (gids && gids.length) {\n\t\t\t\tthis.pantherProps.onClick(this.pantherProps.layerKey, gids);\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseMoveResult(data) {\n\t\tif (this.pantherProps.onHover) {\n\t\t\tlet gids = _compact(\n\t\t\t\tdata.points.map(point => point.data[this.pantherProps.fidColumnName])\n\t\t\t);\n\t\t\tthis.pantherProps.onHover(\n\t\t\t\tthis.pantherProps.layerKey,\n\t\t\t\tgids,\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tnull,\n\t\t\t\tdata.points,\n\t\t\t\tthis.pantherProps.fidColumnName\n\t\t\t);\n\t\t}\n\t}\n\n\tretrieveTileImage(dc, tile, suppressRedraw) {\n\t\tthis.processedTiles[tile.imagePath] = true;\n\n\t\tconst sector = tile.sector;\n\t\tconst extended = this.calculateExtendedSector(sector, 0.2, 0.2);\n\t\tconst points = this.filterGeographically(extended.sector);\n\n\t\tif (points) {\n\t\t\tvar imagePath = tile.imagePath,\n\t\t\t\tcache = dc.gpuResourceCache,\n\t\t\t\tlayer = this;\n\n\t\t\tvar canvas = this.createPointTile(points, {\n\t\t\t\tsector: sector,\n\n\t\t\t\twidth: this.tileWidth,\n\t\t\t\theight: this.tileHeight,\n\t\t\t}).canvas();\n\n\t\t\tvar texture = layer.createTexture(dc, tile, canvas);\n\t\t\tlayer.removeFromCurrentRetrievals(imagePath);\n\n\t\t\tif (texture) {\n\t\t\t\tcache.putResource(imagePath, texture, texture.size);\n\n\t\t\t\tlayer.currentTilesInvalid = true;\n\t\t\t\tlayer.absentResourceList.unmarkResourceAbsent(imagePath);\n\n\t\t\t\tif (!suppressRedraw) {\n\t\t\t\t\t// Send an event to request a redraw.\n\t\t\t\t\tconst e = document.createEvent('Event');\n\t\t\t\t\te.initEvent(REDRAW_EVENT_TYPE, true, true);\n\t\t\t\t\twindow.dispatchEvent(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO Original implementation from @jbalhar\n\t// retrieveTileImage(dc, tile, suppressRedraw) {\n\t// \t// if(tile.level.levelNumber < 14 || this.processedTiles[tile.imagePath]){\n\t// \t// \treturn;\n\t// \t// }\n\t// \tthis.processedTiles[tile.imagePath] = true;\n\t//\n\t// \tconst sector = tile.sector;\n\t// \tconst extended = this.calculateExtendedSector(sector, 0.2, 0.2);\n\t// \tconst extendedWidth = Math.ceil(extended.extensionFactorWidth * this.tileWidth);\n\t// \tconst extendedHeight = Math.ceil(extended.extensionFactorHeight * this.tileHeight);\n\t//\n\t// \tconst points = this.filterGeographically(extended.sector);\n\t//\n\t// \tif(points) {\n\t// \t\tvar imagePath = tile.imagePath,\n\t// \t\t\tcache = dc.gpuResourceCache,\n\t// \t\t\tlayer = this;\n\t//\n\t// \t\tvar canvas = this.createPointTile(points, {\n\t// \t\t\tsector: extended.sector,\n\t//\n\t// \t\t\twidth: this.tileWidth + 2 * extendedWidth,\n\t// \t\t\theight: this.tileHeight + 2 * extendedHeight\n\t// \t\t}).canvas();\n\t//\n\t// \t\tvar result = document.createElement('canvas');\n\t// \t\tresult.height = this.tileHeight;\n\t// \t\tresult.width = this.tileWidth;\n\t// \t\tresult.getContext('2d').putImageData(\n\t// \t\t\tcanvas.getContext('2d').getImageData(extendedWidth, extendedHeight, this.tileWidth, this.tileHeight),\n\t// \t\t\t0, 0\n\t// \t\t);\n\t//\n\t// \t\tvar texture = layer.createTexture(dc, tile, result);\n\t// \t\tlayer.removeFromCurrentRetrievals(imagePath);\n\t//\n\t// \t\tif (texture) {\n\t// \t\t\tcache.putResource(imagePath, texture, texture.size);\n\t//\n\t// \t\t\tlayer.currentTilesInvalid = true;\n\t// \t\t\tlayer.absentResourceList.unmarkResourceAbsent(imagePath);\n\t//\n\t// \t\t\tif (!suppressRedraw) {\n\t// \t\t\t\t// Send an event to request a redraw.\n\t// \t\t\t\tconst e = document.createEvent('Event');\n\t// \t\t\t\te.initEvent(REDRAW_EVENT_TYPE, true, true);\n\t// \t\t\t\twindow.dispatchEvent(e);\n\t// \t\t\t}\n\t// \t\t}\n\t// \t}\n\t// }\n\n\tfilterGeographically(sector) {\n\t\tconst width = sector.maxLongitude - sector.minLongitude;\n\t\tconst height = sector.maxLatitude - sector.minLatitude;\n\t\treturn this.quadTree.query(\n\t\t\tnew Box(sector.minLongitude + 180, sector.minLatitude + 90, width, height)\n\t\t);\n\t}\n\n\tcalculateExtendedSector(sector, extensionFactorWidth, extensionFactorHeight) {\n\t\tvar latitudeChange =\n\t\t\t(sector.maxLatitude - sector.minLatitude) * extensionFactorHeight;\n\t\tvar longitudeChange =\n\t\t\t(sector.maxLongitude - sector.minLongitude) * extensionFactorWidth;\n\t\treturn {\n\t\t\tsector: new Sector(\n\t\t\t\tsector.minLatitude - latitudeChange,\n\t\t\t\tsector.maxLatitude + latitudeChange,\n\t\t\t\tsector.minLongitude - longitudeChange,\n\t\t\t\tsector.maxLongitude + longitudeChange\n\t\t\t),\n\t\t\textensionFactorHeight: extensionFactorHeight,\n\t\t\textensionFactorWidth: extensionFactorWidth,\n\t\t};\n\t}\n\n\tcreatePointTile(data, options) {\n\t\treturn new LargeDataLayerTile(\n\t\t\tdata,\n\t\t\toptions,\n\t\t\tthis.pantherProps.style,\n\t\t\tthis.pantherProps.fidColumnName,\n\t\t\tthis.pantherProps.selected,\n\t\t\tthis.pantherProps.hovered\n\t\t);\n\t}\n\n\tupdateHoveredKeys(hoveredKeys, x, y) {\n\t\tthis.pantherProps.hovered.keys = hoveredKeys;\n\n\t\tconst terrainObject = this.wwd\n\t\t\t.pickTerrain(this.wwd.canvasCoordinates(x, y))\n\t\t\t.terrainObject();\n\n\t\tif (terrainObject) {\n\t\t\tconst lat = terrainObject.position.latitude;\n\t\t\tconst lon = terrainObject.position.longitude;\n\n\t\t\t_each(this.currentTiles, tile => {\n\t\t\t\tconst s = tile.sector;\n\t\t\t\tconst prev = this.previousHoveredCoordinates;\n\n\t\t\t\tconst latDiff = Math.abs(s.maxLatitude - s.minLatitude);\n\t\t\t\tconst lonDiff = Math.abs(s.maxLongitude - s.minLongitude);\n\n\t\t\t\tconst latBuffer = latDiff / 10;\n\t\t\t\tconst lonBuffer = lonDiff / 10;\n\n\t\t\t\tconst hovered =\n\t\t\t\t\tlat <= s.maxLatitude + latBuffer &&\n\t\t\t\t\tlat >= s.minLatitude - latBuffer &&\n\t\t\t\t\tlon <= s.maxLongitude + lonBuffer &&\n\t\t\t\t\tlon >= s.minLongitude - lonBuffer;\n\t\t\t\tconst previouslyHovered =\n\t\t\t\t\tprev &&\n\t\t\t\t\tprev.lat <= s.maxLatitude + latBuffer &&\n\t\t\t\t\tprev.lat >= s.minLatitude - latBuffer &&\n\t\t\t\t\tprev.lon <= s.maxLongitude + lonBuffer &&\n\t\t\t\t\tprev.lon >= s.minLongitude - lonBuffer;\n\n\t\t\t\tif (hovered || previouslyHovered) {\n\t\t\t\t\tthis.retrieveTileImage(this.wwd.drawContext, tile, true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.previousHoveredCoordinates = {lat, lon};\n\t\t}\n\t}\n\n\t/**\n\t * naive point hover buffer determination\n\t * @param wwd\n\t * @return {number} buffer in degrees\n\t */\n\tgetPointHoverBuffer(wwd) {\n\t\tconst canvasWidth = wwd.canvas.clientWidth;\n\t\tconst range = wwd.navigator.range;\n\t\tconst bufferInMeters =\n\t\t\t(range / canvasWidth) * this.pantherProps.pointHoverBuffer;\n\t\treturn bufferInMeters * 0.00001;\n\t}\n}\n\nexport default LargeDataLayer;\n","import WorldWind from 'webworldwind-esa';\n\nimport VectorLayer from './VectorLayer';\nimport WikimediaLayer from './WikimediaLayer';\nimport WmsLayer from './WmsLayer';\nimport WmtsLayer from './WmtsLayer';\nimport LargeDataLayer from './LargeDataLayerSource/LargeDataLayer';\nimport {find as _find} from 'lodash';\nimport {mapStyle} from '@gisatcz/ptr-utils';\n\nfunction getLayerByType(layerDefinition, wwd, onHover, onClick, pointAsMarker) {\n\tif (layerDefinition.type) {\n\t\tswitch (layerDefinition.type) {\n\t\t\tcase 'worldwind':\n\t\t\t\tswitch (layerDefinition.options.layer) {\n\t\t\t\t\tcase 'bingAerial':\n\t\t\t\t\t\treturn new WorldWind.BingAerialLayer(null);\n\t\t\t\t\tcase 'bluemarble':\n\t\t\t\t\t\treturn new WorldWind.BMNGLayer();\n\t\t\t\t\tcase 'wikimedia':\n\t\t\t\t\t\treturn new WikimediaLayer({\n\t\t\t\t\t\t\tattribution:\n\t\t\t\t\t\t\t\t'Wikimedia maps - Map data \\u00A9 OpenStreetMap contributors',\n\t\t\t\t\t\t\tsourceObject: {\n\t\t\t\t\t\t\t\thost: 'maps.wikimedia.org',\n\t\t\t\t\t\t\t\tpath: 'osm-intl',\n\t\t\t\t\t\t\t\tprotocol: 'https',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\tcase 'wmts':\n\t\t\t\treturn new WmtsLayer(layerDefinition);\n\t\t\tcase 'wms':\n\t\t\t\treturn new WmsLayer(layerDefinition);\n\t\t\tcase 'vector':\n\t\t\t\treturn getVectorLayer(\n\t\t\t\t\tlayerDefinition,\n\t\t\t\t\twwd,\n\t\t\t\t\tonHover,\n\t\t\t\t\tonClick,\n\t\t\t\t\tpointAsMarker\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t} else {\n\t\treturn null;\n\t}\n}\n\nfunction getVectorLayer(layerDefinition, wwd, onHover, onClick, pointAsMarker) {\n\tconst url = layerDefinition.options && layerDefinition.options.url;\n\tconst numOfFeatures =\n\t\tlayerDefinition.options &&\n\t\tlayerDefinition.options.features &&\n\t\tlayerDefinition.options.features.length;\n\tconst key = layerDefinition.key || 'Vector layer';\n\tconst layerKey = layerDefinition.layerKey || key;\n\n\tlet options = {\n\t\t...layerDefinition.options,\n\t\tkey,\n\t\tlayerKey,\n\t\tonHover,\n\t\tonClick,\n\t};\n\n\t// TODO better deciding\n\tif (url || pointAsMarker) {\n\t\toptions.pointHoverBuffer = mapStyle.DEFAULT_SIZE; // in px TODO pass pointHoverBuffer\n\t\treturn new LargeDataLayer(wwd, options, layerDefinition);\n\t} else {\n\t\treturn new VectorLayer(layerDefinition, options);\n\t}\n}\n\nfunction updateVectorLayer(layerDefinition, wwd, onHover, onClick) {\n\tlet mapLayer = null;\n\tlet layerKey = layerDefinition.layerKey;\n\tlet worldWindLayer = _find(wwd.layers, lay => {\n\t\treturn (\n\t\t\tlay.pantherProps &&\n\t\t\tlay.pantherProps.layerKey &&\n\t\t\tlay.pantherProps.layerKey === layerKey\n\t\t);\n\t});\n\n\tif (!worldWindLayer) {\n\t\tmapLayer = getLayerByType(layerDefinition, wwd, onHover, onClick);\n\t} else {\n\t\tlet prevFeatures = worldWindLayer.pantherProps.features;\n\t\tlet nextFeatures = layerDefinition.options.features;\n\n\t\tif (prevFeatures === nextFeatures) {\n\t\t\tmapLayer = worldWindLayer;\n\t\t\t// TODO still needed?\n\t\t\t// let prevHoveredKeys = worldWindLayer.pantherProps.hovered && worldWindLayer.pantherProps.hovered.keys;\n\t\t\t// let nextHoveredKeys = layerDefinition.options.hovered && layerDefinition.options.hovered.keys;\n\t\t\t// if (prevHoveredKeys !== nextHoveredKeys) {\n\t\t\t// \tworldWindLayer.updateHoveredKeys(nextHoveredKeys);\n\t\t\t// }\n\t\t} else {\n\t\t\tworldWindLayer.removeListeners();\n\t\t\tmapLayer = getLayerByType(layerDefinition, wwd, onHover, onClick);\n\t\t}\n\t}\n\n\treturn mapLayer;\n}\n\nexport default {\n\tgetLayerByType,\n\tupdateVectorLayer,\n};\n","import viewUtils from '../../utils/view';\n\nfunction getChangedViewParams(prev, next) {\n\tlet changed = {};\n\n\t// check for boxRange change, disregard if change is too small\n\tif (\n\t\tprev.boxRange !== next.boxRange &&\n\t\tMath.abs(prev.boxRange - next.boxRange) > 1\n\t) {\n\t\tchanged.boxRange = next.boxRange;\n\t}\n\n\tif (prev.heading !== next.heading) {\n\t\tchanged.heading = next.heading;\n\t}\n\n\tif (prev.tilt !== next.tilt) {\n\t\tchanged.tilt = next.tilt;\n\t}\n\n\tif (prev.roll !== next.roll) {\n\t\tchanged.roll = next.roll;\n\t}\n\n\tif (\n\t\tprev.center.lat !== next.center.lat ||\n\t\tprev.center.lon !== next.center.lon\n\t) {\n\t\tchanged.center = {\n\t\t\tlat: next.center.lat,\n\t\t\tlon: next.center.lon,\n\t\t};\n\t}\n\n\treturn changed;\n}\n\n/**\n * Update navigator of given World Window\n * @param wwd {WorldWindow}\n * @param view {Object}\n */\nfunction update(wwd, view, width, height) {\n\tlet state = wwd.navigator;\n\tlet wwdUpdate = getWorldWindNavigatorFromViewParams(view, width, height);\n\n\tlet shouldRedraw = false;\n\n\tif (wwdUpdate.range && state.range !== wwdUpdate.range) {\n\t\tstate.range = wwdUpdate.range;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\t(wwdUpdate.tilt || wwdUpdate.tilt === 0) &&\n\t\tstate.tilt !== wwdUpdate.tilt\n\t) {\n\t\tstate.tilt = wwdUpdate.tilt;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\t(wwdUpdate.roll || wwdUpdate.roll === 0) &&\n\t\tstate.roll !== wwdUpdate.roll\n\t) {\n\t\tstate.roll = wwdUpdate.roll;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\t(wwdUpdate.heading || wwdUpdate.heading === 0) &&\n\t\tstate.heading !== wwdUpdate.heading\n\t) {\n\t\tstate.heading = wwdUpdate.heading;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\twwdUpdate.lookAtLocation &&\n\t\t(wwdUpdate.lookAtLocation.latitude ||\n\t\t\twwdUpdate.lookAtLocation.latitude === 0) &&\n\t\tstate.lookAtLocation.latitude !== wwdUpdate.lookAtLocation.latitude\n\t) {\n\t\tstate.lookAtLocation.latitude = wwdUpdate.lookAtLocation.latitude;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\twwdUpdate.lookAtLocation &&\n\t\t(wwdUpdate.lookAtLocation.longitude ||\n\t\t\twwdUpdate.lookAtLocation.longitude === 0) &&\n\t\tstate.lookAtLocation.longitude !== wwdUpdate.lookAtLocation.longitude\n\t) {\n\t\tstate.lookAtLocation.longitude = wwdUpdate.lookAtLocation.longitude;\n\t\tshouldRedraw = true;\n\t}\n\n\t// if (wwd.verticalExaggeration && wwdUpdate.elevation && wwd.verticalExaggeration !== wwdUpdate.elevation){\n\t// \twwd.verticalExaggeration = wwdUpdate.elevation;\n\t// \tshouldRedraw = true;\n\t// }\n\n\tif (shouldRedraw) {\n\t\twwd.redraw();\n\t}\n}\n\n/**\n * Convert view to World Wind Navigator params\n * @param view {Object}\n * @returns {WorldWind.Navigator}\n */\nfunction getWorldWindNavigatorFromViewParams(view, width, height) {\n\tlet {center, boxRange, ...navigator} = view;\n\n\tif (boxRange) {\n\t\tnavigator.range = viewUtils.getWorldWindRangeFromBoxRange(\n\t\t\tboxRange,\n\t\t\twidth,\n\t\t\theight\n\t\t);\n\t}\n\n\tif (center) {\n\t\tnavigator.lookAtLocation = {};\n\t\tif (center.lat || center.lat === 0) {\n\t\t\tnavigator.lookAtLocation.latitude = center.lat;\n\t\t}\n\t\tif (center.lon || center.lon === 0) {\n\t\t\tnavigator.lookAtLocation.longitude = center.lon;\n\t\t}\n\t}\n\n\treturn navigator;\n}\n\nfunction getViewParamsFromWorldWindNavigator(navigator, width, height) {\n\tlet view = {};\n\tlet {lookAtLocation, range} = navigator;\n\n\tif (range) {\n\t\tview.boxRange = viewUtils.getBoxRangeFromWorldWindRange(\n\t\t\trange,\n\t\t\twidth,\n\t\t\theight\n\t\t);\n\t}\n\n\tif (lookAtLocation) {\n\t\tview.center = {};\n\t\tif (lookAtLocation.latitude) {\n\t\t\tview.center.lat = lookAtLocation.latitude;\n\t\t}\n\t\tif (lookAtLocation.longitude) {\n\t\t\tview.center.lon = lookAtLocation.longitude;\n\t\t}\n\t}\n\n\tif (navigator.heading || navigator.heading === 0) {\n\t\tview.heading = navigator.heading;\n\t}\n\n\tif (navigator.tilt || navigator.tilt === 0) {\n\t\tview.tilt = navigator.tilt;\n\t}\n\n\tif (navigator.roll || navigator.roll === 0) {\n\t\tview.roll = navigator.roll;\n\t}\n\n\treturn view;\n}\n\nexport default {\n\tgetChangedViewParams,\n\tgetViewParamsFromWorldWindNavigator,\n\tupdate,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n\tisArray as _isArray,\n\tisEmpty as _isEmpty,\n\tsortBy as _sortBy,\n} from 'lodash';\nimport {CyclicPickController, utils, map as mapUtils} from '@gisatcz/ptr-utils';\n\nimport WorldWind from 'webworldwind-esa';\nimport decorateWorldWindowController from './controllers/WorldWindowControllerDecorator';\nimport layersHelpers from './layers/helpers';\nimport navigator from './navigator/helpers';\n\nimport './style.scss';\n\nimport LargeDataLayer from './layers/LargeDataLayerSource/LargeDataLayer';\n\nimport VectorLayer from './layers/VectorLayer';\n\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport Context from '@gisatcz/cross-package-react-context';\nimport ReactResizeDetector from 'react-resize-detector';\nimport viewport from '../utils/viewport';\nconst HoverContext = Context.getContext('HoverContext');\nconst {WorldWindow, ElevationModel} = WorldWind;\n\nclass WorldWindMap extends React.PureComponent {\n\tstatic contextType = HoverContext;\n\n\tstatic defaultProps = {\n\t\televationModel: null,\n\t};\n\n\tstatic propTypes = {\n\t\tbackgroundLayer: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n\t\tlayers: PropTypes.array,\n\t\tname: PropTypes.string,\n\t\tview: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\n\t\tonClick: PropTypes.func,\n\t\tonLayerClick: PropTypes.func,\n\t\tonViewChange: PropTypes.func,\n\n\t\televationModel: PropTypes.string,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.canvasId = utils.uuid();\n\n\t\tthis.state = {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t};\n\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onLayerHover = this.onLayerHover.bind(this);\n\t\tthis.onWorldWindHover = this.onWorldWindHover.bind(this);\n\t\tthis.onLayerClick = this.onLayerClick.bind(this);\n\t\tthis.onMouseOut = this.onMouseOut.bind(this);\n\t\tthis.onResize = this.onResize.bind(this);\n\t\tthis.onZoomLevelsBased = this.onZoomLevelsBased.bind(this);\n\n\t\tthis.onZoomLevelsBasedTimeout = null;\n\t\tthis.onZoomLevelsBasedStep = 0;\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.wwd = new WorldWindow(this.canvasId, this.getElevationModel());\n\n\t\tdecorateWorldWindowController(\n\t\t\tthis.wwd.worldWindowController,\n\t\t\tthis.props.viewLimits,\n\t\t\tthis.props.levelsBased\n\t\t);\n\t\tthis.wwd.worldWindowController.onNavigatorChanged = this.onNavigatorChange.bind(\n\t\t\tthis\n\t\t);\n\n\t\tif (this.props.levelsBased) {\n\t\t\t// rewrite default wheel listener.\n\t\t\tthis.wwd.eventListeners.wheel.listeners = [\n\t\t\t\tthis.onZoomLevelsBased.bind(this),\n\t\t\t];\n\t\t}\n\n\t\tnew CyclicPickController(\n\t\t\tthis.wwd,\n\t\t\t[\n\t\t\t\t'mousemove',\n\t\t\t\t'mousedown',\n\t\t\t\t'mouseup',\n\t\t\t\t'mouseout',\n\t\t\t\t'touchstart',\n\t\t\t\t'touchmove',\n\t\t\t\t'touchend',\n\t\t\t],\n\t\t\tthis.onWorldWindHover,\n\t\t\ttrue\n\t\t);\n\t\tthis.updateNavigator(mapConstants.defaultMapView);\n\t\tthis.updateLayers();\n\t}\n\n\tonZoomLevelsBased(e) {\n\t\te.preventDefault();\n\n\t\tif (e.wheelDelta) {\n\t\t\tthis.onZoomLevelsBasedStep += e.wheelDelta;\n\n\t\t\tif (this.onZoomLevelsBasedTimeout) {\n\t\t\t\tclearTimeout(this.onZoomLevelsBasedTimeout);\n\t\t\t}\n\n\t\t\tthis.onZoomLevelsBasedTimeout = setTimeout(() => {\n\t\t\t\tlet zoomLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\tthis.props.view.boxRange,\n\t\t\t\t\tthis.state.width,\n\t\t\t\t\tthis.state.height\n\t\t\t\t);\n\n\t\t\t\tif (this.onZoomLevelsBasedStep > 300) {\n\t\t\t\t\tzoomLevel += 3;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep > 150) {\n\t\t\t\t\tzoomLevel += 2;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep > 0) {\n\t\t\t\t\tzoomLevel++;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep < -300) {\n\t\t\t\t\tzoomLevel -= 3;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep < -150) {\n\t\t\t\t\tzoomLevel -= 2;\n\t\t\t\t} else {\n\t\t\t\t\tzoomLevel--;\n\t\t\t\t}\n\n\t\t\t\tlet levelsRange = mapConstants.defaultLevelsRange;\n\t\t\t\tconst boxRangeRange =\n\t\t\t\t\tthis.props.viewLimits && this.props.viewLimits.boxRangeRange;\n\t\t\t\tconst maxLevel =\n\t\t\t\t\tboxRangeRange && boxRangeRange[0]\n\t\t\t\t\t\t? mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\t\t\tboxRangeRange[0],\n\t\t\t\t\t\t\t\tthis.state.width,\n\t\t\t\t\t\t\t\tthis.state.height\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: levelsRange[1];\n\t\t\t\tconst minLevel =\n\t\t\t\t\tboxRangeRange && boxRangeRange[1]\n\t\t\t\t\t\t? mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\t\t\tboxRangeRange[1],\n\t\t\t\t\t\t\t\tthis.state.width,\n\t\t\t\t\t\t\t\tthis.state.height\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: levelsRange[0];\n\n\t\t\t\tlevelsRange = [minLevel, maxLevel];\n\n\t\t\t\tlet finalZoomLevel = zoomLevel;\n\t\t\t\tif (finalZoomLevel > levelsRange[1]) {\n\t\t\t\t\tfinalZoomLevel = levelsRange[1];\n\t\t\t\t} else if (finalZoomLevel < levelsRange[0]) {\n\t\t\t\t\tfinalZoomLevel = levelsRange[0];\n\t\t\t\t}\n\n\t\t\t\tconst boxRange = mapUtils.view.getBoxRangeFromZoomLevel(\n\t\t\t\t\tfinalZoomLevel,\n\t\t\t\t\tthis.state.width,\n\t\t\t\t\tthis.state.height\n\t\t\t\t);\n\t\t\t\tif (this.props.onViewChange) {\n\t\t\t\t\tthis.props.onViewChange({\n\t\t\t\t\t\tboxRange,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.onZoomLevelsBasedTimeout = null;\n\t\t\t\tthis.onZoomLevelsBasedStep = 0;\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif (prevProps) {\n\t\t\tif (this.props.view && prevProps.view !== this.props.view) {\n\t\t\t\tthis.updateNavigator();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tprevProps.layers !== this.props.layers ||\n\t\t\t\tprevProps.backgroundLayer !== this.props.backgroundLayer\n\t\t\t) {\n\t\t\t\tthis.updateLayers();\n\t\t\t}\n\n\t\t\tif (this.context && this.context.hoveredItems) {\n\t\t\t\tconst currentHoveredItemsString = JSON.stringify(\n\t\t\t\t\t_sortBy(this.context.hoveredItems)\n\t\t\t\t);\n\t\t\t\tif (currentHoveredItemsString !== this.previousHoveredItemsString) {\n\t\t\t\t\tthis.updateHoveredFeatures();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateLayers() {\n\t\tlet layers = [];\n\t\tif (this.props.backgroundLayer) {\n\t\t\t// TODO fix for compatibility\n\t\t\tlet backgroundLayers = _isArray(this.props.backgroundLayer)\n\t\t\t\t? this.props.backgroundLayer\n\t\t\t\t: [this.props.backgroundLayer];\n\n\t\t\tbackgroundLayers.forEach(layer => {\n\t\t\t\tlayers.push(layersHelpers.getLayerByType(layer, this.wwd));\n\t\t\t});\n\t\t}\n\n\t\tif (this.props.layers) {\n\t\t\tthis.props.layers.forEach(layer => {\n\t\t\t\tconst mapLayer = layersHelpers.getLayerByType(\n\t\t\t\t\tlayer,\n\t\t\t\t\tthis.wwd,\n\t\t\t\t\tthis.onLayerHover,\n\t\t\t\t\tthis.onLayerClick,\n\t\t\t\t\tthis.props.pointAsMarker\n\t\t\t\t);\n\t\t\t\tlayers.push(mapLayer);\n\t\t\t});\n\t\t}\n\n\t\tthis.invalidateLayers(this.wwd.layers);\n\t\tthis.wwd.layers = layers;\n\t\tthis.wwd.redraw();\n\t}\n\n\tinvalidateLayers(previousLayers) {\n\t\tpreviousLayers.forEach(prevLayer => {\n\t\t\tif (prevLayer instanceof LargeDataLayer) {\n\t\t\t\tprevLayer.removeListeners();\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateHoveredFeatures() {\n\t\tthis.wwd.layers.forEach(layer => {\n\t\t\tif (layer instanceof LargeDataLayer) {\n\t\t\t\tlayer.updateHoveredKeys(\n\t\t\t\t\tthis.context.hoveredItems,\n\t\t\t\t\tthis.context.x,\n\t\t\t\t\tthis.context.y\n\t\t\t\t);\n\t\t\t} else if (layer instanceof VectorLayer) {\n\t\t\t\tlayer.updateHoveredFeatures(this.context.hoveredItems);\n\t\t\t}\n\t\t});\n\t\tthis.wwd.redraw();\n\t\tthis.previousHoveredItemsString = JSON.stringify(\n\t\t\t_sortBy(this.context.hoveredItems)\n\t\t);\n\t}\n\n\tupdateNavigator(defaultView) {\n\t\tconst viewport = this.wwd.viewport;\n\t\tlet width = this.state.width || viewport.width;\n\t\tlet height = this.state.height || viewport.height;\n\n\t\tlet currentView =\n\t\t\tdefaultView ||\n\t\t\tnavigator.getViewParamsFromWorldWindNavigator(\n\t\t\t\tthis.wwd.navigator,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\t\tlet nextView = {...currentView, ...this.props.view};\n\t\tnavigator.update(this.wwd, nextView, width, height);\n\t}\n\n\t/**\n\t * @returns {null | elevation}\n\t */\n\tgetElevationModel() {\n\t\tswitch (this.props.elevationModel) {\n\t\t\tcase 'default':\n\t\t\t\treturn null;\n\t\t\tcase null:\n\t\t\t\tconst elevation = new ElevationModel();\n\t\t\t\televation.removeAllCoverages();\n\t\t\t\treturn elevation;\n\t\t}\n\t}\n\n\tonNavigatorChange(event) {\n\t\tif (event) {\n\t\t\tconst viewParams = navigator.getViewParamsFromWorldWindNavigator(\n\t\t\t\tevent,\n\t\t\t\tthis.state.width,\n\t\t\t\tthis.state.height\n\t\t\t);\n\t\t\tconst changedViewParams = navigator.getChangedViewParams(\n\t\t\t\t{...mapConstants.defaultMapView, ...this.props.view},\n\t\t\t\tviewParams\n\t\t\t);\n\n\t\t\tif (this.props.onViewChange) {\n\t\t\t\tif (!_isEmpty(changedViewParams)) {\n\t\t\t\t\tif (this.props.delayedWorldWindNavigatorSync) {\n\t\t\t\t\t\tif (this.changedNavigatorTimeout) {\n\t\t\t\t\t\t\tclearTimeout(this.changedNavigatorTimeout);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.changedNavigatorTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tthis.props.onViewChange(changedViewParams);\n\t\t\t\t\t\t}, this.props.delayedWorldWindNavigatorSync);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.props.onViewChange(changedViewParams);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonClick() {\n\t\tif (this.props.onClick) {\n\t\t\tconst {width, height} = this.wwd.viewport;\n\t\t\tlet currentView = navigator.getViewParamsFromWorldWindNavigator(\n\t\t\t\tthis.wwd.navigator,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\t\t\tthis.props.onClick(currentView);\n\t\t}\n\t}\n\n\tonMouseOut() {\n\t\tif (this.context && this.context.onHoverOut) {\n\t\t\tthis.context.onHoverOut();\n\t\t}\n\t}\n\n\tonLayerHover(layerKey, featureKeys, x, y, popupContent, data, fidColumnName) {\n\t\t// pass data to popup\n\t\tif (this.context && this.context.onHover && featureKeys.length) {\n\t\t\tthis.context.onHover(featureKeys, {\n\t\t\t\tpopup: {\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tcontent: popupContent,\n\t\t\t\t\tdata,\n\t\t\t\t\tfidColumnName,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tonLayerClick(layerKey, featureKeys) {\n\t\tif (this.props.onLayerClick) {\n\t\t\tthis.props.onLayerClick(this.props.mapKey, layerKey, featureKeys);\n\t\t}\n\t}\n\n\tonWorldWindHover(renderables, event) {\n\t\t// TODO can be hovered more than one renderable at one time?\n\t\tif (renderables.length && renderables.length === 1) {\n\t\t\t// TODO is this enough?\n\t\t\tconst layerPantherProps = renderables[0].parentLayer.pantherProps;\n\n\t\t\tconst data = renderables[0].userObject.userProperties;\n\t\t\tconst featureKeys = [data[layerPantherProps.fidColumnName]];\n\n\t\t\t// TODO add support for touch events\n\t\t\tif (event.type === 'mousedown' && layerPantherProps.selectable) {\n\t\t\t\tthis.onLayerClick(layerPantherProps.layerKey, featureKeys);\n\t\t\t} else if (layerPantherProps.hoverable) {\n\t\t\t\tthis.onLayerHover(\n\t\t\t\t\tlayerPantherProps.layerKey,\n\t\t\t\t\tfeatureKeys,\n\t\t\t\t\tevent.pageX,\n\t\t\t\t\tevent.pageY,\n\t\t\t\t\t<div>{featureKeys.join(',')}</div>,\n\t\t\t\t\tdata,\n\t\t\t\t\tlayerPantherProps.fidColumnName\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (this.context && this.context.onHoverOut) {\n\t\t\tthis.context.onHoverOut();\n\t\t}\n\t}\n\n\tonResize(width, height) {\n\t\theight = viewport.roundDimension(height);\n\t\twidth = viewport.roundDimension(width);\n\n\t\tthis.setState({\n\t\t\twidth,\n\t\t\theight,\n\t\t});\n\t\tthis.updateNavigator();\n\t\tif (this.props.onResize) {\n\t\t\tthis.props.onResize(width, height);\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ReactResizeDetector\n\t\t\t\t\thandleHeight\n\t\t\t\t\thandleWidth\n\t\t\t\t\tonResize={this.onResize}\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"ptr-map ptr-world-wind-map\"\n\t\t\t\t\tonClick={this.onClick}\n\t\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\t>\n\t\t\t\t\t<canvas className=\"ptr-world-wind-map-canvas\" id={this.canvasId}>\n\t\t\t\t\t\tYour browser does not support HTML5 Canvas.\n\t\t\t\t\t</canvas>\n\t\t\t\t</div>\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default WorldWindMap;\n","export default () => <p>render only on server</p>;\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from './presentationEmpty';\n\nconst LoadableMapControls = Loadable({\n\tloader: () => {\n\t\treturn isServer ? import('./presentationEmpty') : import('../MapControls');\n\t},\n\trender(loaded, props) {\n\t\tlet MapControls = loaded.default;\n\t\treturn <MapControls {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <div>Error!</div>;\n\t\t} else {\n\t\t\treturn <div>Loading...</div>;\n\t\t}\n\t},\n});\n\nconst isomorphicLoadableMapControls = props => {\n\treturn isServer ? <PresentationEmpty /> : <LoadableMapControls {...props} />;\n};\nexport default isomorphicLoadableMapControls;\n","import React from 'react';\n\n//TODO - add placeholder for each component\nexport default () => {\n\treturn null;\n};\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from '../LoadableMap/presentationEmpty';\n\nconst LoadableMapSet = Loadable({\n\tloader: () => {\n\t\treturn isServer\n\t\t\t? import('../LoadableMap/presentationEmpty')\n\t\t\t: import('../MapSet/index.js');\n\t},\n\trender(loaded, props) {\n\t\tlet MapSet = loaded.default;\n\t\treturn <MapSet {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <span>Error!</span>;\n\t\t} else {\n\t\t\treturn <span>Loading...</span>;\n\t\t}\n\t},\n});\n\nconst isomorphicMapSet = props => {\n\treturn isServer ? <PresentationEmpty /> : <LoadableMapSet {...props} />;\n};\nexport default isomorphicMapSet;\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from '../LoadableMap/presentationEmpty';\n\nconst LoadableReactLeafletMap = Loadable({\n\tloader: () => {\n\t\treturn isServer\n\t\t\t? import('../LoadableMap/presentationEmpty')\n\t\t\t: import('../ReactLeafletMap');\n\t},\n\trender(loaded, props) {\n\t\tlet ReactLeafletMap = loaded.default;\n\t\treturn <ReactLeafletMap {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <div>Error!</div>;\n\t\t} else {\n\t\t\treturn <div>Loading...</div>;\n\t\t}\n\t},\n});\n\nconst isomorphicLoadableReactLeafletMap = props => {\n\treturn isServer ? (\n\t\t<PresentationEmpty />\n\t) : (\n\t\t<LoadableReactLeafletMap {...props} />\n\t);\n};\nexport default isomorphicLoadableReactLeafletMap;\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from './presentationEmpty';\n\nconst LoadableMap = Loadable({\n\tloader: () => {\n\t\treturn isServer\n\t\t\t? import('../LoadableMap/presentationEmpty')\n\t\t\t: import('../Map');\n\t},\n\trender(loaded, props) {\n\t\tlet PresentationMap = loaded.default;\n\t\treturn <PresentationMap {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <span>Error!</span>;\n\t\t} else {\n\t\t\treturn <span>Loading...</span>;\n\t\t}\n\t},\n});\n\nconst isomorphicMap = props => {\n\treturn isServer ? <PresentationEmpty /> : <LoadableMap {...props} />;\n};\nexport default isomorphicMap;\n","import constants from './constants';\nimport view from './utils/view';\nimport GoToPlace from './controls/GoToPlace';\nimport MapGrid from './MapGrid';\nimport MapControls from './controls/MapControls';\nimport MapSet, {MapSetMap, MapSetPresentationMap} from './MapSet';\nimport MapTools from './controls/MapTools';\nimport MapWrapper from './MapWrapper';\nimport PresentationMap from './Map';\nimport ReactLeafletMap from './ReactLeafletMap';\nimport SimpleLayersControl from './controls/SimpleLayersControl';\nimport WorldWindMap from './WorldWindMap';\n\n//loadable\nimport LoadableMapControls from './controls/LoadableMapControls';\nimport LoadableMapSet from './LoadableMapSet';\nimport LoadableReactLeafletMap from './LoadableReactLeafletMap';\nimport LoadableMap from './LoadableMap';\n\nexport {\n\tconstants,\n\tview,\n\tGoToPlace,\n\tLoadableMapControls,\n\tLoadableMapSet,\n\tLoadableReactLeafletMap,\n\tLoadableMap,\n\tMapControls,\n\tMapGrid,\n\tMapTools,\n\tMapSetMap,\n\tMapSetPresentationMap,\n\tMapSet,\n\tMapWrapper,\n\tPresentationMap,\n\tReactLeafletMap,\n\tSimpleLayersControl,\n\tWorldWindMap,\n};\n\nexport default {\n\tconstants,\n\tview,\n\n\tGoToPlace,\n\n\tLoadableMapControls,\n\tLoadableMapSet,\n\tLoadableReactLeafletMap,\n\tLoadableMap,\n\n\tMapControls,\n\tMapGrid,\n\tMapSetMap,\n\tMapSetPresentationMap,\n\tMapSet,\n\tMapWrapper,\n\tMapTools,\n\tPresentationMap,\n\tSimpleLayersControl,\n\tReactLeafletMap,\n\tWorldWindMap,\n};\n"],"names":["defaultVectorFeatureStyle","fill","fillOpacity","outlineColor","outlineWidth","outlineOpacity","selectedVectorFeatureStyle","hoveredVectorFeatureStyle","selectedHoveredVectorFeatureStyle","vectorFeatureStyle","defaultFull","rules","styles","hovered","selected","selectedHovered","defaultDiagramStyle","diagramFill","diagramFillOpacity","diagramOutlineColor","diagramOutlineWidth","diagramOutlineOpacity","selectedDiagramStyle","hoveredDiagramStyle","selectedHoveredDiagramStyle","diagramStyle","vectorLayerHighlightedFeatureStyle","strokeColor","strokeWidth","vectorLayerDefaultFeatureStyle","fillColor","defaultLeafletPaneZindex","maxFeaturesAsReactElement","projDefinitions","epsg5514","getBoxRangeFromWorldWindRange","range","width","height","getWorldWindRangeFromBoxRange","boxRange","isBoxRangeInRange","_isArray2","fitsInLimits","noLowerLimitLessThanUpper","noUpperLimitMoreThanLower","getCenterWhichFitsLimits","center","limit","updatedLat","updatedLon","givenLat","lat","givenLon","lon","maxLat","maxLon","minLat","minLon","GoToPlace","props","state","text","previousSearching","search","bind","onTextChange","setState","e","charCode","goToPlace","React","Input","Icon","PureComponent","propTypes","PropTypes","func","MapGrid","ref","createRef","resize","window","addEventListener","passive","current","clientWidth","clientHeight","renderMaps","availableWidth","availableHeight","children","length","sizeRatio","rows","columns","toFixed","style","map","index","rowNo","Math","ceil","colNo","wrapperClasses","classNames","MapControls","tiltIncrement","headingIncrement","zoomIncrement","exaggerationIncrement","resetHeadingDisabled","prevProps","prevState","snapshot","view","heading","update","tilt","updateView","mapKey","levelsBased","resetHeading","type","definedLimits","viewLimits","boxRangeRange","currentBoxRange","currentLevel","mapUtils","getZoomLevelFromBoxRange","mapWidth","mapHeight","maxZoom","mapConstants","defaultLevelsRange","definedLimitAsLevel","minZoom","minBoxRange","maxBoxRange","Button","handleZoomIn","isZoomButtonActive","handleZoomOut","zoomOnly","handleHeadingRight","handleResetHeading","transform","handleHeadingLeft","handleTiltDown","handleTiltUp","object","string","bool","oneOfType","array","number","MapWrapper","active","onMapRemove","renderCloseButton","title","renderTitle","name","stateMapKey","defaultProps","Map","PresentationMap","MapSet","stateMapSetKey","mergeViews","defaultMapView","activeMapKey","mapViews","mapsDimensions","child","connectedMapComponent","onMount","onUnmount","_mapValues2","layers","backgroundLayer","refreshUse","syncUpdate","ensureViewIntegrity","sync","_pickBy2","updateVal","updateKey","_isEmpty2","mergedView","onViewChange","key","renderControls","activeMapDimensions","activeMapView","activeMapViewport","onResetHeading","Children","cloneElement","maps","onResize","onMapResize","push","renderMap","mapComponent","restProps","mergeLayers","onClick","onMapClick","renderWrapper","wrapper","wrapperProps","disableMapRemoval","allProps","wrapperComponent","prototype","isReactComponent","createElement","mapSetKey","elementType","element","MapSetMap","MapSetPresentationMap","onPropViewChange","getValidView","_isEqual2","saveViewChange","checkViewEquality","onViewChangeDecorator","Error","renderContent","viewport","getLeafletViewFromViewParams","completeView","zoom","lng","getLeafletViewportFromViewParams","leafletView","stateCenter","getCenter","stateZoom","getZoom","leafletUpdate","setView","svgSize","offset","className","Cross","svg","Pin","icon","cross","anchorPoint","component","pin","MarkerShape","iconAnchor","basicShape","id","shape","onMouseMove","onMouseOver","onMouseOut","oldShape","div","tagName","document","html","getShapeHtml","Element","appendChild","innerHTML","_setIconStyles","helpers","getMarkerShapeCssStyle","ReactDOMServer","renderToString","finalShape","getMarkerShapeSvgStyle","getShapeWithIcon","getShape","getIcon","componentProps","weight","iconStyle","iconFill","shapeStyle","stroke","iconProps","iconComponent","isBasicShape","getElementById","value","L","DivIcon","getDefaultStyleObject","feature","styleDefinition","mapStyle","getStyleObject","properties","constants","getSelectedStyleObject","selectedStyleDefinition","getFeatureDefaultStyle","defaultStyleObject","getFeatureLeafletStyle","getFeatureAccentedStyle","accentedStyleObject","size","volume","finalStyle","color","opacity","geometry","radius","sqrt","PI","convertCoordinatesMemo","memoize","flippedFeature","flip","coordinates","getDefaultStyle","calculateStyle","hoveredStyleDefinition","selectedHoveredStyleDefinition","defaultStyle","hoveredStyleObject","hoveredStyle","selectedStyle","selectedHoveredStyle","selectedHoveredStyleObject","calculateStylesMemo","getMarkerShape","options","shapeKey","iconKey","anchorShift","anchorPositionX","anchorPositionY","shapes","icons","leafletStyle","getMarkerShapeSquareStyle","getMarkerShapeCircleStyle","rotation","borderRadius","rgb","hexToRgb","r","g","b","strokeOpacity","setTransform","el","scale","pos","TRANSFORM","ie3d","x","y","CanvasLayer","extend","initialize","_paneName","paneName","_paneZindex","paneZindex","_map","_canvas","_frame","_delegate","delegate","del","needRedraw","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","newSize","_onLayerDidMove","topLeft","containerPointToLayerPoint","_topLeft","setPosition","_onLayerDidZoom","getEvents","events","moveend","zoomAnimation","any3d","zoomanim","_animateZoom","onAdd","create","tiles","getSize","animated","addClass","pane","getPane","createPane","zIndex","on","onLayerDidMount","onRemove","onLayerWillUnmount","cancelAnimFrame","removeChild","off","addTo","addLayer","LatLonToMercator","latlon","log","tan","bounds","getBounds","corner","containerPointToLatLng","onDrawLayer","layer","canvas","_setTransform","getZoomScale","_latLngBoundsToNewLayerBounds","min","_getCenterOffset","_multiplyBy","subtract","_getMapPanePos","setPolygonStyle","context","fillStyle","chroma","alpha","hex","lineWidth","strokeStyle","lineJoin","setLineStyle","lineCap","definedSize","pixelSizeInMeters","draw","square","circle","a","beginPath","rect","closePath","arc","floor","drawPolygon","forEach","linearRing","start","rest","slice","moveTo","point","lineTo","drawMultiPolygon","polygon","drawLine","LeafletCanvasLayer","customEvents","click","onLayerClick","boundsToQuery","getSouthWest","getNorthEast","isPointInsideBounds","selectable","pointsInsideBounds","selectedPolygons","mousePoint","containerPoint","self","features","original","LatLngBounds","add","BoundingBox","pointFeature","turfPoint","insidePolygon","booleanPointInPolygon","position","nearest","nearestPoint","layerKey","fidColumnName","setProps","data","prepareFeatures","pointFeatures","polygonFeatures","lineFeatures","fid","preparedFeature","selection","keys","_includes2","_orderBy2","params","getContext","clearRect","drawImage","renderOffScreen","offScreenCanvas","pointAsMarker","getPixelSizeInLevelsForLatitude","pixelSizeInLevels","i","omitFeature","omittedFeatureKeys","drawFeature","ctx","latLngToContainerPoint","getPolygonCoordinates","polygons","getLineCoordinates","lines","line","CanvasVectorLayer","uniqueLayerKey","fromProps","toProps","leafletElement","MapLayer","withLeaflet","geojsonRbush","require","getBoundingBox","crs","optLat","calculatedBoxRange","getNearestZoomLevelBoxRange","getBoundingBoxFromViewForEpsg3857","IndexedVectorLayer","rerender","indexTree","repopulateIndexTreeIfNeeded","clear","load","boxRangeFitsLimits","bbox","averageLatitude","geoJsonBbox","foundFeatureCollection","foundFeatures","HoverContext","Context","contextWrapper","WrappedFeature","hoveredFromContext","changeContext","hoveredItems","onHover","onHoverOut","_indexOf2","hoverable","contextType","Feature","shapeId","uniqueFeatureKey","utils","uuid","calculateStyles","convertCoordinates","hasOwnProperty","showOnTop","showOnBottom","event","target","leafletFeature","popup","originalEvent","pageX","pageY","bringToFront","bringToBack","renderPolygon","renderPoint","renderLine","Polygon","Polyline","renderShape","Circle","shallowEqualObjects","setStyle","Marker","interactive","ContextWrapper","GeoJsonLayer","getStyle","filter","onEachFeature","pointToLayer","getRenderId","geometryType","isPolygon","isLine","onFeatureClick","mousemove","mouseout","coord","circleMarker","marker","featureKey","item","GeoJSON","SvgVectorLayer","pointsPaneName","linesPaneName","polygonsPaneName","sortedPointFeatures","sortedPolygonFeatures","points","prepareData","classes","classnames","withSelectedFeaturesOnly","Pane","renderFeatures","renderAsGeoJson","renderGeoJson","renderFeature","resources","getFeatureKeysToOmit","featureKeysGroupedByTileKey","tileKey","indexOfCurrentTile","_findIndex2","tile","featureKeysToOmit","renderedFeatureKeys","Set","featureKeys","has","checkIdentity","prev","next","prevKeys","nextKeys","sort","Tile","renderingTechnique","level","getTileKey","JSON","stringify","getFeaturesGroupedByTileKey","selections","groupedFeatures","groupedFeatureKeys","tileFeatureKeys","selectionKey","unshift","Object","values","_uniq2","TiledVectorLayer","VectorLayer","renderAs","renderAsData","_find2","renderAsItem","getOptions","renderTiledVectorLayer","renderBasicVectorLayer","wms","obj","result","Source","untiled","identify","url","tiled","_url","_subLayers","_overlay","createOverlay","overlayOptions","opt","overlay","tileLayer","refreshOverlay","setParams","subLayers","join","remove","setOpacity","isBack","getLayer","addSubLayer","removeSubLayer","evt","getIdentifyLayers","getFeatureInfo","latlng","showFeatureInfo","callback","getFeatureInfoParams","getParamString","showWaiting","ajax","done","hideWaiting","parseFeatureInfo","call","identifyLayers","wmsParams","updateWmsParams","infoParams","request","query_layers","X","round","Y","info","openPopup","_container","cursor","source","Layer","layerName","getSourceForUrl","_source","_name","sources","TileLayer","WMS","Overlay","defaultWmsParams","service","version","format","transparent","uppercase","attribution","opts","getAttribution","_currentOverlay","removeLayer","_currentUrl","getImageUrl","once","_swap","wmsVersion","parseFloat","projectionKey","nw","project","getNorthWest","se","getSouthEast","code","EPSG4326","pstr","XMLHttpRequest","onreadystatechange","change","open","send","readyState","status","responseText","EVENTS_RE","WMSLayer","singleTile","restParams","_l","leaflet","prevUrl","setUrl","isEqual","superOptions","reduce","test","getBoxRange","TileGridLayer","undefined","tileGrid","getTileGridLevel","tileGridUtils","getGridSizeForLevel","geojsonTileGrid","getTileGridAsGeoJSON","viewportRange","getMapViewportRange","nearestBoxRange","grid","getLevelByViewport","markers","acc","row","rowMarkers","recalculatedBoxrange","getTileGrid","geoJsonTileGrid","getGeoJsonTileGrid","tilesMarkers","getTilesMarkers","roundDimension","dimension","ReactLeafletMap","getCRS","onViewportChanged","originalInitTile","GridLayer","_initTile","include","tileSize","getTileSize","CRS","Proj","resolutions","EPSG3857","viewUtils","Number","isFinite","getBoxRangeFromZoomLevel","hasResized","random","pow","leafletMap","_size","widthChange","abs","heightChange","invalidateSize","setZoomLevelsBounds","viewHelpers","ReactResizeDetector","backgroundLayersSource","backgroundLayersZindex","backgroundLayers","getLayerByType","baseLayersZindex","debugTileGrid","bottom","tileGridLayer","getTileLayer","getWmsTileLayer","getVectorLayer","getTileGridLayer","restOptions","urls","o","imageFormat","reservedParamsKeys","restParameters","entries","includes","isRequired","SimpleLayersControl","onControlButtonClick","onBlur","setTimeout","onSelect","buttonClasses","renderMenu","tileWidth","tileHeight","tileMargin","contentMargin","getGrid","menuClasses","right","left","menuStyle","contentStyle","margin","renderTile","activeLayer","thumbnail","onLayerTileClick","count","Angle","WorldWind","WWMath","basicController","applyLimits","navigator","wwd","currentRange","lookAtLocation","latitude","clamp","longitude","normalizedDegreesLongitude","normalizedDegrees","roll","globe","is2D","enable2DLimits","maxRange","equatorialRadius","onNavigatorChanged","pantherProps","addFeatures","geojson","parser","GeoJSONParser","shapeConfigurationCallback","getStyleDefinition","userProperties","renderablesAddCallback","renderables","renderable","applyStyles","fids","getSelection","applyWorldWindStyles","styleObject","fillRgb","interiorColor","Color","TRANSPARENT","outlineRgb","selectionDefintion","selectedStyleObject","attributes","RenderableLayer","Location","Sector","MercatorTiledImageLayer","OsmLayer","displayName","pickEnabled","destCanvas","destContext","urlBuilder","urlForTile","levelNumber","column","doRender","dc","topLevelTiles","createTile","levels","firstLevel","ArgumentError","Logger","WikimediaLayer","imageSize","sourceObject","logMessage","LEVEL_SEVERE","buildSourceUrl","_attribution","_imageType","imageType","cachePath","detailControl","numLevels","prefix","buildPrefix","prefixes","protocol","host","path","WmsLayer","worldWindOptions","layerNames","levelZeroDelta","sector","styleNames","attributions","customParams","time","screenCreditController","WmtsLayer","template","uriTemplates","varNames","numberOfUrls","s","z","WWUtil","suffixForMimeType","arrow","x0","y0","x1","y1","ellipse","cx","cy","rx","ry","save","translate","fillPolygon","nodes","node","rectangle","dx","dy","restore","globalAlpha","LargeDataLayerTile","_data","_style","_fidColumnName","_hovered","_hoveredStyle","sel","selectedDef","_selected","_sector","createCanvas","_width","_height","tileCenterLatitude","maxLatitude","minLatitude","_latitudeFactor","cos","toDataURL","dataPoint","isHovered","isSelected","indexOf","circleWithArrow","diamond","triangle","getCenterCoordinates","edgeLength","diagonalLength","ty","direction","arrowDirection","arrowLength","arrowColor","arrowWidth","DEFAULT_SIZE","longitudeInSector","latitudeInSector","sizeOfArea","locationInArea","maxLongitude","minLongitude","REDRAW_EVENT_TYPE","SurfaceCircle","TiledImageLayer","LargeDataLayer","processedTiles","quadTree","QuadTree","Box","pointHoverBuffer","loadData","removeEventListener","fetch","then","json","file","centroid","Point","turfCentroid","insert","refresh","touches","clientX","clientY","terrainObject","pickTerrain","canvasCoordinates","buffer","getPointHoverBuffer","query","targetPoint","featureCollection","turfFeatureCollection","onMouseMoveResult","handleEvent","onClickResult","gids","_compact2","suppressRedraw","imagePath","extended","calculateExtendedSector","filterGeographically","cache","gpuResourceCache","createPointTile","texture","createTexture","removeFromCurrentRetrievals","putResource","currentTilesInvalid","absentResourceList","unmarkResourceAbsent","createEvent","initEvent","dispatchEvent","extensionFactorWidth","extensionFactorHeight","latitudeChange","longitudeChange","hoveredKeys","currentTiles","previousHoveredCoordinates","latDiff","lonDiff","latBuffer","lonBuffer","previouslyHovered","retrieveTileImage","drawContext","canvasWidth","bufferInMeters","layerDefinition","BingAerialLayer","BMNGLayer","updateVectorLayer","mapLayer","worldWindLayer","lay","prevFeatures","nextFeatures","removeListeners","getChangedViewParams","changed","wwdUpdate","getWorldWindNavigatorFromViewParams","shouldRedraw","redraw","getViewParamsFromWorldWindNavigator","WorldWindow","ElevationModel","WorldWindMap","canvasId","onLayerHover","onWorldWindHover","onZoomLevelsBased","onZoomLevelsBasedTimeout","onZoomLevelsBasedStep","getElevationModel","decorateWorldWindowController","worldWindowController","onNavigatorChange","eventListeners","wheel","listeners","CyclicPickController","updateNavigator","updateLayers","preventDefault","wheelDelta","clearTimeout","zoomLevel","levelsRange","maxLevel","minLevel","finalZoomLevel","currentHoveredItemsString","_sortBy2","previousHoveredItemsString","updateHoveredFeatures","layersHelpers","invalidateLayers","previousLayers","prevLayer","updateHoveredKeys","defaultView","currentView","nextView","elevationModel","elevation","removeAllCoverages","viewParams","changedViewParams","delayedWorldWindNavigatorSync","changedNavigatorTimeout","popupContent","content","layerPantherProps","parentLayer","userObject","LoadableMapControls","Loadable","loader","isServer","render","loaded","loading","error","isomorphicLoadableMapControls","LoadableMapSet","isomorphicMapSet","PresentationEmpty","LoadableReactLeafletMap","isomorphicLoadableReactLeafletMap","LoadableMap","isomorphicMap","MapTools"],"mappings":"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"}