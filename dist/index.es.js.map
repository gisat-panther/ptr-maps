{"version":3,"file":"index.es.js","sources":["../src/constants/styles.js","../src/constants/index.js","../src/utils/view.js","../src/controls/GoToPlace/index.js","../src/MapGrid/index.js","../src/controls/MapControls/index.js","../src/MapWrapper/index.js","../src/MapSet/index.js","../src/controls/MapTools/index.js","../src/Map.js","../src/ReactLeafletMap/viewHelpers.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/svg.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/Cross.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/Pin.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/shapes/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/MarkerShape.js","../src/ReactLeafletMap/layers/SvgVectorLayer/helpers.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/genericCanvasLayer.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/helpers.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/shapes.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/polygons.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/shapes/lines.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/LeafletCanvasLayer.js","../src/ReactLeafletMap/layers/CanvasVectorLayer/index.js","../src/ReactLeafletMap/layers/IndexedVectorLayer/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/ContextWrapper.js","../src/ReactLeafletMap/layers/SvgVectorLayer/Feature/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/GeoJsonLayer/index.js","../src/ReactLeafletMap/layers/SvgVectorLayer/index.js","../src/ReactLeafletMap/layers/TiledVectorLayer/Tile.js","../src/ReactLeafletMap/layers/TiledVectorLayer/index.js","../src/ReactLeafletMap/layers/VectorLayer/index.js","../src/ReactLeafletMap/layers/WMSLayer/leaflet.wms.js","../src/ReactLeafletMap/layers/WMSLayer/index.js","../src/ReactLeafletMap/layers/TileGridLayer/index.js","../src/utils/viewport.js","../src/ReactLeafletMap/index.js","../src/controls/SimpleLayersControl/index.js","../src/WorldWindMap/controllers/WorldWindowControllerDecorator/index.js","../src/WorldWindMap/layers/VectorLayer.js","../src/WorldWindMap/layers/OsmLayer.js","../src/WorldWindMap/layers/WikimediaLayer.js","../src/WorldWindMap/layers/WmsLayer.js","../src/WorldWindMap/layers/WmtsLayer.js","../src/WorldWindMap/layers/LargeDataLayerSource/canvasShapes.js","../src/WorldWindMap/layers/LargeDataLayerSource/LargeDataLayerTile.js","../src/WorldWindMap/layers/LargeDataLayerSource/LargeDataLayer.js","../src/WorldWindMap/layers/helpers.js","../src/WorldWindMap/navigator/helpers.js","../src/WorldWindMap/index.js","../src/controls/LoadableMapControls/presentationEmpty.js","../src/controls/LoadableMapControls/index.js","../src/LoadableMap/presentationEmpty.js","../src/LoadableMapSet/index.js","../src/LoadableReactLeafletMap/index.js","../src/LoadableMap/index.js","../src/index.js"],"sourcesContent":["/* Vector feature basic style */\nconst defaultVectorFeatureStyle = {\n\tfill: '#ffffff',\n\tfillOpacity: 0.8,\n\toutlineColor: '#000000',\n\toutlineWidth: 2,\n\toutlineOpacity: 1,\n};\n\nconst selectedVectorFeatureStyle = {\n\toutlineWidth: 3,\n\toutlineColor: '#ff00ff',\n\toutlineOpacity: 1,\n};\n\nconst hoveredVectorFeatureStyle = {\n\toutlineWidth: 3,\n\toutlineColor: '#00ffff',\n\toutlineOpacity: 1,\n};\n\nconst selectedHoveredVectorFeatureStyle = {\n\toutlineWidth: 3,\n\toutlineColor: '#8800ff',\n\toutlineOpacity: 1,\n};\n\nconst vectorFeatureStyle = {\n\tdefault: defaultVectorFeatureStyle,\n\tdefaultFull: {rules: [{styles: [defaultVectorFeatureStyle]}]},\n\thovered: hoveredVectorFeatureStyle,\n\tselected: selectedVectorFeatureStyle,\n\tselectedHovered: selectedHoveredVectorFeatureStyle,\n};\n\n/* Diagram basic style */\nconst defaultDiagramStyle = {\n\tdiagramFill: '#87c7ff',\n\tdiagramFillOpacity: 1,\n\tdiagramOutlineColor: '#3b80ff',\n\tdiagramOutlineWidth: 1,\n\tdiagramOutlineOpacity: 1,\n};\n\nconst selectedDiagramStyle = {\n\tdiagramOutlineWidth: 2,\n\tdiagramOutlineColor: '#ff00ff',\n\tdiagramOutlineOpacity: 1,\n};\n\nconst hoveredDiagramStyle = {\n\tdiagramOutlineWidth: 2,\n\tdiagramOutlineColor: '#00ffff',\n\tdiagramOutlineOpacity: 1,\n};\n\nconst selectedHoveredDiagramStyle = {\n\tdiagramOutlineWidth: 2,\n\tdiagramOutlineColor: '#8800ff',\n\tdiagramOutlineOpacity: 1,\n};\n\nconst diagramStyle = {\n\tdefault: defaultDiagramStyle,\n\tdefaultFull: {rules: {styles: [defaultDiagramStyle]}},\n\thovered: hoveredDiagramStyle,\n\tselected: selectedDiagramStyle,\n\tselectedHovered: selectedHoveredDiagramStyle,\n};\n\n/* TODO obsolete, remain due to backward compatibility */\nconst vectorLayerHighlightedFeatureStyle = {\n\tstrokeColor: '#00FFFF',\n\tstrokeWidth: 2,\n};\n\nconst vectorLayerDefaultFeatureStyle = {\n\tfillColor: null,\n\tfillOpacity: 0,\n\tstrokeColor: '#444',\n\tstrokeWidth: 2,\n};\n\nexport default {\n\tdiagramStyle,\n\tvectorFeatureStyle,\n\n\t/* TODO obsolete */\n\tvectorLayerHighlightedFeatureStyle,\n\tvectorLayerDefaultFeatureStyle,\n};\n","import styles from './styles';\n\n// Frameworks\n/** https://leafletjs.com/reference-1.6.0.html#map-overlaypane */\nconst defaultLeafletPaneZindex = 400;\n\n/* Max number of features rendered as React element in leaflet vector layer  */\nconst maxFeaturesAsReactElement = 100;\n\n// Projections\nconst projDefinitions = {\n\tepsg5514:\n\t\t'+proj=krovak +lat_0=49.5 +lon_0=24.83333333333333 +alpha=30.28813972222222 +k=0.9999 +x_0=0 +y_0=0 +ellps=bessel +towgs84=589,76,480,0,0,0,0 +units=m +no_defs',\n};\n\nexport default {\n\tmaxFeaturesAsReactElement,\n\tdefaultLeafletPaneZindex,\n\tprojDefinitions,\n\t...styles,\n};\n","import {isArray as _isArray} from 'lodash';\n\n/**\n * Convert Web World Wind range to Panther boxRange\n * @param range {WorldWind.Navigator.range}\n * @param width {number} map width\n * @param height {number} map height\n * @return {number|*} Panther view box range\n */\nfunction getBoxRangeFromWorldWindRange(range, width, height) {\n\tif (width && width >= height) {\n\t\treturn (range * height) / width;\n\t} else {\n\t\treturn range;\n\t}\n}\n\n/**\n * Convert Panther boxRange to Web World Wind range\n * @param boxRange {number} Panther view boxRange\n * @param width {number} map width\n * @param height {number} map height\n * @return {number|*} WorldWind navigator range\n */\nfunction getWorldWindRangeFromBoxRange(boxRange, width, height) {\n\tif (width && width >= height) {\n\t\treturn (boxRange * width) / height;\n\t} else {\n\t\treturn boxRange;\n\t}\n}\n\n/**\n * Check if given boxRange is inside defined range. Lower limit is excluded, upper limit is included.\n * @param boxRange {number} map view boxRange\n * @param range {Array} boxRangeRange\n * @return {boolean}\n */\nfunction isBoxRangeInRange(boxRange, range) {\n\tif (_isArray(range)) {\n\t\t// both limits defined by number\n\t\tconst fitsInLimits = boxRange > range[0] && boxRange <= range[1];\n\n\t\t// without lower limit\n\t\tconst noLowerLimitLessThanUpper = !range[0] && boxRange <= range[1];\n\n\t\t// without upper limit\n\t\tconst noUpperLimitMoreThanLower = boxRange > range[0] && !range[1];\n\n\t\treturn (\n\t\t\tfitsInLimits || noLowerLimitLessThanUpper || noUpperLimitMoreThanLower\n\t\t);\n\t} else {\n\t\treturn false;\n\t}\n}\n\n/**\n * It compares center coordinates with limits. If given center is outside limit, adjusted center will be returned\n * @param center {{lat: number, lon: number}}\n * @param limit {{minLat: number, maxLat: number, minLon: number, maxLon: number}}\n * @return {{lat: number, lon: number}}\n */\nfunction getCenterWhichFitsLimits(center, limit) {\n\tif (!limit) {\n\t\treturn center;\n\t} else {\n\t\tlet updatedLat = null;\n\t\tlet updatedLon = null;\n\t\tconst givenLat = center.lat;\n\t\tconst givenLon = center.lon;\n\t\tconst maxLat = limit.maxLat;\n\t\tconst maxLon = limit.maxLon;\n\t\tconst minLat = limit.minLat;\n\t\tconst minLon = limit.minLon;\n\n\t\tif (givenLat >= maxLat) {\n\t\t\tupdatedLat = maxLat;\n\t\t}\n\n\t\tif (givenLat <= minLat) {\n\t\t\tupdatedLat = minLat;\n\t\t}\n\n\t\tif (givenLon >= maxLon) {\n\t\t\tupdatedLon = maxLon;\n\t\t}\n\n\t\tif (givenLon <= minLon) {\n\t\t\tupdatedLon = minLon;\n\t\t}\n\n\t\t// Don't mutate, if center fits limits\n\t\tif (!updatedLon && !updatedLat) {\n\t\t\treturn center;\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tlat: updatedLat || center.lat,\n\t\t\t\tlon: updatedLon || center.lon,\n\t\t\t};\n\t\t}\n\t}\n}\n\nexport default {\n\tgetBoxRangeFromWorldWindRange,\n\tgetCenterWhichFitsLimits,\n\tgetWorldWindRangeFromBoxRange,\n\tisBoxRangeInRange,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport './style.scss';\nimport {Icon, Input} from '@gisatcz/ptr-atoms';\n\nclass GoToPlace extends React.PureComponent {\n\tstatic propTypes = {\n\t\tgoToPlace: PropTypes.func,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\ttext: null,\n\t\t\tpreviousSearching: null,\n\t\t};\n\n\t\tthis.search = this.search.bind(this);\n\t\tthis.onTextChange = this.onTextChange.bind(this);\n\t}\n\n\tonTextChange(text) {\n\t\tthis.setState({text});\n\t}\n\n\tsearch(e) {\n\t\tif (\n\t\t\te.charCode === 13 &&\n\t\t\tthis.props.goToPlace &&\n\t\t\tthis.state.text !== this.state.previousSearching\n\t\t) {\n\t\t\tthis.props.goToPlace(this.state.text);\n\t\t\tthis.state.previousSearching = this.state.text;\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"ptr-go-to-place-box\" onKeyPress={this.search}>\n\t\t\t\t<Input\n\t\t\t\t\tplaceholder=\"Zoom to\"\n\t\t\t\t\tonChange={this.onTextChange}\n\t\t\t\t\tvalue={this.state.text}\n\t\t\t\t>\n\t\t\t\t\t<Icon icon=\"search\" />\n\t\t\t\t</Input>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default GoToPlace;\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport './style.scss';\n\nclass MapGrid extends React.PureComponent {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.ref = React.createRef();\n\n\t\tthis.state = {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.resize();\n\t\tif (typeof window !== 'undefined')\n\t\t\twindow.addEventListener('resize', this.resize.bind(this), {\n\t\t\t\tpassive: true,\n\t\t\t}); //todo IE\n\t}\n\n\tresize() {\n\t\tif (this.ref && this.ref.current) {\n\t\t\tlet width = this.ref.current.clientWidth;\n\t\t\tlet height = this.ref.current.clientHeight;\n\n\t\t\tthis.setState({\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t});\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"ptr-map-grid\" ref={this.ref}>\n\t\t\t\t{this.renderMaps()}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderMaps() {\n\t\tlet availableWidth = this.state.width;\n\t\tlet availableHeight = this.state.height;\n\n\t\tif (this.props.children.length && availableWidth && availableHeight) {\n\t\t\tlet sizeRatio = availableWidth / availableHeight;\n\t\t\tlet rows = 1,\n\t\t\t\tcolumns = 1;\n\n\t\t\tswitch (this.props.children.length) {\n\t\t\t\tcase 1:\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tif (sizeRatio > 1) {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tif (sizeRatio > 2) {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t} else if (sizeRatio < 0.6666) {\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tif (sizeRatio > 3) {\n\t\t\t\t\t\tcolumns = 4;\n\t\t\t\t\t} else if (sizeRatio < 0.5) {\n\t\t\t\t\t\trows = 4;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\tcase 6:\n\t\t\t\t\tif (sizeRatio > 1) {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 7:\n\t\t\t\tcase 8:\n\t\t\t\t\tif (sizeRatio > 2) {\n\t\t\t\t\t\tcolumns = 4;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t} else if (sizeRatio < 0.6666) {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 4;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 9:\n\t\t\t\t\tif (sizeRatio > 2.5) {\n\t\t\t\t\t\tcolumns = 5;\n\t\t\t\t\t\trows = 2;\n\t\t\t\t\t} else if (sizeRatio < 0.5) {\n\t\t\t\t\t\tcolumns = 2;\n\t\t\t\t\t\trows = 5;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (sizeRatio > 1) {\n\t\t\t\t\t\tcolumns = 4;\n\t\t\t\t\t\trows = 3;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolumns = 3;\n\t\t\t\t\t\trows = 4;\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet width = +(100 / columns).toFixed(4) + '%';\n\t\t\tlet height = +(100 / rows).toFixed(4) + '%';\n\n\t\t\tlet style = {width, height};\n\n\t\t\treturn this.props.children.map((map, index) => {\n\t\t\t\tindex++;\n\t\t\t\tlet rowNo = Math.ceil(index / columns);\n\t\t\t\tlet colNo = index % columns || columns;\n\n\t\t\t\tlet wrapperClasses = classNames(\n\t\t\t\t\t'ptr-map-grid-cell',\n\t\t\t\t\t'row' + rowNo,\n\t\t\t\t\t'col' + colNo,\n\t\t\t\t\tmap.props.wrapperClasses\n\t\t\t\t);\n\n\t\t\t\treturn (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={'map-grid-cell-' + index}\n\t\t\t\t\t\tclassName={wrapperClasses}\n\t\t\t\t\t\tstyle={style}\n\t\t\t\t\t>\n\t\t\t\t\t\t{map}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t});\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport default MapGrid;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport {Icon, Button} from '@gisatcz/ptr-atoms';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport './style.scss';\n\nclass MapControls extends React.PureComponent {\n\tstatic propTypes = {\n\t\tview: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\t\tupdateView: PropTypes.func,\n\t\tresetHeading: PropTypes.func,\n\t\tmapKey: PropTypes.string,\n\t\tzoomOnly: PropTypes.bool,\n\t\tlevelsBased: PropTypes.oneOfType([PropTypes.bool, PropTypes.array]),\n\t\tmapHeight: PropTypes.number,\n\t\tmapWidth: PropTypes.number,\n\t};\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.tiltIncrement = 5;\n\t\tthis.headingIncrement = 1.0;\n\t\tthis.zoomIncrement = 0.04;\n\t\tthis.exaggerationIncrement = 1;\n\n\t\tthis.state = {\n\t\t\tresetHeadingDisabled: false,\n\t\t};\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (\n\t\t\tthis.state.resetHeadingDisabled &&\n\t\t\t(!this.props.view.heading || this.props.heading === '360')\n\t\t) {\n\t\t\tthis.setState({\n\t\t\t\tresetHeadingDisabled: false,\n\t\t\t});\n\t\t}\n\t}\n\n\thandleTiltUp() {\n\t\tconst update = {tilt: this.props.view.tilt - this.tiltIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleTiltDown() {\n\t\tconst update = {tilt: this.props.view.tilt + this.tiltIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleHeadingRight() {\n\t\tconst update = {heading: this.props.view.heading - this.headingIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\thandleHeadingLeft() {\n\t\tconst update = {heading: this.props.view.heading + this.headingIncrement};\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\thandleZoomIn() {\n\t\tlet update = null;\n\t\tif (this.props.levelsBased && this.props.view && this.props.view.boxRange) {\n\t\t\t// remove 1 from box range to prevent rounding issues\n\t\t\tupdate = {boxRange: (this.props.view.boxRange - 1) / 2};\n\t\t} else {\n\t\t\tupdate = {boxRange: this.props.view.boxRange * (1 - this.zoomIncrement)};\n\t\t}\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleZoomOut() {\n\t\tlet update;\n\t\tif (this.props.levelsBased && this.props.view && this.props.view.boxRange) {\n\t\t\t// add 1 to box range to prevent rounding issues\n\t\t\tupdate = {boxRange: this.props.view.boxRange * 2 + 1};\n\t\t} else {\n\t\t\tupdate = {boxRange: this.props.view.boxRange * (1 + this.zoomIncrement)};\n\t\t}\n\t\tthis.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleResetHeading() {\n\t\tthis.props.resetHeading(this.props.mapKey);\n\t\tthis.setState({\n\t\t\tresetHeadingDisabled: true,\n\t\t});\n\t}\n\n\thandleExaggeratePlus() {\n\t\t// const update = {elevation: this.props.view.elevation + this.exaggerationIncrement};\n\t\t// this.props.updateView(update, this.props.mapKey);\n\t}\n\n\thandleExaggerateMinus() {\n\t\t// const update = {elevation: Math.max(1, this.props.view.elevation - this.exaggerationIncrement)};\n\t\t// this.props.updateView(update, this.props.mapKey);\n\t}\n\n\tisZoomButtonActive(type) {\n\t\tconst definedLimits =\n\t\t\tthis.props.viewLimits && this.props.viewLimits.boxRangeRange;\n\t\tconst currentBoxRange = this.props.view && this.props.view.boxRange;\n\n\t\tif (this.props.levelsBased) {\n\t\t\tconst currentLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\tcurrentBoxRange,\n\t\t\t\tthis.props.mapWidth,\n\t\t\t\tthis.props.mapHeight\n\t\t\t);\n\n\t\t\tif (type === 'in') {\n\t\t\t\tlet maxZoom = mapConstants.defaultLevelsRange[1];\n\t\t\t\tif (definedLimits && definedLimits[0]) {\n\t\t\t\t\tlet definedLimitAsLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\tdefinedLimits[0],\n\t\t\t\t\t\tthis.props.mapWidth,\n\t\t\t\t\t\tthis.props.mapHeight\n\t\t\t\t\t);\n\t\t\t\t\tif (definedLimitAsLevel < maxZoom) {\n\t\t\t\t\t\tmaxZoom = definedLimitAsLevel;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn currentLevel < maxZoom;\n\t\t\t} else {\n\t\t\t\tlet minZoom = mapConstants.defaultLevelsRange[0];\n\t\t\t\tif (definedLimits && definedLimits[1]) {\n\t\t\t\t\tlet definedLimitAsLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\tdefinedLimits[1],\n\t\t\t\t\t\tthis.props.mapWidth,\n\t\t\t\t\t\tthis.props.mapHeight\n\t\t\t\t\t);\n\t\t\t\t\tif (definedLimitAsLevel > minZoom) {\n\t\t\t\t\t\tminZoom = definedLimitAsLevel;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn currentLevel > minZoom;\n\t\t\t}\n\t\t} else {\n\t\t\tif (type === 'in') {\n\t\t\t\tconst limit =\n\t\t\t\t\t(definedLimits && definedLimits[0]) || mapConstants.minBoxRange;\n\t\t\t\treturn currentBoxRange * (1 - this.zoomIncrement) >= limit;\n\t\t\t} else {\n\t\t\t\tconst limit =\n\t\t\t\t\t(definedLimits && definedLimits[1]) || mapConstants.maxBoxRange;\n\t\t\t\treturn currentBoxRange * (1 + this.zoomIncrement) <= limit;\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\t// TODO different controls for 2D\n\t\treturn (\n\t\t\t<div className=\"ptr-map-controls\">\n\t\t\t\t{/* <div className=\"exaggerate-control control\">\n                        <HoldButton \n                            pressCallback={() => {this.handleExaggerateMinus()}}\n                            onClick={() => {this.handleExaggerateMinus()}}\n                            onMouseDown={200}\n                            pressCallbackTimeout={20}\n                            finite={false}\n                        >\n                            <Icon style={{transform: 'rotate(90deg)'}} icon='arrow-left' width={22} height={22} viewBox={'0 0 34 34'}/>\n                        </HoldButton>\n                        <HoldButton \n                            pressCallback={() => {this.handleExaggerateMinus()}}\n                            onClick={() => {this.handleExaggerateMinus()}}\n                            onMouseDown={200}\n                            pressCallbackTimeout={20}\n                            finite={false}\n                        >\n                            <Icon style={{transform: 'rotate(-90deg)'}} icon='arrow-left' width={22} height={22} viewBox={'0 0 34 34'}/>\n                        </HoldButton>\n                    </div> */}\n\t\t\t\t<div className=\"zoom-control control\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\tthis.handleZoomIn();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tthis.handleZoomIn();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!this.isZoomButtonActive('in')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon=\"plus-thick\" />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\tthis.handleZoomOut();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tthis.handleZoomOut();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={!this.isZoomButtonActive('out')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon=\"minus-thick\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t{!this.props.zoomOnly ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<div className=\"rotate-control control\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingRight();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingRight();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"rotate-right\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleResetHeading();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tdisabled={this.state.resetHeadingDisabled}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\ttransform: `rotate(${\n\t\t\t\t\t\t\t\t\t\t\tthis.props.view ? -this.props.view.heading : 0\n\t\t\t\t\t\t\t\t\t\t}deg)`,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ticon=\"north-arrow\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingLeft();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleHeadingLeft();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"rotate-left\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"tilt-control control\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"tilt-more-control\"\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltDown();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltDown();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"tilt-more\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"tilt-more-control\"\n\t\t\t\t\t\t\t\tonHold={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltUp();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tthis.handleTiltUp();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Icon icon=\"tilt-less\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t) : null}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default MapControls;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\n\nimport './style.scss';\nimport {Button} from '@gisatcz/ptr-atoms';\n\nclass MapWrapper extends React.PureComponent {\n\tstatic propTypes = {\n\t\tactive: PropTypes.bool,\n\t\ttitle: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),\n\t\tonMapRemove: PropTypes.func,\n\t};\n\n\tstatic defaultProps = {\n\t\ttitle: false,\n\t};\n\n\trender() {\n\t\tconst props = this.props;\n\t\tconst wrapperClasses = classNames('ptr-map-wrapper', {\n\t\t\tactive: this.props.active,\n\t\t});\n\n\t\treturn (\n\t\t\t<div className={wrapperClasses}>\n\t\t\t\t<div className=\"ptr-map-wrapper-header\">\n\t\t\t\t\t{props.onMapRemove ? this.renderCloseButton() : null}\n\t\t\t\t\t{props.title ? this.renderTitle() : null}\n\t\t\t\t</div>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderTitle() {\n\t\tlet title = this.props.title;\n\t\tif (title === true) {\n\t\t\ttitle = this.props.name || this.props.mapKey || 'Map';\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"ptr-map-wrapper-title\" title={title}>\n\t\t\t\t{title}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderCloseButton() {\n\t\tlet mapKey = this.props.stateMapKey || this.props.mapKey;\n\n\t\treturn (\n\t\t\t<div className=\"ptr-map-wrapper-close-button\">\n\t\t\t\t<Button\n\t\t\t\t\ticon=\"times\"\n\t\t\t\t\tinverted\n\t\t\t\t\tinvisible\n\t\t\t\t\tonClick={this.props.onMapRemove.bind(this, mapKey)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default MapWrapper;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n\tforEach as _forEach,\n\tisEmpty as _isEmpty,\n\tmapValues as _mapValues,\n\tpickBy as _pickBy,\n} from 'lodash';\n\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\n\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport MapGrid from '../MapGrid';\n\nimport './style.scss';\nimport MapWrapper from '../MapWrapper';\n\nclass Map extends React.PureComponent {\n\trender() {\n\t\treturn null;\n\t}\n}\n\nclass PresentationMap extends React.PureComponent {\n\trender() {\n\t\treturn null;\n\t}\n}\n\nclass MapSet extends React.PureComponent {\n\tstatic defaultProps = {\n\t\tdisableMapRemoval: false,\n\t};\n\n\tstatic propTypes = {\n\t\tactiveMapKey: PropTypes.string,\n\t\tactiveMapView: PropTypes.object,\n\t\tactiveMapViewport: PropTypes.object,\n\t\tdisableMapRemoval: PropTypes.bool,\n\t\tmapSetKey: PropTypes.string,\n\t\tmaps: PropTypes.array,\n\t\tmapComponent: PropTypes.func,\n\t\tview: PropTypes.object,\n\t\tstateMapSetKey: PropTypes.string,\n\t\tsync: PropTypes.object,\n\t\twrapper: PropTypes.oneOfType([\n\t\t\tPropTypes.elementType,\n\t\t\tPropTypes.element,\n\t\t\tPropTypes.bool,\n\t\t]),\n\t\twrapperProps: PropTypes.object,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tif (!props.stateMapSetKey) {\n\t\t\tthis.state = {\n\t\t\t\tview: mapUtils.view.mergeViews(mapConstants.defaultMapView, props.view),\n\n\t\t\t\tactiveMapKey: props.activeMapKey,\n\t\t\t\tmapViews: {},\n\t\t\t\tmapsDimensions: {},\n\t\t\t};\n\n\t\t\t_forEach(this.props.children, child => {\n\t\t\t\tif (\n\t\t\t\t\tchild &&\n\t\t\t\t\ttypeof child === 'object' &&\n\t\t\t\t\t(child.type === Map ||\n\t\t\t\t\t\tchild.type === this.props.connectedMapComponent ||\n\t\t\t\t\t\tchild.type === PresentationMap) &&\n\t\t\t\t\tchild.props.mapKey === props.activeMapKey\n\t\t\t\t) {\n\t\t\t\t\tthis.state.mapViews[child.props.mapKey] = mapUtils.view.mergeViews(\n\t\t\t\t\t\tmapConstants.defaultMapView,\n\t\t\t\t\t\tprops.view,\n\t\t\t\t\t\tchild.props.view\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.state = {\n\t\t\t\tmapsDimensions: {},\n\t\t\t};\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif (this.props.onMount) {\n\t\t\tthis.props.onMount();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (this.props.onUnmount) {\n\t\t\tthis.props.onUnmount();\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tconst props = this.props;\n\t\tif (!props.stateMapSetKey) {\n\t\t\tif (prevProps.view !== props.view) {\n\t\t\t\tlet mapViews = _mapValues(this.state.mapViews, view => {\n\t\t\t\t\treturn {...view, ...props.view};\n\t\t\t\t});\n\n\t\t\t\tthis.setState({\n\t\t\t\t\t// TODO sync props to view only?\n\t\t\t\t\tview: {...this.state.view, ...props.view},\n\t\t\t\t\tmapViews,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(props.layers && props.layers !== prevProps.layers) ||\n\t\t\t\t(props.backgroundLayer &&\n\t\t\t\t\tprops.backgroundLayer !== prevProps.backgroundLayer)\n\t\t\t) {\n\t\t\t\tif (props.refreshUse) {\n\t\t\t\t\t// props.refreshUse();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewChange(mapKey, update) {\n\t\tlet syncUpdate;\n\t\tupdate = mapUtils.view.ensureViewIntegrity(update);\n\t\tmapKey = mapKey || this.state.activeMapKey;\n\n\t\tif (this.props.sync) {\n\t\t\tsyncUpdate = _pickBy(update, (updateVal, updateKey) => {\n\t\t\t\treturn this.props.sync[updateKey];\n\t\t\t});\n\t\t\tsyncUpdate = mapUtils.view.ensureViewIntegrity(syncUpdate);\n\t\t}\n\n\t\t// merge views of all maps\n\t\tlet mapViews = _mapValues(this.state.mapViews, view => {\n\t\t\treturn mapUtils.view.mergeViews(view, syncUpdate);\n\t\t});\n\n\t\t// merge views of given map\n\t\tmapViews[mapKey] = mapUtils.view.mergeViews(\n\t\t\tthis.state.mapViews[mapKey],\n\t\t\tupdate\n\t\t);\n\n\t\tif (syncUpdate && !_isEmpty(syncUpdate)) {\n\t\t\tconst mergedView = mapUtils.view.mergeViews(this.state.view, syncUpdate);\n\n\t\t\tthis.setState({\n\t\t\t\tview: mergedView,\n\t\t\t\tmapViews,\n\t\t\t});\n\n\t\t\tif (this.props.onViewChange) {\n\t\t\t\tthis.props.onViewChange(mergedView);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.setState({\n\t\t\t\tmapViews,\n\t\t\t});\n\t\t}\n\t}\n\n\tonResetHeading() {\n\t\tmapUtils.resetHeading(\n\t\t\tthis.state.mapViews[this.state.activeMapKey].heading,\n\t\t\theading => this.onViewChange(this.state.activeMapKey, {heading})\n\t\t);\n\t}\n\n\t/**\n\t * Called in uncontrolled map set\n\t * @param key\n\t * @param view\n\t */\n\tonMapClick(key, view) {\n\t\tif (this.state.mapViews[key]) {\n\t\t\tthis.setState({activeMapKey: key});\n\t\t} else {\n\t\t\tlet mapViews = {...this.state.mapViews};\n\t\t\tmapViews[key] = view;\n\n\t\t\tthis.setState({activeMapKey: key, mapViews});\n\t\t}\n\t}\n\n\tonMapResize(mapKey, width, height) {\n\t\tconst mapsDimensions = {\n\t\t\t...this.state.mapsDimensions,\n\t\t\t[mapKey]: {width, height},\n\t\t};\n\t\tthis.setState({mapsDimensions});\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"ptr-map-set\">\n\t\t\t\t<div className=\"ptr-map-set-maps\">{this.renderMaps()}</div>\n\t\t\t\t<div className=\"ptr-map-set-controls\">{this.renderControls()}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderControls() {\n\t\tlet updateView, resetHeading, view, mapKey, activeMapDimensions;\n\t\tif (this.props.stateMapSetKey) {\n\t\t\tupdateView = this.props.updateView;\n\t\t\tresetHeading = this.props.resetHeading;\n\t\t\tview = this.props.activeMapView || this.props.view;\n\t\t\tmapKey = this.props.activeMapKey;\n\t\t\tactiveMapDimensions = this.props.activeMapViewport;\n\t\t} else {\n\t\t\tupdateView = this.onViewChange.bind(this, null);\n\t\t\tresetHeading = this.onResetHeading.bind(this);\n\t\t\tview = mapUtils.view.mergeViews(\n\t\t\t\tthis.state.view,\n\t\t\t\tthis.state.mapViews[this.state.activeMapKey]\n\t\t\t);\n\t\t\tmapKey = this.state.activeMapKey;\n\t\t\tactiveMapDimensions =\n\t\t\t\tthis.state.mapsDimensions &&\n\t\t\t\tthis.state.mapsDimensions[this.state.activeMapKey];\n\t\t}\n\n\t\treturn React.Children.map(this.props.children, child => {\n\t\t\tif (!(typeof child === 'object' && child.type === Map)) {\n\t\t\t\treturn React.cloneElement(child, {\n\t\t\t\t\t...child.props,\n\t\t\t\t\tview,\n\t\t\t\t\tupdateView,\n\t\t\t\t\tresetHeading,\n\t\t\t\t\tmapKey,\n\t\t\t\t\tmapWidth: activeMapDimensions && activeMapDimensions.width,\n\t\t\t\t\tmapHeight: activeMapDimensions && activeMapDimensions.height,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\trenderMaps() {\n\t\tlet maps = [];\n\n\t\t// For now, render either maps from state, OR from children\n\n\t\tif (this.props.stateMapSetKey) {\n\t\t\t// all from state\n\t\t\tif (this.props.maps && this.props.maps.length) {\n\t\t\t\tthis.props.maps.map(mapKey => {\n\t\t\t\t\tlet props = {\n\t\t\t\t\t\tkey: mapKey,\n\t\t\t\t\t\tstateMapKey: mapKey,\n\t\t\t\t\t\tonResize: this.onMapResize.bind(this, mapKey),\n\t\t\t\t\t};\n\n\t\t\t\t\tmaps.push(\n\t\t\t\t\t\tthis.renderMap(\n\t\t\t\t\t\t\tthis.props.connectedMapComponent,\n\t\t\t\t\t\t\t{...props, mapComponent: this.props.mapComponent},\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tmapKey === this.props.activeMapKey\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tReact.Children.map(this.props.children, (child, index) => {\n\t\t\t\tlet {view, layers, backgroundLayer, mapKey, ...restProps} = child.props;\n\t\t\t\tlet props = {\n\t\t\t\t\t...restProps,\n\t\t\t\t\tkey: index,\n\t\t\t\t\tview: mapUtils.view.mergeViews(\n\t\t\t\t\t\tthis.state.view,\n\t\t\t\t\t\tview,\n\t\t\t\t\t\tthis.state.mapViews[mapKey]\n\t\t\t\t\t),\n\t\t\t\t\tbackgroundLayer: backgroundLayer || this.props.backgroundLayer,\n\t\t\t\t\tlayers: mapUtils.mergeLayers(this.props.layers, layers),\n\t\t\t\t\tonViewChange: this.onViewChange.bind(this, mapKey),\n\t\t\t\t\tonClick: this.onMapClick.bind(this, mapKey),\n\t\t\t\t\tonResize: this.onMapResize.bind(this, mapKey),\n\t\t\t\t\tmapKey,\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\ttypeof child === 'object' &&\n\t\t\t\t\t(child.type === Map ||\n\t\t\t\t\t\tchild.type === this.props.connectedMapComponent)\n\t\t\t\t) {\n\t\t\t\t\t// layers from state\n\t\t\t\t\tmaps.push(\n\t\t\t\t\t\tthis.renderMap(\n\t\t\t\t\t\t\tthis.props.connectedMapComponent,\n\t\t\t\t\t\t\t{...props, mapComponent: this.props.mapComponent},\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tmapKey === this.state.activeMapKey\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t} else if (\n\t\t\t\t\ttypeof child === 'object' &&\n\t\t\t\t\tchild.type === PresentationMap\n\t\t\t\t) {\n\t\t\t\t\t// all presentational\n\t\t\t\t\tmaps.push(\n\t\t\t\t\t\tthis.renderMap(\n\t\t\t\t\t\t\tthis.props.mapComponent || child.props.mapComponent,\n\t\t\t\t\t\t\tprops,\n\t\t\t\t\t\t\tchild.props.children,\n\t\t\t\t\t\t\tmapKey === this.state.activeMapKey,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn <MapGrid>{maps}</MapGrid>;\n\t}\n\n\trenderMap(mapComponent, props, children, active, renderWrapper) {\n\t\t// TODO custom wrapper component\n\t\tif (this.props.wrapper) {\n\t\t\tlet wrapperProps = this.props.wrapperProps;\n\t\t\tif (this.props.onMapRemove && !this.props.disableMapRemoval) {\n\t\t\t\twrapperProps = {\n\t\t\t\t\t...this.props.wrapperProps,\n\t\t\t\t\tonMapRemove: this.props.onMapRemove,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst allProps = {\n\t\t\t\t...props,\n\t\t\t\t...wrapperProps,\n\t\t\t\twrapper: this.props.wrapper,\n\t\t\t\tactive,\n\t\t\t};\n\n\t\t\t// Render wrapper here, if mapComponent is final (framework-specific) map component\n\t\t\tif (renderWrapper) {\n\t\t\t\tconst wrapperComponent =\n\t\t\t\t\t(this.props.wrapper.prototype &&\n\t\t\t\t\t\tthis.props.wrapper.prototype.isReactComponent) ||\n\t\t\t\t\ttypeof this.props.wrapper === 'function'\n\t\t\t\t\t\t? this.props.wrapper\n\t\t\t\t\t\t: MapWrapper;\n\t\t\t\treturn React.createElement(\n\t\t\t\t\twrapperComponent,\n\t\t\t\t\tallProps,\n\t\t\t\t\tReact.createElement(mapComponent, props, children)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn React.createElement(mapComponent, allProps, children);\n\t\t\t}\n\t\t} else {\n\t\t\treturn React.createElement(mapComponent, props, children);\n\t\t}\n\t}\n}\n\nexport const MapSetMap = Map;\nexport const MapSetPresentationMap = PresentationMap;\n\nexport default MapSet;\n","import React from 'react';\nimport './mapTools.scss';\nexport default props => {\n\treturn <div className=\"map-tools\">{props.children}</div>;\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {isEqual as _isEqual, isEmpty as _isEmpty} from 'lodash';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport {Error} from '@gisatcz/ptr-atoms';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport MapWrapper from './MapWrapper';\n\nimport './style.scss';\n\nclass PresentationMap extends React.PureComponent {\n\tstatic propTypes = {\n\t\tbackgroundLayer: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n\t\tchildren: PropTypes.element,\n\t\tlayers: PropTypes.array,\n\t\tmapComponent: PropTypes.oneOfType([PropTypes.element, PropTypes.func]),\n\t\tonMount: PropTypes.func,\n\t\tonPropViewChange: PropTypes.func,\n\t\tonResize: PropTypes.func,\n\t\tonViewChange: PropTypes.func,\n\t\tresetHeading: PropTypes.func,\n\t\tstateMapKey: PropTypes.string,\n\t\tview: PropTypes.object,\n\t\tviewport: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\t\twrapper: PropTypes.oneOfType([\n\t\t\tPropTypes.elementType,\n\t\t\tPropTypes.element,\n\t\t\tPropTypes.bool,\n\t\t]),\n\t\twrapperProps: PropTypes.object,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t};\n\n\t\tif (!props.stateMapKey) {\n\t\t\tthis.state.view = {...mapConstants.defaultMapView, ...props.view};\n\t\t}\n\n\t\tthis.onViewChange = this.onViewChange.bind(this);\n\t\tthis.onPropViewChange = this.onPropViewChange.bind(this);\n\t\tthis.resetHeading = this.resetHeading.bind(this);\n\t\tthis.onResize = this.onResize.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\tif (this.props.onMount) {\n\t\t\tthis.props.onMount(this.state.width, this.state.height);\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tconst props = this.props;\n\t\tif (props.view) {\n\t\t\tconst view = this.getValidView(props.view);\n\t\t\tif (prevProps && prevProps.view) {\n\t\t\t\t//todo simplify\n\t\t\t\tif (!_isEqual(props.view, prevProps.view)) {\n\t\t\t\t\tif (!this.props.stateMapKey) {\n\t\t\t\t\t\tthis.saveViewChange(view, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.onPropViewChange(view);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this.props.stateMapKey) {\n\t\t\t\t\tthis.saveViewChange(view, true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.onPropViewChange(view);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t(props.layers && props.layers !== prevProps.layers) ||\n\t\t\t(props.backgroundLayer &&\n\t\t\t\tprops.backgroundLayer !== prevProps.backgroundLayer)\n\t\t) {\n\t\t\t// this.props.refreshUse();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (this.props.onUnmount) {\n\t\t\tthis.props.onUnmount();\n\t\t}\n\t}\n\n\tonViewChangeDecorator(onViewChange) {\n\t\treturn update => {\n\t\t\tonViewChange(update, this.state.width, this.state.height);\n\t\t};\n\t}\n\n\tgetValidView(update) {\n\t\tlet view = {...mapConstants.defaultMapView, ...view};\n\t\tif (this.state.view && !_isEmpty(this.state.view)) {\n\t\t\tview = {...this.state.view, ...update};\n\t\t}\n\t\tview = mapUtils.view.ensureViewIntegrity(view);\n\t\treturn view;\n\t}\n\n\tsaveViewChange(view, checkViewEquality) {\n\t\tif (checkViewEquality && !_isEqual(view, this.state.view)) {\n\t\t\tif (!this.props.stateMapKey) {\n\t\t\t\tthis.setState({view});\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewChange(update) {\n\t\tconst view = this.getValidView(update);\n\t\tthis.saveViewChange(view, true);\n\n\t\tif (!_isEqual(view, this.state.view)) {\n\t\t\tif (this.props.onViewChange && !this.props.stateMapKey) {\n\t\t\t\tthis.onViewChangeDecorator(this.props.onViewChange)(view);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPropViewChange(view) {\n\t\tif (this.props.stateMapKey && this.props.onPropViewChange) {\n\t\t\tthis.onViewChangeDecorator(this.props.onPropViewChange)(view);\n\t\t}\n\t}\n\n\tresetHeading() {\n\t\tmapUtils.resetHeading(this.state.view.heading, heading =>\n\t\t\tthis.setState({\n\t\t\t\tview: {...this.state.view, heading},\n\t\t\t})\n\t\t);\n\t}\n\n\tonResize(width, height) {\n\t\tif (this.props.onResize) {\n\t\t\tthis.props.onResize(width, height);\n\t\t}\n\n\t\tthis.setState({width, height});\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tmapComponent,\n\t\t\twrapper,\n\t\t\twrapperProps,\n\t\t\t...props\n\t\t} = this.props;\n\n\t\tif (!mapComponent) {\n\t\t\treturn <Error centered>mapComponent not supplied to Map</Error>;\n\t\t} else {\n\t\t\tprops.onResize = this.onResize;\n\n\t\t\tif (!props.stateMapKey) {\n\t\t\t\tprops.view = this.state.view || props.view;\n\t\t\t\tprops.onViewChange = this.onViewChange;\n\t\t\t}\n\n\t\t\tif (wrapper) {\n\t\t\t\tconst wrapperComponent =\n\t\t\t\t\t(this.props.wrapper.prototype &&\n\t\t\t\t\t\tthis.props.wrapper.prototype.isReactComponent) ||\n\t\t\t\t\ttypeof this.props.wrapper === 'function'\n\t\t\t\t\t\t? this.props.wrapper\n\t\t\t\t\t\t: MapWrapper;\n\n\t\t\t\treturn React.createElement(\n\t\t\t\t\twrapperComponent,\n\t\t\t\t\t{...props, ...wrapperProps},\n\t\t\t\t\tthis.renderContent(mapComponent, props, children)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn this.renderContent(mapComponent, props, children);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderContent(mapComponent, props, children) {\n\t\tlet map = React.createElement(mapComponent, props);\n\n\t\tif (!children) {\n\t\t\treturn map;\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div className=\"ptr-map-controls-wrapper\">\n\t\t\t\t\t{map}\n\t\t\t\t\t{React.Children.map(children, child => {\n\t\t\t\t\t\treturn React.cloneElement(child, {\n\t\t\t\t\t\t\t...child.props,\n\t\t\t\t\t\t\tview: props.view,\n\t\t\t\t\t\t\tviewLimits: this.props.viewLimits,\n\t\t\t\t\t\t\tupdateView: props.onViewChange,\n\t\t\t\t\t\t\tresetHeading: this.props.stateMapKey\n\t\t\t\t\t\t\t\t? this.props.resetHeading\n\t\t\t\t\t\t\t\t: this.resetHeading,\n\t\t\t\t\t\t\tmapWidth: this.props.stateMapKey\n\t\t\t\t\t\t\t\t? this.props.viewport?.width\n\t\t\t\t\t\t\t\t: this.state.width,\n\t\t\t\t\t\t\tmapHeight: this.props.stateMapKey\n\t\t\t\t\t\t\t\t? this.props.viewport?.height\n\t\t\t\t\t\t\t\t: this.state.height,\n\t\t\t\t\t\t});\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default PresentationMap;\n","import {mapConstants} from '@gisatcz/ptr-core';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\n\nfunction getLeafletViewFromViewParams(view, width, height) {\n\tconst completeView = {...mapConstants.defaultMapView, ...view};\n\n\treturn {\n\t\tzoom: mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\tcompleteView.boxRange,\n\t\t\twidth,\n\t\t\theight\n\t\t),\n\t\tcenter: {\n\t\t\tlat: completeView.center.lat,\n\t\t\tlng: completeView.center.lon,\n\t\t},\n\t};\n}\n\nfunction getLeafletViewportFromViewParams(view, width, height) {\n\tconst leafletView = getLeafletViewFromViewParams(view, width, height);\n\n\treturn {\n\t\tzoom: leafletView.zoom,\n\t\tcenter: [leafletView.center.lat, leafletView.center.lng],\n\t};\n}\n\nfunction update(map, view, width, height) {\n\tlet stateCenter = map.getCenter();\n\tlet stateZoom = map.getZoom();\n\n\tlet leafletUpdate = getLeafletViewFromViewParams(view, width, height);\n\n\tif (\n\t\tstateCenter.lat !== leafletUpdate.center.lat ||\n\t\tstateCenter.lng !== leafletUpdate.center.lng ||\n\t\tstateZoom !== leafletUpdate.zoom\n\t) {\n\t\tmap.setView(\n\t\t\tleafletUpdate.center || stateCenter,\n\t\t\tleafletUpdate.zoom || stateZoom\n\t\t);\n\t}\n}\n\nexport default {\n\tgetLeafletViewportFromViewParams,\n\tupdate,\n};\n","import React from 'react';\n\nexport default props => {\n\tlet svgSize = 32;\n\tlet offset = 0;\n\n\tif (props.outlineWidth) {\n\t\tsvgSize += props.outlineWidth;\n\t\toffset = props.outlineWidth / 2;\n\t}\n\n\treturn (\n\t\t<svg\n\t\t\tversion=\"1.1\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\txmlnsXlink=\"http://www.w3.org/1999/xlink\"\n\t\t\tx=\"0px\"\n\t\t\ty=\"0px\"\n\t\t\twidth={svgSize + 'px'}\n\t\t\theight={svgSize + 'px'}\n\t\t\tviewBox={`0 0 ${svgSize} ${svgSize}`}\n\t\t\txmlSpace=\"preserve\"\n\t\t\tclassName={`ptr-map-shape ${props.className || ''}`}\n\t\t\tstyle={props.style}\n\t\t>\n\t\t\t{React.createElement(props.children, {...props, offset})}\n\t\t</svg>\n\t);\n};\n","import React from 'react';\nimport svg from './svg';\n\nconst Cross = props => {\n\treturn (\n\t\t<g transform={`translate(${props.offset} ${props.offset})`}>\n\t\t\t<path vectorEffect=\"non-scaling-stroke\" d=\"M 1,1 31,31\" />\n\t\t\t<path vectorEffect=\"non-scaling-stroke\" d=\"M 1,31 31,1\" />\n\t\t</g>\n\t);\n};\n\nexport default props => React.createElement(svg, props, Cross);\n","import React from 'react';\nimport svg from './svg';\n\nconst Pin = props => {\n\treturn (\n\t\t<g\n\t\t\ttransform={`translate(${props.offset} ${\n\t\t\t\tprops.offset + props.offset / 4\n\t\t\t})`}\n\t\t>\n\t\t\t<path\n\t\t\t\tvectorEffect=\"non-scaling-stroke\"\n\t\t\t\td=\"M 27,10.999999 C 26.999936,4.924849 22.075087,0 16,0 9.9249129,0 5.0000636,4.924849 5,10.999999 4.9998451,13.460703 6.2398215,15.834434 8.6666665,18.857143 11.093512,21.879851 13.424935,25.819509 16,32 18.614084,25.725879 20.878951,21.8993 23.333333,18.857143 25.787715,15.814985 26.999857,13.488539 27,10.999999 Z\"\n\t\t\t/>\n\t\t\t{props.icon ? (\n\t\t\t\t<g transform=\"translate(9 3.5) scale(0.4375 0.4375)\">{props.icon}</g>\n\t\t\t) : null}\n\t\t</g>\n\t);\n};\n\nexport default props => React.createElement(svg, props, Pin);\n","import Cross from './Cross';\nimport Pin from './Pin';\n\nexport default {\n\tcross: {\n\t\tanchorPoint: [0.5, 0.5],\n\t\tcomponent: Cross,\n\t},\n\tpin: {\n\t\tanchorPoint: [0.5, 1],\n\t\tcomponent: Pin,\n\t},\n};\n","import L from 'leaflet';\nimport {forIn as _forIn} from 'lodash';\nimport ReactDOMServer from 'react-dom/server';\nimport React from 'react';\nimport helpers from '../helpers';\n\n/**\n * It enables to draw various shapes as marker icon.\n * @augments L.DivIcon\n * @param props {object}\n * @param props.basicShape {bool} If true -> DIV element, if false -> SVG element\n * @param props.icon {Object} Icon definition\n * @param props.icon.component {React.Component}\n * @param props.icon.componentProps {React.Object} Additional icon component props\n * @param props.id {string}\n * @param props.iconAnchor {string} https://leafletjs.com/reference-1.7.1.html#icon-iconanchor\n * @param props.onClick {function} onclick callback\n * @param props.onMouseMove {function} mousemove callback\n * @param props.onMouseOver {function} mouseover callback\n * @param props.onMouseOut {function} mouseout callback\n * @param props.shape {Object} Shape definition\n * @param props.shape.component {React.Component}\n * @param props.shape.componentProps {React.Object} Additional shape component props\n * @param props.style {string} Extended Leaflet style (see getSvgStyle method for details)\n */\nclass MarkerShape extends L.DivIcon {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\t// Needed by L.DivIcon\n\t\tthis.iconAnchor = props.iconAnchor;\n\n\t\tthis.basicShape = props.basicShape;\n\t\tthis.id = props.id;\n\t\tthis.style = props.style;\n\t\tthis.shape = props.shape;\n\t\tthis.icon = props.icon;\n\n\t\tthis.onMouseMove = props.onMouseMove;\n\t\tthis.onMouseOver = props.onMouseOver;\n\t\tthis.onMouseOut = props.onMouseOut;\n\t\tthis.onClick = props.onClick;\n\t}\n\n\t/**\n\t * Overwrite ancestor's method\n\t * @param oldShape\n\t * @return {HTMLDivElement}\n\t */\n\tcreateIcon(oldShape) {\n\t\tlet div;\n\t\tif (oldShape && oldShape.tagName === 'DIV') {\n\t\t\tdiv = oldShape;\n\t\t} else {\n\t\t\tdiv = document.createElement('div');\n\t\t\tdiv.id = this.id;\n\t\t\tif (this.onMouseMove) {\n\t\t\t\tdiv.addEventListener('mousemove', this.onMouseMove);\n\t\t\t}\n\t\t\tif (this.onMouseOver) {\n\t\t\t\tdiv.addEventListener('mouseover', this.onMouseOver);\n\t\t\t}\n\t\t\tif (this.onMouseOut) {\n\t\t\t\tdiv.addEventListener('mouseout', this.onMouseOut);\n\t\t\t}\n\t\t\tif (this.onClick) {\n\t\t\t\tdiv.addEventListener('click', this.onClick);\n\t\t\t}\n\t\t}\n\n\t\tconst html = this.getShapeHtml();\n\t\tif (html instanceof Element) {\n\t\t\tdiv.appendChild(html);\n\t\t} else {\n\t\t\tdiv.innerHTML = html !== false ? html : '';\n\t\t}\n\n\t\tthis._setIconStyles(div, 'icon');\n\n\t\treturn div;\n\t}\n\n\t/**\n\t * Prepare html of the icon based on shape and icon components\n\t * @return {string}\n\t */\n\tgetShapeHtml() {\n\t\t// Basic shape -> no need for svg\n\t\tif (this.basicShape) {\n\t\t\tconst style = helpers.getMarkerShapeCssStyle(this.style);\n\t\t\treturn ReactDOMServer.renderToString(<div style={style} />);\n\t\t} else {\n\t\t\tlet finalShape;\n\t\t\tconst style = helpers.getMarkerShapeSvgStyle(this.style);\n\n\t\t\t// Combined shape and icon\n\t\t\t// Currently only shape=\"pin\" is suitable for combination\n\t\t\tif (this.shape && this.icon) {\n\t\t\t\tfinalShape = this.getShapeWithIcon(style);\n\t\t\t}\n\n\t\t\t// Just shape\n\t\t\telse if (this.shape) {\n\t\t\t\tfinalShape = this.getShape(style);\n\t\t\t}\n\n\t\t\t// No shape, but icon? Use icon as shape\n\t\t\telse if (this.icon) {\n\t\t\t\tfinalShape = this.getIcon(style);\n\t\t\t}\n\n\t\t\treturn ReactDOMServer.renderToString(finalShape);\n\t\t}\n\t}\n\n\t/**\n\t * @param style {Object} style object suitable for SVG\n\t * @return {React.DetailedReactHTMLElement<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>}\n\t */\n\tgetShape(style) {\n\t\tconst props = this.shape.componentProps\n\t\t\t? {...this.shape.componentProps, style}\n\t\t\t: {style};\n\t\treturn React.createElement(this.shape.component, {\n\t\t\t...props,\n\t\t\toutlineWidth: this.style.weight,\n\t\t});\n\t}\n\n\t/**\n\t * @param style {Object} style object suitable for SVG\n\t * @return {React.DetailedReactHTMLElement<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>}\n\t */\n\tgetIcon(style) {\n\t\tconst iconStyle = {\n\t\t\t...style,\n\t\t\tfill: style.iconFill ? style.iconFill : style.fill,\n\t\t};\n\n\t\tconst props = this.icon.componentProps\n\t\t\t? {...this.icon.componentProps, style: iconStyle}\n\t\t\t: {style: iconStyle};\n\t\treturn React.createElement(this.icon.component, props);\n\t}\n\n\t/**\n\t * @param style {Object} style object suitable for SVG\n\t * @return {React.DetailedReactHTMLElement<React.InputHTMLAttributes<HTMLInputElement>, HTMLInputElement>}\n\t */\n\tgetShapeWithIcon(style) {\n\t\tlet iconStyle = {strokeWidth: 0}; // TODO think about icons styling inside shape\n\t\tconst {iconFill, ...shapeStyle} = style;\n\n\t\tif (iconFill) {\n\t\t\ticonStyle.fill = iconFill;\n\t\t} else {\n\t\t\ticonStyle.fill = shapeStyle.stroke;\n\t\t}\n\n\t\tconst iconProps = this.icon.componentProps\n\t\t\t? {...this.icon.componentProps, style: iconStyle}\n\t\t\t: {style: iconStyle};\n\t\tconst iconComponent = React.createElement(this.icon.component, iconProps);\n\n\t\tconst props = this.shape.componentProps\n\t\t\t? {...this.shape.componentProps, style: shapeStyle}\n\t\t\t: {style: shapeStyle};\n\t\treturn React.createElement(this.shape.component, {\n\t\t\t...props,\n\t\t\ticon: iconComponent,\n\t\t\toutlineWidth: this.style.weight,\n\t\t});\n\t}\n\n\t/**\n\t * Set style of element\n\t * @param style {Object} Leaflet style definition\n\t * @param id {string} id of the shape\n\t * @param isBasicShape {bool} If true -> DIV element, if false -> SVG element\n\t */\n\tsetStyle(style, id, isBasicShape) {\n\t\tid = id || this.id;\n\t\tisBasicShape = isBasicShape || this.basicShape;\n\n\t\tlet shapeStyle = isBasicShape\n\t\t\t? helpers.getMarkerShapeCssStyle(style)\n\t\t\t: helpers.getMarkerShapeSvgStyle(style);\n\t\tlet element = document.getElementById(id);\n\t\tlet shape = element?.children?.[0];\n\n\t\tif (shape) {\n\t\t\t_forIn(shapeStyle, (value, key) => {\n\t\t\t\tshape.style[key] = value;\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport default MarkerShape;\n","import {mapStyle} from '@gisatcz/ptr-utils';\nimport constants from '../../../constants';\nimport memoize from 'memoize-one';\nimport flip from '@turf/flip';\nimport shapes from './Feature/shapes';\nimport MarkerShape from './Feature/MarkerShape';\n\n/**\n * @param feature {GeoJSONFeature}\n * @param styleDefinition {Object} Panther style definition\n * @return {Object}\n */\nfunction getDefaultStyleObject(feature, styleDefinition) {\n\treturn mapStyle.getStyleObject(\n\t\tfeature.properties,\n\t\tstyleDefinition || constants.vectorFeatureStyle.defaultFull\n\t);\n}\n\n/**\n * @param selectedStyleDefinition {Object} Panther style definition\n * @return {Object}\n */\nfunction getSelectedStyleObject(selectedStyleDefinition) {\n\treturn selectedStyleDefinition === 'default'\n\t\t? constants.vectorFeatureStyle.selected\n\t\t: selectedStyleDefinition;\n}\n\n/**\n * @param feature {GeoJSONFeature}\n * @param defaultStyleObject {Object} Panther style definition\n * @return {Object}\n */\nfunction getFeatureDefaultStyle(feature, defaultStyleObject) {\n\treturn getFeatureLeafletStyle(feature, defaultStyleObject);\n}\n\n/**\n * @param feature {GeoJSONFeature}\n * @param defaultStyleObject {Object} Panther style definition\n * @param accentedStyleObject {Object} Panther style definition\n * @return {Object}\n */\nfunction getFeatureAccentedStyle(\n\tfeature,\n\tdefaultStyleObject,\n\taccentedStyleObject\n) {\n\tconst style = {...defaultStyleObject, ...accentedStyleObject};\n\treturn getFeatureLeafletStyle(feature, style);\n}\n\n/**\n * @param feature {GeoJSONFeature}\n * @param style {Object} Panther style definition\n * @return {Object} Leaflet style definition\n */\nfunction getFeatureLeafletStyle(feature, style) {\n\tlet {\n\t\toutlineColor,\n\t\toutlineWidth,\n\t\toutlineOpacity,\n\t\tfillOpacity,\n\t\tfill,\n\t\tsize,\n\t\tvolume,\n\t\t...finalStyle\n\t} = style;\n\n\tfinalStyle.color = style.outlineColor ? style.outlineColor : null;\n\tfinalStyle.weight = style.outlineWidth ? style.outlineWidth : 0;\n\tfinalStyle.opacity = style.outlineOpacity ? style.outlineOpacity : 1;\n\tfinalStyle.fillOpacity = style.fillOpacity ? style.fillOpacity : 1;\n\tfinalStyle.fillColor = style.fill;\n\n\tif (!style.fill) {\n\t\tfinalStyle.fillColor = null;\n\t\tfinalStyle.fillOpacity = 0;\n\t}\n\n\tif (!style.outlineColor || !style.outlineWidth) {\n\t\tfinalStyle.color = null;\n\t\tfinalStyle.opacity = 0;\n\t\tfinalStyle.weight = 0;\n\t}\n\n\t// for point features, set radius\n\tif (feature.geometry.type === 'Point') {\n\t\tif (style.size) {\n\t\t\tfinalStyle.radius = style.size;\n\t\t} else if (style.volume) {\n\t\t\tfinalStyle.radius = Math.sqrt(style.volume / Math.PI);\n\t\t}\n\t}\n\n\treturn finalStyle;\n}\n\n/**\n * Leaflet requires coordinates in different order than GeoJSON standard\n * @param feature {GeoJSONFeature}\n */\nconst convertCoordinatesMemo = memoize(feature => {\n\t// TODO do we need turf for this?\n\tconst flippedFeature = flip(feature);\n\treturn (\n\t\tflippedFeature &&\n\t\tflippedFeature.geometry &&\n\t\tflippedFeature.geometry.coordinates\n\t);\n});\n\nconst getDefaultStyle = (feature, styleDefinition) => {\n\tconst defaultStyleObject = getDefaultStyleObject(feature, styleDefinition);\n\treturn getFeatureDefaultStyle(feature, defaultStyleObject);\n};\n\nconst calculateStyle = (\n\tfeature,\n\tstyleDefinition,\n\thoveredStyleDefinition,\n\tselected,\n\tselectedStyleDefinition,\n\tselectedHoveredStyleDefinition\n) => {\n\t// Prepare default style\n\tconst defaultStyleObject = getDefaultStyleObject(feature, styleDefinition);\n\tconst defaultStyle = getFeatureDefaultStyle(feature, defaultStyleObject);\n\n\t// Prepare hovered style\n\tlet hoveredStyleObject = null;\n\tlet hoveredStyle = null;\n\tif (hoveredStyleDefinition) {\n\t\thoveredStyleObject =\n\t\t\thoveredStyleDefinition === 'default'\n\t\t\t\t? constants.vectorFeatureStyle.hovered\n\t\t\t\t: hoveredStyleDefinition;\n\t\thoveredStyle = getFeatureAccentedStyle(\n\t\t\tfeature,\n\t\t\tdefaultStyleObject,\n\t\t\thoveredStyleObject\n\t\t);\n\t}\n\n\t// Prepare selected and selected hovered style, if selected\n\tlet selectedStyle = null;\n\tlet selectedHoveredStyle = null;\n\tif (selected) {\n\t\tlet selectedHoveredStyleObject = null;\n\t\tif (selectedStyleDefinition) {\n\t\t\tselectedStyle = getFeatureAccentedStyle(\n\t\t\t\tfeature,\n\t\t\t\tdefaultStyleObject,\n\t\t\t\tgetSelectedStyleObject(selectedStyleDefinition)\n\t\t\t);\n\t\t}\n\t\tif (selectedHoveredStyleDefinition) {\n\t\t\tselectedHoveredStyleObject =\n\t\t\t\tselectedHoveredStyleDefinition === 'default'\n\t\t\t\t\t? constants.vectorFeatureStyle.selectedHovered\n\t\t\t\t\t: selectedHoveredStyleDefinition;\n\t\t\tselectedHoveredStyle = getFeatureAccentedStyle(\n\t\t\t\tfeature,\n\t\t\t\tdefaultStyleObject,\n\t\t\t\tselectedHoveredStyleObject\n\t\t\t);\n\t\t}\n\t}\n\n\treturn {\n\t\tdefault: defaultStyle,\n\t\thovered: hoveredStyle,\n\t\tselected: selectedStyle,\n\t\tselectedHovered: selectedHoveredStyle,\n\t};\n};\n\nconst calculateStylesMemo = memoize(calculateStyle);\n\n/**\n * @param id {string}\n * @param style {Object} Leaflet style definition\n * @param options {Object}\n * @param options.icons {Object} see https://gisat.github.io/components/maps/map#resources\n * @param options.onMouseMove {function}\n * @param options.onMouseOver {function}\n * @param options.onMouseOut {function}\n * @param options.onClick {function}\n * @return {MarkerShape}\n */\nconst getMarkerShape = (id, style, options) => {\n\tconst shapeKey = style.shape;\n\tconst iconKey = style.icon;\n\tlet basicShape = true;\n\tlet anchorShift = 0; // shift of anchor in pixels\n\tlet anchorPositionX = 0.5; // relative anchor X position (0.5 means that the shape reference point is in the middle horizontally)\n\tlet anchorPositionY = 0.5; // relative anchor Y position\n\tlet shape, icon;\n\n\t// find shape by key in the internal set of shapes\n\tif (shapeKey) {\n\t\tshape = shapes[shapeKey] || null;\n\t}\n\n\t// find icon by key in the given set of icons\n\tif (iconKey) {\n\t\ticon = options?.icons?.[iconKey] || null;\n\t}\n\n\tif (shape || icon) {\n\t\tbasicShape = false;\n\n\t\t// get anchor positions from definitions, if exist\n\t\tif (shape?.anchorPoint) {\n\t\t\tanchorPositionX = shape.anchorPoint[0];\n\t\t\tanchorPositionY = shape.anchorPoint[1];\n\t\t} else if (!shape && icon?.anchorPoint) {\n\t\t\tanchorPositionX = icon.anchorPoint[0];\n\t\t\tanchorPositionY = icon.anchorPoint[1];\n\t\t}\n\n\t\t// if outline, shift the anchor point\n\t\tif (style?.weight) {\n\t\t\tanchorShift = style?.weight;\n\t\t}\n\t}\n\n\treturn new MarkerShape({\n\t\tbasicShape,\n\t\tid: id,\n\t\tstyle,\n\t\ticonAnchor: style.radius\n\t\t\t? [\n\t\t\t\t\t(2 * style.radius + anchorShift) * anchorPositionX,\n\t\t\t\t\t(2 * style.radius + anchorShift) * anchorPositionY,\n\t\t\t  ]\n\t\t\t: null,\n\t\ticon,\n\t\tshape,\n\t\tonMouseMove: options.onMouseMove,\n\t\tonMouseOut: options.onMouseOut,\n\t\tonMouseOver: options.onMouseOver,\n\t\tonClick: options.onClick,\n\t});\n};\n\n/**\n * Prepare element style by shape\n * @param leafletStyle {Object} Leaflet style definition\n * @return {Object} calculated style object\n */\nconst getMarkerShapeCssStyle = leafletStyle => {\n\tswitch (leafletStyle.shape) {\n\t\tcase 'square':\n\t\t\treturn getMarkerShapeSquareStyle(leafletStyle);\n\t\tcase 'diamond':\n\t\t\treturn getMarkerShapeSquareStyle(leafletStyle, 45);\n\t\tcase 'circle':\n\t\tdefault:\n\t\t\treturn getMarkerShapeCircleStyle(leafletStyle);\n\t}\n};\n\n/**\n * @param leafletStyle {Object} Leaflet style definition\n * @return {Object} calculated style object\n */\nconst getMarkerShapeCircleStyle = leafletStyle => {\n\treturn getMarkerShapeSquareStyle(leafletStyle, null, leafletStyle.radius);\n};\n\n/**\n * @param leafletStyle {Object} Leaflet style definition\n * @param rotation {number}\n * @param borderRadius {number}\n * @return {Object} calculated style object\n */\nconst getMarkerShapeSquareStyle = (leafletStyle, rotation, borderRadius) => {\n\tlet style = {};\n\tif (leafletStyle.radius) {\n\t\tstyle.width = leafletStyle.radius * 2 + 'px';\n\t\tstyle.height = leafletStyle.radius * 2 + 'px';\n\t}\n\n\tif (leafletStyle.fillColor) {\n\t\tif (leafletStyle.fillOpacity && leafletStyle.fillOpacity !== 1) {\n\t\t\tconst rgb = mapStyle.hexToRgb(leafletStyle.fillColor);\n\t\t\tstyle[\n\t\t\t\t'backgroundColor'\n\t\t\t] = `rgba(${rgb.r},${rgb.g},${rgb.b},${leafletStyle.fillOpacity})`;\n\t\t} else {\n\t\t\tstyle['backgroundColor'] = leafletStyle.fillColor;\n\t\t}\n\t}\n\n\tif (leafletStyle.color) {\n\t\tif (leafletStyle.opacity && leafletStyle.opacity !== 1) {\n\t\t\tconst rgb = mapStyle.hexToRgb(leafletStyle.color);\n\t\t\tstyle[\n\t\t\t\t'borderColor'\n\t\t\t] = `rgba(${rgb.r},${rgb.g},${rgb.b},${leafletStyle.opacity})`;\n\t\t} else {\n\t\t\tstyle['borderColor'] = leafletStyle.color;\n\t\t}\n\t}\n\n\tif (leafletStyle.weight) {\n\t\tstyle['borderStyle'] = 'solid';\n\t\tstyle['borderWidth'] = leafletStyle.weight + 'px';\n\t}\n\n\tif (borderRadius) {\n\t\tstyle['borderRadius'] = borderRadius + 'px';\n\t}\n\n\tif (rotation) {\n\t\tstyle.transform = 'rotate(' + rotation + 'deg)';\n\t}\n\n\treturn style;\n};\n\n/**\n * Prepare element style\n * @param leafletStyle {Object} Leaflet style definition\n * @param leafletStyle.color {string} hex code of outline color\n * @param leafletStyle.fillColor {string} hex code of fill color\n * @param leafletStyle.fillOpacity {number} range from 0 to 1, where 0 is transparent and 1 is fully opaque\n * @param leafletStyle.icon {string} icon id\n * @param leafletStyle.iconFill {string} hex code of icon fill color\n * @param leafletStyle.opacity {number} Outline opacity. range from 0 to 1, where 0 is transparent and 1 is fully opaque\n * @param leafletStyle.radius {number} Shape radius is a half of shape height/width\n * @param leafletStyle.shape {string} shape id\n * @param leafletStyle.weight {number} outline width\n * @return {Object} calculated style object suitable for SVG\n */\nconst getMarkerShapeSvgStyle = leafletStyle => {\n\tlet style = {};\n\tif (leafletStyle.radius) {\n\t\tconst size = leafletStyle.radius * 2 + (leafletStyle.weight || 0);\n\t\tstyle.width = size + 'px';\n\t\tstyle.height = size + 'px';\n\t}\n\n\tif (leafletStyle.fillColor) {\n\t\tstyle.fill = leafletStyle.fillColor;\n\t}\n\n\tif (leafletStyle.fillOpacity || leafletStyle.fillOpacity === 0) {\n\t\tstyle.fillOpacity = leafletStyle.fillOpacity;\n\t}\n\n\tif (leafletStyle.color) {\n\t\tstyle.stroke = leafletStyle.color;\n\t}\n\n\tif (leafletStyle.opacity) {\n\t\tstyle.strokeOpacity = leafletStyle.opacity;\n\t}\n\n\tif (leafletStyle.weight) {\n\t\tstyle.strokeWidth = leafletStyle.weight + 'px';\n\t}\n\n\tif (leafletStyle.iconFill) {\n\t\tstyle.iconFill = leafletStyle.iconFill;\n\t}\n\n\treturn style;\n};\n\nexport default {\n\tcalculateStyle,\n\tcalculateStylesMemo,\n\tconvertCoordinatesMemo,\n\n\tgetDefaultStyle,\n\tgetDefaultStyleObject,\n\tgetFeatureAccentedStyle,\n\tgetFeatureDefaultStyle,\n\tgetFeatureLeafletStyle,\n\tgetMarkerShape,\n\tgetMarkerShapeCssStyle,\n\tgetMarkerShapeSvgStyle,\n\tgetSelectedStyleObject,\n};\n","/*\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc, 1.2, 1.3\n  copyright Stanislav Sumbera,  2016-2018, sumbera.com , license MIT\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\n\n  also thanks to contributors: heyyeyheman,andern,nikiv3, anyoneelse ?\n  enjoy !\n*/\n\n// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n//------------------------------------------------------------------------------\nimport * as L from 'leaflet';\nL.DomUtil.setTransform =\n\tL.DomUtil.setTransform ||\n\tfunction (el, offset, scale) {\n\t\tvar pos = offset || new L.Point(0, 0);\n\n\t\tel.style[L.DomUtil.TRANSFORM] =\n\t\t\t(L.Browser.ie3d\n\t\t\t\t? 'translate(' + pos.x + 'px,' + pos.y + 'px)'\n\t\t\t\t: 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\n\t};\n\n// -- support for both  0.0.7 and 1.0.0 rc2 leaflet\nexport const CanvasLayer = (L.Layer ? L.Layer : L.Class).extend({\n\t// -- initialized is called on prototype\n\tinitialize: function (options) {\n\t\tthis._paneName = options.paneName;\n\t\tthis._paneZindex = options.paneZindex;\n\t\tthis._map = null;\n\t\tthis._canvas = null;\n\t\tthis._frame = null;\n\t\tthis._delegate = null;\n\t\tL.setOptions(this, options);\n\t},\n\n\tdelegate: function (del) {\n\t\tthis._delegate = del;\n\t\treturn this;\n\t},\n\n\tneedRedraw: function () {\n\t\tif (!this._frame) {\n\t\t\tthis._frame = L.Util.requestAnimFrame(this.drawLayer, this);\n\t\t}\n\t\treturn this;\n\t},\n\n\t//-------------------------------------------------------------\n\t_onLayerDidResize: function (resizeEvent) {\n\t\tthis._canvas.width = resizeEvent.newSize.x;\n\t\tthis._canvas.height = resizeEvent.newSize.y;\n\t},\n\t//-------------------------------------------------------------\n\t_onLayerDidMove: function (e) {\n\t\tvar topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\t\tif (topLeft.x !== this._topLeft?.x || topLeft.y !== this._topLeft.y) {\n\t\t\tthis._topLeft = topLeft;\n\t\t\tL.DomUtil.setPosition(this._canvas, topLeft);\n\t\t\tthis.drawLayer();\n\t\t}\n\t},\n\t_onLayerDidZoom: function (e) {\n\t\tif (this.props.type !== 'tiledVector') {\n\t\t\tvar topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\t\t\tL.DomUtil.setPosition(this._canvas, topLeft);\n\t\t\tthis.needRedraw();\n\t\t}\n\t},\n\t//-------------------------------------------------------------\n\tgetEvents: function () {\n\t\tvar events = {\n\t\t\tresize: this._onLayerDidResize,\n\t\t\tmoveend: this._onLayerDidMove,\n\t\t\tzoom: this._onLayerDidZoom,\n\t\t};\n\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\n\t\t\tevents.zoomanim = this._animateZoom;\n\t\t}\n\n\t\treturn events;\n\t},\n\t//-------------------------------------------------------------\n\tonAdd: function (map) {\n\t\tthis._map = map;\n\t\tthis._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\n\t\tthis.tiles = {};\n\n\t\tvar size = this._map.getSize();\n\t\tthis._canvas.width = size.x;\n\t\tthis._canvas.height = size.y;\n\n\t\tvar animated = this._map.options.zoomAnimation && L.Browser.any3d;\n\t\tL.DomUtil.addClass(\n\t\t\tthis._canvas,\n\t\t\t'leaflet-zoom-' + (animated ? 'animated' : 'hide')\n\t\t);\n\n\t\tvar topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\t\tL.DomUtil.setPosition(this._canvas, topLeft);\n\n\t\tvar pane = this._map.getPane(this._paneName);\n\t\tif (!pane) {\n\t\t\tpane = this._map.createPane(this._paneName);\n\t\t\tpane.style.zIndex = this._paneZindex;\n\t\t}\n\t\tpane.appendChild(this._canvas);\n\n\t\tmap.on(this.getEvents(), this);\n\n\t\tvar del = this._delegate || this;\n\t\tdel.onLayerDidMount && del.onLayerDidMount(); // -- callback\n\t\tthis.needRedraw();\n\t},\n\n\t//-------------------------------------------------------------\n\tonRemove: function (map) {\n\t\tvar del = this._delegate || this;\n\t\tdel.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\n\n\t\tif (this._frame) {\n\t\t\tL.Util.cancelAnimFrame(this._frame);\n\t\t}\n\n\t\tmap.getPane(this._paneName).removeChild(this._canvas);\n\n\t\tmap.off(this.getEvents(), this);\n\n\t\tthis._canvas = null;\n\t},\n\n\t//------------------------------------------------------------\n\taddTo: function (map) {\n\t\tmap.addLayer(this);\n\t\treturn this;\n\t},\n\t// --------------------------------------------------------------------------------\n\tLatLonToMercator: function (latlon) {\n\t\treturn {\n\t\t\tx: (latlon.lng * 6378137 * Math.PI) / 180,\n\t\t\ty: Math.log(Math.tan(((90 + latlon.lat) * Math.PI) / 360)) * 6378137,\n\t\t};\n\t},\n\n\t//------------------------------------------------------------------------------\n\tdrawLayer: function () {\n\t\tif (this._map) {\n\t\t\tvar size = this._map.getSize();\n\t\t\tvar bounds = this._map.getBounds();\n\t\t\tvar zoom = this._map.getZoom();\n\n\t\t\tvar center = this.LatLonToMercator(this._map.getCenter());\n\t\t\tvar corner = this.LatLonToMercator(\n\t\t\t\tthis._map.containerPointToLatLng(this._map.getSize())\n\t\t\t);\n\n\t\t\tvar del = this._delegate || this;\n\t\t\tdel.onDrawLayer &&\n\t\t\t\tdel.onDrawLayer({\n\t\t\t\t\tlayer: this,\n\t\t\t\t\tcanvas: this._canvas,\n\t\t\t\t\tbounds: bounds,\n\t\t\t\t\tsize: size,\n\t\t\t\t\tzoom: zoom,\n\t\t\t\t\tcenter: center,\n\t\t\t\t\tcorner: corner,\n\t\t\t\t});\n\t\t\tthis._frame = null;\n\t\t}\n\t},\n\t// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n\t//------------------------------------------------------------------------------\n\t_setTransform: function (el, offset, scale) {\n\t\tvar pos = offset || new L.Point(0, 0);\n\n\t\tel.style[L.DomUtil.TRANSFORM] =\n\t\t\t(L.Browser.ie3d\n\t\t\t\t? 'translate(' + pos.x + 'px,' + pos.y + 'px)'\n\t\t\t\t: 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\n\t},\n\n\t//------------------------------------------------------------------------------\n\t_animateZoom: function (e) {\n\t\tvar scale = this._map.getZoomScale(e.zoom);\n\t\t// -- different calc of animation zoom  in leaflet 1.0.3 thanks @peterkarabinovic, @jduggan1\n\t\tvar offset = L.Layer\n\t\t\t? this._map._latLngBoundsToNewLayerBounds(\n\t\t\t\t\tthis._map.getBounds(),\n\t\t\t\t\te.zoom,\n\t\t\t\t\te.center\n\t\t\t  ).min\n\t\t\t: this._map\n\t\t\t\t\t._getCenterOffset(e.center)\n\t\t\t\t\t._multiplyBy(-scale)\n\t\t\t\t\t.subtract(this._map._getMapPanePos());\n\n\t\tL.DomUtil.setTransform(this._canvas, offset, scale);\n\t},\n});\n\nexport default options => {\n\treturn new CanvasLayer(options);\n};\n","import chroma from 'chroma-js';\n\nfunction setPolygonStyle(context, style) {\n\tif (style.fill) {\n\t\tcontext.fillStyle = style.fill;\n\t\tif (style.fillOpacity) {\n\t\t\tcontext.fillStyle = chroma(style.fill).alpha(style.fillOpacity).hex();\n\t\t}\n\n\t\tcontext.fill();\n\t}\n\n\tif (style.outlineColor && style.outlineWidth) {\n\t\tcontext.lineWidth = style.outlineWidth;\n\t\tcontext.strokeStyle = style.outlineColor;\n\t\tif (style.outlineOpacity) {\n\t\t\tcontext.strokeStyle = chroma(style.outlineColor)\n\t\t\t\t.alpha(style.outlineOpacity)\n\t\t\t\t.hex();\n\t\t}\n\n\t\tcontext.lineJoin = 'round';\n\t\tcontext.stroke();\n\t}\n}\n\nfunction setLineStyle(context, style) {\n\tif (style.outlineColor && style.outlineWidth) {\n\t\tcontext.lineWidth = style.outlineWidth;\n\t\tcontext.strokeStyle = style.outlineColor;\n\t\tif (style.outlineOpacity) {\n\t\t\tcontext.strokeStyle = chroma(style.outlineColor)\n\t\t\t\t.alpha(style.outlineOpacity)\n\t\t\t\t.hex();\n\t\t}\n\n\t\tcontext.lineJoin = 'round';\n\t\tcontext.lineCap = 'round';\n\t\tcontext.stroke();\n\t}\n}\n\nfunction getSize(definedSize, pixelSizeInMeters) {\n\tlet size = pixelSizeInMeters ? definedSize / pixelSizeInMeters : definedSize;\n\treturn size < 0.5 ? 0.5 : size;\n}\n\nexport default {\n\tsetLineStyle,\n\tsetPolygonStyle,\n\tgetSize,\n};\n","import helpers from './helpers';\n\n/**\n * Draw shape to the given canvas\n * @param context {Object} canvas context\n * @param center {Object} center point of the shape\n * @param style {Object} Panther style definition\n * @param pixelSizeInMeters {number | null}\n */\nfunction draw(context, center, style, pixelSizeInMeters) {\n\t// TODO add other shapes\n\tif (style.shape === 'square') {\n\t\tsquare(context, center, style, pixelSizeInMeters);\n\t} else {\n\t\tcircle(context, center, style, pixelSizeInMeters);\n\t}\n}\n\nfunction square(context, center, style, pixelSizeInMeters) {\n\tconst size = helpers.getSize(style.size, pixelSizeInMeters);\n\tconst a = 2 * size; // side length\n\tcontext.beginPath();\n\tcontext.rect(center.x - a / 2, center.y - a / 2, a, a);\n\thelpers.setPolygonStyle(context, style);\n\tcontext.closePath();\n}\n\nfunction circle(context, center, style, pixelSizeInMeters) {\n\tcontext.beginPath();\n\tconst size = helpers.getSize(style.size, pixelSizeInMeters);\n\tcontext.arc(Math.floor(center.x), Math.floor(center.y), size, 0, Math.PI * 2);\n\thelpers.setPolygonStyle(context, style);\n\tcontext.closePath();\n}\n\nexport default {\n\tdraw,\n};\n","import helpers from './helpers';\n\n/**\n * Draw shape to the given canvas\n * @param context {Object} canvas context\n * @param coordinates {Array}\n * @param style {Object} Panther style definition\n */\nfunction drawPolygon(context, coordinates, style) {\n\tcontext.beginPath();\n\n\tcoordinates.forEach(linearRing => {\n\t\tconst start = linearRing[0];\n\t\tconst rest = linearRing.slice(1);\n\n\t\tcontext.moveTo(Math.floor(start.x), Math.floor(start.y));\n\t\trest.forEach(point => {\n\t\t\tcontext.lineTo(Math.floor(point.x), Math.floor(point.y));\n\t\t});\n\n\t\tcontext.closePath();\n\t});\n\n\thelpers.setPolygonStyle(context, style);\n}\n\nfunction drawMultiPolygon(context, coordinates, style) {\n\tcoordinates.map(polygon => drawPolygon(context, polygon, style));\n}\n\nexport default {\n\tdrawPolygon,\n\tdrawMultiPolygon,\n};\n","import helpers from './helpers';\n\n/**\n * Draw shape to the given canvas\n * @param context {Object} canvas context\n * @param coordinates {Array}\n * @param style {Object} Panther style definition\n */\nfunction drawLine(context, coordinates, style) {\n\tcontext.beginPath();\n\n\tconst start = coordinates[0];\n\tconst rest = coordinates.slice(1);\n\n\tcontext.moveTo(Math.floor(start.x), Math.floor(start.y));\n\trest.forEach(point => {\n\t\tcontext.lineTo(Math.floor(point.x), Math.floor(point.y));\n\t});\n\n\thelpers.setLineStyle(context, style);\n}\n\nexport default {\n\tdrawLine,\n};\n","import {\n\tforEach as _forEach,\n\tforIn as _forIn,\n\tincludes as _includes,\n\tisArray as _isArray,\n\torderBy as _orderBy,\n} from 'lodash';\n\nimport {point as turfPoint} from '@turf/helpers';\nimport nearestPoint from '@turf/nearest-point';\nimport booleanPointInPolygon from '@turf/boolean-point-in-polygon';\nimport {mapConstants} from '@gisatcz/ptr-core';\n\nimport helpers from '../SvgVectorLayer/helpers';\nimport {CanvasLayer} from './genericCanvasLayer';\nimport shapes from './shapes/shapes';\nimport polygons from './shapes/polygons';\nimport lines from './shapes/lines';\nimport * as L from 'leaflet';\n\nconst LeafletCanvasLayer = CanvasLayer.extend({\n\tonLayerDidMount: function () {\n\t\tthis.customEvents = {\n\t\t\tclick: this.onLayerClick,\n\t\t};\n\t\tthis._map.on(this.customEvents, this);\n\t},\n\n\tonLayerWillUnmount: function () {\n\t\tthis._map.off(this.customEvents, this);\n\t},\n\n\tboundsToQuery: function (bounds) {\n\t\treturn {\n\t\t\tlat: bounds.getSouthWest().lat,\n\t\t\tlng: bounds.getSouthWest().lng,\n\t\t\twidth: bounds.getNorthEast().lat - bounds.getSouthWest().lat,\n\t\t\theight: bounds.getNorthEast().lng - bounds.getSouthWest().lng,\n\t\t};\n\t},\n\n\tisPointInsideBounds: function (lat, lng, bounds) {\n\t\treturn (\n\t\t\tlat >= bounds.lat &&\n\t\t\tlat <= bounds.lat + bounds.width &&\n\t\t\tlng >= bounds.lng &&\n\t\t\tlng <= bounds.lng + bounds.height\n\t\t);\n\t},\n\n\tonLayerClick: function (e) {\n\t\tif (this.props.selectable) {\n\t\t\tvar pointsInsideBounds = [];\n\t\t\tvar selectedPolygons = [];\n\t\t\tvar mousePoint = e.containerPoint;\n\n\t\t\tconst self = this;\n\n\t\t\t// TODO breakable loop?\n\t\t\tif (_isArray(this.features)) {\n\t\t\t\tthis.features.forEach(feature => {\n\t\t\t\t\tconst type = feature.original.geometry.type;\n\t\t\t\t\tif (type === 'Point') {\n\t\t\t\t\t\tconst radius = feature.defaultStyle.size;\n\t\t\t\t\t\tvar LatLngBounds = L.latLngBounds(\n\t\t\t\t\t\t\tthis._map.containerPointToLatLng(\n\t\t\t\t\t\t\t\tmousePoint.add(L.point(radius, radius))\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tthis._map.containerPointToLatLng(\n\t\t\t\t\t\t\t\tmousePoint.subtract(L.point(radius, radius))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tvar BoundingBox = this.boundsToQuery(LatLngBounds);\n\t\t\t\t\t\tvar coordinates = feature.original.geometry.coordinates;\n\t\t\t\t\t\tvar lat = coordinates[1];\n\t\t\t\t\t\tvar lng = coordinates[0];\n\n\t\t\t\t\t\tif (self.isPointInsideBounds(lat, lng, BoundingBox)) {\n\t\t\t\t\t\t\tpointsInsideBounds.push(feature.original);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (type === 'Polygon' || type === 'MultiPolygon') {\n\t\t\t\t\t\tconst point = this._map.containerPointToLatLng(\n\t\t\t\t\t\t\tL.point(mousePoint.x, mousePoint.y)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst pointFeature = turfPoint([point.lng, point.lat]);\n\t\t\t\t\t\tconst insidePolygon = booleanPointInPolygon(\n\t\t\t\t\t\t\tpointFeature,\n\t\t\t\t\t\t\tfeature.original.geometry\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (insidePolygon) {\n\t\t\t\t\t\t\tselectedPolygons.push(feature);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// select single point\n\t\t\t\tif (pointsInsideBounds.length) {\n\t\t\t\t\tconst position = this._map.containerPointToLatLng(mousePoint);\n\t\t\t\t\tconst nearest = nearestPoint(\n\t\t\t\t\t\tturfPoint([position.lng, position.lat]),\n\t\t\t\t\t\t{type: 'FeatureCollection', features: pointsInsideBounds}\n\t\t\t\t\t);\n\t\t\t\t\tself.props.onClick(self.props.layerKey, [\n\t\t\t\t\t\tnearest.properties[self.props.fidColumnName],\n\t\t\t\t\t]);\n\t\t\t\t} else if (selectedPolygons.length) {\n\t\t\t\t\tself.props.onClick(self.props.layerKey, [\n\t\t\t\t\t\tselectedPolygons[0].original.properties[self.props.fidColumnName],\n\t\t\t\t\t]);\n\t\t\t\t}\n\n\t\t\t\t// TODO select single line\n\t\t\t}\n\t\t}\n\t},\n\n\tsetProps: function (data) {\n\t\tthis.props = data;\n\t\tthis.features = this.prepareFeatures(data.features);\n\t\tthis.needRedraw();\n\t},\n\n\tprepareFeatures: function (features) {\n\t\tconst props = this.props;\n\t\tlet pointFeatures = [];\n\t\tlet polygonFeatures = [];\n\t\tlet lineFeatures = [];\n\n\t\t_forEach(features, feature => {\n\t\t\tconst type = feature && feature.geometry && feature.geometry.type;\n\t\t\tconst fid =\n\t\t\t\tfeature.id ||\n\t\t\t\t(props.fidColumnName && feature.properties[props.fidColumnName]);\n\t\t\tconst defaultStyle = helpers.getDefaultStyleObject(feature, props.style);\n\n\t\t\tlet preparedFeature = {\n\t\t\t\toriginal: feature,\n\t\t\t\tdefaultStyle,\n\t\t\t\tfid,\n\t\t\t};\n\n\t\t\tif (props.selected && fid) {\n\t\t\t\t_forIn(props.selected, (selection, key) => {\n\t\t\t\t\tif (selection.keys && _includes(selection.keys, fid)) {\n\t\t\t\t\t\tpreparedFeature.selected = true;\n\t\t\t\t\t\tpreparedFeature.selectedStyle = {\n\t\t\t\t\t\t\t...defaultStyle,\n\t\t\t\t\t\t\t...helpers.getSelectedStyleObject(selection.style),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// TODO add support for multipoints and multilines\n\t\t\tif (type === 'Point') {\n\t\t\t\tpointFeatures.push(preparedFeature);\n\t\t\t} else if (type === 'Polygon' || type === 'MultiPolygon') {\n\t\t\t\tpolygonFeatures.push(preparedFeature);\n\t\t\t} else if (type === 'LineString') {\n\t\t\t\tlineFeatures.push(preparedFeature);\n\t\t\t}\n\t\t});\n\n\t\t// TODO what if diferrent geometry types in one layer?\n\t\tif (pointFeatures.length) {\n\t\t\treturn _orderBy(\n\t\t\t\tpointFeatures,\n\t\t\t\t['defaultStyle.size', 'fid'],\n\t\t\t\t['desc', 'asc']\n\t\t\t);\n\t\t} else if (polygonFeatures.length) {\n\t\t\tif (props.selected) {\n\t\t\t\treturn _orderBy(polygonFeatures, ['selected'], ['desc']);\n\t\t\t} else {\n\t\t\t\treturn polygonFeatures;\n\t\t\t}\n\t\t} else if (lineFeatures.length) {\n\t\t\tif (props.selected) {\n\t\t\t\treturn _orderBy(lineFeatures, ['selected'], ['desc']);\n\t\t\t} else {\n\t\t\t\treturn lineFeatures;\n\t\t\t}\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t},\n\n\tonDrawLayer: function (params) {\n\t\tlet context = params.canvas.getContext('2d');\n\t\tcontext.clearRect(0, 0, params.canvas.width, params.canvas.height);\n\t\tif (this.features) {\n\t\t\t// clear whole layer\n\t\t\tcontext.drawImage(this.renderOffScreen(params), 0, 0);\n\t\t}\n\t},\n\n\trenderOffScreen: function (params) {\n\t\tlet pixelSizeInMeters = null;\n\t\tvar offScreenCanvas = document.createElement('canvas');\n\t\toffScreenCanvas.width = params.canvas.width;\n\t\toffScreenCanvas.height = params.canvas.height;\n\t\tvar context = offScreenCanvas.getContext('2d');\n\n\t\tif (!params.layer.props.pointAsMarker) {\n\t\t\tpixelSizeInMeters = mapConstants.getPixelSizeInLevelsForLatitude(\n\t\t\t\tmapConstants.pixelSizeInLevels,\n\t\t\t\t0\n\t\t\t)[params.zoom];\n\t\t}\n\n\t\t// redraw all features\n\t\tfor (let i = 0; i < this.features.length; i++) {\n\t\t\tconst feature = this.features[i];\n\t\t\tconst omitFeature =\n\t\t\t\tthis.props.omittedFeatureKeys?.length &&\n\t\t\t\t_includes(this.props.omittedFeatureKeys, feature.fid);\n\n\t\t\tif (!omitFeature) {\n\t\t\t\tthis.drawFeature(\n\t\t\t\t\tcontext,\n\t\t\t\t\tparams.layer,\n\t\t\t\t\tparams.canvas,\n\t\t\t\t\tfeature,\n\t\t\t\t\tpixelSizeInMeters\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn offScreenCanvas;\n\t},\n\n\t/**\n\t * @param ctx {Object} Canvas context\n\t * @param layer {Object}\n\t * @param canvas {Object}\n\t * @param feature {Object} Feature data\n\t * @param pixelSizeInMeters {number | null}\n\t */\n\tdrawFeature: function (ctx, layer, canvas, feature, pixelSizeInMeters) {\n\t\tconst geometry = feature.original.geometry;\n\t\tconst type = geometry.type;\n\n\t\t// TODO multipoints multilines\n\t\tif (type === 'Point') {\n\t\t\tconst coordinates = geometry.coordinates;\n\t\t\tconst center = layer._map.latLngToContainerPoint([\n\t\t\t\tcoordinates[1],\n\t\t\t\tcoordinates[0],\n\t\t\t]);\n\n\t\t\tif (\n\t\t\t\tcenter.x >= 0 &&\n\t\t\t\tcenter.y >= 0 &&\n\t\t\t\tcenter.x <= canvas.width &&\n\t\t\t\tcenter.y <= canvas.height\n\t\t\t) {\n\t\t\t\tlet style = feature.defaultStyle;\n\n\t\t\t\tif (feature.selected) {\n\t\t\t\t\tstyle = feature.selectedStyle;\n\t\t\t\t}\n\n\t\t\t\tshapes.draw(ctx, center, style, pixelSizeInMeters);\n\t\t\t}\n\t\t} else if (type === 'Polygon' || type === 'MultiPolygon') {\n\t\t\tlet coordinates = null;\n\t\t\tlet style = feature.defaultStyle;\n\n\t\t\tif (feature.selected) {\n\t\t\t\tstyle = feature.selectedStyle;\n\t\t\t}\n\n\t\t\tif (type === 'Polygon') {\n\t\t\t\tcoordinates = this.getPolygonCoordinates(geometry.coordinates, layer);\n\t\t\t\tpolygons.drawPolygon(ctx, coordinates, style);\n\t\t\t} else {\n\t\t\t\tcoordinates = geometry.coordinates.map(polygon =>\n\t\t\t\t\tthis.getPolygonCoordinates(polygon, layer)\n\t\t\t\t);\n\t\t\t\tpolygons.drawMultiPolygon(ctx, coordinates, style);\n\t\t\t}\n\t\t} else if (type === 'LineString') {\n\t\t\tlet coordinates = null;\n\t\t\tlet style = feature.defaultStyle;\n\n\t\t\tif (feature.selected) {\n\t\t\t\tstyle = feature.selectedStyle;\n\t\t\t}\n\n\t\t\tcoordinates = this.getLineCoordinates(geometry.coordinates, layer);\n\t\t\tlines.drawLine(ctx, coordinates, style);\n\t\t}\n\t},\n\n\tgetPolygonCoordinates: function (polygon, layer) {\n\t\treturn polygon.map(linearRing =>\n\t\t\tthis.getLineCoordinates(linearRing, layer)\n\t\t);\n\t},\n\n\tgetLineCoordinates: function (line, layer) {\n\t\treturn line.map(coordinates => {\n\t\t\t// TODO do not add the same points again?\n\t\t\treturn layer._map.latLngToContainerPoint([\n\t\t\t\tcoordinates[1],\n\t\t\t\tcoordinates[0],\n\t\t\t]);\n\t\t});\n\t},\n});\n\nexport default LeafletCanvasLayer;\n","import {MapLayer, withLeaflet} from 'react-leaflet';\nimport LeafletCanvasLayer from './LeafletCanvasLayer';\n\nclass CanvasVectorLayer extends MapLayer {\n\tcreateLeafletElement(props) {\n\t\tlet layer = new LeafletCanvasLayer({\n\t\t\tpaneName: props.uniqueLayerKey,\n\t\t\tpaneZindex: props.zIndex,\n\t\t});\n\t\tlayer.setProps(props);\n\t\treturn layer;\n\t}\n\n\tupdateLeafletElement(fromProps, toProps) {\n\t\tsuper.updateLeafletElement(fromProps, toProps);\n\n\t\t// TODO\n\t\tif (\n\t\t\tfromProps.selected !== toProps.selected ||\n\t\t\tfromProps.features !== toProps.features ||\n\t\t\tfromProps.style !== toProps.style ||\n\t\t\tfromProps.omittedFeatureKeys !== this.props.omittedFeatureKeys\n\t\t) {\n\t\t\tthis.leafletElement.setProps(toProps);\n\t\t}\n\t}\n}\n\nexport default withLeaflet(CanvasVectorLayer);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport memoize from 'memoize-one';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport {mapConstants} from '@gisatcz/ptr-core';\n\nconst geojsonRbush = require('geojson-rbush').default;\n\nfunction getBoundingBox(view, width, height, crs, optLat) {\n\t// TODO extent calculations for non-mercator projections\n\tif (!crs || crs === 'EPSG:3857') {\n\t\tlet boxRange = view.boxRange;\n\n\t\t// view.boxRange may differ from actual rance visible in map because of levels\n\t\tconst calculatedBoxRange = mapUtils.view.getNearestZoomLevelBoxRange(\n\t\t\twidth,\n\t\t\theight,\n\t\t\tview.boxRange\n\t\t);\n\n\t\tif (boxRange !== calculatedBoxRange) {\n\t\t\tboxRange = calculatedBoxRange;\n\t\t}\n\n\t\treturn mapUtils.view.getBoundingBoxFromViewForEpsg3857(\n\t\t\tview.center,\n\t\t\tboxRange,\n\t\t\twidth / height,\n\t\t\toptLat\n\t\t);\n\t} else {\n\t\treturn {\n\t\t\tminLat: -90,\n\t\t\tmaxLat: 90,\n\t\t\tminLon: -180,\n\t\t\tmaxLon: 180,\n\t\t};\n\t}\n}\n\nclass IndexedVectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tboxRangeRange: PropTypes.array,\n\t\tcomponent: PropTypes.oneOfType([PropTypes.func, PropTypes.object]),\n\t\tomittedFeatureKeys: PropTypes.array,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\trerender: null,\n\t\t};\n\n\t\tthis.indexTree = geojsonRbush();\n\t\tthis.repopulateIndexTreeIfNeeded = memoize(features => {\n\t\t\tif (features) {\n\t\t\t\tthis.indexTree.clear();\n\t\t\t\tthis.indexTree.load(features);\n\t\t\t}\n\t\t});\n\t}\n\n\tboxRangeFitsLimits() {\n\t\tconst props = this.props;\n\t\tif (props.boxRangeRange) {\n\t\t\tconst minBoxRange = props.boxRangeRange[0];\n\t\t\tconst maxBoxRange = props.boxRangeRange[1];\n\t\t\tif (minBoxRange && maxBoxRange) {\n\t\t\t\treturn (\n\t\t\t\t\tminBoxRange <= props.view.boxRange &&\n\t\t\t\t\tmaxBoxRange >= props.view.boxRange\n\t\t\t\t);\n\t\t\t} else if (minBoxRange) {\n\t\t\t\treturn minBoxRange <= props.view.boxRange;\n\t\t\t} else if (maxBoxRange) {\n\t\t\t\treturn maxBoxRange >= props.view.boxRange;\n\t\t\t}\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {view, zoom, component, width, height, crs, ...props} = this.props;\n\n\t\tif (props.features && this.boxRangeFitsLimits()) {\n\t\t\tthis.repopulateIndexTreeIfNeeded(props.features);\n\t\t\tconst bbox = getBoundingBox(\n\t\t\t\tview,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\tcrs,\n\t\t\t\tmapConstants.averageLatitude\n\t\t\t);\n\t\t\tconst geoJsonBbox = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tbbox: [bbox.minLon, bbox.minLat, bbox.maxLon, bbox.maxLat],\n\t\t\t};\n\n\t\t\t// Find features in given bounding box\n\t\t\tconst foundFeatureCollection = this.indexTree.search(geoJsonBbox);\n\t\t\tconst foundFeatures =\n\t\t\t\t(foundFeatureCollection && foundFeatureCollection.features) || [];\n\n\t\t\t// Add filtered features only to Vector layer\n\t\t\tif (props.features.length !== foundFeatures.length) {\n\t\t\t\tprops.features = foundFeatures;\n\t\t\t}\n\n\t\t\treturn React.createElement(component, props);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport default IndexedVectorLayer;\n","import React from 'react';\n\nimport Context from '@gisatcz/cross-package-react-context';\nimport {indexOf as _indexOf} from 'lodash';\nconst HoverContext = Context.getContext('HoverContext');\n\nexport default function contextWrapper(WrappedFeature) {\n\treturn class extends React.PureComponent {\n\t\tstatic contextType = HoverContext;\n\n\t\tconstructor(props) {\n\t\t\tsuper(props);\n\n\t\t\tthis.hoveredFromContext = false;\n\t\t\tthis.changeContext = this.changeContext.bind(this);\n\t\t}\n\n\t\tchangeContext(hoveredItems, options) {\n\t\t\tif (hoveredItems && this.context && this.context.onHover) {\n\t\t\t\tthis.context.onHover(hoveredItems, options);\n\t\t\t} else if (!hoveredItems && this.context && this.context.onHoverOut) {\n\t\t\t\tthis.context.onHoverOut();\n\t\t\t}\n\t\t}\n\n\t\trender() {\n\t\t\tif (this.props.fid && this.context && this.context.hoveredItems) {\n\t\t\t\tthis.hoveredFromContext =\n\t\t\t\t\t_indexOf(this.context.hoveredItems, this.props.fid) !== -1;\n\t\t\t}\n\n\t\t\t// TODO interactive without context case?\n\t\t\tif (this.context && this.props.hoverable) {\n\t\t\t\treturn (\n\t\t\t\t\t<WrappedFeature\n\t\t\t\t\t\t{...this.props}\n\t\t\t\t\t\tchangeContext={this.changeContext}\n\t\t\t\t\t\thoveredFromContext={this.hoveredFromContext}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn <WrappedFeature {...this.props} />;\n\t\t\t}\n\t\t}\n\t};\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Circle, Polygon, Marker, Polyline} from 'react-leaflet';\nimport {shallowEqualObjects} from 'shallow-equal';\nimport {utils} from '@gisatcz/ptr-utils';\n\nimport ContextWrapper from './ContextWrapper';\nimport helpers from '../helpers';\n\nclass Feature extends React.PureComponent {\n\tstatic propTypes = {\n\t\tfeature: PropTypes.object,\n\t\tfid: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n\t\tfidColumnName: PropTypes.string,\n\t\thoverable: PropTypes.bool,\n\t\thoveredFromContext: PropTypes.bool,\n\t\thoveredStyleDefinition: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object,\n\t\t]),\n\t\tselectable: PropTypes.bool,\n\t\tselected: PropTypes.bool,\n\t\tselectedStyleDefinition: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object,\n\t\t]),\n\t\tselectedHoveredStyleDefinition: PropTypes.oneOfType([\n\t\t\tPropTypes.string,\n\t\t\tPropTypes.object,\n\t\t]),\n\t\tchangeContext: PropTypes.func,\n\t\tinteractive: PropTypes.bool,\n\t\tstyleDefinition: PropTypes.object,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this);\n\t\tthis.onMouseOut = this.onMouseOut.bind(this);\n\t\tthis.onAdd = this.onAdd.bind(this);\n\n\t\tthis.fid = props.fid;\n\n\t\tif (props.type === 'Point' && props.pointAsMarker) {\n\t\t\tthis.shapeId = this.props.uniqueFeatureKey\n\t\t\t\t? `${this.props.uniqueFeatureKey}_icon`\n\t\t\t\t: utils.uuid();\n\t\t}\n\n\t\tthis.state = {\n\t\t\thovered: false,\n\t\t};\n\n\t\tthis.calculateStyles = helpers.calculateStylesMemo;\n\t\tthis.convertCoordinates = helpers.convertCoordinatesMemo;\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (this.props.hasOwnProperty('hoveredFromContext')) {\n\t\t\tif (this.props.hoveredFromContext && !this.state.hovered) {\n\t\t\t\tthis.showOnTop();\n\t\t\t\tthis.setState({hovered: true});\n\t\t\t} else if (!this.props.hoveredFromContext && this.state.hovered) {\n\t\t\t\tif (!this.props.selected) {\n\t\t\t\t\tthis.showOnBottom();\n\t\t\t\t}\n\t\t\t\tthis.setState({hovered: false});\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (this.props.changeContext) {\n\t\t\tthis.props.changeContext(null);\n\t\t}\n\t}\n\n\tonAdd(event) {\n\t\tif (event.target) {\n\t\t\tthis.leafletFeature = event.target;\n\t\t}\n\t}\n\n\tonClick() {\n\t\tif (this.props.selectable) {\n\t\t\tthis.showOnTop();\n\n\t\t\tif (this.props.onClick && this.props.fid) {\n\t\t\t\tthis.props.onClick(this.props.fid);\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseMove(event) {\n\t\tif (this.props.hoverable) {\n\t\t\tthis.showOnTop();\n\n\t\t\tif (this.fid && this.props.changeContext) {\n\t\t\t\tthis.props.changeContext([this.fid], {\n\t\t\t\t\tpopup: {\n\t\t\t\t\t\tx: event.originalEvent ? event.originalEvent.pageX : event.pageX,\n\t\t\t\t\t\ty: event.originalEvent ? event.originalEvent.pageY : event.pageY,\n\t\t\t\t\t\tfidColumnName: this.props.fidColumnName,\n\t\t\t\t\t\tdata: this.props.feature.properties,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.state.hovered) {\n\t\t\t\tthis.setState({hovered: true});\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseOut() {\n\t\tif (this.props.hoverable) {\n\t\t\tif (!this.props.selected) {\n\t\t\t\tthis.showOnBottom();\n\t\t\t}\n\n\t\t\tif (this.props.changeContext) {\n\t\t\t\tthis.props.changeContext(null);\n\t\t\t}\n\n\t\t\tthis.setState({hovered: false});\n\t\t}\n\t}\n\n\t/**\n\t * Show feature on the top of others, if it's not a point\n\t */\n\tshowOnTop() {\n\t\tif (this.leafletFeature && this.props.type !== 'Point') {\n\t\t\tthis.leafletFeature.bringToFront();\n\t\t}\n\t}\n\n\t/**\n\t * Show feature in the bottom, if it's a polygon\n\t */\n\tshowOnBottom() {\n\t\tif (\n\t\t\tthis.leafletFeature &&\n\t\t\t(this.props.type === 'Polygon' || this.props.type === 'MultiPolygon')\n\t\t) {\n\t\t\tthis.leafletFeature.bringToBack();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst props = this.props;\n\t\tconst coordinates = this.convertCoordinates(props.feature);\n\t\tconst styles = this.calculateStyles(\n\t\t\tprops.feature,\n\t\t\tprops.styleDefinition,\n\t\t\tprops.hoveredStyleDefinition,\n\t\t\tprops.selected,\n\t\t\tprops.selectedStyleDefinition,\n\t\t\tprops.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tlet style = styles.default;\n\n\t\tif (props.selected && this.state.hovered && styles.selectedHovered) {\n\t\t\tstyle = styles.selectedHovered;\n\t\t} else if (this.state.hovered && styles.hovered) {\n\t\t\tstyle = styles.hovered;\n\t\t} else if (props.selected && styles.selected) {\n\t\t\tstyle = styles.selected;\n\t\t}\n\n\t\t// TODO add support for other geometry types\n\t\tswitch (this.props.type) {\n\t\t\tcase 'Polygon':\n\t\t\tcase 'MultiPolygon':\n\t\t\t\treturn this.renderPolygon(coordinates, style);\n\t\t\tcase 'Point':\n\t\t\tcase 'MultiPoint':\n\t\t\t\treturn this.renderPoint(coordinates, style);\n\t\t\tcase 'LineString':\n\t\t\tcase 'MultiLineString':\n\t\t\t\treturn this.renderLine(coordinates, style);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\trenderPolygon(coordinates, style) {\n\t\treturn (\n\t\t\t<Polygon\n\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\tonAdd={this.onAdd}\n\t\t\t\tonClick={this.onClick}\n\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\tpositions={coordinates}\n\t\t\t\t{...style}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderLine(coordinates, style) {\n\t\treturn (\n\t\t\t<Polyline\n\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\tonAdd={this.onAdd}\n\t\t\t\tonClick={this.onClick}\n\t\t\t\tonMouseOver={this.onMouseMove}\n\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\tpositions={coordinates}\n\t\t\t\t{...style}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderPoint(coordinates, style) {\n\t\tif (this.props.pointAsMarker) {\n\t\t\treturn this.renderShape(coordinates, style);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<Circle\n\t\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\t\tonAdd={this.onAdd}\n\t\t\t\t\tonClick={this.onClick}\n\t\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\t\tonMouseOver={this.onMouseMove}\n\t\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\t\tcenter={coordinates}\n\t\t\t\t\t{...style}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n\n\trenderShape(coordinates, style) {\n\t\tif (!this.shape) {\n\t\t\tthis.shape = helpers.getMarkerShape(this.shapeId, style, {\n\t\t\t\ticons: this.props.icons,\n\t\t\t\tonMouseMove: this.onMouseMove,\n\t\t\t\tonMouseOver: this.onMouseMove,\n\t\t\t\tonMouseOut: this.onMouseOut,\n\t\t\t\tonClick: this.onClick,\n\t\t\t});\n\t\t}\n\n\t\tif (!shallowEqualObjects(this.style, style)) {\n\t\t\tthis.style = style;\n\t\t\tthis.shape.setStyle(style, this.shapeId, this.shape.basicShape);\n\t\t}\n\n\t\treturn (\n\t\t\t<Marker\n\t\t\t\tinteractive={this.props.hoverable || this.props.selectable}\n\t\t\t\tposition={coordinates}\n\t\t\t\ticon={this.shape}\n\t\t\t\tonAdd={this.onAdd}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default ContextWrapper(Feature);\n","import React from 'react';\nimport {includes as _includes} from 'lodash';\nimport PropTypes from 'prop-types';\nimport {utils} from '@gisatcz/ptr-utils';\nimport {GeoJSON, withLeaflet} from 'react-leaflet';\nimport L from 'leaflet';\nimport helpers from '../helpers';\nimport memoize from 'memoize-one';\n\nclass GeoJsonLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tomittedFeatureKeys: PropTypes.array, // list of feature keys that shouldn't be rendered\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getStyle = this.getStyle.bind(this);\n\t\tthis.filter = this.filter.bind(this);\n\t\tthis.onEachFeature = this.onEachFeature.bind(this);\n\t\tthis.pointToLayer = this.pointToLayer.bind(this);\n\n\t\tthis.getRenderId = memoize(features => {\n\t\t\tif (features) {\n\t\t\t\treturn utils.uuid();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetStyle(feature) {\n\t\tconst styles = helpers.calculateStyle(\n\t\t\tfeature.feature,\n\t\t\tthis.props.styleDefinition,\n\t\t\tthis.props.hoveredStyleDefinition,\n\t\t\tfeature.selected,\n\t\t\tfeature.selectedStyleDefinition,\n\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tif (feature.selected) {\n\t\t\treturn styles.selected;\n\t\t} else {\n\t\t\treturn styles.default;\n\t\t}\n\t}\n\n\tonEachFeature(feature, layer) {\n\t\tconst geometryType = feature.geometry.type;\n\t\tconst isPolygon =\n\t\t\tgeometryType === 'Polygon' || geometryType === 'MultiPolygon';\n\t\tconst isLine = geometryType === 'Line' || geometryType === 'LineString';\n\n\t\tconst styles = helpers.calculateStyle(\n\t\t\tfeature.feature,\n\t\t\tthis.props.styleDefinition,\n\t\t\tthis.props.hoveredStyleDefinition,\n\t\t\tfeature.selected,\n\t\t\tfeature.selectedStyleDefinition,\n\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tlayer.on({\n\t\t\tclick: e => {\n\t\t\t\tif (this.props.onFeatureClick && this.props.selectable && feature.fid) {\n\t\t\t\t\tthis.props.onFeatureClick(feature.fid);\n\t\t\t\t}\n\t\t\t},\n\t\t\tmousemove: e => {\n\t\t\t\tif (this.props.hoverable) {\n\t\t\t\t\tif (feature.selected && styles.selectedHovered) {\n\t\t\t\t\t\tthis.setStyle(styles.selectedHovered, e.target);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setStyle(styles.hovered, e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isPolygon || isLine) {\n\t\t\t\t\t\tlayer.bringToFront();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmouseout: e => {\n\t\t\t\tif (this.props.hoverable) {\n\t\t\t\t\tif (feature.selected && styles.selected) {\n\t\t\t\t\t\tthis.setStyle(styles.selected, e.target);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setStyle(styles.default, e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((isLine || isPolygon) && !feature.selected) {\n\t\t\t\t\t\tlayer.bringToBack();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Set style of the feature\n\t * @param leafletStyle {Object} Leaflet style definition\n\t * @param element {Object} Leaflet element\n\t */\n\tsetStyle(leafletStyle, element) {\n\t\tconst shape = element?.options?.icon;\n\t\tif (shape) {\n\t\t\tshape.setStyle(leafletStyle, shape.id, shape.isBasicShape);\n\t\t} else {\n\t\t\telement.setStyle(leafletStyle);\n\t\t}\n\t}\n\n\t// render points\n\tpointToLayer(feature, coord) {\n\t\tif (this.props.pointAsMarker) {\n\t\t\tlet style = feature.defaultStyle;\n\n\t\t\t// for circles, use L.circleMarker due to better performance\n\t\t\tif ((!style?.shape && !style?.icon) || style?.shape === 'circle') {\n\t\t\t\treturn L.circleMarker(coord, {\n\t\t\t\t\t...feature.defaultStyle,\n\t\t\t\t\tpane: this.props.paneName,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (feature.selected) {\n\t\t\t\t\tconst styles = helpers.calculateStyle(\n\t\t\t\t\t\tfeature.feature,\n\t\t\t\t\t\tthis.props.styleDefinition,\n\t\t\t\t\t\tthis.props.hoveredStyleDefinition,\n\t\t\t\t\t\tfeature.selected,\n\t\t\t\t\t\tfeature.selectedStyleDefinition,\n\t\t\t\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t\t\t\t);\n\t\t\t\t\tstyle = styles.selected;\n\t\t\t\t}\n\n\t\t\t\tconst shapeId = feature.uniqueFeatureKey\n\t\t\t\t\t? `${feature.uniqueFeatureKey}_icon`\n\t\t\t\t\t: utils.uuid();\n\t\t\t\tconst shape = helpers.getMarkerShape(shapeId, style, {\n\t\t\t\t\ticons: this.props.icons,\n\t\t\t\t});\n\n\t\t\t\treturn L.marker(coord, {\n\t\t\t\t\tpane: this.props.paneName,\n\t\t\t\t\tinteractive: this.props.hoverable || this.props.selectable,\n\t\t\t\t\ticon: shape,\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\treturn L.circle(coord, feature.defaultStyle);\n\t\t}\n\t}\n\n\tfilter(feature) {\n\t\tif (this.props.omittedFeatureKeys) {\n\t\t\tconst featureKey =\n\t\t\t\tfeature.id || feature.properties[this.props.fidColumnName];\n\t\t\treturn !(\n\t\t\t\tfeatureKey && _includes(this.props.omittedFeatureKeys, featureKey)\n\t\t\t);\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\trender() {\n\t\tconst features = this.props.features.map(item => {\n\t\t\treturn {...item.feature, ...item};\n\t\t});\n\n\t\t// generate new key on features change to return the new instance\n\t\t// more: https://react-leaflet.js.org/docs/en/components#geojson\n\t\tconst key = this.getRenderId(this.props.features);\n\n\t\treturn (\n\t\t\t<GeoJSON\n\t\t\t\tkey={key}\n\t\t\t\tdata={features}\n\t\t\t\tstyle={this.getStyle}\n\t\t\t\tonEachFeature={this.onEachFeature}\n\t\t\t\tpointToLayer={this.pointToLayer}\n\t\t\t\tfilter={this.filter}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default withLeaflet(GeoJsonLayer);\n","import React from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\nimport {\n\tforEach as _forEach,\n\tforIn as _forIn,\n\tincludes as _includes,\n\torderBy as _orderBy,\n} from 'lodash';\nimport {utils} from '@gisatcz/ptr-utils';\nimport {Pane} from 'react-leaflet';\n\nimport helpers from './helpers';\nimport Feature from './Feature';\nimport constants from '../../../constants';\nimport GeoJsonLayer from './GeoJsonLayer';\n\nclass SvgVectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.string, // typically a combination of layerKey and data source key (or just layerKey, if no data source)\n\t\trenderAsGeoJson: PropTypes.bool, // Use Leaflet's GeoJSON layer to render vector features\n\t\tfeatures: PropTypes.array,\n\t\tfidColumnName: PropTypes.string,\n\t\tomittedFeatureKeys: PropTypes.array,\n\t\tselectable: PropTypes.bool,\n\t\tselected: PropTypes.object,\n\t\thoverable: PropTypes.bool,\n\t\thovered: PropTypes.object,\n\t\tstyle: PropTypes.object,\n\t\tpointAsMarker: PropTypes.bool,\n\t\tonClick: PropTypes.func,\n\t\twithSelectedFeaturesOnly: PropTypes.bool, // True, if layer contains only selected features\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.pointsPaneName = utils.uuid();\n\t\tthis.linesPaneName = utils.uuid();\n\t\tthis.polygonsPaneName = utils.uuid();\n\t\tthis.onFeatureClick = this.onFeatureClick.bind(this);\n\t}\n\n\tonFeatureClick(fid) {\n\t\tif (this.props.onClick) {\n\t\t\tthis.props.onClick(this.props.layerKey, [fid]);\n\t\t}\n\t}\n\n\tprepareData(features) {\n\t\tif (features) {\n\t\t\tlet pointFeatures = [];\n\t\t\tlet polygonFeatures = [];\n\t\t\tlet lineFeatures = [];\n\n\t\t\tlet sortedPointFeatures = null;\n\t\t\tlet sortedPolygonFeatures = null;\n\n\t\t\t_forEach(features, feature => {\n\t\t\t\tconst type = feature && feature.geometry && feature.geometry.type;\n\n\t\t\t\tif (type) {\n\t\t\t\t\tconst fid =\n\t\t\t\t\t\tthis.props.fidColumnName &&\n\t\t\t\t\t\tfeature.properties[this.props.fidColumnName];\n\t\t\t\t\tconst uniqueFeatureKey = `${this.props.uniqueLayerKey}_${fid}`;\n\n\t\t\t\t\tlet selected = null;\n\t\t\t\t\tlet defaultStyle = null;\n\n\t\t\t\t\tif (this.props.selected && fid) {\n\t\t\t\t\t\t_forIn(this.props.selected, (selection, key) => {\n\t\t\t\t\t\t\tif (selection.keys && _includes(selection.keys, fid)) {\n\t\t\t\t\t\t\t\tselected = selection;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === 'Point' || type === 'MultiPoint') {\n\t\t\t\t\t\tdefaultStyle = helpers.getDefaultStyle(feature, this.props.style);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst data = {\n\t\t\t\t\t\tfeature,\n\t\t\t\t\t\tfid,\n\t\t\t\t\t\tuniqueFeatureKey,\n\t\t\t\t\t\tdefaultStyle,\n\t\t\t\t\t\tselected: !!selected,\n\t\t\t\t\t\tselectedStyleDefinition: selected?.style,\n\t\t\t\t\t\tselectedHoveredStyleDefinition: selected?.hoveredStyle,\n\t\t\t\t\t};\n\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase 'Point':\n\t\t\t\t\t\tcase 'MultiPoint':\n\t\t\t\t\t\t\tpointFeatures.push(data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Polygon':\n\t\t\t\t\t\tcase 'MultiPolygon':\n\t\t\t\t\t\t\tpolygonFeatures.push(data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'LineString':\n\t\t\t\t\t\tcase 'MultiLineString':\n\t\t\t\t\t\t\tlineFeatures.push(data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// sort point features by radius\n\t\t\tif (pointFeatures.length) {\n\t\t\t\tsortedPointFeatures = _orderBy(\n\t\t\t\t\tpointFeatures,\n\t\t\t\t\t['defaultStyle.radius', 'fid'],\n\t\t\t\t\t['desc', 'asc']\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// sort polygon features, if selected\n\t\t\tif (polygonFeatures.length) {\n\t\t\t\tif (this.props.selected) {\n\t\t\t\t\tsortedPolygonFeatures = _orderBy(\n\t\t\t\t\t\tpolygonFeatures,\n\t\t\t\t\t\t['selected'],\n\t\t\t\t\t\t['asc']\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsortedPolygonFeatures = polygonFeatures;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tpolygons: sortedPolygonFeatures,\n\t\t\t\tpoints: sortedPointFeatures || pointFeatures,\n\t\t\t\tlines: lineFeatures,\n\t\t\t};\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\trender() {\n\t\tconst data = this.prepareData(this.props.features);\n\t\tconst style = this.props.opacity ? {opacity: this.props.opacity} : null;\n\t\tconst classes = classnames({\n\t\t\t'hoverable-pane': this.props.hoverable,\n\t\t\t'selected-features-pane': this.props.withSelectedFeaturesOnly,\n\t\t});\n\n\t\treturn data ? (\n\t\t\t<>\n\t\t\t\t{data.polygons?.length ? (\n\t\t\t\t\t<Pane className={classes} style={style} name={this.polygonsPaneName}>\n\t\t\t\t\t\t{this.renderFeatures(data.polygons)}\n\t\t\t\t\t</Pane>\n\t\t\t\t) : null}\n\t\t\t\t{data.lines?.length ? (\n\t\t\t\t\t<Pane className={classes} style={style} name={this.linesPaneName}>\n\t\t\t\t\t\t{this.renderFeatures(data.lines)}\n\t\t\t\t\t</Pane>\n\t\t\t\t) : null}\n\t\t\t\t{data.points?.length ? (\n\t\t\t\t\t<Pane className={classes} style={style} name={this.pointsPaneName}>\n\t\t\t\t\t\t{this.renderFeatures(data.points)}\n\t\t\t\t\t</Pane>\n\t\t\t\t) : null}\n\t\t\t</>\n\t\t) : null;\n\t}\n\n\trenderFeatures(features) {\n\t\tif (\n\t\t\tthis.props.renderAsGeoJson ||\n\t\t\tfeatures.length > constants.maxFeaturesAsReactElement\n\t\t) {\n\t\t\t// GeoJsonLayer doesn't get context\n\t\t\treturn this.renderGeoJson(features);\n\t\t} else {\n\t\t\treturn features.map((item, index) => this.renderFeature(item, index));\n\t\t}\n\t}\n\n\trenderGeoJson(features) {\n\t\treturn (\n\t\t\t<GeoJsonLayer\n\t\t\t\tlayerKey={this.props.layerKey}\n\t\t\t\tuniqueLayerKey={this.props.uniqueLayerKey}\n\t\t\t\tpaneName={this.pointsPaneName}\n\t\t\t\tfeatures={features}\n\t\t\t\tonFeatureClick={this.onFeatureClick}\n\t\t\t\tomittedFeatureKeys={this.props.omittedFeatureKeys}\n\t\t\t\tfidColumnName={this.props.fidColumnName}\n\t\t\t\tpointAsMarker={this.props.pointAsMarker}\n\t\t\t\tselectable={this.props.selectable}\n\t\t\t\thoverable={this.props.hoverable}\n\t\t\t\tstyleDefinition={this.props.style}\n\t\t\t\thoveredStyleDefinition={this.props.hovered && this.props.hovered.style}\n\t\t\t\ticons={this.props.resources?.icons}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderFeature(data, index) {\n\t\tconst key =\n\t\t\tdata.uniqueFeatureKey ||\n\t\t\t`${this.props.uniqueLayerKey}_${data.fid || index}`;\n\n\t\treturn (\n\t\t\t<Feature\n\t\t\t\tkey={key}\n\t\t\t\tuniqueFeatureKey={data.uniqueFeatureKey}\n\t\t\t\tonClick={this.onFeatureClick}\n\t\t\t\tfid={data.fid}\n\t\t\t\tfidColumnName={this.props.fidColumnName}\n\t\t\t\tfeature={data.feature}\n\t\t\t\ttype={data.feature.geometry.type}\n\t\t\t\tpointAsMarker={this.props.pointAsMarker}\n\t\t\t\tselectable={this.props.selectable}\n\t\t\t\tselected={data.selected}\n\t\t\t\tselectedStyleDefinition={data.selectedStyleDefinition}\n\t\t\t\tselectedHoveredStyleDefinition={data.selectedStyleDefinition}\n\t\t\t\thoverable={this.props.hoverable}\n\t\t\t\tstyleDefinition={this.props.style}\n\t\t\t\thoveredStyleDefinition={this.props.hovered && this.props.hovered.style}\n\t\t\t\ticons={this.props.resources?.icons}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default SvgVectorLayer;\n","import React from 'react';\nimport {\n\tfindIndex as _findIndex,\n\tforEach as _forEach,\n\tisEqual as _isEqual,\n} from 'lodash';\nimport PropTypes from 'prop-types';\nimport memoize from 'memoize-one';\n\nimport IndexedVectorLayer from '../IndexedVectorLayer';\nimport CanvasVectorLayer from '../CanvasVectorLayer';\nimport SvgVectorLayer from '../SvgVectorLayer';\n\n/**\n * @param featureKeysGroupedByTileKey {Array} A collection of feature keys by tile key\n * @param tileKey {String} unique tile identifier\n * @param features {Array} List of current tile's features\n * @param fidColumnName {String}\n * @return {[]|null} List of feature keys to omit\n */\nfunction getFeatureKeysToOmit(\n\tfeatureKeysGroupedByTileKey,\n\ttileKey,\n\tfeatures,\n\tfidColumnName\n) {\n\t// Find the order of current tile among others\n\tconst indexOfCurrentTile = _findIndex(featureKeysGroupedByTileKey, tile => {\n\t\treturn tile.tileKey === tileKey;\n\t});\n\n\tlet i = 0;\n\tif (indexOfCurrentTile > 0) {\n\t\tlet featureKeysToOmit = [];\n\t\tlet renderedFeatureKeys = new Set();\n\n\t\t// Iterate over sibling tiles that should be rendered earlier\n\t\t// TODO don't iterate through features in each tile again\n\t\twhile (i < indexOfCurrentTile) {\n\t\t\tconst tile = featureKeysGroupedByTileKey[i];\n\t\t\t_forEach(tile.featureKeys, featureKey => {\n\t\t\t\trenderedFeatureKeys.add(featureKey);\n\t\t\t});\n\t\t\ti++;\n\t\t}\n\n\t\t// Iterate over current tile's features to find which features are rendered already\n\t\t_forEach(features, feature => {\n\t\t\t// TODO feature.id\n\t\t\tconst featureKey = feature.properties[fidColumnName];\n\t\t\tif (featureKey && renderedFeatureKeys.has(featureKey)) {\n\t\t\t\tfeatureKeysToOmit.push(featureKey);\n\t\t\t}\n\t\t});\n\n\t\treturn featureKeysToOmit.length ? featureKeysToOmit : null;\n\t} else {\n\t\treturn null;\n\t}\n}\n\n/**\n * Return true, if previous feature keys are the same as the next\n * @param prev {Array} previous arguments\n * @param next {Array} next arguments\n * @return {boolean}\n */\nfunction checkIdentity(prev, next) {\n\tconst prevKeys = prev[0];\n\tconst nextKeys = next[0];\n\n\tif (!prevKeys && !nextKeys) {\n\t\treturn true;\n\t} else if (!prevKeys || !nextKeys) {\n\t\treturn false;\n\t} else {\n\t\t//performance suggestion\n\t\t// return prevKeys.sort().join(',') === nextKeys.sort().join(',')\n\t\treturn _isEqual(prevKeys.sort(), nextKeys.sort());\n\t}\n}\n\nclass Tile extends React.PureComponent {\n\tstatic propTypes = {\n\t\ttileKey: PropTypes.string,\n\t\tfeatures: PropTypes.array,\n\t\tfidColumnName: PropTypes.string,\n\t\tlevel: PropTypes.number,\n\t\ttile: PropTypes.oneOfType([PropTypes.array, PropTypes.string]),\n\t\tfeatureKeysGroupedByTileKey: PropTypes.array, // a collection of all tiles and their features for each tile in the layer\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getFeatureKeysToOmit = memoize(getFeatureKeysToOmit);\n\n\t\t// return memoized feature keys, if nothing changed and not render IndexedVectorLayer again\n\t\tthis.checkIdentity = memoize(keys => keys, checkIdentity);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttileKey,\n\t\t\tfeatureKeysGroupedByTileKey,\n\t\t\tcomponent,\n\t\t\t...props\n\t\t} = this.props;\n\t\tconst omittedFeatureKeys = this.getFeatureKeysToOmit(\n\t\t\tfeatureKeysGroupedByTileKey,\n\t\t\ttileKey,\n\t\t\tprops.features,\n\t\t\tprops.fidColumnName\n\t\t);\n\n\t\tif (props.renderingTechnique === 'canvas') {\n\t\t\treturn (\n\t\t\t\t<CanvasVectorLayer\n\t\t\t\t\t{...props}\n\t\t\t\t\tkey={tileKey}\n\t\t\t\t\tuniqueLayerKey={tileKey}\n\t\t\t\t\tomittedFeatureKeys={this.checkIdentity(omittedFeatureKeys)}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<IndexedVectorLayer\n\t\t\t\t\t{...props}\n\t\t\t\t\tcomponent={SvgVectorLayer}\n\t\t\t\t\tkey={tileKey}\n\t\t\t\t\tuniqueLayerKey={tileKey}\n\t\t\t\t\tomittedFeatureKeys={this.checkIdentity(omittedFeatureKeys)}\n\t\t\t\t\trenderAsGeoJson // TODO always render as GeoJson for now\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default Tile;\n","import React from 'react';\nimport {\n\tforEach as _forEach,\n\tforIn as _forIn,\n\tincludes as _includes,\n\tisEmpty as _isEmpty,\n\tuniq as _uniq,\n} from 'lodash';\nimport PropTypes from 'prop-types';\nimport memoize from 'memoize-one';\n\nimport Tile from './Tile';\n\n/**\n * @param uniqueLayerKey {string}\n * @param tile {Object}\n * @return {string}\n */\nfunction getTileKey(uniqueLayerKey, tile) {\n\treturn `${uniqueLayerKey}_${tile.level}_${\n\t\ttypeof tile.tile === 'string' ? tile.tile : JSON.stringify(tile.tile)\n\t}`;\n}\n\n/**\n * @param uniqueLayerKey {string}\n * @param tiles {Array}\n * @param fidColumnName {string}\n * @param selections {Object}\n * @return {Object} groupedFeatures - a collection of features grouped by tile key, groupedFeaturesKeys - a collection of feature keys grouped by tile key\n */\nfunction getFeaturesGroupedByTileKey(\n\tuniqueLayerKey,\n\ttiles,\n\tfidColumnName,\n\tselections\n) {\n\tlet groupedFeatures = [];\n\tlet groupedFeatureKeys = [];\n\tlet selected = {};\n\n\t_forEach(tiles, tile => {\n\t\t// TODO pass featureKeys or filters\n\t\tconst key = getTileKey(uniqueLayerKey, tile);\n\t\tlet tileFeatureKeys = [];\n\n\t\tif (tile.features) {\n\t\t\t_forEach(tile.features, feature => {\n\t\t\t\tconst fid = feature.id || feature.properties[fidColumnName];\n\n\t\t\t\tif (selections) {\n\t\t\t\t\t_forIn(selections, (selection, selectionKey) => {\n\t\t\t\t\t\tif (selection.keys && _includes(selection.keys, fid)) {\n\t\t\t\t\t\t\tif (selected[selectionKey]?.features) {\n\t\t\t\t\t\t\t\tselected[selectionKey].features[fid] = feature;\n\t\t\t\t\t\t\t\tselected[selectionKey].featureKeys.push(fid);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected[selectionKey] = {\n\t\t\t\t\t\t\t\t\tfeatures: {\n\t\t\t\t\t\t\t\t\t\t[fid]: feature,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfeatureKeys: [fid],\n\t\t\t\t\t\t\t\t\tlevel: tile.level,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttileFeatureKeys.push(fid);\n\t\t\t});\n\t\t}\n\n\t\tgroupedFeatures.push({\n\t\t\t...tile,\n\t\t\tkey,\n\t\t});\n\n\t\tgroupedFeatureKeys.push({\n\t\t\tkey,\n\t\t\tfeatureKeys: tileFeatureKeys,\n\t\t});\n\t});\n\n\tif (!_isEmpty(selected)) {\n\t\t_forIn(selected, (selection, selectionKey) => {\n\t\t\tconst key = `${uniqueLayerKey}_${selectionKey}_${selection.level}`;\n\t\t\tgroupedFeatures.unshift({\n\t\t\t\tkey,\n\t\t\t\tfeatures: Object.values(selection.features),\n\t\t\t\tlevel: selection.level,\n\t\t\t\twithSelectedFeaturesOnly: true,\n\t\t\t});\n\n\t\t\tgroupedFeatureKeys.unshift({\n\t\t\t\tkey,\n\t\t\t\tfeatureKeys: _uniq(selection.featureKeys),\n\t\t\t});\n\t\t});\n\t}\n\n\treturn {groupedFeatures, groupedFeatureKeys};\n}\n\nclass TiledVectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tfidColumnName: PropTypes.string,\n\t\ttiles: PropTypes.array,\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.string,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.getFeaturesGroupedByTileKey = memoize(getFeaturesGroupedByTileKey);\n\t}\n\n\trender() {\n\t\tconst {tiles, ...props} = this.props;\n\t\tconst data = this.getFeaturesGroupedByTileKey(\n\t\t\tprops.uniqueLayerKey,\n\t\t\ttiles,\n\t\t\tprops.fidColumnName,\n\t\t\tprops.selected\n\t\t);\n\n\t\tif (data.groupedFeatures?.length) {\n\t\t\treturn data.groupedFeatures.map(tile => {\n\t\t\t\treturn (\n\t\t\t\t\t<Tile\n\t\t\t\t\t\t{...props}\n\t\t\t\t\t\tkey={tile.key}\n\t\t\t\t\t\ttileKey={tile.key}\n\t\t\t\t\t\tfeatures={tile.features}\n\t\t\t\t\t\tlevel={tile.level}\n\t\t\t\t\t\ttile={tile.tile}\n\t\t\t\t\t\tfeatureKeysGroupedByTileKey={data.groupedFeatureKeys}\n\t\t\t\t\t\twithSelectedFeaturesOnly={tile.withSelectedFeaturesOnly}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t});\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nexport default TiledVectorLayer;\n","import React from 'react';\nimport {find as _find} from 'lodash';\nimport PropTypes from 'prop-types';\n\nimport CanvasVectorLayer from '../CanvasVectorLayer';\nimport IndexedVectorLayer from '../IndexedVectorLayer';\nimport SvgVectorLayer from '../SvgVectorLayer';\nimport TiledVectorLayer from '../TiledVectorLayer';\nimport view from '../../../utils/view';\n\nclass VectorLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\t\tonClick: PropTypes.func,\n\t\topacity: PropTypes.number,\n\t\toptions: PropTypes.object,\n\t\ttype: PropTypes.string,\n\t\tview: PropTypes.object,\n\t\tzoom: PropTypes.number,\n\t\tzIndex: PropTypes.number,\n\t};\n\n\tgetOptions() {\n\t\tconst props = this.props;\n\t\tconst renderAs = props.options?.renderAs;\n\t\tlet options = props.options;\n\n\t\tif (renderAs) {\n\t\t\tconst boxRange = props.view?.boxRange;\n\t\t\tconst renderAsData = _find(renderAs, renderAsItem => {\n\t\t\t\treturn view.isBoxRangeInRange(boxRange, renderAsItem.boxRangeRange);\n\t\t\t});\n\n\t\t\tif (renderAsData) {\n\t\t\t\t// TODO enable to define other layer options in renderAs\n\t\t\t\toptions = {\n\t\t\t\t\t...options,\n\t\t\t\t\tstyle: renderAsData.options?.style || options?.style,\n\t\t\t\t\tpointAsMarker: renderAsData.options?.hasOwnProperty('pointAsMarker')\n\t\t\t\t\t\t? renderAsData.options.pointAsMarker\n\t\t\t\t\t\t: options?.pointAsMarker,\n\t\t\t\t\trenderingTechnique:\n\t\t\t\t\t\trenderAsData.options?.renderingTechnique ||\n\t\t\t\t\t\toptions?.renderingTechnique,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn options;\n\t}\n\n\trender() {\n\t\tconst {type} = this.props;\n\t\tconst options = this.getOptions();\n\n\t\t// TODO handle type 'diagram'\n\t\tif (type === 'tiledVector' || type === 'tiled-vector') {\n\t\t\treturn this.renderTiledVectorLayer(options);\n\t\t} else {\n\t\t\treturn this.renderBasicVectorLayer(options);\n\t\t}\n\t}\n\n\trenderTiledVectorLayer(options) {\n\t\tconst {options: opt, ...props} = this.props;\n\n\t\treturn <TiledVectorLayer {...props} {...options} />;\n\t}\n\n\trenderBasicVectorLayer(options) {\n\t\tconst {options: opt, ...props} = this.props;\n\n\t\tif (options.renderingTechnique === 'canvas') {\n\t\t\treturn <CanvasVectorLayer {...props} {...options} />;\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<IndexedVectorLayer\n\t\t\t\t\tcomponent={SvgVectorLayer}\n\t\t\t\t\t{...props}\n\t\t\t\t\t{...options}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default VectorLayer;\n","/*!\n * leaflet.wms.js\n * A collection of Leaflet utilities for working with Web Mapping services.\n * (c) 2014-2016, Houston Engineering, Inc.\n * MIT License\n */\nimport * as L from 'leaflet';\n\n// Module object\nvar wms = {};\n\n// Quick shim for Object.keys()\nif (!('keys' in Object)) {\n\tObject.keys = function (obj) {\n\t\tvar result = [];\n\t\tfor (var i in obj) {\n\t\t\tif (obj.hasOwnProperty(i)) {\n\t\t\t\tresult.push(i);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n}\n\n/*\n * wms.Source\n * The Source object manages a single WMS connection.  Multiple \"layers\" can be\n * created with the getLayer function, but a single request will be sent for\n * each image update.  Can be used in non-tiled \"overlay\" mode (default), or\n * tiled mode, via an internal wms.Overlay or wms.TileLayer, respectively.\n */\nwms.Source = L.Layer.extend({\n\toptions: {\n\t\tuntiled: true,\n\t\tidentify: true,\n\t},\n\n\tinitialize: function (url, options) {\n\t\tL.setOptions(this, options);\n\t\tif (this.options.tiled) {\n\t\t\tthis.options.untiled = false;\n\t\t}\n\t\tthis._url = url;\n\t\tthis._subLayers = {};\n\t\tthis._overlay = this.createOverlay(this.options.untiled);\n\t},\n\n\tcreateOverlay: function (untiled) {\n\t\t// Create overlay with all options other than untiled & identify\n\t\tvar overlayOptions = {};\n\t\tfor (var opt in this.options) {\n\t\t\tif (opt != 'untiled' && opt != 'identify') {\n\t\t\t\toverlayOptions[opt] = this.options[opt];\n\t\t\t}\n\t\t}\n\t\tif (untiled) {\n\t\t\treturn wms.overlay(this._url, overlayOptions);\n\t\t} else {\n\t\t\treturn wms.tileLayer(this._url, overlayOptions);\n\t\t}\n\t},\n\n\tonAdd: function () {\n\t\tthis.refreshOverlay();\n\t},\n\n\tsetParams: function (params) {\n\t\t// L.extend(this.wmsParams, params);\n\t\t// this.update();\n\t\tthis._overlay.setParams(params);\n\t},\n\n\tonRemove: function () {\n\t\tvar subLayers = Object.keys(this._subLayers).join(',');\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\tif (subLayers) {\n\t\t\tthis._overlay.remove();\n\t\t}\n\t},\n\n\tgetEvents: function () {\n\t\tif (this.options.identify) {\n\t\t\treturn {click: this.identify};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\n\tsetOpacity: function (opacity) {\n\t\tthis.options.opacity = opacity;\n\t\tif (this._overlay) {\n\t\t\tthis._overlay.setOpacity(opacity);\n\t\t}\n\t},\n\n\tbringToBack: function () {\n\t\tthis.options.isBack = true;\n\t\tif (this._overlay) {\n\t\t\tthis._overlay.bringToBack();\n\t\t}\n\t},\n\n\tbringToFront: function () {\n\t\tthis.options.isBack = false;\n\t\tif (this._overlay) {\n\t\t\tthis._overlay.bringToFront();\n\t\t}\n\t},\n\n\tgetLayer: function (name) {\n\t\treturn wms.layer(this, name);\n\t},\n\n\taddSubLayer: function (name) {\n\t\tthis._subLayers[name] = true;\n\t\tthis.refreshOverlay();\n\t},\n\n\tremoveSubLayer: function (name) {\n\t\tdelete this._subLayers[name];\n\t\tthis.refreshOverlay();\n\t},\n\n\trefreshOverlay: function () {\n\t\tvar subLayers = Object.keys(this._subLayers).join(',');\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\tif (!subLayers) {\n\t\t\tthis._overlay.remove();\n\t\t} else {\n\t\t\tthis._overlay.setParams({layers: subLayers});\n\t\t\tthis._overlay.addTo(this._map);\n\t\t}\n\t},\n\n\tidentify: function (evt) {\n\t\t// Identify map features in response to map clicks. To customize this\n\t\t// behavior, create a class extending wms.Source and override one or\n\t\t// more of the following hook functions.\n\n\t\tvar layers = this.getIdentifyLayers();\n\t\tif (!layers.length) {\n\t\t\treturn;\n\t\t}\n\t\tthis.getFeatureInfo(\n\t\t\tevt.containerPoint,\n\t\t\tevt.latlng,\n\t\t\tlayers,\n\t\t\tthis.showFeatureInfo\n\t\t);\n\t},\n\n\tgetFeatureInfo: function (point, latlng, layers, callback) {\n\t\t// Request WMS GetFeatureInfo and call callback with results\n\t\t// (split from identify() to faciliate use outside of map events)\n\t\tvar params = this.getFeatureInfoParams(point, layers),\n\t\t\turl = this._url + L.Util.getParamString(params, this._url);\n\n\t\tthis.showWaiting();\n\t\tthis.ajax(url, done);\n\n\t\tfunction done(result) {\n\t\t\tthis.hideWaiting();\n\t\t\tvar text = this.parseFeatureInfo(result, url);\n\t\t\tcallback.call(this, latlng, text);\n\t\t}\n\t},\n\n\tajax: function (url, callback) {\n\t\tajax.call(this, url, callback);\n\t},\n\n\tgetIdentifyLayers: function () {\n\t\t// Hook to determine which layers to identify\n\t\tif (this.options.identifyLayers) return this.options.identifyLayers;\n\t\treturn Object.keys(this._subLayers);\n\t},\n\n\tgetFeatureInfoParams: function (point, layers) {\n\t\t// Hook to generate parameters for WMS service GetFeatureInfo request\n\t\tvar wmsParams, overlay;\n\t\tif (this.options.untiled) {\n\t\t\t// Use existing overlay\n\t\t\twmsParams = this._overlay.wmsParams;\n\t\t} else {\n\t\t\t// Create overlay instance to leverage updateWmsParams\n\t\t\toverlay = this.createOverlay(true);\n\t\t\toverlay.updateWmsParams(this._map);\n\t\t\twmsParams = overlay.wmsParams;\n\t\t\twmsParams.layers = layers.join(',');\n\t\t}\n\t\tvar infoParams = {\n\t\t\trequest: 'GetFeatureInfo',\n\t\t\tquery_layers: layers.join(','),\n\t\t\tX: Math.round(point.x),\n\t\t\tY: Math.round(point.y),\n\t\t};\n\t\treturn L.extend({}, wmsParams, infoParams);\n\t},\n\n\tparseFeatureInfo: function (result, url) {\n\t\t// Hook to handle parsing AJAX response\n\t\tif (result == 'error') {\n\t\t\t// AJAX failed, possibly due to CORS issues.\n\t\t\t// Try loading content in <iframe>.\n\t\t\tresult = \"<iframe src='\" + url + \"' style='border:none'>\";\n\t\t}\n\t\treturn result;\n\t},\n\n\tshowFeatureInfo: function (latlng, info) {\n\t\t// Hook to handle displaying parsed AJAX response to the user\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\tthis._map.openPopup(info, latlng);\n\t},\n\n\tshowWaiting: function () {\n\t\t// Hook to customize AJAX wait animation\n\t\tif (!this._map) return;\n\t\tthis._map._container.style.cursor = 'progress';\n\t},\n\n\thideWaiting: function () {\n\t\t// Hook to remove AJAX wait animation\n\t\tif (!this._map) return;\n\t\tthis._map._container.style.cursor = 'default';\n\t},\n});\n\nwms.source = function (url, options) {\n\treturn new wms.Source(url, options);\n};\n\n/*\n * Layer\n * Leaflet \"layer\" with all actual rendering handled via an underlying Source\n * object.  Can be called directly with a URL to automatically create or reuse\n * an existing Source.  Note that the auto-source feature doesn't work well in\n * multi-map environments; so for best results, create a Source first and use\n * getLayer() to retrieve wms.Layer instances.\n */\n\nwms.Layer = L.Layer.extend({\n\tinitialize: function (source, layerName, options) {\n\t\tL.setOptions(this, {pane: source.options.pane});\n\t\tif (!source.addSubLayer) {\n\t\t\t// Assume source is a URL\n\t\t\tsource = wms.getSourceForUrl(source, options);\n\t\t}\n\t\tthis._source = source;\n\t\tthis._name = layerName;\n\t},\n\tonAdd: function () {\n\t\tif (!this._source._map) this._source.addTo(this._map);\n\t\tthis._source.addSubLayer(this._name);\n\t},\n\tonRemove: function () {\n\t\tthis._source.removeSubLayer(this._name);\n\t},\n\tsetOpacity: function (opacity) {\n\t\tthis._source.setOpacity(opacity);\n\t},\n\n\tsetParams: function (params) {\n\t\tthis._source.setParams(params);\n\t},\n\tbringToBack: function () {\n\t\tthis._source.bringToBack();\n\t},\n\tbringToFront: function () {\n\t\tthis._source.bringToFront();\n\t},\n});\n\nwms.layer = function (source, options) {\n\treturn new wms.Layer(source, options);\n};\n\n// Cache of sources for use with wms.Layer auto-source option\nvar sources = {};\nwms.getSourceForUrl = function (url, options) {\n\tif (!sources[url]) {\n\t\tsources[url] = wms.source(url, options);\n\t}\n\treturn sources[url];\n};\n\n// Copy tiled WMS layer from leaflet core, in case we need to subclass it later\nwms.TileLayer = L.TileLayer.WMS;\nwms.tileLayer = L.tileLayer.wms;\n\n/*\n * wms.Overlay:\n * \"Single Tile\" WMS image overlay that updates with map changes.\n * Portions of wms.Overlay are directly extracted from L.TileLayer.WMS.\n * See Leaflet license.\n */\nwms.Overlay = L.Layer.extend({\n\tdefaultWmsParams: {\n\t\tservice: 'WMS',\n\t\trequest: 'GetMap',\n\t\tversion: '1.1.1',\n\t\tlayers: '',\n\t\tstyles: '',\n\t\tformat: 'image/jpeg',\n\t\ttransparent: false,\n\t},\n\n\toptions: {\n\t\tcrs: null,\n\t\tuppercase: false,\n\t\tattribution: '',\n\t\topacity: 1,\n\t\tisBack: false,\n\t\tminZoom: 0,\n\t\tmaxZoom: 18,\n\t},\n\n\tinitialize: function (url, options) {\n\t\tthis._url = url;\n\n\t\t// Move WMS parameters to params object\n\t\tvar params = {},\n\t\t\topts = {};\n\t\tfor (var opt in options) {\n\t\t\tif (opt in this.options) {\n\t\t\t\topts[opt] = options[opt];\n\t\t\t} else {\n\t\t\t\tparams[opt] = options[opt];\n\t\t\t}\n\t\t}\n\t\tL.setOptions(this, opts);\n\t\tthis.wmsParams = L.extend({}, this.defaultWmsParams, params);\n\t},\n\n\tsetParams: function (params) {\n\t\tL.extend(this.wmsParams, params);\n\t\tthis.update();\n\t},\n\n\tgetAttribution: function () {\n\t\treturn this.options.attribution;\n\t},\n\n\tonAdd: function () {\n\t\tthis.update();\n\t},\n\n\tonRemove: function (map) {\n\t\tif (this._currentOverlay) {\n\t\t\tmap.removeLayer(this._currentOverlay);\n\t\t\tdelete this._currentOverlay;\n\t\t}\n\t\tif (this._currentUrl) {\n\t\t\tdelete this._currentUrl;\n\t\t}\n\t},\n\n\tgetEvents: function () {\n\t\treturn {\n\t\t\tmoveend: this.update,\n\t\t};\n\t},\n\n\tupdate: function () {\n\t\tif (!this._map) {\n\t\t\treturn;\n\t\t}\n\t\t// Determine image URL and whether it has changed since last update\n\t\tthis.updateWmsParams();\n\t\tvar url = this.getImageUrl();\n\t\tif (this._currentUrl == url) {\n\t\t\treturn;\n\t\t}\n\t\tthis._currentUrl = url;\n\n\t\t// Keep current image overlay in place until new one loads\n\t\t// (inspired by esri.leaflet)\n\t\tvar bounds = this._map.getBounds();\n\t\tvar overlay = L.imageOverlay(url, bounds, {\n\t\t\topacity: 0,\n\t\t\tpane: this.options.pane,\n\t\t});\n\t\toverlay.addTo(this._map);\n\t\toverlay.once('load', _swap, this);\n\t\tfunction _swap() {\n\t\t\tif (!this._map) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (overlay._url != this._currentUrl) {\n\t\t\t\tthis._map.removeLayer(overlay);\n\t\t\t\treturn;\n\t\t\t} else if (this._currentOverlay) {\n\t\t\t\tthis._map.removeLayer(this._currentOverlay);\n\t\t\t}\n\t\t\tthis._currentOverlay = overlay;\n\t\t\toverlay.setOpacity(this.options.opacity ? this.options.opacity : 1);\n\t\t\tif (this.options.isBack === true) {\n\t\t\t\toverlay.bringToBack();\n\t\t\t}\n\t\t\tif (this.options.isBack === false) {\n\t\t\t\toverlay.bringToFront();\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\tthis._map.getZoom() < this.options.minZoom ||\n\t\t\tthis._map.getZoom() > this.options.maxZoom\n\t\t) {\n\t\t\tthis._map.removeLayer(overlay);\n\t\t}\n\t},\n\n\tsetOpacity: function (opacity) {\n\t\tthis.options.opacity = opacity;\n\t\tif (this._currentOverlay) {\n\t\t\tthis._currentOverlay.setOpacity(opacity);\n\t\t}\n\t},\n\n\tbringToBack: function () {\n\t\tthis.options.isBack = true;\n\t\tif (this._currentOverlay) {\n\t\t\tthis._currentOverlay.bringToBack();\n\t\t}\n\t},\n\n\tbringToFront: function () {\n\t\tthis.options.isBack = false;\n\t\tif (this._currentOverlay) {\n\t\t\tthis._currentOverlay.bringToFront();\n\t\t}\n\t},\n\n\t// See L.TileLayer.WMS: onAdd() & getTileUrl()\n\tupdateWmsParams: function (map) {\n\t\tif (!map) {\n\t\t\tmap = this._map;\n\t\t}\n\t\t// Compute WMS options\n\t\tvar bounds = map.getBounds();\n\t\tvar size = map.getSize();\n\t\tvar wmsVersion = parseFloat(this.wmsParams.version);\n\t\tvar crs = this.options.crs || map.options.crs;\n\t\tvar projectionKey = wmsVersion >= 1.3 ? 'crs' : 'srs';\n\t\tvar nw = crs.project(bounds.getNorthWest());\n\t\tvar se = crs.project(bounds.getSouthEast());\n\n\t\t// Assemble WMS parameter string\n\t\tvar params = {\n\t\t\twidth: size.x,\n\t\t\theight: size.y,\n\t\t};\n\t\tparams[projectionKey] = crs.code;\n\t\tparams.bbox = (wmsVersion >= 1.3 && crs === L.CRS.EPSG4326\n\t\t\t? [se.y, nw.x, nw.y, se.x]\n\t\t\t: [nw.x, se.y, se.x, nw.y]\n\t\t).join(',');\n\n\t\tL.extend(this.wmsParams, params);\n\t},\n\n\tgetImageUrl: function () {\n\t\tvar uppercase = this.options.uppercase || false;\n\t\tvar pstr = L.Util.getParamString(this.wmsParams, this._url, uppercase);\n\t\treturn this._url + pstr;\n\t},\n});\n\nwms.overlay = function (url, options) {\n\treturn new wms.Overlay(url, options);\n};\n\n// Simple AJAX helper (since we can't assume jQuery etc. are present)\nfunction ajax(url, callback) {\n\tvar context = this,\n\t\trequest = new XMLHttpRequest();\n\trequest.onreadystatechange = change;\n\trequest.open('GET', url);\n\trequest.send();\n\n\tfunction change() {\n\t\tif (request.readyState === 4) {\n\t\t\tif (request.status === 200) {\n\t\t\t\tcallback.call(context, request.responseText);\n\t\t\t} else {\n\t\t\t\tcallback.call(context, 'error');\n\t\t\t}\n\t\t}\n\t}\n}\nexport default wms;\n","import {TileLayer} from 'leaflet';\nimport isEqual from 'fast-deep-equal';\nimport {MapLayer, withLeaflet} from 'react-leaflet';\n\nimport wms from './leaflet.wms';\nexport const EVENTS_RE = /^on(.+)$/i;\nclass WMSLayer extends MapLayer {\n\tcreateLeafletElement(props) {\n\t\tconst {url, params, singleTile, ...restParams} = props;\n\t\tconst {leaflet: _l, ...options} = this.getOptions({\n\t\t\t...restParams,\n\t\t\t...params,\n\t\t});\n\n\t\tif (singleTile) {\n\t\t\tconst source = new wms.source(url, {\n\t\t\t\t...options,\n\t\t\t\tpane: _l.pane,\n\t\t\t\ttiled: false,\n\t\t\t\tidentify: false,\n\t\t\t});\n\t\t\tconst layer = source.getLayer(options.layers);\n\t\t\tlayer.options.pane = _l.pane;\n\t\t\treturn layer;\n\t\t} else {\n\t\t\treturn new TileLayer.WMS(url, options);\n\t\t}\n\t}\n\n\tupdateLeafletElement(fromProps, toProps) {\n\t\tsuper.updateLeafletElement(fromProps, toProps);\n\n\t\tconst {url: prevUrl} = fromProps;\n\t\tconst {url} = toProps;\n\n\t\tif (url !== prevUrl) {\n\t\t\tthis.leafletElement.setUrl(url);\n\t\t}\n\t\tif (!isEqual(fromProps.params, toProps.params)) {\n\t\t\tthis.leafletElement.setParams({\n\t\t\t\t...toProps.params,\n\t\t\t\tpane: toProps.leaflet.pane,\n\t\t\t});\n\t\t}\n\t}\n\n\tgetOptions(params) {\n\t\tconst superOptions = super.getOptions(params);\n\t\treturn Object.keys(superOptions).reduce((options, key) => {\n\t\t\tif (!EVENTS_RE.test(key)) {\n\t\t\t\toptions[key] = superOptions[key];\n\t\t\t}\n\t\t\treturn options;\n\t\t}, {});\n\t}\n}\n\nexport default withLeaflet(WMSLayer);\n","import React from 'react';\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport {utils} from '@gisatcz/ptr-utils';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\nimport {utils as tileGridUtils, grid} from '@gisatcz/ptr-tile-grid';\nimport {GeoJSON, withLeaflet, Marker, Pane} from 'react-leaflet';\nimport memoize from 'memoize-one';\nimport helpers from '../SvgVectorLayer/helpers';\n\nconst getBoxRange = (boxRange, width, height) => {\n\tconst calculatedBoxRange = mapUtils.view.getNearestZoomLevelBoxRange(\n\t\twidth,\n\t\theight,\n\t\tboxRange\n\t);\n\n\tif (boxRange !== calculatedBoxRange) {\n\t\treturn calculatedBoxRange;\n\t} else {\n\t\treturn boxRange;\n\t}\n};\n\nclass TileGridLayer extends React.PureComponent {\n\tstatic propTypes = {\n\t\tlayerKey: PropTypes.string,\n\t\tuniqueLayerKey: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\t\tview: PropTypes.object,\n\t\tzoom: PropTypes.number,\n\t\tzIndex: PropTypes.number,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.pointsPaneName = utils.uuid();\n\t\tthis.getStyle = this.getStyle.bind(this);\n\t\tthis.onEachFeature = this.onEachFeature.bind(this);\n\n\t\tthis.getRenderId = memoize(features => {\n\t\t\tif (features) {\n\t\t\t\treturn utils.uuid();\n\t\t\t}\n\t\t});\n\t}\n\n\tonEachFeature(feature, layer) {}\n\n\tgetStyle(feature) {\n\t\tconst styles = helpers.calculateStyle(\n\t\t\tfeature,\n\t\t\tthis.props.style,\n\t\t\tundefined,\n\t\t\tfeature.selected,\n\t\t\tfeature.selectedStyleDefinition,\n\t\t\tfeature.selectedHoveredStyleDefinition\n\t\t);\n\n\t\tif (feature.selected) {\n\t\t\treturn styles.selected;\n\t\t} else {\n\t\t\treturn styles.default;\n\t\t}\n\t}\n\n\t/**\n\t * Set style of the feature\n\t * @param leafletStyle {Object} Leaflet style definition\n\t * @param element {Object} Leaflet element\n\t */\n\tsetStyle(leafletStyle, element) {\n\t\tconst shape = element?.options?.icon;\n\t\tif (shape) {\n\t\t\tshape.setStyle(leafletStyle, shape.id, shape.isBasicShape);\n\t\t} else {\n\t\t\telement.setStyle(leafletStyle);\n\t\t}\n\t}\n\n\trender() {\n\t\tconst options = this.props.options;\n\t\treturn this.renderBasicVectorLayer(options);\n\t}\n\n\tgetGeoJsonTileGrid(tileGrid, boxRange, viewport) {\n\t\tconst level = this.getTileGridLevel(boxRange, viewport);\n\n\t\t// // todo\n\t\t// // add buffer for leveles bigger than 5\n\t\tconst size = tileGridUtils.getGridSizeForLevel(level);\n\n\t\t// //consider caching levels\n\t\tconst geojsonTileGrid = tileGridUtils.getTileGridAsGeoJSON(tileGrid, size);\n\t\treturn geojsonTileGrid;\n\t}\n\n\tgetTileGridLevel(boxRange, viewport) {\n\t\tconst viewportRange = mapUtils.view.getMapViewportRange(\n\t\t\tviewport.width,\n\t\t\tviewport.height\n\t\t);\n\t\tconst nearestBoxRange = mapUtils.view.getNearestZoomLevelBoxRange(\n\t\t\tviewport.width,\n\t\t\tviewport.height,\n\t\t\tboxRange\n\t\t);\n\t\tconst level = grid.getLevelByViewport(nearestBoxRange, viewportRange);\n\n\t\treturn level;\n\t}\n\tgetTilesMarkers(tileGrid = [], boxRange, viewport) {\n\t\tconst level = this.getTileGridLevel(boxRange, viewport);\n\n\t\tconst markers = tileGrid.reduce((acc, row) => {\n\t\t\tconst rowMarkers = row.map((tile, i) => {\n\t\t\t\treturn (\n\t\t\t\t\t<Pane\n\t\t\t\t\t\tstyle={{zIndex: this.props.zIndex}}\n\t\t\t\t\t\tkey={`${level}-${tile[0]}-${tile[1]}`}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Marker\n\t\t\t\t\t\t\tzIndex={this.props.zIndex}\n\t\t\t\t\t\t\tposition={[tile[1], tile[0]]}\n\t\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t\tnew L.DivIcon({\n\t\t\t\t\t\t\t\t\t//push every second tile title up to prevent overlays\n\t\t\t\t\t\t\t\t\ticonAnchor: [-10, 20 + (i % 2) * 20],\n\t\t\t\t\t\t\t\t\tclassName: 'my-div-icon',\n\t\t\t\t\t\t\t\t\thtml: `<div style=\"display:flex\"><div style=\"white-space: nowrap;\">${level}-${tile[0]}-${tile[1]}</div></div>`,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Pane>\n\t\t\t\t);\n\t\t\t});\n\n\t\t\treturn [...acc, ...rowMarkers];\n\t\t}, []);\n\n\t\treturn markers;\n\t}\n\n\trenderBasicVectorLayer(options) {\n\t\tconst {options: opt, ...props} = this.props;\n\n\t\tconst recalculatedBoxrange = getBoxRange(\n\t\t\tprops.view.boxRange,\n\t\t\toptions.viewport.width,\n\t\t\toptions.viewport.height\n\t\t);\n\n\t\tconst tileGrid = grid.getTileGrid(\n\t\t\toptions.viewport.width,\n\t\t\toptions.viewport.height,\n\t\t\trecalculatedBoxrange,\n\t\t\tprops.view.center,\n\t\t\ttrue\n\t\t);\n\n\t\tconst geoJsonTileGrid = this.getGeoJsonTileGrid(\n\t\t\ttileGrid,\n\t\t\trecalculatedBoxrange,\n\t\t\toptions.viewport\n\t\t);\n\n\t\t// generate new key on features change to return the new instance\n\t\t// more: https://react-leaflet.js.org/docs/en/components#geojson\n\t\tconst key = this.getRenderId(geoJsonTileGrid.features);\n\n\t\tconst tilesMarkers = this.getTilesMarkers(\n\t\t\ttileGrid,\n\t\t\trecalculatedBoxrange,\n\t\t\toptions.viewport\n\t\t);\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<GeoJSON\n\t\t\t\t\tkey={key}\n\t\t\t\t\tdata={geoJsonTileGrid.features}\n\t\t\t\t\tstyle={this.getStyle}\n\t\t\t\t\tonEachFeature={this.onEachFeature}\n\t\t\t\t\tzIndex={this.props.zIndex}\n\t\t\t\t\t// pointToLayer={this.pointToLayer}\n\t\t\t\t\t// filter={this.filter}\n\t\t\t\t/>\n\t\t\t\t{tilesMarkers}\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default withLeaflet(TileGridLayer);\n","/**\n * Round one viewport dimension (width or height)\n * @param dimension {number} original dimension (width or height)\n * @return {number} Rounded dimension\n */\nconst roundDimension = dimension => {\n\treturn Math.ceil(dimension);\n};\n\nexport default {\n\troundDimension,\n};\n","import React from 'react';\nimport {isArray as _isArray, isEmpty as _isEmpty} from 'lodash';\nimport {Map, TileLayer, Pane} from 'react-leaflet';\nimport PropTypes from 'prop-types';\nimport L from 'leaflet';\nimport Proj from 'proj4leaflet';\nimport ReactResizeDetector from 'react-resize-detector';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport {map as mapUtils} from '@gisatcz/ptr-utils';\n\nimport viewUtils from '../utils/view';\nimport viewHelpers from './viewHelpers';\nimport VectorLayer from './layers/VectorLayer';\nimport WMSLayer from './layers/WMSLayer';\nimport TileGridLayer from './layers/TileGridLayer';\nimport constants from '../constants';\nimport viewport from '../utils/viewport';\n\nimport './style.scss';\n\nclass ReactLeafletMap extends React.PureComponent {\n\tstatic propTypes = {\n\t\tbackgroundLayer: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n\t\tname: PropTypes.string,\n\t\tcrs: PropTypes.string,\n\t\tlayers: PropTypes.array,\n\t\tmapKey: PropTypes.string.isRequired,\n\t\tonClick: PropTypes.func,\n\t\tonLayerClick: PropTypes.func,\n\t\tonViewChange: PropTypes.func,\n\t\tresources: PropTypes.object,\n\t\tview: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\t\tdebugTileGrid: PropTypes.oneOfType([\n\t\t\tPropTypes.bool,\n\t\t\tPropTypes.shape({\n\t\t\t\tbottom: PropTypes.bool,\n\t\t\t}),\n\t\t]),\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tview: null,\n\t\t\tcrs: this.getCRS(props.crs),\n\t\t};\n\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onLayerClick = this.onLayerClick.bind(this);\n\t\tthis.onViewportChanged = this.onViewportChanged.bind(this);\n\t\tthis.onResize = this.onResize.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\t// Hack for ugly 1px tile borders in Chrome\n\t\t// Version of Leaflet package in dependencies should match version used by react-leaflet\n\t\tlet originalInitTile = L.GridLayer.prototype._initTile;\n\t\tL.GridLayer.include({\n\t\t\t_initTile: function (tile) {\n\t\t\t\toriginalInitTile.call(this, tile);\n\n\t\t\t\tvar tileSize = this.getTileSize();\n\n\t\t\t\ttile.style.width = tileSize.x + 1 + 'px';\n\t\t\t\ttile.style.height = tileSize.y + 1 + 'px';\n\t\t\t},\n\t\t});\n\t}\n\n\tgetCRS(code) {\n\t\tswitch (code) {\n\t\t\tcase 'EPSG:4326':\n\t\t\t\treturn L.CRS.EPSG4326;\n\t\t\tcase 'EPSG:5514':\n\t\t\t\treturn new Proj.CRS('EPSG:5514', constants.projDefinitions.epsg5514, {\n\t\t\t\t\tresolutions: [\n\t\t\t\t\t\t102400,\n\t\t\t\t\t\t51200,\n\t\t\t\t\t\t25600,\n\t\t\t\t\t\t12800,\n\t\t\t\t\t\t6400,\n\t\t\t\t\t\t3200,\n\t\t\t\t\t\t1600,\n\t\t\t\t\t\t800,\n\t\t\t\t\t\t400,\n\t\t\t\t\t\t200,\n\t\t\t\t\t\t100,\n\t\t\t\t\t\t50,\n\t\t\t\t\t\t25,\n\t\t\t\t\t\t12.5,\n\t\t\t\t\t\t6.25,\n\t\t\t\t\t\t3.125,\n\t\t\t\t\t\t1.5625,\n\t\t\t\t\t\t0.78125,\n\t\t\t\t\t\t0.390625,\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn L.CRS.EPSG3857;\n\t\t}\n\t}\n\n\tsetZoomLevelsBounds(width, height) {\n\t\tconst props = this.props;\n\t\tthis.minZoom = mapConstants.defaultLevelsRange[0];\n\t\tthis.maxZoom = mapConstants.defaultLevelsRange[1];\n\t\tif (props.viewLimits && props.viewLimits.boxRangeRange) {\n\t\t\tif (props.viewLimits.boxRangeRange[1]) {\n\t\t\t\tthis.minZoom = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\tprops.viewLimits.boxRangeRange[1],\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (props.viewLimits.boxRangeRange[0]) {\n\t\t\t\tthis.maxZoom = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\tprops.viewLimits.boxRangeRange[0],\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tonViewportChanged(viewport) {\n\t\tif (viewport) {\n\t\t\tlet change = {};\n\n\t\t\tif (\n\t\t\t\tviewport.center &&\n\t\t\t\t(viewport.center[0] !== this.state.leafletView.center[0] ||\n\t\t\t\t\tviewport.center[1] !== this.state.leafletView.center[1])\n\t\t\t) {\n\t\t\t\tchange.center = viewUtils.getCenterWhichFitsLimits(\n\t\t\t\t\t{\n\t\t\t\t\t\tlat: viewport.center[0],\n\t\t\t\t\t\tlon: viewport.center[1],\n\t\t\t\t\t},\n\t\t\t\t\tthis.props.viewLimits?.center\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tviewport.hasOwnProperty('zoom') &&\n\t\t\t\tNumber.isFinite(viewport.zoom) &&\n\t\t\t\tviewport.zoom !== this.state.leafletView.zoom\n\t\t\t) {\n\t\t\t\tchange.boxRange = mapUtils.view.getBoxRangeFromZoomLevel(\n\t\t\t\t\tviewport.zoom,\n\t\t\t\t\tthis.state.width,\n\t\t\t\t\tthis.state.height\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!_isEmpty(change) && !this.hasResized()) {\n\t\t\t\tchange = mapUtils.view.ensureViewIntegrity(change);\n\n\t\t\t\tif (this.props.viewLimits?.center) {\n\t\t\t\t\t/* Center coordinate values are compared by value. If the map view is changed from inside (by dragging) and the center gets out of the range, then the center coordinates are adjusted to those limits. However, if we move the map a bit again, these values will remain the same and the map component will not reredner. Therefore, it is necessary to make insignificant change in center coordinates values */\n\t\t\t\t\tchange.center = {\n\t\t\t\t\t\tlat: change.center.lat + Math.random() / Math.pow(10, 13),\n\t\t\t\t\t\tlon: change.center.lon + Math.random() / Math.pow(10, 13),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (this.props.onViewChange) {\n\t\t\t\t\tthis.props.onViewChange(change);\n\t\t\t\t}\n\t\t\t\t// just presentational map\n\t\t\t\telse {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tview: {...this.props.view, ...this.state.view, ...change},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thasResized() {\n\t\tconst {x, y} = this.leafletMap._size;\n\n\t\t// take into account only a significant change in size\n\t\tconst widthChange = Math.abs(x - this.state.width) > 5;\n\t\tconst heightChange = Math.abs(y - this.state.height) > 5;\n\t\treturn widthChange || heightChange;\n\t}\n\n\tonResize(width, height) {\n\t\theight = viewport.roundDimension(height);\n\t\twidth = viewport.roundDimension(width);\n\n\t\tif (this.leafletMap) {\n\t\t\tthis.leafletMap.invalidateSize();\n\t\t}\n\n\t\tif (!this.maxZoom && !this.minZoom) {\n\t\t\tthis.setZoomLevelsBounds(width, height);\n\t\t}\n\n\t\tthis.setState({\n\t\t\twidth,\n\t\t\theight,\n\t\t\tleafletView: viewHelpers.getLeafletViewportFromViewParams(\n\t\t\t\tthis.state.view || this.props.view,\n\t\t\t\tthis.state.width,\n\t\t\t\tthis.state.height\n\t\t\t),\n\t\t});\n\n\t\tif (this.props.onResize) {\n\t\t\tthis.props.onResize(width, height);\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ReactResizeDetector\n\t\t\t\t\thandleHeight\n\t\t\t\t\thandleWidth\n\t\t\t\t\tonResize={this.onResize}\n\t\t\t\t\trefreshMode=\"debounce\"\n\t\t\t\t\trefreshRate={500}\n\t\t\t\t/>\n\t\t\t\t{this.state.width && this.state.height ? this.renderMap() : null}\n\t\t\t</>\n\t\t);\n\t}\n\n\trenderMap() {\n\t\tconst leafletView = viewHelpers.getLeafletViewportFromViewParams(\n\t\t\tthis.state.view || this.props.view,\n\t\t\tthis.state.width,\n\t\t\tthis.state.height\n\t\t);\n\n\t\t// fix for backward compatibility\n\t\tconst backgroundLayersSource = _isArray(this.props.backgroundLayer)\n\t\t\t? this.props.backgroundLayer\n\t\t\t: [this.props.backgroundLayer];\n\t\tconst backgroundLayersZindex = constants.defaultLeafletPaneZindex + 1;\n\t\tconst backgroundLayers =\n\t\t\tbackgroundLayersSource &&\n\t\t\tbackgroundLayersSource.map((layer, i) =>\n\t\t\t\tthis.getLayerByType(layer, i, null, leafletView.zoom)\n\t\t\t);\n\n\t\tconst baseLayersZindex = constants.defaultLeafletPaneZindex + 101;\n\t\tlet layers =\n\t\t\tthis.props.layers &&\n\t\t\tthis.props.layers.map((layer, i) => (\n\t\t\t\t<Pane key={layer.key || i} style={{zIndex: baseLayersZindex + i}}>\n\t\t\t\t\t{this.getLayerByType(\n\t\t\t\t\t\tlayer,\n\t\t\t\t\t\ti,\n\t\t\t\t\t\tbaseLayersZindex + i,\n\t\t\t\t\t\tleafletView.zoom\n\t\t\t\t\t)}\n\t\t\t\t</Pane>\n\t\t\t));\n\n\t\t//\n\t\t// Add debug grid layer on under all \"layers\" or at the top\n\t\t//\n\t\tif (this.props.debugTileGrid) {\n\t\t\tconst bottom = this.props.debugTileGrid?.bottom;\n\t\t\tconst zIndex = bottom ? 0 : (layers?.length || 0) + 1;\n\t\t\tconst tileGridLayer = (\n\t\t\t\t<Pane key={'tilegrid'} style={{zIndex: baseLayersZindex + zIndex - 1}}>\n\t\t\t\t\t{this.getLayerByType(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'tile-grid',\n\t\t\t\t\t\t\tkey: 'tilegrid',\n\t\t\t\t\t\t\tlayerKey: 'tilegridlayerkey',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tviewport: {\n\t\t\t\t\t\t\t\t\twidth: this.state.width,\n\t\t\t\t\t\t\t\t\theight: this.state.height,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tbaseLayersZindex + zIndex - 1,\n\t\t\t\t\t\tleafletView.zoom\n\t\t\t\t\t)}\n\t\t\t\t</Pane>\n\t\t\t);\n\n\t\t\tif (bottom) {\n\t\t\t\tlayers = layers ? [tileGridLayer, ...layers] : [tileGridLayer];\n\t\t\t} else {\n\t\t\t\tlayers = layers ? [...layers, tileGridLayer] : [tileGridLayer];\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<Map\n\t\t\t\tid={this.props.mapKey}\n\t\t\t\tref={map => {\n\t\t\t\t\tthis.leafletMap = map && map.leafletElement;\n\t\t\t\t}}\n\t\t\t\tclassName=\"ptr-map ptr-leaflet-map\"\n\t\t\t\tonViewportChanged={this.onViewportChanged}\n\t\t\t\tonClick={this.onClick}\n\t\t\t\tcenter={leafletView.center}\n\t\t\t\tzoom={leafletView.zoom}\n\t\t\t\tzoomControl={false}\n\t\t\t\tminZoom={this.minZoom} // non-dynamic prop\n\t\t\t\tmaxZoom={this.maxZoom} // non-dynamic prop\n\t\t\t\tattributionControl={false}\n\t\t\t\tcrs={this.state.crs}\n\t\t\t\tanimate={false}\n\t\t\t>\n\t\t\t\t<Pane style={{zIndex: backgroundLayersZindex}}>{backgroundLayers}</Pane>\n\t\t\t\t{layers}\n\t\t\t\t{this.props.children}\n\t\t\t</Map>\n\t\t);\n\t}\n\n\tgetLayerByType(layer, i, zIndex, zoom) {\n\t\tif (layer && layer.type) {\n\t\t\tswitch (layer.type) {\n\t\t\t\tcase 'wmts':\n\t\t\t\t\treturn this.getTileLayer(layer, i);\n\t\t\t\tcase 'wms':\n\t\t\t\t\treturn this.getWmsTileLayer(layer, i);\n\t\t\t\tcase 'vector':\n\t\t\t\tcase 'tiledVector':\n\t\t\t\tcase 'tiled-vector':\n\t\t\t\tcase 'diagram':\n\t\t\t\t\treturn this.getVectorLayer(layer, i, zIndex, zoom);\n\t\t\t\tcase 'tile-grid':\n\t\t\t\t\treturn this.getTileGridLayer(layer, i, zIndex, zoom);\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetVectorLayer(layer, i, zIndex, zoom) {\n\t\treturn (\n\t\t\t<VectorLayer\n\t\t\t\tkey={layer.key || i}\n\t\t\t\tlayerKey={layer.layerKey || layer.key}\n\t\t\t\tuniqueLayerKey={layer.key || i}\n\t\t\t\tresources={this.props.resources}\n\t\t\t\tonClick={this.onLayerClick}\n\t\t\t\topacity={layer.opacity || 1}\n\t\t\t\toptions={layer.options}\n\t\t\t\ttype={layer.type}\n\t\t\t\tview={this.state.view || this.props.view}\n\t\t\t\twidth={this.state.width}\n\t\t\t\theight={this.state.height}\n\t\t\t\tcrs={this.props.crs}\n\t\t\t\tzoom={zoom}\n\t\t\t\tzIndex={zIndex}\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetTileGridLayer(layer, i, zIndex, zoom) {\n\t\treturn (\n\t\t\t<TileGridLayer\n\t\t\t\tkey={layer.key || i}\n\t\t\t\tlayerKey={layer.layerKey || layer.key}\n\t\t\t\tuniqueLayerKey={layer.key || i}\n\t\t\t\tview={this.state.view || this.props.view}\n\t\t\t\toptions={layer.options}\n\t\t\t\tzoom={zoom}\n\t\t\t\tzIndex={zIndex}\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetTileLayer(layer, i) {\n\t\tlet {url, ...restOptions} = layer.options;\n\n\t\t// fix for backward compatibility\n\t\tif (layer.options.urls) {\n\t\t\turl = layer.options.urls[0];\n\t\t}\n\n\t\treturn <TileLayer key={layer.key || i} url={url} {...restOptions} />;\n\t}\n\n\tgetWmsTileLayer(layer, i) {\n\t\tconst o = layer.options;\n\t\tlet layers = (o.params && o.params.layers) || '';\n\t\tlet crs = (o.params && o.params.crs && this.getCRS(o.params.crs)) || null;\n\t\tlet imageFormat = (o.params && o.params.imageFormat) || 'image/png';\n\t\tconst reservedParamsKeys = [\n\t\t\t'layers',\n\t\t\t'crs',\n\t\t\t'imageFormat',\n\t\t\t'pane',\n\t\t\t'maxZoom',\n\t\t\t'styles',\n\t\t];\n\t\tlet restParameters =\n\t\t\t(o.params &&\n\t\t\t\tObject.entries(o.params).reduce((acc, [key, value]) => {\n\t\t\t\t\tif (reservedParamsKeys.includes(key)) {\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tacc[key] = value;\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t}\n\t\t\t\t}, {})) ||\n\t\t\t{};\n\n\t\treturn (\n\t\t\t<WMSLayer\n\t\t\t\tkey={layer.key || i}\n\t\t\t\turl={o.url}\n\t\t\t\tcrs={crs}\n\t\t\t\tsingleTile={o.singleTile === true}\n\t\t\t\tparams={{\n\t\t\t\t\tlayers: layers,\n\t\t\t\t\topacity: layer.opacity || 1,\n\t\t\t\t\ttransparent: true,\n\t\t\t\t\tformat: imageFormat,\n\t\t\t\t\t...restParameters,\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonLayerClick(layerKey, featureKeys) {\n\t\tif (this.props.onLayerClick) {\n\t\t\tthis.props.onLayerClick(this.props.mapKey, layerKey, featureKeys);\n\t\t}\n\t}\n\n\tonClick() {\n\t\tif (this.props.onClick) {\n\t\t\tthis.props.onClick(this.props.view);\n\t\t}\n\t}\n}\n\nexport default ReactLeafletMap;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport {Icon, Button} from '@gisatcz/ptr-atoms';\n\nimport './style.scss';\n\n// TODO Refactor\nclass SimpleLayersControl extends React.PureComponent {\n\tstatic propTypes = {\n\t\tactiveLayer: PropTypes.object,\n\t\tlayers: PropTypes.array,\n\t\tonSelect: PropTypes.func,\n\t\tright: PropTypes.bool,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.ref = React.createRef();\n\t\tthis.state = {\n\t\t\topen: false,\n\t\t};\n\n\t\tthis.onControlButtonClick = this.onControlButtonClick.bind(this);\n\t\tthis.onBlur = this.onBlur.bind(this);\n\t}\n\n\tonBlur(e) {\n\t\tsetTimeout(() => {\n\t\t\tthis.setState({open: false});\n\t\t}, 50);\n\t}\n\n\tonControlButtonClick() {\n\t\tthis.setState({\n\t\t\topen: !this.state.open,\n\t\t});\n\t}\n\n\tonLayerTileClick(key) {\n\t\tif (this.props.onSelect) {\n\t\t\tthis.props.onSelect(key);\n\t\t}\n\t}\n\n\trender() {\n\t\tlet buttonClasses = classnames('ptr-simple-layers-control control', {\n\t\t\topen: this.state.open,\n\t\t});\n\n\t\treturn (\n\t\t\t<div className={buttonClasses} onBlur={this.onBlur} ref={this.ref}>\n\t\t\t\t<Button onClick={this.onControlButtonClick}>\n\t\t\t\t\t<Icon icon=\"layers\" />\n\t\t\t\t</Button>\n\t\t\t\t{this.renderMenu()}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderMenu() {\n\t\tconst layers = this.props.layers;\n\t\tconst tileWidth = 7;\n\t\tconst tileHeight = 5;\n\t\tconst tileMargin = 0.25;\n\t\tconst contentMargin = 1;\n\n\t\tif (layers) {\n\t\t\tlet grid = this.getGrid(layers.length);\n\n\t\t\tlet menuClasses = classnames('ptr-simple-layers-control-menu', {\n\t\t\t\topen: this.state.open,\n\t\t\t\tright: this.props.right,\n\t\t\t\tleft: !this.props.right,\n\t\t\t});\n\n\t\t\tlet menuStyle = {\n\t\t\t\twidth: this.state.open\n\t\t\t\t\t? `${\n\t\t\t\t\t\t\t(tileWidth + 2 * tileMargin) * grid.width + 2 * contentMargin\n\t\t\t\t\t  }rem`\n\t\t\t\t\t: 0,\n\t\t\t\theight: this.state.open\n\t\t\t\t\t? `${\n\t\t\t\t\t\t\t(tileHeight + 2 * tileMargin) * grid.height + 2 * contentMargin\n\t\t\t\t\t  }rem`\n\t\t\t\t\t: '2rem',\n\t\t\t};\n\n\t\t\tlet contentStyle = {\n\t\t\t\tmargin: `${contentMargin}rem`,\n\t\t\t\twidth: `calc(100% - ${2 * contentMargin}rem)`,\n\t\t\t\theight: `calc(100% - ${2 * contentMargin}rem)`,\n\t\t\t};\n\n\t\t\treturn (\n\t\t\t\t<div className={menuClasses} style={menuStyle}>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"ptr-simple-layers-control-menu-content\"\n\t\t\t\t\t\tstyle={contentStyle}\n\t\t\t\t\t>\n\t\t\t\t\t\t{layers.map(layer =>\n\t\t\t\t\t\t\tthis.renderTile(layer, tileWidth, tileHeight, tileMargin)\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\trenderTile(layer, width, height, margin) {\n\t\tlet active = layer.key === this.props.activeLayer.key;\n\n\t\tlet classes = classnames('ptr-simple-layers-control-tile', {\n\t\t\tactive,\n\t\t});\n\n\t\tlet style = {\n\t\t\twidth: `${width}rem`,\n\t\t\theight: `${height}rem`,\n\t\t\tmargin: `${margin}rem`,\n\t\t};\n\n\t\tif (layer.thumbnail) {\n\t\t\t// TODO check type of thumbnail\n\t\t\t// style.backgroundImage = `url(${require('./img/' + layer.thumbnail + '.png')})`;\n\t\t}\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tkey={layer.key}\n\t\t\t\tstyle={style}\n\t\t\t\tclassName={classes}\n\t\t\t\tonClick={this.onLayerTileClick.bind(this, layer.key)}\n\t\t\t>\n\t\t\t\t<div className=\"ptr-simple-layers-control-tile-name\">{layer.name}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tgetGrid(count) {\n\t\tlet width = 1;\n\t\tlet height = 1;\n\n\t\t// TODO solve 9+ cases\n\t\tif (count >= 7) {\n\t\t\twidth = 3;\n\t\t\theight = 3;\n\t\t} else if (count >= 5) {\n\t\t\twidth = 2;\n\t\t\theight = 3;\n\t\t} else if (count === 4) {\n\t\t\twidth = 2;\n\t\t\theight = 2;\n\t\t} else if (count === 3) {\n\t\t\theight = 3;\n\t\t} else if (count === 2) {\n\t\t\theight = 2;\n\t\t}\n\n\t\treturn {width, height};\n\t}\n}\n\nexport default SimpleLayersControl;\n","import WorldWind from 'webworldwind-esa';\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport viewUtils from '../../../utils/view';\n\nconst {Angle, WWMath} = WorldWind;\n\n/**\n * @param {WorldWind.WorldWindController} basicController\n * @param {Object} viewLimits\n */\nexport default function (basicController, viewLimits, levelsBased) {\n\t//Customized applyLimits function that call onNavigatorChanged on every execution\n\tconst applyLimits = () => {\n\t\tlet navigator = basicController.wwd.navigator;\n\t\tconst {width, height} = basicController.wwd.viewport;\n\n\t\tif (!levelsBased) {\n\t\t\tlet minBoxRange =\n\t\t\t\t(viewLimits &&\n\t\t\t\t\tviewLimits.boxRangeRange &&\n\t\t\t\t\tviewLimits.boxRangeRange[0]) ||\n\t\t\t\tmapConstants.minBoxRange;\n\t\t\tlet maxBoxRange =\n\t\t\t\t(viewLimits &&\n\t\t\t\t\tviewLimits.boxRangeRange &&\n\t\t\t\t\tviewLimits.boxRangeRange[1]) ||\n\t\t\t\tmapConstants.maxBoxRange;\n\t\t\tlet currentRange = viewUtils.getBoxRangeFromWorldWindRange(\n\t\t\t\tnavigator.range,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\n\t\t\tif (currentRange < minBoxRange) {\n\t\t\t\tnavigator.range = viewUtils.getWorldWindRangeFromBoxRange(\n\t\t\t\t\tminBoxRange,\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t} else if (currentRange > maxBoxRange) {\n\t\t\t\tnavigator.range = viewUtils.getWorldWindRangeFromBoxRange(\n\t\t\t\t\tmaxBoxRange,\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// TODO apply other viewLimits params\n\n\t\t// Clamp latitude to between -90 and +90, and normalize longitude to between -180 and +180.\n\t\tnavigator.lookAtLocation.latitude = WWMath.clamp(\n\t\t\tnavigator.lookAtLocation.latitude,\n\t\t\t-90,\n\t\t\t90\n\t\t);\n\t\tnavigator.lookAtLocation.longitude = Angle.normalizedDegreesLongitude(\n\t\t\tnavigator.lookAtLocation.longitude\n\t\t);\n\n\t\t// Normalize heading to between -180 and +180.\n\t\tnavigator.heading = Angle.normalizedDegrees(navigator.heading);\n\n\t\t// Clamp tilt to between 0 and +90 to prevent the viewer from going upside down.\n\t\tnavigator.tilt = WWMath.clamp(navigator.tilt, 0, 90);\n\n\t\t// Normalize heading to between -180 and +180.\n\t\tnavigator.roll = Angle.normalizedDegrees(navigator.roll);\n\n\t\t// Apply 2D limits when the globe is 2D.\n\t\tif (basicController.wwd.globe.is2D() && navigator.enable2DLimits) {\n\t\t\t// Clamp range to prevent more than 360 degrees of visible longitude. Assumes a 45 degree horizontal\n\t\t\t// field of view.\n\t\t\tvar maxRange = 2 * Math.PI * basicController.wwd.globe.equatorialRadius;\n\t\t\tnavigator.range = WWMath.clamp(navigator.range, 1, maxRange);\n\n\t\t\t// Force tilt to 0 when in 2D mode to keep the viewer looking straight down.\n\t\t\tnavigator.tilt = 0;\n\t\t}\n\n\t\t//event map changed\n\t\tif (typeof basicController.onNavigatorChanged === 'function') {\n\t\t\tbasicController.onNavigatorChanged(navigator);\n\t\t}\n\t};\n\n\tbasicController.applyLimits = applyLimits;\n\tbasicController.onNavigatorChanged = null;\n}\n","import WorldWind from 'webworldwind-esa';\nimport utils from '@gisatcz/ptr-utils';\nimport {forIn as _forIn, includes as _includes} from 'lodash';\nimport constants from '../../constants';\n\n/**\n * @param layer {Object}\n * @param layer.key {string}\n * @param layer.name {string}\n * @param layer.opacity {number}\n * @param layer.options {Object}\n * @param layer.options.features {Array}\n * @augments WorldWind.RenderableLayer\n * @constructor\n */\nclass VectorLayer extends WorldWind.RenderableLayer {\n\tconstructor(layer, options) {\n\t\tconst name = layer.name || '';\n\t\tsuper(name);\n\n\t\tthis.opacity = layer.opacity || 1;\n\n\t\tthis.pantherProps = {\n\t\t\tfeatures: options.features || [],\n\t\t\tfidColumnName: options.fidColumnName,\n\t\t\thoverable: options.hoverable,\n\t\t\tselectable: options.selectable,\n\t\t\thovered: {...options.hovered},\n\t\t\tselected: {...options.selected},\n\t\t\tkey: layer.key,\n\t\t\tlayerKey: options.layerKey,\n\t\t\tonHover: options.onHover,\n\t\t\tonClick: options.onClick,\n\t\t\tstyle: options.style,\n\t\t};\n\n\t\tthis.addFeatures(this.pantherProps.features);\n\t}\n\n\t/**;\n\t * @param features {Array} List of GeoJSON features\n\t */\n\taddFeatures(features) {\n\t\tlet geojson = {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: features,\n\t\t};\n\n\t\tconst parser = new WorldWind.GeoJSONParser(geojson);\n\n\t\tconst shapeConfigurationCallback = (geometry, properties) => {\n\t\t\tconst defaultStyleObject = utils.mapStyle.getStyleObject(\n\t\t\t\tproperties,\n\t\t\t\tthis.pantherProps.style || constants.vectorFeatureStyle.defaultFull\n\t\t\t);\n\t\t\tconst defaultStyle = this.getStyleDefinition(defaultStyleObject);\n\n\t\t\tlet hoveredStyleObject, hoveredStyle;\n\t\t\tif (this.pantherProps.hovered?.style) {\n\t\t\t\thoveredStyleObject =\n\t\t\t\t\tthis.pantherProps.hovered.style === 'default'\n\t\t\t\t\t\t? constants.vectorFeatureStyle.hovered\n\t\t\t\t\t\t: this.pantherProps.hovered.style;\n\t\t\t\thoveredStyle = this.getStyleDefinition({\n\t\t\t\t\t...defaultStyleObject,\n\t\t\t\t\t...hoveredStyleObject,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserProperties: {\n\t\t\t\t\t...properties,\n\t\t\t\t\tdefaultStyleObject,\n\t\t\t\t\tdefaultStyle,\n\t\t\t\t\thoveredStyleObject,\n\t\t\t\t\thoveredStyle,\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\n\t\tconst renderablesAddCallback = layer => {\n\t\t\tlayer.renderables.forEach(renderable => {\n\t\t\t\tthis.applyStyles(renderable);\n\t\t\t});\n\t\t};\n\n\t\tparser.load(renderablesAddCallback, shapeConfigurationCallback, this);\n\t}\n\n\t/**\n\t * @param fids {Array}\n\t */\n\tupdateHoveredFeatures(fids) {\n\t\tthis.renderables.forEach(renderable => {\n\t\t\tconst key = renderable.userProperties[this.pantherProps.fidColumnName];\n\t\t\tif (_includes(fids, key)) {\n\t\t\t\tconst selection = this.getSelection(renderable);\n\t\t\t\tif (selection?.hoveredStyle) {\n\t\t\t\t\tlet selectedHoveredStyleObject =\n\t\t\t\t\t\tselection.hoveredStyle === 'default'\n\t\t\t\t\t\t\t? constants.vectorFeatureStyle.selectedHovered\n\t\t\t\t\t\t\t: selection.hoveredStyle;\n\t\t\t\t\tlet selectedHoveredStyle = this.getStyleDefinition({\n\t\t\t\t\t\t...renderable.userProperties.defaultStyleObject,\n\t\t\t\t\t\t...selectedHoveredStyleObject,\n\t\t\t\t\t});\n\t\t\t\t\tthis.applyWorldWindStyles(renderable, selectedHoveredStyle);\n\t\t\t\t} else if ((renderable, renderable.userProperties.hoveredStyle)) {\n\t\t\t\t\tthis.applyWorldWindStyles(\n\t\t\t\t\t\trenderable,\n\t\t\t\t\t\trenderable.userProperties.hoveredStyle\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.applyStyles(renderable);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Convert panther style definition to World Wind style definition\n\t * @param styleObject {Object}\n\t * @return {Object}\n\t */\n\tgetStyleDefinition(styleObject) {\n\t\tlet style = {};\n\n\t\tif (styleObject.fill) {\n\t\t\tconst fillRgb = utils.mapStyle.hexToRgb(styleObject.fill);\n\t\t\tstyle.interiorColor = new WorldWind.Color(\n\t\t\t\tfillRgb.r / 255,\n\t\t\t\tfillRgb.g / 256,\n\t\t\t\tfillRgb.b / 256,\n\t\t\t\tstyleObject.fillOpacity || 1\n\t\t\t);\n\t\t} else {\n\t\t\tstyle.interiorColor = WorldWind.Color.TRANSPARENT;\n\t\t}\n\n\t\tif (styleObject.outlineColor && styleObject.outlineWidth) {\n\t\t\tconst outlineRgb = utils.mapStyle.hexToRgb(styleObject.outlineColor);\n\t\t\tstyle.outlineColor = new WorldWind.Color(\n\t\t\t\toutlineRgb.r / 255,\n\t\t\t\toutlineRgb.g / 256,\n\t\t\t\toutlineRgb.b / 256,\n\t\t\t\tstyleObject.outlineOpacity || 1\n\t\t\t);\n\t\t\tstyle.outlineWidth = styleObject.outlineWidth;\n\t\t} else {\n\t\t\tstyle.outlineColor = WorldWind.Color.TRANSPARENT;\n\t\t}\n\n\t\treturn style;\n\t}\n\n\t/**\n\t * Get selection for feature\n\t * @param renderable {Object}\n\t * @return {Object}\n\t */\n\tgetSelection(renderable) {\n\t\tif (this.pantherProps.selected) {\n\t\t\tconst featureKey =\n\t\t\t\trenderable.userProperties[this.pantherProps.fidColumnName];\n\t\t\tlet selectionDefintion = null;\n\n\t\t\t_forIn(this.pantherProps.selected, (selection, key) => {\n\t\t\t\tif (selection.keys && _includes(selection.keys, featureKey)) {\n\t\t\t\t\tselectionDefintion = selection;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn selectionDefintion;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * @param renderable {WorldWind.Renderable}\n\t */\n\tapplyStyles(renderable) {\n\t\tconst defaultStyleObject = renderable.userProperties.defaultStyleObject;\n\t\tconst selection = this.getSelection(renderable);\n\n\t\tif (selection?.style) {\n\t\t\tconst selectedStyleObject =\n\t\t\t\tselection.style === 'default'\n\t\t\t\t\t? constants.vectorFeatureStyle.selected\n\t\t\t\t\t: selection.style;\n\t\t\tconst selectedStyle = this.getStyleDefinition({\n\t\t\t\t...defaultStyleObject,\n\t\t\t\t...selectedStyleObject,\n\t\t\t});\n\t\t\tthis.applyWorldWindStyles(renderable, selectedStyle);\n\t\t} else {\n\t\t\tthis.applyWorldWindStyles(\n\t\t\t\trenderable,\n\t\t\t\trenderable.userProperties.defaultStyle\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * @param renderable {WorldWind.Renderable}\n\t * @param style {Object}\n\t */\n\tapplyWorldWindStyles(renderable, style) {\n\t\trenderable.attributes.outlineWidth = style.outlineWidth;\n\t\trenderable.attributes.outlineColor = style.outlineColor;\n\t\trenderable.attributes.interiorColor = style.interiorColor;\n\t}\n}\n\nexport default VectorLayer;\n","import WorldWind from 'webworldwind-esa';\n\nconst {Location, Sector, MercatorTiledImageLayer} = WorldWind;\n\n/**\n * Constructs an Open Street Map layer.\n * @alias OpenStreetMapImageLayer\n * @constructor\n * @augments MercatorTiledImageLayer\n * @classdesc Provides a layer that shows Open Street Map imagery.\n *\n * @param {String} displayName This layer's display name. \"Open Street Map\" if this parameter is\n * null or undefined.\n */\nclass OsmLayer extends MercatorTiledImageLayer {\n\tconstructor(displayName) {\n\t\tdisplayName = displayName || 'Open Street Map';\n\n\t\tsuper(\n\t\t\tnew Sector(-85.05, 85.05, -180, 180),\n\t\t\tnew Location(85.05, 180),\n\t\t\t19,\n\t\t\t'image/png',\n\t\t\tdisplayName,\n\t\t\t256,\n\t\t\t256\n\t\t);\n\n\t\tthis.displayName = displayName;\n\t\tthis.pickEnabled = false;\n\n\t\t// Create a canvas we can use when unprojecting retrieved images.\n\t\tthis.destCanvas = document.createElement('canvas');\n\t\tthis.destContext = this.destCanvas.getContext('2d');\n\n\t\tthis.urlBuilder = {\n\t\t\turlForTile: function (tile, imageFormat) {\n\t\t\t\t//var url = \"https://a.tile.openstreetmap.org/\" +\n\t\t\t\treturn (\n\t\t\t\t\t'https://otile1.mqcdn.com/tiles/1.0.0/osm/' +\n\t\t\t\t\t(tile.level.levelNumber + 1) +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.column +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.row +\n\t\t\t\t\t'.png'\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\n\t\tthis.doRender = this.doRender.bind(this);\n\t}\n\n\tdoRender(dc) {\n\t\tMercatorTiledImageLayer.prototype.doRender.call(this, dc);\n\t}\n\n\t// Overridden from TiledImageLayer.\n\tcreateTopLevelTiles(dc) {\n\t\tthis.topLevelTiles = [];\n\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 0, 0)\n\t\t);\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 0, 1)\n\t\t);\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 1, 0)\n\t\t);\n\t\tthis.topLevelTiles.push(\n\t\t\tthis.createTile(null, this.levels.firstLevel(), 1, 1)\n\t\t);\n\t}\n\n\t// Determines the Bing map size for a specified level number.\n\tmapSizeForLevel(levelNumber) {\n\t\treturn 256 << (levelNumber + 1);\n\t}\n}\n\nexport default OsmLayer;\n","import OsmLayer from './OsmLayer';\nimport WorldWind from 'webworldwind-esa';\n\nconst {ArgumentError, Logger} = WorldWind;\n\nclass WikimediaLayer extends OsmLayer {\n\tconstructor(options) {\n\t\tsuper('');\n\t\tthis.imageSize = 256;\n\n\t\tif (!options.source && !options.sourceObject) {\n\t\t\tthrow new ArgumentError(\n\t\t\t\tLogger.logMessage(\n\t\t\t\t\tLogger.LEVEL_SEVERE,\n\t\t\t\t\t'MyOsmLayer',\n\t\t\t\t\t'constructor',\n\t\t\t\t\t'missingSource'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis._source = options.sourceObject\n\t\t\t? this.buildSourceUrl(options.sourceObject)\n\t\t\t: options.source;\n\t\tthis._attribution = options.attribution;\n\t\tthis._imageType = options.imageType ? options.imageType : 'png';\n\n\t\tthis.cachePath = this._source;\n\t\tthis.detailControl = options.detailControl ? options.detailControl : 1;\n\t\tthis.levels.numLevels = 18;\n\n\t\tlet self = this;\n\t\tthis.urlBuilder = {\n\t\t\turlForTile: function (tile, imageFormat) {\n\t\t\t\treturn (\n\t\t\t\t\tself._source +\n\t\t\t\t\t(tile.level.levelNumber + 1) +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.column +\n\t\t\t\t\t'/' +\n\t\t\t\t\ttile.row +\n\t\t\t\t\t'.' +\n\t\t\t\t\tself._imageType\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Build source URL\n\t * @param source {Object}\n\t * @returns {string} URL of source\n\t */\n\tbuildSourceUrl(source) {\n\t\tlet prefix = this.buildPrefix(source.prefixes);\n\t\tlet protocol = source.protocol ? source.protocol + '://' : 'http://';\n\t\tlet host = source.host + '/';\n\t\tlet path = source.path ? source.path + '/' : '';\n\n\t\treturn protocol + prefix + host + path;\n\t}\n\n\tbuildPrefix(prefixes) {\n\t\tlet prefix = '';\n\t\tif (prefixes) {\n\t\t\tlet index = Math.floor(Math.random() * prefixes.length);\n\t\t\tprefix = prefixes[index] + '.';\n\t\t}\n\t\treturn prefix;\n\t}\n}\n\nexport default WikimediaLayer;\n","import WorldWind from 'webworldwind-esa';\nimport {isEmpty as _isEmpty} from 'lodash';\n\n/**\n * @param layer {Object}\n * @param layer.key {string}\n * @param layer.opacity {number}\n * @param layer.options {Object}\n * @param layer.options.url {string}\n * @param layer.options.params {object}\n * @augments WorldWind.WmsLayer\n * @constructor\n */\nclass WmsLayer extends WorldWind.WmsLayer {\n\tconstructor(layer) {\n\t\tconst {key, options, opacity} = layer;\n\t\tconst {\n\t\t\timageFormat,\n\t\t\tlayers,\n\t\t\tname,\n\t\t\tstyles,\n\t\t\tversion,\n\t\t\t...params\n\t\t} = options.params;\n\n\t\tconst worldWindOptions = {\n\t\t\tkey: key,\n\t\t\tformat: imageFormat || 'image/png',\n\t\t\tlayerNames: layers,\n\t\t\tlevelZeroDelta: new WorldWind.Location(45, 45),\n\t\t\tname: name,\n\t\t\tnumLevels: 18,\n\t\t\topacity: opacity || 1,\n\t\t\tparams: _isEmpty(params) ? null : params,\n\t\t\tsector: new WorldWind.Sector(-90, 90, -180, 180),\n\t\t\tservice: options.url,\n\t\t\tsize: 256,\n\t\t\tstyleNames: styles,\n\t\t\tversion: version || '1.3.0',\n\t\t};\n\n\t\tsuper(worldWindOptions);\n\n\t\tthis.key = key;\n\t\tthis.attributions = options.attributions;\n\t\tthis.layerNames = layers;\n\t\tthis.service = options.url;\n\t\tthis.styleNames = styles || '';\n\t\tthis.customParams = params;\n\t\tthis.numLevels = worldWindOptions.numLevels;\n\n\t\tthis.cachePath = `${this.service}/${this.layerNames}`;\n\t\tif (this.styleNames) {\n\t\t\tthis.cachePath += `/${this.styleNames}`;\n\t\t}\n\t\tif (this.customParams && this.customParams.time) {\n\t\t\tthis.cachePath += `/${this.customParams.time}`;\n\t\t}\n\n\t\tthis.opacity = worldWindOptions.opacity;\n\n\t\t// TODO extend url builder to accept custom params\n\t}\n\n\tdoRender(dc) {\n\t\tWorldWind.WmsLayer.prototype.doRender.call(this, dc);\n\t\tdc.screenCreditController.clear();\n\t}\n}\n\nexport default WmsLayer;\n","import OsmLayer from './OsmLayer';\nimport WorldWind from 'webworldwind-esa';\nimport uriTemplates from 'uri-templates';\n\nclass WmtsLayer extends OsmLayer {\n\tconstructor(layer) {\n\t\tsuper('');\n\t\tthis.imageSize = 256;\n\t\tthis.detailControl = 1;\n\t\tthis.levels.numLevels = 18;\n\n\t\tthis.cachePath = layer.options.url;\n\t\tthis.urlBuilder = {\n\t\t\t...this.urlBuilder,\n\t\t\turlForTile: this.urlForTile.bind(this, layer.options.url),\n\t\t};\n\t}\n\n\t/**\n\t * @param url {string} URL template\n\t * @param tile {Tile}\n\t * @param imageFormat {string}\n\t * @returns {string} Final url for request\n\t */\n\turlForTile(url, tile, imageFormat) {\n\t\tlet template = uriTemplates(url);\n\t\tif (template && template.varNames && template.varNames.length) {\n\t\t\tlet prefixes = ['a', 'b', 'c']; // TODO optional\n\t\t\tlet numberOfUrls = prefixes.length;\n\t\t\tlet index = tile.row % numberOfUrls;\n\n\t\t\treturn template.fill({\n\t\t\t\ts: prefixes[index],\n\t\t\t\tz: tile.level.levelNumber + 1,\n\t\t\t\tx: tile.column,\n\t\t\t\ty: tile.row,\n\t\t\t});\n\t\t} else {\n\t\t\treturn `${url}/${tile.level.levelNumber + 1}/${tile.column}/${\n\t\t\t\ttile.row\n\t\t\t}.${WorldWind.WWUtil.suffixForMimeType(imageFormat)}`;\n\t\t}\n\t}\n}\n\nexport default WmtsLayer;\n","/**\n * @param context\n * @param x0 {number} starting x coordinate\n * @param y0 {number} starting y coordinate\n * @param x1 {number} ending x coordinate\n * @param y1 {number} ending y coordinate\n * @param color {string} hex code\n * @param width {number} line width in pixels\n */\nfunction arrow(context, x0, y0, x1, y1, color, width) {\n\tcontext.beginPath();\n\tcontext.moveTo(x0, y0);\n\tcontext.lineTo(x1, y1);\n\tcontext.strokeStyle = color;\n\tcontext.lineWidth = width;\n\tcontext.stroke();\n}\n\n/**\n * @param context\n * @param cx {number} x coordinate of center\n * @param cy {number} y coordinate of center\n * @param rx {number} x radius\n * @param ry {number} y radius\n * @param style {Object}\n */\nfunction ellipse(context, cx, cy, rx, ry, style) {\n\tcontext.save(); // save state\n\tcontext.beginPath();\n\n\tcontext.translate(cx - rx, cy - ry);\n\tcontext.scale(rx, ry);\n\tcontext.arc(1, 1, 1, 0, 2 * Math.PI, false);\n\n\tfillPolygon(context, style);\n}\n\nfunction path(context, nodes, style) {\n\tcontext.save(); // save state\n\tcontext.beginPath();\n\n\tnodes.forEach((node, index) => {\n\t\tif (index === 0) {\n\t\t\tcontext.moveTo(node[0], node[1]);\n\t\t} else {\n\t\t\tcontext.lineTo(node[0], node[1]);\n\t\t}\n\t});\n\n\tfillPolygon(context, style);\n}\n\n/**\n *\n * @param context\n * @param x0\n * @param y0\n * @param dx\n * @param dy\n * @param style\n */\nfunction rectangle(context, x0, y0, dx, dy, style) {\n\tcontext.save(); // save state\n\tcontext.beginPath();\n\tcontext.rect(x0, y0, dx, dy);\n\n\tfillPolygon(context, style);\n}\n\n// helpers\nfunction fillPolygon(context, style) {\n\tcontext.restore(); // restore to original state\n\tcontext.fillStyle = style.fill;\n\tcontext.lineWidth = style.outlineWidth;\n\tcontext.strokeStyle = style.outlineColor;\n\tcontext.globalAlpha = style.fillOpacity || style.outlineOpacity; // TODO solve opacity properly\n\tcontext.fill();\n\tcontext.stroke();\n}\n\nexport default {\n\tarrow,\n\tellipse,\n\tpath,\n\trectangle,\n};\n","/**\n * Constructs a HeatMapTile.\n *\n * Returns one tile for the HeatMap information. It is basically an interface specifying the public methods\n * properties and default configuration. The logic itself is handled in the subclasses.\n *\n * @alias HeatMapTile\n * @constructor\n * @classdesc Tile for the HeatMap layer visualising data on a canvas using shades of gray scale.\n *\n * @param data {Object[]} Array of information constituting points in the map.\n * @param options {Object}\n * @param options.sector {Sector} Sector representing the geographical area for this tile. It is used to correctly\n *  interpret the location of the MeasuredLocation on the resulting canvas.\n * @param options.width {Number} Width of the Canvas to be created in pixels.\n * @param options.height {Number} Height of the Canvas to be created in pixels.\n * @param options.radius {Number} Radius of the data point in pixels. The radius represents the blur applied to the\n *  drawn shape\n * @param options.incrementPerIntensity {Number} The ratio representing the 1 / measure for the maximum measure.\n * @param options.intensityGradient {Object} Keys represent the opacity between 0 and 1 and the values represent\n *  color strings.\n */\nimport {mapStyle} from '@gisatcz/ptr-utils';\nimport {isEmpty as _isEmpty, forIn as _forIn} from 'lodash';\nimport shapes from './canvasShapes';\n\nclass LargeDataLayerTile {\n\tconstructor(data, options, style, fidColumnName, selected, hovered) {\n\t\tthis._data = data;\n\t\tthis._style = style;\n\t\tthis._fidColumnName = fidColumnName;\n\t\tthis._hovered = hovered;\n\n\t\t// todo here?\n\t\tif (this._hovered && this._hovered.keys) {\n\t\t\tthis._hoveredStyle = mapStyle.getStyleObject(\n\t\t\t\tnull,\n\t\t\t\tthis._hovered.style,\n\t\t\t\ttrue\n\t\t\t); // todo add default\n\t\t}\n\n\t\tif (selected && !_isEmpty(selected)) {\n\t\t\tlet sel = [];\n\t\t\t_forIn(selected, selectedDef => {\n\t\t\t\tif (selectedDef && !_isEmpty(selectedDef)) {\n\t\t\t\t\tsel.push({\n\t\t\t\t\t\tkeys: selectedDef.keys,\n\t\t\t\t\t\tstyle: mapStyle.getStyleObject(null, selectedDef.style, true), // todo add default\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._selected = sel.length ? sel : null;\n\t\t}\n\n\t\tthis._sector = options.sector;\n\n\t\tthis._canvas = this.createCanvas(options.width, options.height);\n\n\t\tthis._width = options.width;\n\t\tthis._height = options.height;\n\n\t\tconst tileCenterLatitude =\n\t\t\t((this._sector.maxLatitude + this._sector.minLatitude) *\n\t\t\t\t(Math.PI / 180)) /\n\t\t\t2;\n\t\tthis._latitudeFactor = 1 / Math.cos(Math.abs(tileCenterLatitude));\n\t}\n\n\t/**\n\t * Returns the drawn HeatMapTile in the form of URL.\n\t * @return {String} Data URL of the tile.\n\t */\n\turl() {\n\t\treturn this.draw().toDataURL();\n\t}\n\n\t/**\n\t * Returns the whole Canvas. It is then possible to use further. This one is actually used in the\n\t * HeatMapLayer mechanism so if you want to provide some custom implementation of Canvas creation in your tile,\n\t * change this method.\n\t * @return {HTMLCanvasElement} Canvas Element representing the drawn tile.\n\t */\n\tcanvas() {\n\t\treturn this.draw();\n\t}\n\n\t/**\n\t * Draws the shapes on the canvas.\n\t * @returns {HTMLCanvasElement}\n\t */\n\tdraw() {\n\t\tconst ctx = this._canvas.getContext('2d');\n\t\tlet hovered = [];\n\t\tlet selected = [];\n\n\t\tfor (let i = 0; i < this._data.length; i++) {\n\t\t\tconst dataPoint = this._data[i];\n\t\t\tconst attributes = dataPoint.data;\n\n\t\t\tlet isHovered = this.isHovered(attributes);\n\t\t\tlet isSelected = this.isSelected(attributes);\n\n\t\t\tif (isSelected) {\n\t\t\t\tselected.push(dataPoint);\n\t\t\t} else if (isHovered) {\n\t\t\t\thovered.push(dataPoint);\n\t\t\t} else {\n\t\t\t\tthis.shape(ctx, dataPoint);\n\t\t\t}\n\t\t}\n\n\t\t// draw hovered\n\t\thovered.forEach(dataPoint => {\n\t\t\tthis.shape(ctx, dataPoint, true);\n\t\t});\n\n\t\t// draw selected\n\t\tselected.forEach(dataPoint => {\n\t\t\tthis.shape(ctx, dataPoint, false, true);\n\t\t});\n\n\t\treturn this._canvas;\n\t}\n\n\tisHovered(attributes) {\n\t\tif (this._hovered && this._hovered.keys) {\n\t\t\treturn this._hovered.keys.indexOf(attributes[this._fidColumnName]) !== -1;\n\t\t}\n\t}\n\n\tisSelected(attributes) {\n\t\tlet isSelected = false;\n\t\tif (this._selected) {\n\t\t\tthis._selected.forEach(selection => {\n\t\t\t\tlet selected =\n\t\t\t\t\tselection.keys.indexOf(attributes[this._fidColumnName]) !== -1;\n\t\t\t\tif (selected) {\n\t\t\t\t\tisSelected = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn isSelected;\n\t}\n\n\tshape(context, data, hovered, selected) {\n\t\tlet attributes = data.data;\n\t\tlet style = mapStyle.getStyleObject(attributes, this._style);\n\n\t\t// apply hovered style, if feature is hovered\n\t\tif (hovered) {\n\t\t\tstyle = {...style, ...this._hoveredStyle};\n\t\t}\n\n\t\t// TODO optimize looping through selections two times\n\t\t// apply selected style, if feature is selected\n\t\tif (selected) {\n\t\t\tthis._selected.forEach(selection => {\n\t\t\t\tlet selected =\n\t\t\t\t\tselection.keys.indexOf(attributes[this._fidColumnName]) !== -1;\n\t\t\t\tif (selected) {\n\t\t\t\t\tstyle = {...style, ...selection.style};\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (style.shape) {\n\t\t\tif (style.shape === 'circle-with-arrow') {\n\t\t\t\tthis.circleWithArrow(context, data, style);\n\t\t\t} else if (style.shape === 'circle') {\n\t\t\t\tthis.point(context, data, style);\n\t\t\t} else if (style.shape === 'square') {\n\t\t\t\tthis.square(context, data, style);\n\t\t\t} else if (style.shape === 'diamond') {\n\t\t\t\tthis.diamond(context, data, style);\n\t\t\t} else if (style.shape === 'triangle') {\n\t\t\t\tthis.triangle(context, data, style);\n\t\t\t} else {\n\t\t\t\tthis.point(context, data, style);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.point(context, data, style);\n\t\t}\n\t}\n\n\tpoint(context, data, style) {\n\t\tlet radius = this.getSize(style) / 2;\n\t\tlet center = this.getCenterCoordinates(data);\n\t\tlet cy = radius;\n\t\tlet cx = radius * this._latitudeFactor;\n\n\t\tshapes.ellipse(context, center[0], center[1], cx, cy, style);\n\t}\n\n\tsquare(context, data, style) {\n\t\tlet size = this.getSize(style);\n\t\tlet center = this.getCenterCoordinates(data);\n\t\tlet dx = size * this._latitudeFactor;\n\n\t\tshapes.rectangle(\n\t\t\tcontext,\n\t\t\tcenter[0] - dx / 2,\n\t\t\tcenter[1] - size / 2,\n\t\t\tdx,\n\t\t\tsize,\n\t\t\tstyle\n\t\t);\n\t}\n\n\tdiamond(context, data, style) {\n\t\tlet edgeLength = this.getSize(style);\n\t\tlet diagonalLength = Math.sqrt(2) * edgeLength;\n\n\t\t// center coordinates\n\t\tlet center = this.getCenterCoordinates(data);\n\n\t\tlet dx = diagonalLength * this._latitudeFactor;\n\t\tlet nodes = [\n\t\t\t[center[0] - dx / 2, center[1]],\n\t\t\t[center[0], center[1] - diagonalLength / 2],\n\t\t\t[center[0] + dx / 2, center[1]],\n\t\t\t[center[0], center[1] + diagonalLength / 2],\n\t\t\t[center[0] - dx / 2, center[1]],\n\t\t];\n\n\t\tshapes.path(context, nodes, style);\n\t}\n\n\ttriangle(context, data, style) {\n\t\tlet edgeLength = this.getSize(style);\n\t\tlet ty = Math.sqrt(Math.pow(edgeLength, 2) - Math.pow(edgeLength / 2, 2));\n\n\t\t// center coordinates\n\t\tlet center = this.getCenterCoordinates(data);\n\n\t\tlet dx = edgeLength * this._latitudeFactor;\n\t\tlet nodes = [\n\t\t\t[center[0] - dx / 2, center[1] + ty / 3],\n\t\t\t[center[0], center[1] - (2 * ty) / 3],\n\t\t\t[center[0] + dx / 2, center[1] + ty / 3],\n\t\t\t[center[0] - dx / 2, center[1] + ty / 3],\n\t\t];\n\n\t\tshapes.path(context, nodes, style);\n\t}\n\n\tcircleWithArrow(context, data, style) {\n\t\tlet radius = this.getSize(style) / 2;\n\t\tlet direction = style.arrowDirection || 1;\n\n\t\tlet center = this.getCenterCoordinates(data);\n\t\tlet ry = radius;\n\t\tlet rx = radius * this._latitudeFactor;\n\n\t\tshapes.ellipse(context, center[0], center[1], rx, ry, style);\n\n\t\tlet x0 = center[0] + direction * rx;\n\t\tlet y0 = center[1];\n\t\tlet x1 = x0 + direction * style.arrowLength;\n\t\tlet y1 = y0;\n\n\t\tshapes.arrow(context, x0, y0, x1, y1, style.arrowColor, style.arrowWidth);\n\t}\n\n\tgetSize(style) {\n\t\tif (style.size) {\n\t\t\treturn style.size;\n\t\t} else if (style.volume) {\n\t\t\tif (style.shape === 'triangle') {\n\t\t\t\treturn Math.sqrt(style.volume / 2);\n\t\t\t} else if (style.shape === 'square' || style.shape === 'diamond') {\n\t\t\t\treturn Math.sqrt(style.volume);\n\t\t\t} else {\n\t\t\t\treturn Math.sqrt(style.volume / Math.PI);\n\t\t\t}\n\t\t} else {\n\t\t\treturn mapStyle.DEFAULT_SIZE;\n\t\t}\n\t}\n\n\tgetCenterCoordinates(data) {\n\t\treturn [\n\t\t\tthis.longitudeInSector(data, this._sector, this._width),\n\t\t\tthis._height - this.latitudeInSector(data, this._sector, this._height),\n\t\t];\n\t}\n\n\t/**\n\t * Creates canvas element of given size.\n\t * @protected\n\t * @param width {Number} Width of the canvas in pixels\n\t * @param height {Number} Height of the canvas in pixels\n\t * @returns {HTMLCanvasElement} Created the canvas\n\t */\n\tcreateCanvas(width, height) {\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\treturn canvas;\n\t}\n\n\t/**\n\t * Calculates position in pixels of the point based on its latitude.\n\t * @param dataPoint {Object} Location to transform\n\t * @param sector {Sector} Sector to which transform\n\t * @param height {Number} Height of the tile to draw to.\n\t * @private\n\t * @returns {Number} Position on the height in pixels.\n\t */\n\tlatitudeInSector(dataPoint, sector, height) {\n\t\tvar sizeOfArea = sector.maxLatitude - sector.minLatitude;\n\t\tvar locationInArea = dataPoint.y - 90 - sector.minLatitude;\n\t\treturn Math.ceil((locationInArea / sizeOfArea) * height);\n\t}\n\n\t/**\n\t * Calculates position in pixels of the point based on its longitude.\n\t * @param dataPoint {Object} Location to transform\n\t * @param sector {Sector} Sector to which transform\n\t * @param width {Number} Width of the tile to draw to.\n\t * @private\n\t * @returns {Number} Position on the width in pixels.\n\t */\n\tlongitudeInSector(dataPoint, sector, width) {\n\t\tvar sizeOfArea = sector.maxLongitude - sector.minLongitude;\n\t\tvar locationInArea = dataPoint.x - 180 - sector.minLongitude;\n\t\treturn Math.ceil((locationInArea / sizeOfArea) * width);\n\t}\n}\n\nexport default LargeDataLayerTile;\n","import React from 'react';\nimport WorldWind from 'webworldwind-esa';\nimport {QuadTree, Box, Point, Circle} from 'js-quadtree';\nimport {\n\tpoint as turfPoint,\n\tfeatureCollection as turfFeatureCollection,\n} from '@turf/helpers';\nimport nearestPoint from '@turf/nearest-point';\nimport turfCentroid from '@turf/centroid';\nimport LargeDataLayerTile from './LargeDataLayerTile';\nimport {compact as _compact, each as _each} from 'lodash';\nimport {mapStyle} from '@gisatcz/ptr-utils';\n\nconst {\n\tLocation,\n\tREDRAW_EVENT_TYPE,\n\tSector,\n\tSurfaceCircle,\n\tTiledImageLayer,\n} = WorldWind;\n\n// It supports GeoJSON as format with only points and maximum 1 000 000 points.\n// Multipolygons are represented as points\n\n// TODO: Highlight the selected points.\nclass LargeDataLayer extends TiledImageLayer {\n\tconstructor(wwd, options, layer) {\n\t\tsuper(\n\t\t\tnew Sector(-90, 90, -180, 180),\n\t\t\tnew Location(45, 45),\n\t\t\t18,\n\t\t\t'image/png',\n\t\t\tlayer.key,\n\t\t\t256,\n\t\t\t256\n\t\t);\n\n\t\tthis.tileWidth = 256;\n\t\tthis.tileHeight = 256;\n\t\tthis.detailControl = 1;\n\t\tthis.wwd = wwd;\n\n\t\t// At the moment the URL must contain the GeoJSON.\n\t\tthis.processedTiles = {};\n\t\tthis.quadTree = new QuadTree(new Box(0, 0, 360, 180));\n\n\t\tthis.pantherProps = {\n\t\t\tfeatures: options.features,\n\t\t\tfidColumnName: options.fidColumnName,\n\t\t\thovered: {...options.hovered},\n\t\t\tselected: {...options.selected},\n\t\t\tkey: layer.key,\n\t\t\tlayerKey: layer.layerKey,\n\t\t\tonHover: options.onHover,\n\t\t\tonClick: options.onClick,\n\t\t\tpointHoverBuffer: options.pointHoverBuffer || mapStyle.DEFAULT_SIZE,\n\t\t\tstyle: options.style,\n\t\t\twwd: wwd,\n\t\t};\n\n\t\tif (this.pantherProps.features) {\n\t\t\tthis.addFeatures(this.pantherProps.features);\n\t\t} else {\n\t\t\tthis.loadData(options.url);\n\t\t}\n\n\t\tthis.onClick = this.onClick.bind(this, wwd);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this, wwd);\n\t\twwd.addEventListener('click', this.onClick);\n\t\twwd.addEventListener('mousemove', this.onMouseMove);\n\t}\n\n\tremoveListeners() {\n\t\tthis.pantherProps.wwd.removeEventListener('click', this.onClick);\n\t\tthis.pantherProps.wwd.removeEventListener('mousemove', this.onMouseMove);\n\t}\n\n\tloadData(url) {\n\t\tfetch(url)\n\t\t\t.then(data => {\n\t\t\t\treturn data.json();\n\t\t\t})\n\t\t\t.then(file => {\n\t\t\t\tif (file.features.length > 1000000) {\n\t\t\t\t\tthrow new Error('Too many features.');\n\t\t\t\t}\n\n\t\t\t\tthis.addFeatures(file.features);\n\t\t\t});\n\t}\n\n\taddFeatures(features) {\n\t\tfeatures.forEach(feature => {\n\t\t\tconst type = feature.geometry && feature.geometry.type;\n\t\t\tlet point = null;\n\t\t\tlet props = {...feature.properties};\n\n\t\t\t// TODO support other geometry types\n\t\t\tif (type === 'Point') {\n\t\t\t\tprops.centroid = feature.geometry.coordinates;\n\t\t\t\tpoint = new Point(\n\t\t\t\t\tfeature.geometry.coordinates[0] + 180,\n\t\t\t\t\tfeature.geometry.coordinates[1] + 90,\n\t\t\t\t\tprops\n\t\t\t\t);\n\t\t\t} else if (type === 'MultiPoint') {\n\t\t\t\tconst coordinates = feature.geometry.coordinates[0];\n\t\t\t\tprops.centroid = coordinates;\n\t\t\t\tpoint = new Point(coordinates[0] + 180, coordinates[1] + 90, props);\n\t\t\t} else if (type === 'MultiPolygon') {\n\t\t\t\tlet centroid = turfCentroid(feature.geometry);\n\t\t\t\tprops.centroid = centroid.geometry.coordinates;\n\t\t\t\tpoint = new Point(\n\t\t\t\t\tcentroid.geometry.coordinates[0] + 180,\n\t\t\t\t\tcentroid.geometry.coordinates[1] + 90,\n\t\t\t\t\tprops\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (point) {\n\t\t\t\tthis.quadTree.insert(point);\n\t\t\t}\n\t\t});\n\n\t\tthis.refresh();\n\t}\n\n\thandleEvent(wwd, event) {\n\t\tconst x =\n\t\t\t\t(event.touches && event.touches[0] && event.touches[0].clientX) ||\n\t\t\t\tevent.clientX,\n\t\t\ty =\n\t\t\t\t(event.touches && event.touches[0] && event.touches[0].clientY) ||\n\t\t\t\tevent.clientY;\n\n\t\tconst pageX =\n\t\t\t(event.touches && event.touches[0] && event.touches[0].pageX) ||\n\t\t\tevent.pageX;\n\t\tconst pageY =\n\t\t\t(event.touches && event.touches[0] && event.touches[0].pageY) ||\n\t\t\tevent.pageY;\n\n\t\tconst terrainObject = wwd\n\t\t\t.pickTerrain(wwd.canvasCoordinates(x, y))\n\t\t\t.terrainObject();\n\n\t\tlet buffer = this.getPointHoverBuffer(wwd);\n\n\t\tif (terrainObject) {\n\t\t\tconst position = terrainObject.position;\n\t\t\tlet points = this.quadTree.query(\n\t\t\t\tnew Circle(position.longitude + 180, position.latitude + 90, buffer)\n\t\t\t);\n\n\t\t\t// find nearest\n\t\t\tif (points.length > 1) {\n\t\t\t\tlet targetPoint = turfPoint([position.longitude, position.latitude]);\n\t\t\t\tlet features = points.map(point => {\n\t\t\t\t\treturn turfPoint([point.data.centroid[0], point.data.centroid[1]], {\n\t\t\t\t\t\t...point,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tlet featureCollection = turfFeatureCollection(features);\n\t\t\t\tlet nearest = nearestPoint(targetPoint, featureCollection);\n\t\t\t\tpoints = [nearest.properties];\n\t\t\t}\n\n\t\t\treturn {points, x: pageX, y: pageY};\n\t\t} else {\n\t\t\treturn {points: [], x: pageX, y: pageY};\n\t\t}\n\t}\n\n\tonMouseMove(wwd, event) {\n\t\tthis.onMouseMoveResult(this.handleEvent(wwd, event));\n\t}\n\n\tonClick(wwd, event) {\n\t\tthis.onClickResult(this.handleEvent(wwd, event));\n\t}\n\n\tonClickResult(data) {\n\t\tif (this.pantherProps.onClick) {\n\t\t\tlet gids = data.points.map(\n\t\t\t\tpoint => point.data[this.pantherProps.fidColumnName]\n\t\t\t);\n\t\t\tif (gids && gids.length) {\n\t\t\t\tthis.pantherProps.onClick(this.pantherProps.layerKey, gids);\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseMoveResult(data) {\n\t\tif (this.pantherProps.onHover) {\n\t\t\tlet gids = _compact(\n\t\t\t\tdata.points.map(point => point.data[this.pantherProps.fidColumnName])\n\t\t\t);\n\t\t\tthis.pantherProps.onHover(\n\t\t\t\tthis.pantherProps.layerKey,\n\t\t\t\tgids,\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tnull,\n\t\t\t\tdata.points,\n\t\t\t\tthis.pantherProps.fidColumnName\n\t\t\t);\n\t\t}\n\t}\n\n\tretrieveTileImage(dc, tile, suppressRedraw) {\n\t\tthis.processedTiles[tile.imagePath] = true;\n\n\t\tconst sector = tile.sector;\n\t\tconst extended = this.calculateExtendedSector(sector, 0.2, 0.2);\n\t\tconst points = this.filterGeographically(extended.sector);\n\n\t\tif (points) {\n\t\t\tvar imagePath = tile.imagePath,\n\t\t\t\tcache = dc.gpuResourceCache,\n\t\t\t\tlayer = this;\n\n\t\t\tvar canvas = this.createPointTile(points, {\n\t\t\t\tsector: sector,\n\n\t\t\t\twidth: this.tileWidth,\n\t\t\t\theight: this.tileHeight,\n\t\t\t}).canvas();\n\n\t\t\tvar texture = layer.createTexture(dc, tile, canvas);\n\t\t\tlayer.removeFromCurrentRetrievals(imagePath);\n\n\t\t\tif (texture) {\n\t\t\t\tcache.putResource(imagePath, texture, texture.size);\n\n\t\t\t\tlayer.currentTilesInvalid = true;\n\t\t\t\tlayer.absentResourceList.unmarkResourceAbsent(imagePath);\n\n\t\t\t\tif (!suppressRedraw) {\n\t\t\t\t\t// Send an event to request a redraw.\n\t\t\t\t\tconst e = document.createEvent('Event');\n\t\t\t\t\te.initEvent(REDRAW_EVENT_TYPE, true, true);\n\t\t\t\t\twindow.dispatchEvent(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO Original implementation from @jbalhar\n\t// retrieveTileImage(dc, tile, suppressRedraw) {\n\t// \t// if(tile.level.levelNumber < 14 || this.processedTiles[tile.imagePath]){\n\t// \t// \treturn;\n\t// \t// }\n\t// \tthis.processedTiles[tile.imagePath] = true;\n\t//\n\t// \tconst sector = tile.sector;\n\t// \tconst extended = this.calculateExtendedSector(sector, 0.2, 0.2);\n\t// \tconst extendedWidth = Math.ceil(extended.extensionFactorWidth * this.tileWidth);\n\t// \tconst extendedHeight = Math.ceil(extended.extensionFactorHeight * this.tileHeight);\n\t//\n\t// \tconst points = this.filterGeographically(extended.sector);\n\t//\n\t// \tif(points) {\n\t// \t\tvar imagePath = tile.imagePath,\n\t// \t\t\tcache = dc.gpuResourceCache,\n\t// \t\t\tlayer = this;\n\t//\n\t// \t\tvar canvas = this.createPointTile(points, {\n\t// \t\t\tsector: extended.sector,\n\t//\n\t// \t\t\twidth: this.tileWidth + 2 * extendedWidth,\n\t// \t\t\theight: this.tileHeight + 2 * extendedHeight\n\t// \t\t}).canvas();\n\t//\n\t// \t\tvar result = document.createElement('canvas');\n\t// \t\tresult.height = this.tileHeight;\n\t// \t\tresult.width = this.tileWidth;\n\t// \t\tresult.getContext('2d').putImageData(\n\t// \t\t\tcanvas.getContext('2d').getImageData(extendedWidth, extendedHeight, this.tileWidth, this.tileHeight),\n\t// \t\t\t0, 0\n\t// \t\t);\n\t//\n\t// \t\tvar texture = layer.createTexture(dc, tile, result);\n\t// \t\tlayer.removeFromCurrentRetrievals(imagePath);\n\t//\n\t// \t\tif (texture) {\n\t// \t\t\tcache.putResource(imagePath, texture, texture.size);\n\t//\n\t// \t\t\tlayer.currentTilesInvalid = true;\n\t// \t\t\tlayer.absentResourceList.unmarkResourceAbsent(imagePath);\n\t//\n\t// \t\t\tif (!suppressRedraw) {\n\t// \t\t\t\t// Send an event to request a redraw.\n\t// \t\t\t\tconst e = document.createEvent('Event');\n\t// \t\t\t\te.initEvent(REDRAW_EVENT_TYPE, true, true);\n\t// \t\t\t\twindow.dispatchEvent(e);\n\t// \t\t\t}\n\t// \t\t}\n\t// \t}\n\t// }\n\n\tfilterGeographically(sector) {\n\t\tconst width = sector.maxLongitude - sector.minLongitude;\n\t\tconst height = sector.maxLatitude - sector.minLatitude;\n\t\treturn this.quadTree.query(\n\t\t\tnew Box(sector.minLongitude + 180, sector.minLatitude + 90, width, height)\n\t\t);\n\t}\n\n\tcalculateExtendedSector(sector, extensionFactorWidth, extensionFactorHeight) {\n\t\tvar latitudeChange =\n\t\t\t(sector.maxLatitude - sector.minLatitude) * extensionFactorHeight;\n\t\tvar longitudeChange =\n\t\t\t(sector.maxLongitude - sector.minLongitude) * extensionFactorWidth;\n\t\treturn {\n\t\t\tsector: new Sector(\n\t\t\t\tsector.minLatitude - latitudeChange,\n\t\t\t\tsector.maxLatitude + latitudeChange,\n\t\t\t\tsector.minLongitude - longitudeChange,\n\t\t\t\tsector.maxLongitude + longitudeChange\n\t\t\t),\n\t\t\textensionFactorHeight: extensionFactorHeight,\n\t\t\textensionFactorWidth: extensionFactorWidth,\n\t\t};\n\t}\n\n\tcreatePointTile(data, options) {\n\t\treturn new LargeDataLayerTile(\n\t\t\tdata,\n\t\t\toptions,\n\t\t\tthis.pantherProps.style,\n\t\t\tthis.pantherProps.fidColumnName,\n\t\t\tthis.pantherProps.selected,\n\t\t\tthis.pantherProps.hovered\n\t\t);\n\t}\n\n\tupdateHoveredKeys(hoveredKeys, x, y) {\n\t\tthis.pantherProps.hovered.keys = hoveredKeys;\n\n\t\tconst terrainObject = this.wwd\n\t\t\t.pickTerrain(this.wwd.canvasCoordinates(x, y))\n\t\t\t.terrainObject();\n\n\t\tif (terrainObject) {\n\t\t\tconst lat = terrainObject.position.latitude;\n\t\t\tconst lon = terrainObject.position.longitude;\n\n\t\t\t_each(this.currentTiles, tile => {\n\t\t\t\tconst s = tile.sector;\n\t\t\t\tconst prev = this.previousHoveredCoordinates;\n\n\t\t\t\tconst latDiff = Math.abs(s.maxLatitude - s.minLatitude);\n\t\t\t\tconst lonDiff = Math.abs(s.maxLongitude - s.minLongitude);\n\n\t\t\t\tconst latBuffer = latDiff / 10;\n\t\t\t\tconst lonBuffer = lonDiff / 10;\n\n\t\t\t\tconst hovered =\n\t\t\t\t\tlat <= s.maxLatitude + latBuffer &&\n\t\t\t\t\tlat >= s.minLatitude - latBuffer &&\n\t\t\t\t\tlon <= s.maxLongitude + lonBuffer &&\n\t\t\t\t\tlon >= s.minLongitude - lonBuffer;\n\t\t\t\tconst previouslyHovered =\n\t\t\t\t\tprev &&\n\t\t\t\t\tprev.lat <= s.maxLatitude + latBuffer &&\n\t\t\t\t\tprev.lat >= s.minLatitude - latBuffer &&\n\t\t\t\t\tprev.lon <= s.maxLongitude + lonBuffer &&\n\t\t\t\t\tprev.lon >= s.minLongitude - lonBuffer;\n\n\t\t\t\tif (hovered || previouslyHovered) {\n\t\t\t\t\tthis.retrieveTileImage(this.wwd.drawContext, tile, true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.previousHoveredCoordinates = {lat, lon};\n\t\t}\n\t}\n\n\t/**\n\t * naive point hover buffer determination\n\t * @param wwd\n\t * @return {number} buffer in degrees\n\t */\n\tgetPointHoverBuffer(wwd) {\n\t\tconst canvasWidth = wwd.canvas.clientWidth;\n\t\tconst range = wwd.navigator.range;\n\t\tconst bufferInMeters =\n\t\t\t(range / canvasWidth) * this.pantherProps.pointHoverBuffer;\n\t\treturn bufferInMeters * 0.00001;\n\t}\n}\n\nexport default LargeDataLayer;\n","import WorldWind from 'webworldwind-esa';\n\nimport VectorLayer from './VectorLayer';\nimport WikimediaLayer from './WikimediaLayer';\nimport WmsLayer from './WmsLayer';\nimport WmtsLayer from './WmtsLayer';\nimport LargeDataLayer from './LargeDataLayerSource/LargeDataLayer';\nimport {find as _find} from 'lodash';\nimport {mapStyle} from '@gisatcz/ptr-utils';\n\nfunction getLayerByType(layerDefinition, wwd, onHover, onClick, pointAsMarker) {\n\tif (layerDefinition.type) {\n\t\tswitch (layerDefinition.type) {\n\t\t\tcase 'worldwind':\n\t\t\t\tswitch (layerDefinition.options.layer) {\n\t\t\t\t\tcase 'bingAerial':\n\t\t\t\t\t\treturn new WorldWind.BingAerialLayer(null);\n\t\t\t\t\tcase 'bluemarble':\n\t\t\t\t\t\treturn new WorldWind.BMNGLayer();\n\t\t\t\t\tcase 'wikimedia':\n\t\t\t\t\t\treturn new WikimediaLayer({\n\t\t\t\t\t\t\tattribution:\n\t\t\t\t\t\t\t\t'Wikimedia maps - Map data \\u00A9 OpenStreetMap contributors',\n\t\t\t\t\t\t\tsourceObject: {\n\t\t\t\t\t\t\t\thost: 'maps.wikimedia.org',\n\t\t\t\t\t\t\t\tpath: 'osm-intl',\n\t\t\t\t\t\t\t\tprotocol: 'https',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\tcase 'wmts':\n\t\t\t\treturn new WmtsLayer(layerDefinition);\n\t\t\tcase 'wms':\n\t\t\t\treturn new WmsLayer(layerDefinition);\n\t\t\tcase 'vector':\n\t\t\t\treturn getVectorLayer(\n\t\t\t\t\tlayerDefinition,\n\t\t\t\t\twwd,\n\t\t\t\t\tonHover,\n\t\t\t\t\tonClick,\n\t\t\t\t\tpointAsMarker\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t} else {\n\t\treturn null;\n\t}\n}\n\nfunction getVectorLayer(layerDefinition, wwd, onHover, onClick, pointAsMarker) {\n\tconst url = layerDefinition.options && layerDefinition.options.url;\n\tconst numOfFeatures =\n\t\tlayerDefinition.options &&\n\t\tlayerDefinition.options.features &&\n\t\tlayerDefinition.options.features.length;\n\tconst key = layerDefinition.key || 'Vector layer';\n\tconst layerKey = layerDefinition.layerKey || key;\n\n\tlet options = {\n\t\t...layerDefinition.options,\n\t\tkey,\n\t\tlayerKey,\n\t\tonHover,\n\t\tonClick,\n\t};\n\n\t// TODO better deciding\n\tif (url || pointAsMarker) {\n\t\toptions.pointHoverBuffer = mapStyle.DEFAULT_SIZE; // in px TODO pass pointHoverBuffer\n\t\treturn new LargeDataLayer(wwd, options, layerDefinition);\n\t} else {\n\t\treturn new VectorLayer(layerDefinition, options);\n\t}\n}\n\nfunction updateVectorLayer(layerDefinition, wwd, onHover, onClick) {\n\tlet mapLayer = null;\n\tlet layerKey = layerDefinition.layerKey;\n\tlet worldWindLayer = _find(wwd.layers, lay => {\n\t\treturn (\n\t\t\tlay.pantherProps &&\n\t\t\tlay.pantherProps.layerKey &&\n\t\t\tlay.pantherProps.layerKey === layerKey\n\t\t);\n\t});\n\n\tif (!worldWindLayer) {\n\t\tmapLayer = getLayerByType(layerDefinition, wwd, onHover, onClick);\n\t} else {\n\t\tlet prevFeatures = worldWindLayer.pantherProps.features;\n\t\tlet nextFeatures = layerDefinition.options.features;\n\n\t\tif (prevFeatures === nextFeatures) {\n\t\t\tmapLayer = worldWindLayer;\n\t\t\t// TODO still needed?\n\t\t\t// let prevHoveredKeys = worldWindLayer.pantherProps.hovered && worldWindLayer.pantherProps.hovered.keys;\n\t\t\t// let nextHoveredKeys = layerDefinition.options.hovered && layerDefinition.options.hovered.keys;\n\t\t\t// if (prevHoveredKeys !== nextHoveredKeys) {\n\t\t\t// \tworldWindLayer.updateHoveredKeys(nextHoveredKeys);\n\t\t\t// }\n\t\t} else {\n\t\t\tworldWindLayer.removeListeners();\n\t\t\tmapLayer = getLayerByType(layerDefinition, wwd, onHover, onClick);\n\t\t}\n\t}\n\n\treturn mapLayer;\n}\n\nexport default {\n\tgetLayerByType,\n\tupdateVectorLayer,\n};\n","import viewUtils from '../../utils/view';\n\nfunction getChangedViewParams(prev, next) {\n\tlet changed = {};\n\n\t// check for boxRange change, disregard if change is too small\n\tif (\n\t\tprev.boxRange !== next.boxRange &&\n\t\tMath.abs(prev.boxRange - next.boxRange) > 1\n\t) {\n\t\tchanged.boxRange = next.boxRange;\n\t}\n\n\tif (prev.heading !== next.heading) {\n\t\tchanged.heading = next.heading;\n\t}\n\n\tif (prev.tilt !== next.tilt) {\n\t\tchanged.tilt = next.tilt;\n\t}\n\n\tif (prev.roll !== next.roll) {\n\t\tchanged.roll = next.roll;\n\t}\n\n\tif (\n\t\tprev.center.lat !== next.center.lat ||\n\t\tprev.center.lon !== next.center.lon\n\t) {\n\t\tchanged.center = {\n\t\t\tlat: next.center.lat,\n\t\t\tlon: next.center.lon,\n\t\t};\n\t}\n\n\treturn changed;\n}\n\n/**\n * Update navigator of given World Window\n * @param wwd {WorldWindow}\n * @param view {Object}\n */\nfunction update(wwd, view, width, height) {\n\tlet state = wwd.navigator;\n\tlet wwdUpdate = getWorldWindNavigatorFromViewParams(view, width, height);\n\n\tlet shouldRedraw = false;\n\n\tif (wwdUpdate.range && state.range !== wwdUpdate.range) {\n\t\tstate.range = wwdUpdate.range;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\t(wwdUpdate.tilt || wwdUpdate.tilt === 0) &&\n\t\tstate.tilt !== wwdUpdate.tilt\n\t) {\n\t\tstate.tilt = wwdUpdate.tilt;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\t(wwdUpdate.roll || wwdUpdate.roll === 0) &&\n\t\tstate.roll !== wwdUpdate.roll\n\t) {\n\t\tstate.roll = wwdUpdate.roll;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\t(wwdUpdate.heading || wwdUpdate.heading === 0) &&\n\t\tstate.heading !== wwdUpdate.heading\n\t) {\n\t\tstate.heading = wwdUpdate.heading;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\twwdUpdate.lookAtLocation &&\n\t\t(wwdUpdate.lookAtLocation.latitude ||\n\t\t\twwdUpdate.lookAtLocation.latitude === 0) &&\n\t\tstate.lookAtLocation.latitude !== wwdUpdate.lookAtLocation.latitude\n\t) {\n\t\tstate.lookAtLocation.latitude = wwdUpdate.lookAtLocation.latitude;\n\t\tshouldRedraw = true;\n\t}\n\n\tif (\n\t\twwdUpdate.lookAtLocation &&\n\t\t(wwdUpdate.lookAtLocation.longitude ||\n\t\t\twwdUpdate.lookAtLocation.longitude === 0) &&\n\t\tstate.lookAtLocation.longitude !== wwdUpdate.lookAtLocation.longitude\n\t) {\n\t\tstate.lookAtLocation.longitude = wwdUpdate.lookAtLocation.longitude;\n\t\tshouldRedraw = true;\n\t}\n\n\t// if (wwd.verticalExaggeration && wwdUpdate.elevation && wwd.verticalExaggeration !== wwdUpdate.elevation){\n\t// \twwd.verticalExaggeration = wwdUpdate.elevation;\n\t// \tshouldRedraw = true;\n\t// }\n\n\tif (shouldRedraw) {\n\t\twwd.redraw();\n\t}\n}\n\n/**\n * Convert view to World Wind Navigator params\n * @param view {Object}\n * @returns {WorldWind.Navigator}\n */\nfunction getWorldWindNavigatorFromViewParams(view, width, height) {\n\tlet {center, boxRange, ...navigator} = view;\n\n\tif (boxRange) {\n\t\tnavigator.range = viewUtils.getWorldWindRangeFromBoxRange(\n\t\t\tboxRange,\n\t\t\twidth,\n\t\t\theight\n\t\t);\n\t}\n\n\tif (center) {\n\t\tnavigator.lookAtLocation = {};\n\t\tif (center.lat || center.lat === 0) {\n\t\t\tnavigator.lookAtLocation.latitude = center.lat;\n\t\t}\n\t\tif (center.lon || center.lon === 0) {\n\t\t\tnavigator.lookAtLocation.longitude = center.lon;\n\t\t}\n\t}\n\n\treturn navigator;\n}\n\nfunction getViewParamsFromWorldWindNavigator(navigator, width, height) {\n\tlet view = {};\n\tlet {lookAtLocation, range} = navigator;\n\n\tif (range) {\n\t\tview.boxRange = viewUtils.getBoxRangeFromWorldWindRange(\n\t\t\trange,\n\t\t\twidth,\n\t\t\theight\n\t\t);\n\t}\n\n\tif (lookAtLocation) {\n\t\tview.center = {};\n\t\tif (lookAtLocation.latitude) {\n\t\t\tview.center.lat = lookAtLocation.latitude;\n\t\t}\n\t\tif (lookAtLocation.longitude) {\n\t\t\tview.center.lon = lookAtLocation.longitude;\n\t\t}\n\t}\n\n\tif (navigator.heading || navigator.heading === 0) {\n\t\tview.heading = navigator.heading;\n\t}\n\n\tif (navigator.tilt || navigator.tilt === 0) {\n\t\tview.tilt = navigator.tilt;\n\t}\n\n\tif (navigator.roll || navigator.roll === 0) {\n\t\tview.roll = navigator.roll;\n\t}\n\n\treturn view;\n}\n\nexport default {\n\tgetChangedViewParams,\n\tgetViewParamsFromWorldWindNavigator,\n\tupdate,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n\tisArray as _isArray,\n\tisEmpty as _isEmpty,\n\tsortBy as _sortBy,\n} from 'lodash';\nimport {CyclicPickController, utils, map as mapUtils} from '@gisatcz/ptr-utils';\n\nimport WorldWind from 'webworldwind-esa';\nimport decorateWorldWindowController from './controllers/WorldWindowControllerDecorator';\nimport layersHelpers from './layers/helpers';\nimport navigator from './navigator/helpers';\n\nimport './style.scss';\n\nimport LargeDataLayer from './layers/LargeDataLayerSource/LargeDataLayer';\n\nimport VectorLayer from './layers/VectorLayer';\n\nimport {mapConstants} from '@gisatcz/ptr-core';\nimport Context from '@gisatcz/cross-package-react-context';\nimport ReactResizeDetector from 'react-resize-detector';\nimport viewport from '../utils/viewport';\nconst HoverContext = Context.getContext('HoverContext');\nconst {WorldWindow, ElevationModel} = WorldWind;\n\nclass WorldWindMap extends React.PureComponent {\n\tstatic contextType = HoverContext;\n\n\tstatic defaultProps = {\n\t\televationModel: null,\n\t};\n\n\tstatic propTypes = {\n\t\tbackgroundLayer: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n\t\tlayers: PropTypes.array,\n\t\tname: PropTypes.string,\n\t\tview: PropTypes.object,\n\t\tviewLimits: PropTypes.object,\n\n\t\tonClick: PropTypes.func,\n\t\tonLayerClick: PropTypes.func,\n\t\tonViewChange: PropTypes.func,\n\n\t\televationModel: PropTypes.string,\n\t};\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.canvasId = utils.uuid();\n\n\t\tthis.state = {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t};\n\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onLayerHover = this.onLayerHover.bind(this);\n\t\tthis.onWorldWindHover = this.onWorldWindHover.bind(this);\n\t\tthis.onLayerClick = this.onLayerClick.bind(this);\n\t\tthis.onMouseOut = this.onMouseOut.bind(this);\n\t\tthis.onResize = this.onResize.bind(this);\n\t\tthis.onZoomLevelsBased = this.onZoomLevelsBased.bind(this);\n\n\t\tthis.onZoomLevelsBasedTimeout = null;\n\t\tthis.onZoomLevelsBasedStep = 0;\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.wwd = new WorldWindow(this.canvasId, this.getElevationModel());\n\n\t\tdecorateWorldWindowController(\n\t\t\tthis.wwd.worldWindowController,\n\t\t\tthis.props.viewLimits,\n\t\t\tthis.props.levelsBased\n\t\t);\n\t\tthis.wwd.worldWindowController.onNavigatorChanged = this.onNavigatorChange.bind(\n\t\t\tthis\n\t\t);\n\n\t\tif (this.props.levelsBased) {\n\t\t\t// rewrite default wheel listener.\n\t\t\tthis.wwd.eventListeners.wheel.listeners = [\n\t\t\t\tthis.onZoomLevelsBased.bind(this),\n\t\t\t];\n\t\t}\n\n\t\tnew CyclicPickController(\n\t\t\tthis.wwd,\n\t\t\t[\n\t\t\t\t'mousemove',\n\t\t\t\t'mousedown',\n\t\t\t\t'mouseup',\n\t\t\t\t'mouseout',\n\t\t\t\t'touchstart',\n\t\t\t\t'touchmove',\n\t\t\t\t'touchend',\n\t\t\t],\n\t\t\tthis.onWorldWindHover,\n\t\t\ttrue\n\t\t);\n\t\tthis.updateNavigator(mapConstants.defaultMapView);\n\t\tthis.updateLayers();\n\t}\n\n\tonZoomLevelsBased(e) {\n\t\te.preventDefault();\n\n\t\tif (e.wheelDelta) {\n\t\t\tthis.onZoomLevelsBasedStep += e.wheelDelta;\n\n\t\t\tif (this.onZoomLevelsBasedTimeout) {\n\t\t\t\tclearTimeout(this.onZoomLevelsBasedTimeout);\n\t\t\t}\n\n\t\t\tthis.onZoomLevelsBasedTimeout = setTimeout(() => {\n\t\t\t\tlet zoomLevel = mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\tthis.props.view.boxRange,\n\t\t\t\t\tthis.state.width,\n\t\t\t\t\tthis.state.height\n\t\t\t\t);\n\n\t\t\t\tif (this.onZoomLevelsBasedStep > 300) {\n\t\t\t\t\tzoomLevel += 3;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep > 150) {\n\t\t\t\t\tzoomLevel += 2;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep > 0) {\n\t\t\t\t\tzoomLevel++;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep < -300) {\n\t\t\t\t\tzoomLevel -= 3;\n\t\t\t\t} else if (this.onZoomLevelsBasedStep < -150) {\n\t\t\t\t\tzoomLevel -= 2;\n\t\t\t\t} else {\n\t\t\t\t\tzoomLevel--;\n\t\t\t\t}\n\n\t\t\t\tlet levelsRange = mapConstants.defaultLevelsRange;\n\t\t\t\tconst boxRangeRange =\n\t\t\t\t\tthis.props.viewLimits && this.props.viewLimits.boxRangeRange;\n\t\t\t\tconst maxLevel =\n\t\t\t\t\tboxRangeRange && boxRangeRange[0]\n\t\t\t\t\t\t? mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\t\t\tboxRangeRange[0],\n\t\t\t\t\t\t\t\tthis.state.width,\n\t\t\t\t\t\t\t\tthis.state.height\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: levelsRange[1];\n\t\t\t\tconst minLevel =\n\t\t\t\t\tboxRangeRange && boxRangeRange[1]\n\t\t\t\t\t\t? mapUtils.view.getZoomLevelFromBoxRange(\n\t\t\t\t\t\t\t\tboxRangeRange[1],\n\t\t\t\t\t\t\t\tthis.state.width,\n\t\t\t\t\t\t\t\tthis.state.height\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: levelsRange[0];\n\n\t\t\t\tlevelsRange = [minLevel, maxLevel];\n\n\t\t\t\tlet finalZoomLevel = zoomLevel;\n\t\t\t\tif (finalZoomLevel > levelsRange[1]) {\n\t\t\t\t\tfinalZoomLevel = levelsRange[1];\n\t\t\t\t} else if (finalZoomLevel < levelsRange[0]) {\n\t\t\t\t\tfinalZoomLevel = levelsRange[0];\n\t\t\t\t}\n\n\t\t\t\tconst boxRange = mapUtils.view.getBoxRangeFromZoomLevel(\n\t\t\t\t\tfinalZoomLevel,\n\t\t\t\t\tthis.state.width,\n\t\t\t\t\tthis.state.height\n\t\t\t\t);\n\t\t\t\tif (this.props.onViewChange) {\n\t\t\t\t\tthis.props.onViewChange({\n\t\t\t\t\t\tboxRange,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.onZoomLevelsBasedTimeout = null;\n\t\t\t\tthis.onZoomLevelsBasedStep = 0;\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif (prevProps) {\n\t\t\tif (this.props.view && prevProps.view !== this.props.view) {\n\t\t\t\tthis.updateNavigator();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tprevProps.layers !== this.props.layers ||\n\t\t\t\tprevProps.backgroundLayer !== this.props.backgroundLayer\n\t\t\t) {\n\t\t\t\tthis.updateLayers();\n\t\t\t}\n\n\t\t\tif (this.context && this.context.hoveredItems) {\n\t\t\t\tconst currentHoveredItemsString = JSON.stringify(\n\t\t\t\t\t_sortBy(this.context.hoveredItems)\n\t\t\t\t);\n\t\t\t\tif (currentHoveredItemsString !== this.previousHoveredItemsString) {\n\t\t\t\t\tthis.updateHoveredFeatures();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateLayers() {\n\t\tlet layers = [];\n\t\tif (this.props.backgroundLayer) {\n\t\t\t// TODO fix for compatibility\n\t\t\tlet backgroundLayers = _isArray(this.props.backgroundLayer)\n\t\t\t\t? this.props.backgroundLayer\n\t\t\t\t: [this.props.backgroundLayer];\n\n\t\t\tbackgroundLayers.forEach(layer => {\n\t\t\t\tlayers.push(layersHelpers.getLayerByType(layer, this.wwd));\n\t\t\t});\n\t\t}\n\n\t\tif (this.props.layers) {\n\t\t\tthis.props.layers.forEach(layer => {\n\t\t\t\tconst mapLayer = layersHelpers.getLayerByType(\n\t\t\t\t\tlayer,\n\t\t\t\t\tthis.wwd,\n\t\t\t\t\tthis.onLayerHover,\n\t\t\t\t\tthis.onLayerClick,\n\t\t\t\t\tthis.props.pointAsMarker\n\t\t\t\t);\n\t\t\t\tlayers.push(mapLayer);\n\t\t\t});\n\t\t}\n\n\t\tthis.invalidateLayers(this.wwd.layers);\n\t\tthis.wwd.layers = layers;\n\t\tthis.wwd.redraw();\n\t}\n\n\tinvalidateLayers(previousLayers) {\n\t\tpreviousLayers.forEach(prevLayer => {\n\t\t\tif (prevLayer instanceof LargeDataLayer) {\n\t\t\t\tprevLayer.removeListeners();\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateHoveredFeatures() {\n\t\tthis.wwd.layers.forEach(layer => {\n\t\t\tif (layer instanceof LargeDataLayer) {\n\t\t\t\tlayer.updateHoveredKeys(\n\t\t\t\t\tthis.context.hoveredItems,\n\t\t\t\t\tthis.context.x,\n\t\t\t\t\tthis.context.y\n\t\t\t\t);\n\t\t\t} else if (layer instanceof VectorLayer) {\n\t\t\t\tlayer.updateHoveredFeatures(this.context.hoveredItems);\n\t\t\t}\n\t\t});\n\t\tthis.wwd.redraw();\n\t\tthis.previousHoveredItemsString = JSON.stringify(\n\t\t\t_sortBy(this.context.hoveredItems)\n\t\t);\n\t}\n\n\tupdateNavigator(defaultView) {\n\t\tconst viewport = this.wwd.viewport;\n\t\tlet width = this.state.width || viewport.width;\n\t\tlet height = this.state.height || viewport.height;\n\n\t\tlet currentView =\n\t\t\tdefaultView ||\n\t\t\tnavigator.getViewParamsFromWorldWindNavigator(\n\t\t\t\tthis.wwd.navigator,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\t\tlet nextView = {...currentView, ...this.props.view};\n\t\tnavigator.update(this.wwd, nextView, width, height);\n\t}\n\n\t/**\n\t * @returns {null | elevation}\n\t */\n\tgetElevationModel() {\n\t\tswitch (this.props.elevationModel) {\n\t\t\tcase 'default':\n\t\t\t\treturn null;\n\t\t\tcase null:\n\t\t\t\tconst elevation = new ElevationModel();\n\t\t\t\televation.removeAllCoverages();\n\t\t\t\treturn elevation;\n\t\t}\n\t}\n\n\tonNavigatorChange(event) {\n\t\tif (event) {\n\t\t\tconst viewParams = navigator.getViewParamsFromWorldWindNavigator(\n\t\t\t\tevent,\n\t\t\t\tthis.state.width,\n\t\t\t\tthis.state.height\n\t\t\t);\n\t\t\tconst changedViewParams = navigator.getChangedViewParams(\n\t\t\t\t{...mapConstants.defaultMapView, ...this.props.view},\n\t\t\t\tviewParams\n\t\t\t);\n\n\t\t\tif (this.props.onViewChange) {\n\t\t\t\tif (!_isEmpty(changedViewParams)) {\n\t\t\t\t\tif (this.props.delayedWorldWindNavigatorSync) {\n\t\t\t\t\t\tif (this.changedNavigatorTimeout) {\n\t\t\t\t\t\t\tclearTimeout(this.changedNavigatorTimeout);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.changedNavigatorTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tthis.props.onViewChange(changedViewParams);\n\t\t\t\t\t\t}, this.props.delayedWorldWindNavigatorSync);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.props.onViewChange(changedViewParams);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonClick() {\n\t\tif (this.props.onClick) {\n\t\t\tconst {width, height} = this.wwd.viewport;\n\t\t\tlet currentView = navigator.getViewParamsFromWorldWindNavigator(\n\t\t\t\tthis.wwd.navigator,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\t\t\tthis.props.onClick(currentView);\n\t\t}\n\t}\n\n\tonMouseOut() {\n\t\tif (this.context && this.context.onHoverOut) {\n\t\t\tthis.context.onHoverOut();\n\t\t}\n\t}\n\n\tonLayerHover(layerKey, featureKeys, x, y, popupContent, data, fidColumnName) {\n\t\t// pass data to popup\n\t\tif (this.context && this.context.onHover && featureKeys.length) {\n\t\t\tthis.context.onHover(featureKeys, {\n\t\t\t\tpopup: {\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tcontent: popupContent,\n\t\t\t\t\tdata,\n\t\t\t\t\tfidColumnName,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tonLayerClick(layerKey, featureKeys) {\n\t\tif (this.props.onLayerClick) {\n\t\t\tthis.props.onLayerClick(this.props.mapKey, layerKey, featureKeys);\n\t\t}\n\t}\n\n\tonWorldWindHover(renderables, event) {\n\t\t// TODO can be hovered more than one renderable at one time?\n\t\tif (renderables.length && renderables.length === 1) {\n\t\t\t// TODO is this enough?\n\t\t\tconst layerPantherProps = renderables[0].parentLayer.pantherProps;\n\n\t\t\tconst data = renderables[0].userObject.userProperties;\n\t\t\tconst featureKeys = [data[layerPantherProps.fidColumnName]];\n\n\t\t\t// TODO add support for touch events\n\t\t\tif (event.type === 'mousedown' && layerPantherProps.selectable) {\n\t\t\t\tthis.onLayerClick(layerPantherProps.layerKey, featureKeys);\n\t\t\t} else if (layerPantherProps.hoverable) {\n\t\t\t\tthis.onLayerHover(\n\t\t\t\t\tlayerPantherProps.layerKey,\n\t\t\t\t\tfeatureKeys,\n\t\t\t\t\tevent.pageX,\n\t\t\t\t\tevent.pageY,\n\t\t\t\t\t<div>{featureKeys.join(',')}</div>,\n\t\t\t\t\tdata,\n\t\t\t\t\tlayerPantherProps.fidColumnName\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (this.context && this.context.onHoverOut) {\n\t\t\tthis.context.onHoverOut();\n\t\t}\n\t}\n\n\tonResize(width, height) {\n\t\theight = viewport.roundDimension(height);\n\t\twidth = viewport.roundDimension(width);\n\n\t\tthis.setState({\n\t\t\twidth,\n\t\t\theight,\n\t\t});\n\t\tthis.updateNavigator();\n\t\tif (this.props.onResize) {\n\t\t\tthis.props.onResize(width, height);\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ReactResizeDetector\n\t\t\t\t\thandleHeight\n\t\t\t\t\thandleWidth\n\t\t\t\t\tonResize={this.onResize}\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"ptr-map ptr-world-wind-map\"\n\t\t\t\t\tonClick={this.onClick}\n\t\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\t>\n\t\t\t\t\t<canvas className=\"ptr-world-wind-map-canvas\" id={this.canvasId}>\n\t\t\t\t\t\tYour browser does not support HTML5 Canvas.\n\t\t\t\t\t</canvas>\n\t\t\t\t</div>\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default WorldWindMap;\n","export default () => <p>render only on server</p>;\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from './presentationEmpty';\n\nconst LoadableMapControls = Loadable({\n\tloader: () => {\n\t\treturn isServer ? import('./presentationEmpty') : import('../MapControls');\n\t},\n\trender(loaded, props) {\n\t\tlet MapControls = loaded.default;\n\t\treturn <MapControls {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <div>Error!</div>;\n\t\t} else {\n\t\t\treturn <div>Loading...</div>;\n\t\t}\n\t},\n});\n\nconst isomorphicLoadableMapControls = props => {\n\treturn isServer ? <PresentationEmpty /> : <LoadableMapControls {...props} />;\n};\nexport default isomorphicLoadableMapControls;\n","import React from 'react';\n\n//TODO - add placeholder for each component\nexport default () => {\n\treturn null;\n};\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from '../LoadableMap/presentationEmpty';\n\nconst LoadableMapSet = Loadable({\n\tloader: () => {\n\t\treturn isServer\n\t\t\t? import('../LoadableMap/presentationEmpty')\n\t\t\t: import('../MapSet/index.js');\n\t},\n\trender(loaded, props) {\n\t\tlet MapSet = loaded.default;\n\t\treturn <MapSet {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <span>Error!</span>;\n\t\t} else {\n\t\t\treturn <span>Loading...</span>;\n\t\t}\n\t},\n});\n\nconst isomorphicMapSet = props => {\n\treturn isServer ? <PresentationEmpty /> : <LoadableMapSet {...props} />;\n};\nexport default isomorphicMapSet;\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from '../LoadableMap/presentationEmpty';\n\nconst LoadableReactLeafletMap = Loadable({\n\tloader: () => {\n\t\treturn isServer\n\t\t\t? import('../LoadableMap/presentationEmpty')\n\t\t\t: import('../ReactLeafletMap');\n\t},\n\trender(loaded, props) {\n\t\tlet ReactLeafletMap = loaded.default;\n\t\treturn <ReactLeafletMap {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <div>Error!</div>;\n\t\t} else {\n\t\t\treturn <div>Loading...</div>;\n\t\t}\n\t},\n});\n\nconst isomorphicLoadableReactLeafletMap = props => {\n\treturn isServer ? (\n\t\t<PresentationEmpty />\n\t) : (\n\t\t<LoadableReactLeafletMap {...props} />\n\t);\n};\nexport default isomorphicLoadableReactLeafletMap;\n","import React from 'react';\nimport Loadable from 'react-loadable';\nimport {isServer} from '@gisatcz/ptr-core';\nimport PresentationEmpty from './presentationEmpty';\n\nconst LoadableMap = Loadable({\n\tloader: () => {\n\t\treturn isServer\n\t\t\t? import('../LoadableMap/presentationEmpty')\n\t\t\t: import('../Map');\n\t},\n\trender(loaded, props) {\n\t\tlet PresentationMap = loaded.default;\n\t\treturn <PresentationMap {...props} />;\n\t},\n\tloading: props => {\n\t\tif (props.error) {\n\t\t\treturn <span>Error!</span>;\n\t\t} else {\n\t\t\treturn <span>Loading...</span>;\n\t\t}\n\t},\n});\n\nconst isomorphicMap = props => {\n\treturn isServer ? <PresentationEmpty /> : <LoadableMap {...props} />;\n};\nexport default isomorphicMap;\n","import constants from './constants';\nimport view from './utils/view';\nimport GoToPlace from './controls/GoToPlace';\nimport MapGrid from './MapGrid';\nimport MapControls from './controls/MapControls';\nimport MapSet, {MapSetMap, MapSetPresentationMap} from './MapSet';\nimport MapTools from './controls/MapTools';\nimport MapWrapper from './MapWrapper';\nimport PresentationMap from './Map';\nimport ReactLeafletMap from './ReactLeafletMap';\nimport SimpleLayersControl from './controls/SimpleLayersControl';\nimport WorldWindMap from './WorldWindMap';\n\n//loadable\nimport LoadableMapControls from './controls/LoadableMapControls';\nimport LoadableMapSet from './LoadableMapSet';\nimport LoadableReactLeafletMap from './LoadableReactLeafletMap';\nimport LoadableMap from './LoadableMap';\n\nexport {\n\tconstants,\n\tview,\n\tGoToPlace,\n\tLoadableMapControls,\n\tLoadableMapSet,\n\tLoadableReactLeafletMap,\n\tLoadableMap,\n\tMapControls,\n\tMapGrid,\n\tMapTools,\n\tMapSetMap,\n\tMapSetPresentationMap,\n\tMapSet,\n\tMapWrapper,\n\tPresentationMap,\n\tReactLeafletMap,\n\tSimpleLayersControl,\n\tWorldWindMap,\n};\n\nexport default {\n\tconstants,\n\tview,\n\n\tGoToPlace,\n\n\tLoadableMapControls,\n\tLoadableMapSet,\n\tLoadableReactLeafletMap,\n\tLoadableMap,\n\n\tMapControls,\n\tMapGrid,\n\tMapSetMap,\n\tMapSetPresentationMap,\n\tMapSet,\n\tMapWrapper,\n\tMapTools,\n\tPresentationMap,\n\tSimpleLayersControl,\n\tReactLeafletMap,\n\tWorldWindMap,\n};\n"],"names":["defaultVectorFeatureStyle","fill","fillOpacity","outlineColor","outlineWidth","outlineOpacity","selectedVectorFeatureStyle","hoveredVectorFeatureStyle","selectedHoveredVectorFeatureStyle","vectorFeatureStyle","defaultFull","rules","styles","hovered","selected","selectedHovered","defaultDiagramStyle","diagramFill","diagramFillOpacity","diagramOutlineColor","diagramOutlineWidth","diagramOutlineOpacity","selectedDiagramStyle","hoveredDiagramStyle","selectedHoveredDiagramStyle","diagramStyle","vectorLayerHighlightedFeatureStyle","strokeColor","strokeWidth","vectorLayerDefaultFeatureStyle","fillColor","defaultLeafletPaneZindex","maxFeaturesAsReactElement","projDefinitions","epsg5514","getBoxRangeFromWorldWindRange","range","width","height","getWorldWindRangeFromBoxRange","boxRange","isBoxRangeInRange","fitsInLimits","noLowerLimitLessThanUpper","noUpperLimitMoreThanLower","getCenterWhichFitsLimits","center","limit","updatedLat","updatedLon","givenLat","lat","givenLon","lon","maxLat","maxLon","minLat","minLon","GoToPlace","props","state","text","previousSearching","search","bind","onTextChange","setState","e","charCode","goToPlace","React","PureComponent","propTypes","PropTypes","func","MapGrid","ref","createRef","resize","window","addEventListener","passive","current","clientWidth","clientHeight","renderMaps","availableWidth","availableHeight","children","length","sizeRatio","rows","columns","toFixed","style","map","index","rowNo","Math","ceil","colNo","wrapperClasses","classNames","MapControls","tiltIncrement","headingIncrement","zoomIncrement","exaggerationIncrement","resetHeadingDisabled","prevProps","prevState","snapshot","view","heading","update","tilt","updateView","mapKey","levelsBased","resetHeading","type","definedLimits","viewLimits","boxRangeRange","currentBoxRange","currentLevel","mapUtils","getZoomLevelFromBoxRange","mapWidth","mapHeight","maxZoom","mapConstants","defaultLevelsRange","definedLimitAsLevel","minZoom","minBoxRange","maxBoxRange","handleZoomIn","isZoomButtonActive","handleZoomOut","zoomOnly","handleHeadingRight","handleResetHeading","transform","handleHeadingLeft","handleTiltDown","handleTiltUp","object","string","bool","oneOfType","array","number","MapWrapper","active","onMapRemove","renderCloseButton","title","renderTitle","name","stateMapKey","defaultProps","Map","PresentationMap","MapSet","stateMapSetKey","mergeViews","defaultMapView","activeMapKey","mapViews","mapsDimensions","child","connectedMapComponent","onMount","onUnmount","layers","backgroundLayer","refreshUse","syncUpdate","ensureViewIntegrity","sync","updateVal","updateKey","mergedView","onViewChange","key","renderControls","activeMapDimensions","activeMapView","activeMapViewport","onResetHeading","Children","cloneElement","maps","onResize","onMapResize","push","renderMap","mapComponent","restProps","mergeLayers","onClick","onMapClick","renderWrapper","wrapper","wrapperProps","disableMapRemoval","allProps","wrapperComponent","prototype","isReactComponent","createElement","mapSetKey","elementType","element","MapSetMap","MapSetPresentationMap","onPropViewChange","getValidView","saveViewChange","checkViewEquality","onViewChangeDecorator","Error","renderContent","viewport","getLeafletViewFromViewParams","completeView","zoom","lng","getLeafletViewportFromViewParams","leafletView","stateCenter","getCenter","stateZoom","getZoom","leafletUpdate","setView","svgSize","offset","className","Cross","svg","Pin","icon","cross","anchorPoint","component","pin","MarkerShape","iconAnchor","basicShape","id","shape","onMouseMove","onMouseOver","onMouseOut","oldShape","div","tagName","document","html","getShapeHtml","Element","appendChild","innerHTML","_setIconStyles","helpers","getMarkerShapeCssStyle","ReactDOMServer","renderToString","finalShape","getMarkerShapeSvgStyle","getShapeWithIcon","getShape","getIcon","componentProps","weight","iconStyle","iconFill","shapeStyle","stroke","iconProps","iconComponent","isBasicShape","getElementById","value","L","DivIcon","getDefaultStyleObject","feature","styleDefinition","mapStyle","getStyleObject","properties","constants","getSelectedStyleObject","selectedStyleDefinition","getFeatureDefaultStyle","defaultStyleObject","getFeatureLeafletStyle","getFeatureAccentedStyle","accentedStyleObject","size","volume","finalStyle","color","opacity","geometry","radius","sqrt","PI","convertCoordinatesMemo","memoize","flippedFeature","flip","coordinates","getDefaultStyle","calculateStyle","hoveredStyleDefinition","selectedHoveredStyleDefinition","defaultStyle","hoveredStyleObject","hoveredStyle","selectedStyle","selectedHoveredStyle","selectedHoveredStyleObject","calculateStylesMemo","getMarkerShape","options","shapeKey","iconKey","anchorShift","anchorPositionX","anchorPositionY","shapes","icons","leafletStyle","getMarkerShapeSquareStyle","getMarkerShapeCircleStyle","rotation","borderRadius","rgb","hexToRgb","r","g","b","strokeOpacity","setTransform","el","scale","pos","TRANSFORM","ie3d","x","y","CanvasLayer","extend","initialize","_paneName","paneName","_paneZindex","paneZindex","_map","_canvas","_frame","_delegate","delegate","del","needRedraw","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","newSize","_onLayerDidMove","topLeft","containerPointToLayerPoint","_topLeft","setPosition","_onLayerDidZoom","getEvents","events","moveend","zoomAnimation","any3d","zoomanim","_animateZoom","onAdd","create","tiles","getSize","animated","addClass","pane","getPane","createPane","zIndex","on","onLayerDidMount","onRemove","onLayerWillUnmount","cancelAnimFrame","removeChild","off","addTo","addLayer","LatLonToMercator","latlon","log","tan","bounds","getBounds","corner","containerPointToLatLng","onDrawLayer","layer","canvas","_setTransform","getZoomScale","_latLngBoundsToNewLayerBounds","min","_getCenterOffset","_multiplyBy","subtract","_getMapPanePos","setPolygonStyle","context","fillStyle","chroma","alpha","hex","lineWidth","strokeStyle","lineJoin","setLineStyle","lineCap","definedSize","pixelSizeInMeters","draw","square","circle","a","beginPath","rect","closePath","arc","floor","drawPolygon","forEach","linearRing","start","rest","slice","moveTo","point","lineTo","drawMultiPolygon","polygon","drawLine","LeafletCanvasLayer","customEvents","click","onLayerClick","boundsToQuery","getSouthWest","getNorthEast","isPointInsideBounds","selectable","pointsInsideBounds","selectedPolygons","mousePoint","containerPoint","self","features","original","LatLngBounds","add","BoundingBox","pointFeature","turfPoint","insidePolygon","booleanPointInPolygon","position","nearest","nearestPoint","layerKey","fidColumnName","setProps","data","prepareFeatures","pointFeatures","polygonFeatures","lineFeatures","fid","preparedFeature","selection","keys","params","getContext","clearRect","drawImage","renderOffScreen","offScreenCanvas","pointAsMarker","getPixelSizeInLevelsForLatitude","pixelSizeInLevels","i","omitFeature","omittedFeatureKeys","drawFeature","ctx","latLngToContainerPoint","getPolygonCoordinates","polygons","getLineCoordinates","lines","line","CanvasVectorLayer","uniqueLayerKey","fromProps","toProps","leafletElement","MapLayer","withLeaflet","geojsonRbush","require","getBoundingBox","crs","optLat","calculatedBoxRange","getNearestZoomLevelBoxRange","getBoundingBoxFromViewForEpsg3857","IndexedVectorLayer","rerender","indexTree","repopulateIndexTreeIfNeeded","clear","load","boxRangeFitsLimits","bbox","averageLatitude","geoJsonBbox","foundFeatureCollection","foundFeatures","HoverContext","Context","contextWrapper","WrappedFeature","hoveredFromContext","changeContext","hoveredItems","onHover","onHoverOut","hoverable","contextType","Feature","shapeId","uniqueFeatureKey","utils","uuid","calculateStyles","convertCoordinates","hasOwnProperty","showOnTop","showOnBottom","event","target","leafletFeature","popup","originalEvent","pageX","pageY","bringToFront","bringToBack","renderPolygon","renderPoint","renderLine","renderShape","shallowEqualObjects","setStyle","interactive","ContextWrapper","GeoJsonLayer","getStyle","filter","onEachFeature","pointToLayer","getRenderId","geometryType","isPolygon","isLine","onFeatureClick","mousemove","mouseout","coord","circleMarker","marker","featureKey","item","SvgVectorLayer","pointsPaneName","linesPaneName","polygonsPaneName","sortedPointFeatures","sortedPolygonFeatures","points","prepareData","classes","classnames","withSelectedFeaturesOnly","renderFeatures","renderAsGeoJson","renderGeoJson","renderFeature","resources","getFeatureKeysToOmit","featureKeysGroupedByTileKey","tileKey","indexOfCurrentTile","tile","featureKeysToOmit","renderedFeatureKeys","Set","featureKeys","has","checkIdentity","prev","next","prevKeys","nextKeys","sort","Tile","renderingTechnique","level","getTileKey","JSON","stringify","getFeaturesGroupedByTileKey","selections","groupedFeatures","groupedFeatureKeys","tileFeatureKeys","selectionKey","unshift","Object","values","TiledVectorLayer","VectorLayer","renderAs","renderAsData","renderAsItem","getOptions","renderTiledVectorLayer","renderBasicVectorLayer","wms","obj","result","Source","untiled","identify","url","tiled","_url","_subLayers","_overlay","createOverlay","overlayOptions","opt","overlay","tileLayer","refreshOverlay","setParams","subLayers","join","remove","setOpacity","isBack","getLayer","addSubLayer","removeSubLayer","evt","getIdentifyLayers","getFeatureInfo","latlng","showFeatureInfo","callback","getFeatureInfoParams","getParamString","showWaiting","ajax","done","hideWaiting","parseFeatureInfo","call","identifyLayers","wmsParams","updateWmsParams","infoParams","request","query_layers","X","round","Y","info","openPopup","_container","cursor","source","Layer","layerName","getSourceForUrl","_source","_name","sources","TileLayer","WMS","Overlay","defaultWmsParams","service","version","format","transparent","uppercase","attribution","opts","getAttribution","_currentOverlay","removeLayer","_currentUrl","getImageUrl","once","_swap","wmsVersion","parseFloat","projectionKey","nw","project","getNorthWest","se","getSouthEast","code","EPSG4326","pstr","XMLHttpRequest","onreadystatechange","change","open","send","readyState","status","responseText","EVENTS_RE","WMSLayer","singleTile","restParams","_l","leaflet","prevUrl","setUrl","isEqual","superOptions","reduce","test","getBoxRange","TileGridLayer","undefined","tileGrid","getTileGridLevel","tileGridUtils","getGridSizeForLevel","geojsonTileGrid","getTileGridAsGeoJSON","viewportRange","getMapViewportRange","nearestBoxRange","grid","getLevelByViewport","markers","acc","row","rowMarkers","recalculatedBoxrange","getTileGrid","geoJsonTileGrid","getGeoJsonTileGrid","tilesMarkers","getTilesMarkers","roundDimension","dimension","ReactLeafletMap","getCRS","onViewportChanged","originalInitTile","GridLayer","_initTile","include","tileSize","getTileSize","CRS","Proj","resolutions","EPSG3857","viewUtils","Number","isFinite","getBoxRangeFromZoomLevel","hasResized","random","pow","leafletMap","_size","widthChange","abs","heightChange","invalidateSize","setZoomLevelsBounds","viewHelpers","backgroundLayersSource","backgroundLayersZindex","backgroundLayers","getLayerByType","baseLayersZindex","debugTileGrid","bottom","tileGridLayer","getTileLayer","getWmsTileLayer","getVectorLayer","getTileGridLayer","restOptions","urls","o","imageFormat","reservedParamsKeys","restParameters","entries","includes","isRequired","SimpleLayersControl","onControlButtonClick","onBlur","setTimeout","onSelect","buttonClasses","renderMenu","tileWidth","tileHeight","tileMargin","contentMargin","getGrid","menuClasses","right","left","menuStyle","contentStyle","margin","renderTile","activeLayer","thumbnail","onLayerTileClick","count","Angle","WorldWind","WWMath","basicController","applyLimits","navigator","wwd","currentRange","lookAtLocation","latitude","clamp","longitude","normalizedDegreesLongitude","normalizedDegrees","roll","globe","is2D","enable2DLimits","maxRange","equatorialRadius","onNavigatorChanged","pantherProps","addFeatures","geojson","parser","GeoJSONParser","shapeConfigurationCallback","getStyleDefinition","userProperties","renderablesAddCallback","renderables","renderable","applyStyles","fids","getSelection","applyWorldWindStyles","styleObject","fillRgb","interiorColor","Color","TRANSPARENT","outlineRgb","selectionDefintion","selectedStyleObject","attributes","RenderableLayer","Location","Sector","MercatorTiledImageLayer","OsmLayer","displayName","pickEnabled","destCanvas","destContext","urlBuilder","urlForTile","levelNumber","column","doRender","dc","topLevelTiles","createTile","levels","firstLevel","ArgumentError","Logger","WikimediaLayer","imageSize","sourceObject","logMessage","LEVEL_SEVERE","buildSourceUrl","_attribution","_imageType","imageType","cachePath","detailControl","numLevels","prefix","buildPrefix","prefixes","protocol","host","path","WmsLayer","worldWindOptions","layerNames","levelZeroDelta","sector","styleNames","attributions","customParams","time","screenCreditController","WmtsLayer","template","uriTemplates","varNames","numberOfUrls","s","z","WWUtil","suffixForMimeType","arrow","x0","y0","x1","y1","ellipse","cx","cy","rx","ry","save","translate","fillPolygon","nodes","node","rectangle","dx","dy","restore","globalAlpha","LargeDataLayerTile","_data","_style","_fidColumnName","_hovered","_hoveredStyle","sel","selectedDef","_selected","_sector","createCanvas","_width","_height","tileCenterLatitude","maxLatitude","minLatitude","_latitudeFactor","cos","toDataURL","dataPoint","isHovered","isSelected","indexOf","circleWithArrow","diamond","triangle","getCenterCoordinates","edgeLength","diagonalLength","ty","direction","arrowDirection","arrowLength","arrowColor","arrowWidth","DEFAULT_SIZE","longitudeInSector","latitudeInSector","sizeOfArea","locationInArea","maxLongitude","minLongitude","REDRAW_EVENT_TYPE","SurfaceCircle","TiledImageLayer","LargeDataLayer","processedTiles","quadTree","QuadTree","Box","pointHoverBuffer","loadData","removeEventListener","fetch","then","json","file","centroid","Point","turfCentroid","insert","refresh","touches","clientX","clientY","terrainObject","pickTerrain","canvasCoordinates","buffer","getPointHoverBuffer","query","Circle","targetPoint","featureCollection","turfFeatureCollection","onMouseMoveResult","handleEvent","onClickResult","gids","suppressRedraw","imagePath","extended","calculateExtendedSector","filterGeographically","cache","gpuResourceCache","createPointTile","texture","createTexture","removeFromCurrentRetrievals","putResource","currentTilesInvalid","absentResourceList","unmarkResourceAbsent","createEvent","initEvent","dispatchEvent","extensionFactorWidth","extensionFactorHeight","latitudeChange","longitudeChange","hoveredKeys","currentTiles","previousHoveredCoordinates","latDiff","lonDiff","latBuffer","lonBuffer","previouslyHovered","retrieveTileImage","drawContext","canvasWidth","bufferInMeters","layerDefinition","BingAerialLayer","BMNGLayer","updateVectorLayer","mapLayer","worldWindLayer","lay","prevFeatures","nextFeatures","removeListeners","getChangedViewParams","changed","wwdUpdate","getWorldWindNavigatorFromViewParams","shouldRedraw","redraw","getViewParamsFromWorldWindNavigator","WorldWindow","ElevationModel","WorldWindMap","canvasId","onLayerHover","onWorldWindHover","onZoomLevelsBased","onZoomLevelsBasedTimeout","onZoomLevelsBasedStep","getElevationModel","decorateWorldWindowController","worldWindowController","onNavigatorChange","eventListeners","wheel","listeners","CyclicPickController","updateNavigator","updateLayers","preventDefault","wheelDelta","clearTimeout","zoomLevel","levelsRange","maxLevel","minLevel","finalZoomLevel","currentHoveredItemsString","previousHoveredItemsString","updateHoveredFeatures","layersHelpers","invalidateLayers","previousLayers","prevLayer","updateHoveredKeys","defaultView","currentView","nextView","elevationModel","elevation","removeAllCoverages","viewParams","changedViewParams","delayedWorldWindNavigatorSync","changedNavigatorTimeout","popupContent","content","layerPantherProps","parentLayer","userObject","LoadableMapControls","Loadable","loader","isServer","render","loaded","loading","error","isomorphicLoadableMapControls","LoadableMapSet","isomorphicMapSet","PresentationEmpty","LoadableReactLeafletMap","isomorphicLoadableReactLeafletMap","LoadableMap","isomorphicMap","MapTools"],"mappings":"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"}